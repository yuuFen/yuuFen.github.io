<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://yuufen.com/blog</id>
    <title>YuuFen</title>
    <updated>2020-03-15T22:25:21.591Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://yuufen.com/blog"/>
    <link rel="self" href="https://yuufen.com/blog/atom.xml"/>
    <subtitle>å¸Œæœ›ä½ å¯ä»¥è®°ä½æˆ‘</subtitle>
    <logo>https://yuufen.com/blog/images/avatar.png</logo>
    <icon>https://yuufen.com/blog/favicon.ico</icon>
    <rights>All rights reserved 2020, YuuFen</rights>
    <entry>
        <title type="html"><![CDATA[ä½ å¥½å‘€ï¼Œé™Œç”Ÿäºº]]></title>
        <id>https://yuufen.com/blog/post/about/</id>
        <link href="https://yuufen.com/blog/post/about/">
        </link>
        <updated>2024-02-28T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤</p>
</blockquote>
<h2 id="å…³äºæœ¬ç«™">ğŸ  å…³äºæœ¬ç«™</h2>
<p>å› ä¸ºç¬”è®°å¤ªå¤šå¤ªæ‚ï¼Œå†³å®šå®šæœŸå†™å†™åšå®¢æ•´ç†æ•´ç†ç¬”è®°ã€‚</p>
<p><s>ç„¶åå› ä¸ºå„ç§åŸå› å¤±å»äº†åŠ¨åŠ›</s></p>
<p><s>å› æ­¤æä¸¢äº†å¥½å¤šç¬”è®°å•Šå•Šå•Šå•Šå•Šå•Šå•ŠğŸ˜­ğŸ˜­ğŸ˜­</s></p>
<p><s>çœ‹äº†çœ‹ä¸€å¹´å‰çš„åšæ–‡å‘ç°è‡ªå·±çœŸçš„å˜åŒ–äº†è›®å¤šçš„ï¼ˆåŠ æ²¹ğŸ’ªï¼‰</s></p>
<p>æ€»ä¹‹ç°åœ¨åˆå¼€å§‹äº†</p>
<h2 id="å…³äºæˆ‘">ğŸŸ å…³äºæˆ‘</h2>
<p>æˆ‘ç›®å‰å¤§äºŒåœ¨è¯»ï¼Œæˆ‘çš„èŒä¸šè§„åˆ’æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œæˆ‘çš„ä¸“ä¸šæ˜¯ç”µå­ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘è¿˜äº†è§£ä¸€äº›åµŒå…¥å¼å¼€å‘ï¼ˆå½“ç„¶åªæ˜¯ä¸€äº›äº›ï¼‰ï¼Œå¯¹Pythonå’ŒTensorFlowä¹Ÿæœ‰ä¸€å®šçš„æ¶‰çŒã€‚æˆ‘æ­£åœ¨åŠªåŠ›å¯»æ‰¾æš‘æœŸå®ä¹ ï¼</p>
<p>åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æœ‰å…³æˆ‘çš„æ›´å¤šä¿¡æ¯ï¼š</p>
<p><a href="https://yuufen.com/" target="_blank" class="text-button">ä¸»é¡µ</a><a href="https://yuufen.com/blog" target="_blank" class="text-button">åšå®¢</a><a href="https://github.com/yuuFen" target="_blank" class="text-button">é¡¹ç›®</a><a href="mailto:me@yuufen.com" class="text-button">ç»™æˆ‘å‘é‚®ä»¶</a></p>
<h2 id="å…´è¶£çˆ±å¥½">ğŸ¨ å…´è¶£çˆ±å¥½</h2>
<p><strong>æ‘„å½±</strong>ã€ç¾½æ¯›çƒã€è½®æ»‘ï¼Œand playing!</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è™šæ‹Ÿ DOM æ·±å…¥ä¸ç®€å•å®ç°]]></title>
        <id>https://yuufen.com/blog/post/M0Xa7RsWm/</id>
        <link href="https://yuufen.com/blog/post/M0Xa7RsWm/">
        </link>
        <updated>2020-03-12T03:24:31.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æ]]></title>
        <id>https://yuufen.com/blog/post/jD_rI1NpH/</id>
        <link href="https://yuufen.com/blog/post/jD_rI1NpH/">
        </link>
        <updated>2020-03-11T18:22:09.000Z</updated>
        <content type="html"><![CDATA[<center>
        <a href="https://yuufen.com/blog/post/28tbvr2E1/">å¯åŠ¨é¡¹ç›®ä¸å…¥å£æ–‡ä»¶åˆ†æ</a>
</center>
<center>
        <a href="https://yuufen.com/blog/post/sW2ztpxVO/">ä»å…¥å£æ–‡ä»¶åˆ° Vue å£°æ˜ï¼Œcreate</a>
</center>
<center>
        <a href="https://yuufen.com/blog/post/LGEsZIcVg/">æ•°æ®å“åº”å¼å®ç°ç»†èŠ‚</a>
</center>
<center>
        <a href="https://yuufen.com/blog/post/xFIRxtfFh/">ä»è™šæ‹Ÿ DOM åˆ° DOMï¼Œmount</a>
</center>
<center>
        <a href="https://yuufen.com/blog/post/cRGCDD5es/">æ¨¡æ¿ç¼–è¯‘</a>
</center>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æï¼šæ¨¡æ¿ç¼–è¯‘]]></title>
        <id>https://yuufen.com/blog/post/cRGCDD5es/</id>
        <link href="https://yuufen.com/blog/post/cRGCDD5es/">
        </link>
        <updated>2020-03-10T21:20:32.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æï¼šä»è™šæ‹Ÿ DOM åˆ° DOMï¼Œmount]]></title>
        <id>https://yuufen.com/blog/post/xFIRxtfFh/</id>
        <link href="https://yuufen.com/blog/post/xFIRxtfFh/">
        </link>
        <updated>2020-03-08T12:28:02.000Z</updated>
        <content type="html"><![CDATA[<h2 id="è™šæ‹Ÿ-dom">è™šæ‹Ÿ DOM</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<p>è™šæ‹Ÿ DOM è½»é‡ã€å¿«é€Ÿï¼Œå½“å®ƒä»¬å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡æ–°æ—§è™šæ‹ŸDOMæ¯”å¯¹å¯ä»¥å¾—åˆ°æœ€å° DOM æ“ä½œé‡ï¼Œä»è€Œæå‡æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ JavaScript è¿ç®—æˆæœ¬æ›¿æ¢ DOM æ“ä½œçš„æ‰§è¡Œæˆæœ¬ï¼Œå‰è€…è¿ç®—é€Ÿåº¦æ¯”åè€…å¿«å¾ˆå¤šã€‚</p>
<p>Vue 1.0 ä¸­æœ‰ç»†ç²’åº¦çš„æ•°æ®å˜åŒ–ä¾¦æµ‹ï¼Œå®ƒæ˜¯ä¸éœ€è¦è™šæ‹ŸDOMçš„ï¼Œä½†æ˜¯ç»†ç²’åº¦é€ æˆäº†å¤§é‡å¼€é”€ï¼Œè¿™å¯¹äºå¤§å‹é¡¹ç›®æ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<p>å› æ­¤ï¼ŒVue 2.0 é€‰æ‹©äº†ä¸­ç­‰ç²’åº¦çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯ä¸€ä¸ªç»„ä»¶åˆ›å»ºä¸€ä¸ª Watcher å®ä¾‹ï¼Œè¿™æ ·çŠ¶æ€å˜åŒ–æ—¶åªèƒ½é€šçŸ¥åˆ°ç»„ä»¶ï¼Œæ‰€ä»¥å†é€šè¿‡å¼•å…¥è™šæ‹ŸDOMå»è¿›è¡Œå¯¹æ¯”å’Œæ¸²æŸ“ï¼ˆåŒæ—¶å¯ä»¥è§£å†³è·¨å¹³å°çš„é—®é¢˜ï¼‰ã€‚</p>
<h2 id="ä»è¡¨åˆ°é‡Œ">ä»è¡¨åˆ°é‡Œ</h2>
<blockquote>
<pre><code>new Vue().$mount('#app')
</code></pre>
</blockquote>
<h3 id="1-mount">1. $mount</h3>
<p>src\platforms\web\runtime\index.js</p>
<pre><code class="language-js">// public mount method
Vue.prototype.$mount = function (
  el?: string | Element,
  hydrating?: boolean
): Component {
  // æ‹¿åˆ°å¯¹åº” DOM å…ƒç´ 
  el = el &amp;&amp; inBrowser ? query(el) : undefined
  return mountComponent(this, el, hydrating)
}
</code></pre>
<ul>
<li>mountComponent</li>
</ul>
<h3 id="2-mountcomponent">2. mountComponent</h3>
<p>src\core\instance\lifecycle.js</p>
<pre><code class="language-js">export function mountComponent (
  vm: Component,
  el: ?Element,
  hydrating?: boolean
): Component {
  // æŒ‚è½½ el
  vm.$el = el

  // å¦‚æœå¸¦ç¼–è¯‘å™¨ï¼Œä¼šåœ¨è°ƒç”¨å‰ç¼–è¯‘å‡º render å‡½æ•°
  if (!vm.$options.render) {
    vm.$options.render = createEmptyVNode
    // çœç•¥æŠ¥é”™
  }
  // è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ beforeMountã€‚initå’Œç¼–è¯‘éƒ½å‘ç”Ÿåœ¨è¿™ä¹‹å‰
  // ï¼ˆä»initMixinçš„createdåˆ°è°ƒç”¨$mountæ‰§è¡Œåˆ°è¿™é‡Œï¼Œåšäº†å¾ˆå¤šäº‹æƒ…ï¼‰
  callHook(vm, 'beforeMount')

  // å®šä¹‰äº†æ›´æ–°å‡½æ•°
  let updateComponent
  updateComponent = () =&gt; {
    // vm._render ä¸­è°ƒç”¨äº† $options ä¸Šçš„ renderï¼Œè¿”å› VNode
    // ç„¶å VNode ä½œä¸ºå‚æ•°ä¼ å…¥ vm._updateï¼ŒåšçœŸå® DOM æ›´æ–°
    vm._update(vm._render(), hydrating)
  }

  // åœ¨åˆ›å»ºç»„ä»¶æ—¶ä¼š new ä¸€ä¸ªå’Œç»„ä»¶å¯¹åº” Watcher å®ä¾‹ï¼ˆå³render watcherï¼‰ï¼Œ
  // render watcher ä¼šç‹¬ç«‹äºç»„ä»¶çš„å…¶ä»– watcher å•ç‹¬ä¿å­˜
  // å®ƒä¼šåœ¨æ•°æ®æ›´æ–°æ—¶é€šçŸ¥ ç»„ä»¶ æ›´æ–° DOMï¼ˆä¸­ç­‰ç²’åº¦ï¼‰
  // å³è°ƒç”¨ updateComponentã€‚
  // ï¼ˆä½¿ç”¨ $watcher / watcheré€‰é¡¹ ä¼šé¢å¤–åˆ›å»º Watcher å®ä¾‹ï¼‰
  new Watcher(vm, updateComponent, noop, {
    before () {
      if (vm._isMounted &amp;&amp; !vm._isDestroyed) {
        callHook(vm, 'beforeUpdate')
      }
    }
  }, true /* isRenderWatcher */)
  hydrating = false

  // manually mounted instance, call mounted on self
  // mounted is called for render-created child components in its inserted hook
  if (vm.$vnode == null) {
    vm._isMounted = true
    // è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ mountedã€‚beforeMounted åˆ° mounted çš„è¿‡ç¨‹ï¼Œ
    // è°ƒç”¨äº†å·²æœ‰çš„renderå‡½æ•°ç”Ÿæˆäº†è™šæ‹Ÿ DOMï¼Œç„¶åç”Ÿæˆäº†çœŸå® DOM
    callHook(vm, 'mounted')
  }
  return vm
}
</code></pre>
<ul>
<li>_render</li>
<li>_update</li>
</ul>
<h3 id="3-_render">3. _render</h3>
<p>src\core\instance\render.js</p>
<pre><code class="language-js">const { render, _parentVnode } = vm.$options	
// ...
vnode = render.call(vm._renderProxy, vm.$createElement)
// ...
return vnode
</code></pre>
<h3 id="4-_update">4. _update</h3>
<p>src\core\instance\lifecycle.js</p>
<pre><code class="language-js">    if (!prevVnode) {
      // initial render
      // æ²¡æœ‰æ—§çš„ vnodeï¼Œå³ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶
      vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */)
    } else {
      // updates
      // æ›´æ–°ï¼Œæ–°æ—§ vnode ä¹‹é—´ diffï¼Œè¿”å›æ–°çš„ DOM
      vm.$el = vm.__patch__(prevVnode, vnode)
    }

	// ç„¶ååšä¸€äº›çŠ¶æ€æ›´æ–°
	// ...
</code></pre>
<ul>
<li>_<em>patch</em>_</li>
</ul>
<h3 id="5-_patch_">5. _<em>patch</em>_</h3>
<p>src\platforms\web\runtime\index.js</p>
<pre><code class="language-js">import { patch } from './patch'
Vue.prototype.__patch__ = inBrowser ? patch : noop
</code></pre>
<ul>
<li>patch</li>
</ul>
<p>src\platforms\web\runtime\patch.js</p>
<pre><code class="language-js">// é‡Œé¢å°è£…æœ‰å„ä¸ªæµè§ˆå™¨å¹³å°ä¸­å¯¹ DOM èŠ‚ç‚¹çš„æ“ä½œ
import * as nodeOps from 'web/runtime/node-ops'
import { createPatchFunction } from 'core/vdom/patch'
import baseModules from 'core/vdom/modules/index'
// é‡Œé¢å°è£…æœ‰å„ä¸ªæµè§ˆå™¨å¹³å°ä¸­å¯¹å±æ€§çš„æ“ä½œ
import platformModules from 'web/runtime/modules/index'

// the directive module should be applied last, after all
// built-in modules have been applied.
// æ‰©å±•æ“ä½œï¼šæŠŠé€šç”¨æ¨¡å—å’Œæµè§ˆå™¨ä¸­ç‰¹æœ‰æ¨¡å—åˆå¹¶
const modules = platformModules.concat(baseModules)

// å·¥å‚å‡½æ•°ï¼šåˆ›å»ºç”¨æˆ·ä½¿ç”¨çš„æµè§ˆå™¨ç‰¹æœ‰çš„ patch å‡½æ•°ï¼Œä¸»è¦æ˜¯ä¸ºäº†å®ç°è·¨å¹³å°
export const patch: Function = createPatchFunction({ nodeOps, modules })
</code></pre>
<ul>
<li>createPatchFunction</li>
</ul>
<p>src\core\vdom\patch.js</p>
<pre><code class="language-js">// è¿™æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè¿”å›äº†æµè§ˆå™¨ä¸­ä½¿ç”¨çš„ patch æ–¹æ³•
// åœ¨ 700 è¡Œå·¦å³ return
// è¯¦è§ä¸‹æ–‡
</code></pre>
<h2 id="patch-è§£æ">patch è§£æ</h2>
<p>vue ä½¿ç”¨çš„ patching ç®—æ³•åŸºäº Snabbdomï¼ŒVNodeçš„ children / text äºŒé€‰ä¸€ï¼Œä¸å¯å…±å­˜ ã€‚</p>
<p>patch å°†æ–°è€ VNode èŠ‚ç‚¹è¿›è¡Œæ¯”å¯¹ï¼ˆdiff ç®—æ³•ï¼‰ï¼Œç„¶åæ ¹æ®æ¯”è¾ƒç»“æœè¿›è¡Œæœ€å°é‡çš„ DOM æ“ä½œï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªè§†å›¾æ ¹æ®æ–°çš„ VNode é‡ç»˜ã€‚</p>
<p>é‚£ä¹ˆ patch æ˜¯æ€ä¹ˆå·¥ä½œçš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆè¯´ä¸€ä¸‹ patch çš„æ ¸å¿ƒ â€”â€” diff ç®—æ³•ï¼šé€šè¿‡<strong>åŒå±‚çš„æ ‘èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ</strong>ï¼ˆä¸€èˆ¬çš„ web å¼€å‘ä¸ä¼šå‡ºç°è·¨å±‚çš„ DOM å˜åŒ–ï¼‰ï¼Œè€Œéå¯¹æ ‘è¿›è¡Œé€å±‚æœç´¢éå†çš„æ–¹å¼ï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦åªæœ‰ O(n)ï¼Œè€Œä¸æ˜¯ O(n^3)ï¼Œæ˜¯ä¸€ç§ç›¸å½“é«˜æ•ˆçš„ç®—æ³•ã€‚</p>
<p>åŒå±‚çº§åªåšä¸‰ä»¶äº‹ï¼šå¢åˆ æ”¹ã€‚new VNode ä¸å­˜åœ¨å°±åˆ ï¼›old VNode ä¸å­˜åœ¨å°±å¢ï¼›éƒ½å­˜åœ¨å°±æ¯”è¾ƒï¼ˆæ ‡ç­¾ï¼‰ç±»å‹å’Œ keyï¼Œæœ‰ä¸€é¡¹ä¸åŒå°±ç›´æ¥æ•´ä½“æ›¿æ¢ï¼Œéƒ½ç›¸åŒæ‰§è¡Œæ›´æ–°ï¼ˆé€’å½’ï¼‰ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1584040706895.png" alt="" loading="lazy"></figure>
<h3 id="1-createpatchfunction">1. createPatchFunction</h3>
<p>è¿™æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œåœ¨ 700 è¡Œå·¦å³è¿”å›äº†æµè§ˆå™¨ä¸­ä½¿ç”¨çš„ patch æ–¹æ³•</p>
<pre><code class="language-js">  return function patch (oldVnode, vnode, hydrating, removeOnly) {
    // å¦‚æœæ²¡æœ‰æ–°çš„ vnodeï¼šåˆ 
    if (isUndef(vnode)) {
      if (isDef(oldVnode)) invokeDestroyHook(oldVnode)
      return
    }

    let isInitialPatch = false
    const insertedVnodeQueue = []

    if (isUndef(oldVnode)) {
      // å¦‚æœè€èŠ‚ç‚¹ä¸å­˜åœ¨ï¼šå¢
      // empty mount (likely as component), create new root element
      isInitialPatch = true
      createElm(vnode, insertedVnodeQueue)
    } else {
      // oldVnodeï¼Œvnode éƒ½å­˜åœ¨ï¼Œæœ‰ä¸‰ç§æƒ…å†µ
      // 1. oldVnode ä¸æ˜¯ DOMï¼Œå¹¶ä¸”æ–°è€ VNode æ˜¯ &quot;sameVnode&quot;ï¼Œå°±è°ƒç”¨ patchVnode
      // 2. oldVnode ä¸æ˜¯ DOMï¼Œä½†æ˜¯æ–°è€ VNode ä¸æ˜¯ &quot;sameVnode&quot;ï¼Œå°±æ•´ä½“æ›¿æ¢
      // 3. oldVnode æ˜¯çœŸå® DOMï¼Œåˆå§‹åŒ–è¿‡ç¨‹ï¼ˆæˆ–è€…æ˜¯ SSR ç›¸å…³ï¼Œè¿˜æ²¡çœ‹ï¼‰ï¼Œå°±æ•´ä½“æ›¿æ¢
      
      // å¦‚æœ oldVnode å­˜åœ¨nodeTypeï¼Œè¯´æ˜ä¼ è¿›æ¥çš„æ˜¯ä¸€ä¸ªçœŸå® DOM
      const isRealElement = isDef(oldVnode.nodeType)
      if (!isRealElement &amp;&amp; sameVnode(oldVnode, vnode)) {
        // è‡ªå®šä¹‰ç»„ä»¶çš„è¡¥ä¸æ“ä½œ
        // patch existing root node
        patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly)
      } else {
        if (isRealElement) {
          // mounting to a real element
          // check if this is server-rendered content and if we can perform
          // a successful hydration.
          if (oldVnode.nodeType === 1 &amp;&amp; oldVnode.hasAttribute(SSR_ATTR)) {
            oldVnode.removeAttribute(SSR_ATTR)
            hydrating = true
          }
          if (isTrue(hydrating)) {
            if (hydrate(oldVnode, vnode, insertedVnodeQueue)) {
              invokeInsertHook(vnode, insertedVnodeQueue, true)
              return oldVnode
            } else if (process.env.NODE_ENV !== 'production') {
              warn(
                'The client-side rendered virtual DOM tree is not matching ' +
                'server-rendered content. This is likely caused by incorrect ' +
                'HTML markup, for example nesting block-level elements inside ' +
                '&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing ' +
                'full client-side render.'
              )
            }
          }
          // either not server-rendered, or hydration failed.
          // create an empty node and replace it
          oldVnode = emptyNodeAt(oldVnode)
        }

        // replacing existing element
        // ä¸‹é¢æ˜¯æ›¿æ¢æ“ä½œï¼Œå¯ä»¥æ‰“æ–­ç‚¹çœ‹çœ‹
        const oldElm = oldVnode.elm
        const parentElm = nodeOps.parentNode(oldElm)

        // create new node
        // ä»¥è€èŠ‚ç‚¹ä¸ºæ¨¡æ¿ï¼Œæ–°å»ºäº†ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå…¶ä¸­å€¼å·²ç»æ›´æ–°ï¼‰
        createElm(
          vnode,
          insertedVnodeQueue,
          // extremely rare edge case: do not insert if old element is in a
          // leaving transition. Only happens when combining transition +
          // keep-alive + HOCs. (#4590)
          oldElm._leaveCb ? null : parentElm,
          nodeOps.nextSibling(oldElm)
        )

        // update parent placeholder node element, recursively
        // è¿™æ—¶ parent ä¸­å­˜åœ¨ç€ æ–°è€ä¸¤ä¸ªèŠ‚ç‚¹
        if (isDef(vnode.parent)) {
          let ancestor = vnode.parent
          const patchable = isPatchable(vnode)
          while (ancestor) {
            for (let i = 0; i &lt; cbs.destroy.length; ++i) {
              cbs.destroy[i](ancestor)
            }
            ancestor.elm = vnode.elm
            if (patchable) {
              for (let i = 0; i &lt; cbs.create.length; ++i) {
                cbs.create[i](emptyNode, ancestor)
              }
              // #6513
              // invoke insert hooks that may have been merged by create hooks.
              // e.g. for directives that uses the &quot;inserted&quot; hook.
              const insert = ancestor.data.hook.insert
              if (insert.merged) {
                // start at index 1 to avoid re-invoking component mounted hook
                for (let i = 1; i &lt; insert.fns.length; i++) {
                  insert.fns[i]()
                }
              }
            } else {
              registerRef(ancestor)
            }
            ancestor = ancestor.parent
          }
        }

        // destroy old node
        // ç›´åˆ°è¿™é‡Œï¼Œè€èŠ‚ç‚¹è¢«é”€æ¯
        if (isDef(parentElm)) {
          removeVnodes([oldVnode], 0, 0) // è¿™é‡Œ remove äº†è€èŠ‚ç‚¹ï¼Œparent ä¸­åªå‰©æ–°èŠ‚ç‚¹
        } else if (isDef(oldVnode.tag)) {
          invokeDestroyHook(oldVnode)
        }
      }
    }

    invokeInsertHook(vnode, insertedVnodeQueue, isInitialPatch)
    return vnode.elm
  }
</code></pre>
<h3 id="2-samevnode">2. sameVnode</h3>
<pre><code class="language-js">function sameVnode (a, b) {
  return (
    a.key === b.key &amp;&amp; (
      (
        a.tag === b.tag &amp;&amp;
        a.isComment === b.isComment &amp;&amp;
        isDef(a.data) === isDef(b.data) &amp;&amp;
        sameInputType(a, b)
      ) || (
        isTrue(a.isAsyncPlaceholder) &amp;&amp;
        a.asyncFactory === b.asyncFactory &amp;&amp;
        isUndef(b.asyncFactory.error)
      )
    )
  )
}
</code></pre>
<h3 id="2-patchvnode">2. patchVnode</h3>
<p>ä¸¤ä¸ª VNode æ˜¯ â€œsameVnodeâ€ï¼Œå°±æ‰§è¡Œæ›´æ–°æ“ä½œï¼ŒåŒ…æ‹¬ï¼š<strong>å±æ€§æ›´æ–° props</strong>ã€<strong>æ–‡æœ¬æ›´æ–° text</strong>ã€<strong>å­èŠ‚ç‚¹æ›´æ–° å¦‚reorder</strong>ã€‚ï¼ˆVNode çš„ children / text äºŒè€…åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼‰</p>
<p>patchVNode å…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>å¦‚æœæ–°æ—§ VNode éƒ½æ˜¯<strong>é™æ€çš„</strong>ï¼ˆä¸ä¼šæ”¹å˜ï¼‰ï¼ŒåŒæ—¶å®ƒä»¬çš„ key ç›¸åŒï¼ˆä»£è¡¨åŒä¸€èŠ‚ç‚¹ï¼‰ï¼Œå¹¶ä¸”æ–°çš„ VNode æ˜¯ clone æˆ–è€…æ ‡è®°äº† v-onceï¼Œé‚£ä¹ˆåªéœ€è¦æ›¿æ¢ elm ä»¥åŠ <code>componentInstance</code> å³å¯ï¼›</p>
</li>
<li>
<p>å¦‚æœæ–°è€èŠ‚ç‚¹éƒ½æœ‰ <code>children</code> å­èŠ‚ç‚¹ï¼Œåˆ™å¯¹å­èŠ‚ç‚¹è¿›è¡Œ diff æ“ä½œï¼Œè°ƒç”¨ updateChildrenï¼Œå®ƒæ˜¯ diff çš„æ ¸å¿ƒä¹‹ä¸€ï¼›</p>
</li>
<li>
<p>å¦‚æœè€èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè€Œæ–°èŠ‚ç‚¹å­˜åœ¨å­èŠ‚ç‚¹ï¼Œåˆ™å…ˆæ¸…ç©ºè€èŠ‚ç‚¹ DOM çš„æ–‡æœ¬å†…å®¹ï¼Œç„¶åä¸ºå½“å‰ DOM èŠ‚ç‚¹åŠ å…¥å­èŠ‚ç‚¹ï¼›</p>
</li>
<li>
<p>å½“æ–°èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œè€Œè€èŠ‚ç‚¹å­˜åœ¨å­èŠ‚ç‚¹æ—¶ï¼Œåˆ™ç§»é™¤è¯¥ DOM èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼›</p>
</li>
<li>
<p>å½“æ–°è€èŠ‚ç‚¹éƒ½æ— å­èŠ‚ç‚¹æ—¶ï¼Œå°±åªæ˜¯æ–‡æœ¬çš„æ›¿æ¢ã€‚</p>
</li>
</ol>
<pre><code class="language-js">  function patchVnode (
    oldVnode,
    vnode,
    insertedVnodeQueue,
    ownerArray,
    index,
    removeOnly
  ) {
    // æ–°æ—§ VNode ç›¸åŒå°±ç›´æ¥è¿”å›
    if (oldVnode === vnode) {
      return
    }

    if (isDef(vnode.elm) &amp;&amp; isDef(ownerArray)) {
      // clone reused vnode
      vnode = ownerArray[index] = cloneVNode(vnode)
    }

    // elm ä¿å­˜ç€å¯¹åº”çš„ DOMï¼Œè¿™é‡Œæ–°çš„ä»è€çš„é‚£é‡Œè·å–åˆ° elm
    const elm = vnode.elm = oldVnode.elm

    // å¼‚æ­¥ç»„ä»¶çš„ç‰¹æ®Šå¤„ç†
    if (isTrue(oldVnode.isAsyncPlaceholder)) {
      if (isDef(vnode.asyncFactory.resolved)) {
        hydrate(oldVnode.elm, vnode, insertedVnodeQueue)
      } else {
        vnode.isAsyncPlaceholder = true
      }
      return
    }

    // reuse element for static trees.
    // note we only do this if the vnode is cloned -
    // if the new node is not cloned it means the render functions have been
    // reset by the hot-reload-api and we need to do a proper re-render.
    // é™æ€èŠ‚ç‚¹å¯å¤ç”¨ï¼Œæ›´æ–° componentIstance ï¼Œç„¶åè·³è¿‡
    if (isTrue(vnode.isStatic) &amp;&amp;
      isTrue(oldVnode.isStatic) &amp;&amp;
      vnode.key === oldVnode.key &amp;&amp;
      (isTrue(vnode.isCloned) || isTrue(vnode.isOnce))
    ) {
      vnode.componentInstance = oldVnode.componentInstance
      return
    }

    let i
    const data = vnode.data
    if (isDef(data) &amp;&amp; isDef(i = data.hook) &amp;&amp; isDef(i = i.prepatch)) {
      i(oldVnode, vnode)
    }

    const oldCh = oldVnode.children
    const ch = vnode.children

    // æ›´æ–°å±æ€§ï¼Ÿ
    if (isDef(data) &amp;&amp; isPatchable(vnode)) {
      for (i = 0; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode)
      if (isDef(i = data.hook) &amp;&amp; isDef(i = i.update)) i(oldVnode, vnode)
    }

    // å‰æï¼švnode çš„ children / text åªèƒ½å­˜åœ¨ä¸€ä¸ª
    if (isUndef(vnode.text)) {
      // æ–°çš„ æ²¡æœ‰ textï¼ˆå³åªå¯èƒ½å­˜åœ¨ childrenï¼‰æ—¶ï¼š
      if (isDef(oldCh) &amp;&amp; isDef(ch)) {
        // å¦‚æœæ–°è€ éƒ½æœ‰å­èŠ‚ç‚¹
        if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly)
      } else if (isDef(ch)) {
        // å¦‚æœè€çš„æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæ–°çš„æœ‰å­èŠ‚ç‚¹ï¼š
        if (process.env.NODE_ENV !== 'production') {
          checkDuplicateKeys(ch)
        }
        if (isDef(oldVnode.text)){
          // å¦‚æœè€çš„æœ‰ textï¼šæ¸…ç©º
          nodeOps.setTextContent(elm, '')
        }
        // å¾€ elm ä¸­åŠ ä¸œè¥¿
        addVnodes(elm, null, ch, 0, ch.length - 1, insertedVnodeQueue)
      } else if (isDef(oldCh)) {
        // å¦‚æœè€çš„æœ‰å­èŠ‚ç‚¹ï¼Œæ–°çš„æ²¡æœ‰å­èŠ‚ç‚¹ï¼šåˆ æ‰
        removeVnodes(oldCh, 0, oldCh.length - 1)
      } else if (isDef(oldVnode.text)) {
        // å¦‚æœè€çš„æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œæœ‰ textï¼›æ–°çš„æ²¡æœ‰å­èŠ‚ç‚¹ä¹Ÿæ²¡æœ‰ textï¼šæ¸…ç©º
        nodeOps.setTextContent(elm, '')
      }
    } else if (oldVnode.text !== vnode.text) {
      // æ–°èŠ‚ç‚¹æœ‰textï¼Œæ–°è€ text ä¸åŒï¼ˆå¦‚æœç›¸åŒå°±ä¸æ”¹äº†ï¼‰æ—¶ï¼š
      nodeOps.setTextContent(elm, vnode.text)
    }

    // é’©å­ï¼Œæš‚æ—¶ä¸çœ‹äº†
    if (isDef(data)) {
      if (isDef(i = data.hook) &amp;&amp; isDef(i = i.postpatch)) i(oldVnode, vnode)
    }
  }
</code></pre>
<ul>
<li>updateChildren</li>
</ul>
<h3 id="31-updatechildren">3.1 updateChildren</h3>
<p>updateChildren çš„ä¸»è¦ä½œç”¨æ˜¯ç”¨ä¸€ç§è¾ƒé«˜æ•ˆçš„æ–¹å¼æ¯”å¯¹æ–°æ—§ä¸¤ä¸ª VNode çš„ childrenï¼Œå¾—å‡ºæœ€å°æ“ä½œã€‚</p>
<p>ä¼ ç»Ÿæ–¹å¼æ˜¯æ‰§è¡Œä¸€ä¸ªåŒå¾ªç¯ï¼ŒVue ä¸­é’ˆå¯¹ web  åœºæ™¯ç‰¹ç‚¹åšäº†ç‰¹åˆ«çš„ç®—æ³•ä¼˜åŒ–ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1584051570854.png" alt="" loading="lazy"></figure>
<p>æ–°è€ä¸¤ç»„ VNode èŠ‚ç‚¹çš„å·¦å³å¤´å°¾ä¸¤ä¾§éƒ½æœ‰ä¸€ä¸ªå˜é‡æ ‡è®°ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­è¿™å‡ ä¸ªå˜é‡éƒ½ä¼šå‘ä¸­é—´é æ‹¢ã€‚å½“ oldStartIdx &gt; oldEndIdx æˆ–è€… newStartIdx &gt; newEndIdx æ—¶ï¼Œç»“æŸå¾ªç¯ï¼ˆä¸éœ€è¦å† updateChildrenï¼Œè€Œæ˜¯åšå…¶ä»–æ“ä½œï¼‰ã€‚</p>
<p>ä¸‹é¢æ˜¯éå†è§„åˆ™ï¼š</p>
<p>é¦–å…ˆï¼ŒoldStartVNodeã€oldEndVNode ä¸ newStartVNodeã€newEndVNode <strong>ä¸¤ä¸¤äº¤å‰æ¯”è¾ƒ</strong>ï¼Œå…±æœ‰ 4 ç§æ¯”è¾ƒæ–¹æ³•ã€‚å…¶ä¸­å½“ oldStartVNode å’Œ newStartVNode æˆ–è€… oldEndVNode å’Œ newEndVNode æ»¡è¶³ sameVNodeï¼Œç›´æ¥å°†è¯¥ VNode èŠ‚ç‚¹è¿›è¡Œ patchVNode å³å¯ï¼Œä¸éœ€è¦å†éå†å°±å®Œæˆäº†ä¸€æ¬¡å¾ªç¯ï¼ˆä¹‹åå¯¹åé¢çš„å…ƒç´ è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼‰ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://yuufen.com/blog/post-images/1584051578325.png" alt="" loading="lazy"></figure>
<p>å¦‚æœ oldStartVNode ä¸ newEndVNode æ»¡è¶³ sameVNodeï¼Œè¯´æ˜ oldStartVNode å·²ç»è¢«ç§»åŠ¨åˆ° oldEndVNode åé¢äº†ï¼Œè¿›è¡ŒpatchVNode çš„åŒæ—¶è¿˜è¦å°†çœŸå® DOM èŠ‚ç‚¹ç§»åŠ¨åˆ° oldEndVNode çš„åé¢ï¼ˆä¹‹åå¯¹åé¢çš„å…ƒç´ è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼‰ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://yuufen.com/blog/post-images/1584051582834.png" alt="" loading="lazy"></figure>
<p>å¦‚æœ oldEndVNode ä¸ oldEndVNode newStartVNode æ»¡è¶³ sameVNodeï¼Œè¯´æ˜ oldEndVNode å·²ç»è¢«ç§»åŠ¨åˆ° newStartVNode å‰é¢äº†ï¼Œè¿›è¡ŒpatchVNode çš„åŒæ—¶è¿˜è¦å°†çœŸå® DOM èŠ‚ç‚¹ç§»åŠ¨åˆ° newStartVNode çš„å‰é¢ï¼ˆä¹‹åå¯¹åé¢çš„å…ƒç´ è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯ï¼‰ï¼š</p>
<figure data-type="image" tabindex="5"><img src="https://yuufen.com/blog/post-images/1584051587249.png" alt="" loading="lazy"></figure>
<p>å¦‚æœä»¥ä¸Šæƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œåˆ™åœ¨ old VNode ä¸­æ‰¾ä¸ newStartVNode æ»¡è¶³ sameVNode çš„ VNodeï¼ˆæ ‡è®°ä¸º vnodeToMoveï¼‰ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™æ‰§è¡Œ patchVNodeï¼ŒåŒæ—¶å°† vnodeToMove å¯¹åº” DOM ç§»åŠ¨åˆ° oldStartVNode å¯¹åº” DOM çš„å‰é¢ï¼ˆç„¶åå°† new VNode ä¸­æ¸¸æ ‡åç§»ä¸€ä¸ªï¼Œè¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼‰ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://yuufen.com/blog/post-images/1584051592284.png" alt="" loading="lazy"></figure>
<p>ä¹Ÿæœ‰å¯èƒ½ newStartVNode åœ¨ old VNode ä¸­æ‰¾ä¸åˆ° sameVNodeï¼Œè¿™æ˜¯ä¼šè°ƒç”¨ createElm åˆ›å»ºä¸€ä¸ªæ–°çš„ DOM èŠ‚ç‚¹ï¼š</p>
<figure data-type="image" tabindex="7"><img src="https://yuufen.com/blog/post-images/1584051596648.png" alt="" loading="lazy"></figure>
<p>ç›´åˆ°å¾ªç¯ç»“æŸï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦å¤„ç†å‰©ä¸‹çš„èŠ‚ç‚¹ï¼š</p>
<ol>
<li>å¦‚æœç»“æŸæ—¶ oldStartIdx &gt; oldEndIdxï¼Œè¯´æ˜è¿™ä¸ªæ—¶å€™æ—§çš„ VNode èŠ‚ç‚¹å·²ç»éå†å®Œäº†ï¼Œä½†æ˜¯æ–°çš„èŠ‚ç‚¹è¿˜æ²¡æœ‰ï¼›è¯´æ˜æ–°çš„ VNode èŠ‚ç‚¹å®é™…ä¸Šæ¯”è€çš„ VNode èŠ‚ç‚¹å¤šï¼Œéœ€è¦å°†å‰©ä¸‹çš„ VNode å¯¹åº”çš„ DOM æ’å…¥åˆ°çœŸå® DOM ä¸­ï¼Œæ­¤æ—¶è°ƒç”¨ addVNodesï¼ˆå…¶ä¸­æ‰¹é‡è°ƒç”¨ createE lm æ¥å£ï¼‰ï¼š</li>
</ol>
<figure data-type="image" tabindex="8"><img src="https://yuufen.com/blog/post-images/1584051601336.png" alt="" loading="lazy"></figure>
<ol start="2">
<li>å¦‚æœ newStart &gt; newEndIdxï¼Œè¯´æ˜æ–°çš„ VNode èŠ‚ç‚¹å·²ç»éå†å®Œäº†ï¼Œä½†æ˜¯è€çš„èŠ‚ç‚¹è¿˜æœ‰å¤šï¼Œéœ€è¦æ‰§è¡Œ remove æ“ä½œ</li>
</ol>
<figure data-type="image" tabindex="9"><img src="https://yuufen.com/blog/post-images/1584051605554.png" alt="" loading="lazy"></figure>
<pre><code class="language-js">  function updateChildren (parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly) {
    let oldStartIdx = 0
    let newStartIdx = 0
    let oldEndIdx = oldCh.length - 1
    let oldStartVnode = oldCh[0]
    let oldEndVnode = oldCh[oldEndIdx]
    let newEndIdx = newCh.length - 1
    let newStartVnode = newCh[0]
    let newEndVnode = newCh[newEndIdx]
    let oldKeyToIdx, idxInOld, vnodeToMove, refElm

    // removeOnly is a special flag used only by &lt;transition-group&gt;
    // to ensure removed elements stay in correct relative positions
    // during leaving transitions
    const canMove = !removeOnly

    if (process.env.NODE_ENV !== 'production') {
      checkDuplicateKeys(newCh)
    }

    while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) {
      if (isUndef(oldStartVnode)) {
        oldStartVnode = oldCh[++oldStartIdx] // Vnode has been moved left
      } else if (isUndef(oldEndVnode)) {
        oldEndVnode = oldCh[--oldEndIdx]
      } else if (sameVnode(oldStartVnode, newStartVnode)) {
        patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)
        oldStartVnode = oldCh[++oldStartIdx]
        newStartVnode = newCh[++newStartIdx]
      } else if (sameVnode(oldEndVnode, newEndVnode)) {
        patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)
        oldEndVnode = oldCh[--oldEndIdx]
        newEndVnode = newCh[--newEndIdx]
      } else if (sameVnode(oldStartVnode, newEndVnode)) { // Vnode moved right
        patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)
        canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))
        oldStartVnode = oldCh[++oldStartIdx]
        newEndVnode = newCh[--newEndIdx]
      } else if (sameVnode(oldEndVnode, newStartVnode)) { // Vnode moved left
        patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)
        canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)
        oldEndVnode = oldCh[--oldEndIdx]
        newStartVnode = newCh[++newStartIdx]
      } else {
        // æ–°è€é¦–å°¾ä¸¤ä¸¤ä¸åŒï¼Œå¼€å§‹éå† 
        if (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)
        idxInOld = isDef(newStartVnode.key)
          ? oldKeyToIdx[newStartVnode.key]
          : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)
        if (isUndef(idxInOld)) { // New element
          // æ–°å…ƒç´ åœ¨è€çš„é‡Œé¢ä¸å­˜åœ¨
          createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)
        } else {
          vnodeToMove = oldCh[idxInOld]
          if (sameVnode(vnodeToMove, newStartVnode)) {
            // æ‰¾åˆ°äº†ç›¸åŒçš„
            patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)
            oldCh[idxInOld] = undefined
            canMove &amp;&amp; nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)
          } else {
            // same key but different element. treat as new element
            createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)
          }
        }
        newStartVnode = newCh[++newStartIdx]
      }
    }
    // å¾ªç¯ç»“æŸä¹‹åï¼Œæ–°è€ VNode å¯èƒ½æœ‰è¿˜æœ‰ä¸€ä¸ªçš„å­©å­èŠ‚ç‚¹æ²¡æœ‰å¤„ç†å®Œ
    if (oldStartIdx &gt; oldEndIdx) {
      // æ–°çš„è¿˜å‰©ï¼Œæ‰¹é‡æ–°å¢
      refElm = isUndef(newCh[newEndIdx + 1]) ? null : newCh[newEndIdx + 1].elm
      addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)
    } else if (newStartIdx &gt; newEndIdx) {
      //è€çš„è¿˜å‰©ï¼Œæ‰¹é‡åˆ é™¤
      removeVnodes(oldCh, oldStartIdx, oldEndIdx)
    }
  }
</code></pre>
<h3 id="32-å±æ€§æ›´æ–°">3.2 å±æ€§æ›´æ–°</h3>
<pre><code class="language-js">// patch.js
const hooks = ['create', 'activate', 'update', 'remove', 'destroy']
export function createPatchFunction (backend) {
  let i, j
  const cbs = {}

  // ä¼ è¿›æ¥çš„æ‰©å±•æ¨¡å—å’ŒèŠ‚ç‚¹æ“ä½œå¯¹è±¡
  const { modules, nodeOps } = backend

  for (i = 0; i &lt; hooks.length; ++i) {
    // cbs['update'] = []
    cbs[hooks[i]] = []
    //modules: [ attrs, klass, events, domProps, style, transition]
    for (j = 0; j &lt; modules.length; ++j) {
      // modules[0]['update'] æ˜¯åˆ›å»ºå±æ€§æ‰§â¾è¡Œï¨ˆå‡½æ•°ï¼Œå…¶ä»–hookä»¥æ­¤ç±»æ¨
      if (isDef(modules[j][hooks[i]])) {
        cbs[hooks[i]].push(modules[j][hooks[i]])
      }
    }
    // cbs['update']: [fn,fn,fn....]
  }
  // ...
    
  function patchVnode (...) {
    // æ›´æ–°å±æ€§
    if (isDef(data) &amp;&amp; isPatchable(vnode)) {
      // æ¯æ¬¡ patch å…ˆæ›´æ–°å±æ€§
      for (i = 0; i &lt; cbs.update.length; ++i) cbs.update[i](oldVnode, vnode)
      if (isDef(i = data.hook) &amp;&amp; isDef(i = i.update)) i(oldVnode, vnode)
    }
    // ...
  }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æï¼šæ•°æ®å“åº”å¼]]></title>
        <id>https://yuufen.com/blog/post/LGEsZIcVg/</id>
        <link href="https://yuufen.com/blog/post/LGEsZIcVg/">
        </link>
        <updated>2020-03-05T21:21:33.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æŒ‰å¼•ç”¨é¡ºåº-æ¦‚è§ˆ">æŒ‰å¼•ç”¨é¡ºåº æ¦‚è§ˆ</h2>
<h3 id="srccoreinstancestatejs-initdata">src\core\instance\state.js &gt; initData</h3>
<pre><code class="language-js">function initData (vm: Component) {
  let data = vm.$options.data
  data = vm._data = typeof data === 'function'
    ? getData(data, vm)
    : data || {}
  if (!isPlainObject(data)) {
	// data functions should return an object
    data = {}
  }
  // proxy data on instance
  const keys = Object.keys(data)
  const props = vm.$options.props
  const methods = vm.$options.methods
  let i = keys.length
  while (i--) {
    const key = keys[i]
    if ( /* key æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼ˆæ²¡æœ‰è¢«å ç”¨ä¹Ÿä¸æ˜¯ä¿ç•™åï¼‰ */ ) {
      // è®¾ç½®ä»£ç†ï¼ŒæŠŠ key ç›´æ¥æŒ‚è½½å®ä¾‹ this ä¸Š
      proxy(vm, `_data`, key)
    }
  }
  // observe data
  // æ ¸å¿ƒï¼šè®¾ç½®å“åº”å¼
  observe(data, true /* asRootData */)
}
</code></pre>
<ul>
<li>proxy</li>
<li>observe</li>
</ul>
<h3 id="srccoreobserverindexjs-observe">src\core\observer\index.js &gt; observe</h3>
<pre><code class="language-js">/**
 * å°è¯•åˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹
 * returns the new observer if successfully observed,
 * or the existing observer if the value already has one.
 */
export function observe (value: any, asRootData: ?boolean): Observer | void {
  // å¦‚æœä¸æ˜¯ objectï¼Œç›´æ¥ return äº†ï¼ˆæ•°ç»„ä¹Ÿç®—æ˜¯ objcetï¼‰
  if (!isObject(value) || value instanceof VNode) {
    return
  }
  let ob: Observer | void
  if (hasOwn(value, '__ob__') &amp;&amp; value.__ob__ instanceof Observer) {
    ob = value.__ob__
  } else if (
    shouldObserve &amp;&amp;
    !isServerRendering() &amp;&amp;
    (Array.isArray(value) || isPlainObject(value)) &amp;&amp;
    Object.isExtensible(value) &amp;&amp;
    !value._isVue
  ) {
    ob = new Observer(value)
  }
  if (asRootData &amp;&amp; ob) {
    ob.vmCount++
  }
  return ob
}
</code></pre>
<ul>
<li>Observer</li>
</ul>
<h3 id="srccoreobserverindexjs-observer">src\core\observer\index.js &gt; observer</h3>
<pre><code class="language-js">/**
 * Observer class that is attached to each observed
 * object. Once attached, the observer converts the target
 * object's property keys into getter/setters that
 * collect dependencies and dispatch updates.
 */
export class Observer {
  value: any;
  dep: Dep;
  vmCount: number; // number of vms that have this object as root $data

  constructor (value: any) {
    this.value = value
    this.dep = new Dep()
    this.vmCount = 0
    def(value, '__ob__', this)

    // åˆ¤æ–­å½“å‰çš„valueæ˜¯æ•°ç»„ / Object
    if (Array.isArray(value)) {
      // å¦‚æœæ˜¯æ•°ç»„
      // å°±æŠŠæ•°ç»„çš„ 7 ä¸ªå¯ä»¥æ”¹å˜æ•°æ®çš„æ–¹æ³•å…¨æ‹¦æˆªäº†
      if (hasProto) {
        // å…¼å®¹æ€§å¤„ç†ï¼Œå¦‚æœæµè§ˆå™¨æœ‰åŸå‹
        protoAugment(value, arrayMethods)
      } else {
        // å¦‚æœæµè§ˆå™¨æ²¡æœ‰åŸå‹
        copyAugment(value, arrayMethods, arrayKeys)
      }
      // ç„¶åå¾ªç¯ä¸€é
      this.observeArray(value)
    } else {
      // å¦‚æœæ˜¯å¯¹è±¡
      this.walk(value)
    }
  }

  /**
   * Walk through all properties and convert them into
   * getter/setters. This method should only be called when
   * value type is Object.
   */
  walk (obj: Object) {
    const keys = Object.keys(obj)
    for (let i = 0; i &lt; keys.length; i++) {
      // æ¯ä¸€é¡¹éƒ½èµ°ä¸€é
      defineReactive(obj, keys[i])
    }
  }

  /**
   * Observe a list of Array items.
   */
  // å¦‚æœæ˜¯å¯¹è±¡åˆ—è¡¨ï¼Œåˆ™æ¯ä¸€é¡¹éƒ½èµ°ä¸€é observe
  observeArray (items: Array&lt;any&gt;) {
    for (let i = 0, l = items.length; i &lt; l; i++) {
      // ç›´æ¥ä¼ å…¥æ•°ç»„å…ƒç´ ï¼Œçœç•¥åœ¨é”®ä¸Šè®¾ç½® getter/setter çš„æ­¥éª¤
      observe(items[i]) // å¼•ç”¨å˜é‡ï¼Œä¼ å…¥çš„æ˜¯æŒ‡å‘çš„å€¼
    }
  }
}
</code></pre>
<ul>
<li>arrayMethods</li>
<li>defineReactive</li>
</ul>
<h3 id="srccoreobserverindexjs-definereactive">src\core\observer\index.js &gt; defineReactive</h3>
<pre><code class="language-js">export function defineReactive (
  obj: Object,
  key: string,
  val: any,
  customSetter?: ?Function,
  shallow?: boolean
) {
  const dep = new Dep()

  const property = Object.getOwnPropertyDescriptor(obj, key)
  if (property &amp;&amp; property.configurable === false) {
    return
  }

  // å¦‚æœç”¨æˆ·è‡ªå·±è®¾ç½®äº†getterå’Œsetterçš„å¤„ç†
  const getter = property &amp;&amp; property.get
  const setter = property &amp;&amp; property.set
  if ((!getter || setter) &amp;&amp; arguments.length === 2) {
    // åŸç†å’Œæˆ‘ä»¬å®ç°çš„ä¸€æ ·
    val = obj[key]
  }

  // å¦‚æœè¿˜æ˜¯å¯¹è±¡ï¼Œé€’å½’ï¼Œå…ˆæ‰§è¡Œ
  let childOb = !shallow &amp;&amp; observe(val)
  // å­å¯¹è±¡å¤„ç†å®Œä¹‹åï¼š
  Object.defineProperty(obj, key, {
    enumerable: true,
    configurable: true,
    get: function reactiveGetter () {
      // å¦‚æœç”¨æˆ·è‡ªå·±è®¾ç½®äº†getter
      const value = getter ? getter.call(obj) : val
      if (Dep.target) {
        // Dep.target æ˜¯ä¸€ä¸ª watcher å®ä¾‹
        // åŸç†å’Œæˆ‘ä»¬å®ç°çš„ä¸€æ ·ï¼Œå¦‚æœå­˜åœ¨ targetï¼Œå°±æ·»åŠ åˆ° Dep å®ä¾‹ä¸Š
        // ä½†æ˜¯è¿™é‡ŒåŒæ—¶ä¼šæŠŠ dep çš„ id ä¿å­˜åœ¨ watcher ä¸Šï¼Œæ˜¯å¤šå¯¹å¤šçš„å…³ç³»
        // è¿˜æœ‰ä¸€ç‚¹ï¼šè¿™é‡Œçš„ watcher æ˜¯ç»„ä»¶çº§çš„ï¼ˆå¦‚æœä¸ä½¿ç”¨$watcherï¼‰
        // å¦‚æœä¸ä½¿ç”¨$watcherï¼Œä¸€ä¸ªç»„ä»¶åªæœ‰ä¸€ä¸ªwatcherå®ä¾‹ï¼ˆåˆ›å»ºç»„ä»¶æ—¶ä¼š new ä¸€ä¸ªï¼‰
        // å®ƒä¼šæŠŠæ›´æ–°æ¶ˆæ¯ä¼ é€’ç»™ç»„ä»¶ï¼Œç„¶åç»„ä»¶åœ¨è¿›è¡Œè™šæ‹Ÿ DOM ç­‰æ“ä½œ
        // ï¼ˆ$watcher è¿˜æ²¡æœ‰çœ‹åˆ°ï¼‰
        dep.depend()
        if (childOb) {
          // çˆ¶å¯¹è±¡æ›´æ–°æ—¶å­å¯¹è±¡è¦æ›´æ–°ï¼ŒåŒæ—¶
          // å­å¯¹è±¡æ›´æ–°ä¹‹åï¼Œçˆ¶å¯¹è±¡ä¹Ÿè¦æ›´æ–°
          // æ¯”å¦‚ä» &quot;{foo: 'foo'}&quot; å˜æˆ &quot;{doo: 'doo'}&quot;
          // æ‰€ä»¥è¦æŠŠè¿™ä¸ª watcher æ·»åŠ ç»™ childOb çš„ dep
          childOb.dep.depend()
          if (Array.isArray(value)) {
            // å¦‚æœæ˜¯æ•°ç»„ï¼Œè¿˜éœ€è¦å¾ªç¯
            dependArray(value)
          }
        }
      }
      return value
    },
    set: function reactiveSetter (newVal) {
      const value = getter ? getter.call(obj) : val
      /* eslint-disable no-self-compare */
      if (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) {
        return
      }
      /* eslint-enable no-self-compare */
      if (process.env.NODE_ENV !== 'production' &amp;&amp; customSetter) {
        customSetter()
      }
      // #7981: for accessor properties without setter
      if (getter &amp;&amp; !setter) return
      if (setter) {
        setter.call(obj, newVal)
      } else {
        val = newVal
      }
      // æ¯”å¦‚æœ¬æ¥æ˜¯ 'str'ï¼Œç”¨æˆ·æ”¹æˆäº† {foo: 'str}
      // æ‰€ä»¥è¦é€’å½’
      childOb = !shallow &amp;&amp; observe(newVal)
      dep.notify()
    }
  })
}
</code></pre>
<ul>
<li>Dep.target ï¼ˆæœªç†æ¸…ï¼‰</li>
<li>Dep</li>
<li>Watcher</li>
</ul>
<h3 id="srccoreobserverwatcherjs">src\core\observer\watcher.js</h3>
<pre><code class="language-js">  constructor (
    vm: Component,
    expOrFn: string | Function, // $watcher('foo.bar') / ç»„ä»¶çš„çš„ updateComponent
    cb: Function,
    options?: ?Object,
    isRenderWatcher?: boolean
  ) {
    this.vm = vm
    // å¦‚æœæ˜¯render watcherï¼Œå•ç‹¬ä¿å­˜
    if (isRenderWatcher) {
      vm._watcher = this
    }
    vm._watchers.push(this)
    // options
 	// ä¸€äº›ç»†èŠ‚
    // ã€‚ã€‚ã€‚
      
    // parse expression for getter
    if (typeof expOrFn === 'function') {
      // å¦‚æœæ˜¯ç»„ä»¶åˆ›å»ºæ—¶åˆ›å»ºçš„ watcher å®ä¾‹ï¼ˆrender watcherï¼‰
      // getter å°±æ˜¯æ›´æ–° DOM çš„æ–¹æ³•
      // å½“ç„¶ä¹Ÿå¯èƒ½æ˜¯watchï¼ŒåŸç†ä¸€æ ·ï¼Œéƒ½æ˜¯è°ƒç”¨æ–¹æ³•
      this.getter = expOrFn
    } else {
      // å¦‚æœæ˜¯å¦‚ $watcher('foo.bar') åˆ›å»ºçš„ watcherå®ä¾‹
      // getter å°±æ˜¯è·å– vm[foo][bar] çš„æ–¹æ³•ï¼ˆå°±æ˜¯æˆ‘ä¹‹å‰å†™çš„å¤„ç†åµŒå¥—çš„æ–¹æ³•ï¼‰
      this.getter = parsePath(expOrFn)
      if (!this.getter) {
        this.getter = noop
        process.env.NODE_ENV !== 'production' &amp;&amp; warn(
          `Failed watching path: &quot;${expOrFn}&quot; ` +
          'Watcher only accepts simple dot-delimited paths. ' +
          'For full control, use a function instead.',
          vm
        )
      }
    }
    this.value = this.lazy
      ? undefined
      : this.get() // è¿™é‡Œè°ƒç”¨äº†getï¼Œgetä¸­è°ƒç”¨äº†ä¸Šé¢çš„getter
  }
  /**
   * Subscriber interface.
   * Will be called when a dependency changes.
   */
  update () {
    /* istanbul ignore else */
    if (this.lazy) {
      this.dirty = true
    } else if (this.sync) {
      this.run()
    } else {
      // watcher é˜Ÿåˆ—ï¼Œæ‰¹é‡æ‰§è¡Œï¼Œä½¿ç”¨ nextTick å‡å°‘ DOM æ“ä½œ
      queueWatcher(this)
    }
  }
</code></pre>
<ul>
<li>
<p>queueWatcher</p>
<ul>
<li>
<p>nextTick</p>
<ul>
<li>timerFunc</li>
</ul>
<blockquote>
<p>å„ç§å…¼å®¹å›é€€ï¼Œé¦–é€‰å¾®ä»»åŠ¡ã€‚</p>
<p>ä¸€æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åæµè§ˆå™¨ä¼šåˆ·æ–°ä¸€æ¬¡ç”»é¢ï¼Œæ‰€ä»¥é¦–é€‰å…ˆåœ¨å¾®ä»»åŠ¡ä¸­æ·»åŠ  DOM æ“ä½œï¼Œåœ¨ä¸€æ¬¡å®ä»»åŠ¡ä¸­æ‰¹é‡æ“ä½œã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="ç»†èŠ‚">ç»†èŠ‚</h2>
<h3 id="æ•°ç»„çš„å“åº”å¼-arraymethods">æ•°ç»„çš„å“åº”å¼ arrayMethods</h3>
<pre><code class="language-js">/*
 * not type checking this file because flow doesn't play well with
 * dynamically accessing methods on Array prototype
 */

import { def } from '../util/index'

const arrayProto = Array.prototype
export const arrayMethods = Object.create(arrayProto)

// 7 ä¸ªå¯ä»¥æ”¹å˜æ•°ç»„çš„æ–¹æ³•
const methodsToPatc h = [
  'push',
  'pop',
  'shift',
  'unshift',
  'splice',
  'sort',
  'reverse'
]

/**
 * Intercept mutating methods and emit events
 */
methodsToPatch.forEach(function (method) {
  // cache original method
  const original = arrayProto[method]
  // æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼šé€šçŸ¥æ›´æ–°
  def(arrayMethods, method, function mutator (...args) {
    const result = original.apply(this, args)
    const ob = this.__ob__

    let inserted
    switch (method) {
      case 'push':
      case 'unshift':
        inserted = args
        break
      case 'splice':
        inserted = args.slice(2)
        break
    }
    // å¦‚æœæ˜¯æ’å…¥æ“ä½œï¼Œæ–°å¢å…ƒç´ ï¼Œåˆ™éœ€è¦é¢å¤–åšå“åº”å¼
    if (inserted) ob.observeArray(inserted)
    
    // notify change
    ob.dep.notify()
    return result
  })
})
</code></pre>
<blockquote>
<h2 id="æ•°ç»„å°å‘">æ•°ç»„å°å‘</h2>
<pre><code class="language-js">// Observer ä¸­
observeArray (items: Array&lt;any&gt;) {
  for (let i = 0, l = items.length; i &lt; l; i++) {
    // ç›´æ¥ä¼ å…¥æ•°ç»„å…ƒç´ ï¼Œçœç•¥åœ¨é”®ä¸Šè®¾ç½® getter/setter çš„æ­¥éª¤
    observe(items[i]) // å¼•ç”¨å˜é‡ï¼Œä¼ å…¥çš„æ˜¯æŒ‡å‘çš„å€¼
  }
}
</code></pre>
<p>æ‰€ä»¥æ•°ç»„çš„é”®æ²¡æœ‰é…ç½® getter / setterï¼Œæ‰€ä»¥ Vue ä¸­æ•°ç»„æœ‰å“åº”å¼çš„æ“ä½œåªæœ‰è¿™ä¸ƒç§ï¼Œç›´æ¥é€šè¿‡ç´¢å¼•èµ‹å€¼ä¹Ÿä¸è¡Œï¼ˆåªèƒ½é€šè¿‡$setï¼‰ã€‚</p>
<pre><code class="language-js">this.arr[0] = '123434312122' // æ”¹çš„æ˜¯é”®ï¼ˆåœ°å€ï¼‰ï¼ŒæŒ‡å‘çš„å€¼æ²¡æœ‰å˜ï¼Œæ— å“åº”å¼æ›´æ–°
this.arr[0] = { doo: 'doo' } // æ”¹çš„æ˜¯é”®ï¼ˆåœ°å€ï¼‰ï¼ŒæŒ‡å‘çš„å€¼æ²¡æœ‰å˜ï¼Œæ— å“åº”å¼æ›´æ–°
this.arr[0].foo = 'doo' // æœ‰æ›´æ–°
this.$set(this.arr, 0, { doo: 'doo' }) // æœ‰æ›´æ–°
</code></pre>
<p>å› ä¸º js æ“ä½œæ•°ç»„å¾ˆå®¹æ˜“æ”¹å˜keyï¼Œå¦‚æœä½¿ç”¨getter / setterï¼Œå¾ˆå®¹æ˜“å¤±æ•ˆã€‚</p>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æï¼šä»å…¥å£æ–‡ä»¶åˆ° Vue å£°æ˜ï¼Œcreate]]></title>
        <id>https://yuufen.com/blog/post/sW2ztpxVO/</id>
        <link href="https://yuufen.com/blog/post/sW2ztpxVO/">
        </link>
        <updated>2020-03-05T08:46:02.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç»å†äº†ä»€ä¹ˆ">ç»å†äº†ä»€ä¹ˆ</h2>
<p>src/platforms/web/entry-runtime-with-compiler.js</p>
<pre><code class="language-js">import Vue from './runtime/index'

const mount = Vue.prototype.$mount
</code></pre>
<p>src/platforms/web/runtime.js</p>
<pre><code class="language-js">import Vue from 'core/index'

// ...

// è¡¥ä¸ç®—æ³•ï¼ŒVNode diff -&gt; DOM
Vue.prototype.__patch__ = inBrowser ? patch : noop

// public mount method
Vue.prototype.$mount = function (
  el?: string | Element,
  hydrating?: boolean
): Component {
  el = el &amp;&amp; inBrowser ? query(el) : undefined
  return mountComponent(this, el, hydrating)
}
</code></pre>
<ul>
<li>mountComponent
<ul>
<li>è™šæ‹Ÿ DOM</li>
<li>diff</li>
<li>patch</li>
<li>......</li>
</ul>
</li>
<li>_<em>patch</em>_</li>
</ul>
<p>src/core/index.js</p>
<pre><code class="language-js">import Vue from './instance/index'

initGlobalAPI(Vue)
</code></pre>
<ul>
<li>initGlobalAPI
<ul>
<li>set</li>
<li>delete</li>
<li>nextTick</li>
<li>......</li>
</ul>
</li>
</ul>
<p>src/core/instance/index.js æ€»ç®—åˆ°ç«™äº†</p>
<pre><code class="language-js">function Vue (options) {
  this._init(options)
}

// åˆå¹¶å‚æ•°ã€åˆå§‹åŒ– $parent ç­‰å±æ€§ã€åˆå§‹åŒ–äº‹ä»¶ä¸­å¿ƒã€æŒ‚è½½ h å‡½æ•°ï¼ˆ$createElementï¼‰
// è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ beforeCreate
// è·å–æ³¨å…¥çš„æ•°æ®ã€åˆå§‹åŒ– propsã€methodsã€dataã€computedã€watch
// æ³¨å…¥æ•°æ®å¤„ç†
// è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ created
initMixin(Vue) 
// å®ç° $setã€$deleteã€$watch
stateMixin(Vue)
// å®ç° $onã€$onceã€$offã€$emit
eventsMixin(Vue)
// å®ç° _updateï¼ˆè°ƒç”¨è¡¥ä¸ç®—æ³•ï¼‰ã€$forceUpdateã€$destroy
lifecycleMixin(Vue)
// installRenderHelpers
// å®ç°äº† $nextTickã€_render(è¿™é‡Œè°ƒç”¨ $options ä¸Šçš„æ¸²æŸ“å‡½æ•°)
renderMixin(Vue)
</code></pre>
<ul>
<li>initMixin
<ul>
<li>initLifecycle</li>
<li>initEvents</li>
<li>initRender</li>
<li>callHook(vm, 'beforeCreate')</li>
<li>initInjections</li>
<li>initState (<a href="https://yuufen.com/blog/post/LGEsZIcVg/">æ•°æ®å“åº”å¼ç»†èŠ‚</a>)</li>
<li>initProvide</li>
<li>callHook(vm, 'created')</li>
</ul>
</li>
<li>stateMixin
<ul>
<li>$set</li>
<li>$delete</li>
<li>$watch</li>
</ul>
</li>
<li>eventsMixin
<ul>
<li>$on</li>
<li>$once</li>
<li>$off</li>
<li>$emit</li>
</ul>
</li>
<li>lifecycleMixin
<ul>
<li>_updateï¼ˆè°ƒç”¨è¡¥ä¸ç®—æ³•ï¼‰</li>
<li>$forceUpdate</li>
<li>$destroy</li>
</ul>
</li>
<li>renderMixin
<ul>
<li>installRenderHelpers</li>
<li>$nextTick</li>
<li>_render(è¿™é‡Œè°ƒç”¨initæŒ‚è½½çš„æ¸²æŸ“å‡½æ•°)</li>
</ul>
</li>
</ul>
<h2 id="initmixin">initMixin</h2>
<pre><code class="language-js">export function initMixin (Vue: Class&lt;Component&gt;) {
  Vue.prototype._init = function (options?: Object) {
    const vm: Component = this
    // a uid
    vm._uid = uid++

    let startTag, endTag
    /* istanbul ignore if */
    if (process.env.NODE_ENV !== 'production' &amp;&amp; config.performance &amp;&amp; mark) {
      startTag = `vue-perf-start:${vm._uid}`
      endTag = `vue-perf-end:${vm._uid}`
      mark(startTag)
    }

    // a flag to avoid this being observed
    vm._isVue = true
    // åˆå¹¶å‚æ•°
    if (options &amp;&amp; options._isComponent) {
      // optimize internal component instantiation
      // since dynamic options merging is pretty slow, and none of the
      // internal component options needs special treatment.
      initInternalComponent(vm, options)
    } else {
      vm.$options = mergeOptions(
        resolveConstructorOptions(vm.constructor),
        options || {},
        vm
      )
    }
    /* istanbul ignore else */
    if (process.env.NODE_ENV !== 'production') { 
      initProxy(vm) // è®¾ç½®ä¸Šä¸‹æ–‡
    } else {
      vm._renderProxy = vm
    }
    // expose real self
    vm._self = vm
    initLifecycle(vm) // åˆå§‹åŒ–ä¸å½“å‰ç»„ä»¶ç›¸å…³çš„å±æ€§ï¼ˆ$parentç­‰ç­‰ï¼‰ï¼ˆè¿™æ—¶parentå·²ç»å­˜åœ¨äº†ï¼‰
    initEvents(vm) // åˆå§‹åŒ–äº‹ä»¶ä¸­å¿ƒ
    initRender(vm) // å®šä¹‰äº† vm.$createElement ï¼ˆrender å‡½æ•°é‡Œçš„ h å‡½æ•°ï¼‰
    callHook(vm, 'beforeCreate') // è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ beforeCreate
    initInjections(vm) // è·å–æ³¨å…¥çš„æ•°æ®ï¼ˆæ˜¯å“åº”å¼çš„ï¼‰ï¼Œåœ¨ initState ä¹‹å‰
    initState(vm) // åˆå§‹åŒ– propsã€methodsã€dataã€computedã€watch
    initProvide(vm) // æ³¨å…¥æ•°æ®å¤„ç†ï¼Œåœ¨ initState ä¹‹å
    callHook(vm, 'created') // è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ created

    /* istanbul ignore if */
    if (process.env.NODE_ENV !== 'production' &amp;&amp; config.performance &amp;&amp; mark) {
      vm._name = formatComponentName(vm, false)
      mark(endTag)
      measure(`vue ${vm._name} init`, startTag, endTag)
    }

    if (vm.$options.el) {
      vm.$mount(vm.$options.el)
    }
  }
}
</code></pre>
<h3 id="initevents">initEvents</h3>
<pre><code class="language-js">
export function initEvents (vm: Component) {
  vm._events = Object.create(null)
  vm._hasHookEvent = false
  // init parent attached events
  const listeners = vm.$options._parentListeners
  if (listeners) {
    updateComponentListeners(vm, listeners)
  }
}
</code></pre>
<ul>
<li>updateComponentListeners</li>
</ul>
<h3 id="initstate">initState</h3>
<pre><code class="language-js">export function initState (vm: Component) {
  vm._watchers = []
  const opts = vm.$options
  if (opts.props) initProps(vm, opts.props)
  if (opts.methods) initMethods(vm, opts.methods)
  if (opts.data) {
    initData(vm)
  } else {
    observe(vm._data = {}, true /* asRootData */)
  }
  if (opts.computed) initComputed(vm, opts.computed)
  if (opts.watch &amp;&amp; opts.watch !== nativeWatch) {
    initWatch(vm, opts.watch)
  }
}
</code></pre>
<ul>
<li>initProps</li>
<li>initMethods</li>
<li>initData</li>
<li>initComputed</li>
<li>watch</li>
</ul>
<h2 id="statemixin">stateMixin</h2>
<pre><code class="language-js">export function stateMixin (Vue: Class&lt;Component&gt;) {
  // flow somehow has problems with directly declared definition object
  // when using Object.defineProperty, so we have to procedurally build up
  // the object here.
  const dataDef = {}
  dataDef.get = function () { return this._data }
  const propsDef = {}
  propsDef.get = function () { return this._props }
  if (process.env.NODE_ENV !== 'production') {
    dataDef.set = function () {
      warn(
        'Avoid replacing instance root $data. ' +
        'Use nested data properties instead.',
        this
      )
    }
    propsDef.set = function () {
      warn(`$props is readonly.`, this)
    }
  }
  // æŒ‚è½½åªè¯»å±æ€§
  Object.defineProperty(Vue.prototype, '$data', dataDef)
  Object.defineProperty(Vue.prototype, '$props', propsDef)
  // æŒ‚è½½äº† $setã€$deleteã€$watch
  Vue.prototype.$set = set
  Vue.prototype.$delete = del

  Vue.prototype.$watch = function (...
  }
}
</code></pre>
<h2 id="eventsmixinæœªå®Œæˆ">eventsMixinï¼ˆæœªå®Œæˆï¼‰</h2>
<pre><code class="language-js">export function eventsMixin (Vue: Class&lt;Component&gt;) {
  const hookRE = /^hook:/
  Vue.prototype.$on = function (event: string | Array&lt;string&gt;, fn: Function): Component {
    const vm: Component = this
    if (Array.isArray(event)) {
      for (let i = 0, l = event.length; i &lt; l; i++) {
        vm.$on(event[i], fn)
      }
    } else {
      (vm._events[event] || (vm._events[event] = [])).push(fn)
      // optimize hook:event cost by using a boolean flag marked at registration
      // instead of a hash lookup
      if (hookRE.test(event)) {
        vm._hasHookEvent = true
      }
    }
    return vm
  }

  Vue.prototype.$once = function (event: string, fn: Function): Component {
    const vm: Component = this
    function on () {
      vm.$off(event, on)
      fn.apply(vm, arguments)
    }
    on.fn = fn
    vm.$on(event, on)
    return vm
  }

  Vue.prototype.$off = function (event?: string | Array&lt;string&gt;, fn?: Function): Component {
    const vm: Component = this
    // all
    if (!arguments.length) {
      vm._events = Object.create(null)
      return vm
    }
    // array of events
    if (Array.isArray(event)) {
      for (let i = 0, l = event.length; i &lt; l; i++) {
        vm.$off(event[i], fn)
      }
      return vm
    }
    // specific event
    const cbs = vm._events[event]
    if (!cbs) {
      return vm
    }
    if (!fn) {
      vm._events[event] = null
      return vm
    }
    // specific handler
    let cb
    let i = cbs.length
    while (i--) {
      cb = cbs[i]
      if (cb === fn || cb.fn === fn) {
        cbs.splice(i, 1)
        break
      }
    }
    return vm
  }

  Vue.prototype.$emit = function (event: string): Component {
    const vm: Component = this
    if (process.env.NODE_ENV !== 'production') {
      const lowerCaseEvent = event.toLowerCase()
      if (lowerCaseEvent !== event &amp;&amp; vm._events[lowerCaseEvent]) {
        tip(
          `Event &quot;${lowerCaseEvent}&quot; is emitted in component ` +
          `${formatComponentName(vm)} but the handler is registered for &quot;${event}&quot;. ` +
          `Note that HTML attributes are case-insensitive and you cannot use ` +
          `v-on to listen to camelCase events when using in-DOM templates. ` +
          `You should probably use &quot;${hyphenate(event)}&quot; instead of &quot;${event}&quot;.`
        )
      }
    }
    let cbs = vm._events[event]
    if (cbs) {
      cbs = cbs.length &gt; 1 ? toArray(cbs) : cbs
      const args = toArray(arguments, 1)
      const info = `event handler for &quot;${event}&quot;`
      for (let i = 0, l = cbs.length; i &lt; l; i++) {
        invokeWithErrorHandling(cbs[i], vm, args, vm, info)
      }
    }
    return vm
  }
}
</code></pre>
<h2 id="lifecyclemixinæœªå®Œæˆ">lifecycleMixinï¼ˆæœªå®Œæˆï¼‰</h2>
<pre><code class="language-js">export function lifecycleMixin (Vue: Class&lt;Component&gt;) {
  Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) {
    const vm: Component = this
    const prevEl = vm.$el
    const prevVnode = vm._vnode
    const restoreActiveInstance = setActiveInstance(vm)
    vm._vnode = vnode
    // Vue.prototype.__patch__ is injected in entry points
    // based on the rendering backend used.
    if (!prevVnode) {
      // initial render
      vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */)
    } else {
      // updates
      vm.$el = vm.__patch__(prevVnode, vnode)
    }
    restoreActiveInstance()
    // update __vue__ reference
    if (prevEl) {
      prevEl.__vue__ = null
    }
    if (vm.$el) {
      vm.$el.__vue__ = vm
    }
    // if parent is an HOC, update its $el as well
    if (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) {
      vm.$parent.$el = vm.$el
    }
    // updated hook is called by the scheduler to ensure that children are
    // updated in a parent's updated hook.
  }

  Vue.prototype.$forceUpdate = function () {
    const vm: Component = this
    if (vm._watcher) {
      vm._watcher.update()
    }
  }

  Vue.prototype.$destroy = function () {
    const vm: Component = this
    if (vm._isBeingDestroyed) {
      return
    }
    callHook(vm, 'beforeDestroy')
    vm._isBeingDestroyed = true
    // remove self from parent
    const parent = vm.$parent
    if (parent &amp;&amp; !parent._isBeingDestroyed &amp;&amp; !vm.$options.abstract) {
      remove(parent.$children, vm)
    }
    // teardown watchers
    if (vm._watcher) {
      vm._watcher.teardown()
    }
    let i = vm._watchers.length
    while (i--) {
      vm._watchers[i].teardown()
    }
    // remove reference from data ob
    // frozen object may not have observer.
    if (vm._data.__ob__) {
      vm._data.__ob__.vmCount--
    }
    // call the last hook...
    vm._isDestroyed = true
    // invoke destroy hooks on current rendered tree
    vm.__patch__(vm._vnode, null)
    // fire destroyed hook
    callHook(vm, 'destroyed')
    // turn off all instance listeners.
    vm.$off()
    // remove __vue__ reference
    if (vm.$el) {
      vm.$el.__vue__ = null
    }
    // release circular reference (#6759)
    if (vm.$vnode) {
      vm.$vnode.parent = null
    }
  }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æï¼šå¯åŠ¨é¡¹ç›®ä¸å…¥å£æ–‡ä»¶åˆ†æ]]></title>
        <id>https://yuufen.com/blog/post/28tbvr2E1/</id>
        <link href="https://yuufen.com/blog/post/28tbvr2E1/">
        </link>
        <updated>2020-03-04T10:40:42.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å¯åŠ¨é¡¹ç›®">å¯åŠ¨é¡¹ç›®</h2>
<h3 id="è·å–-vue-é¡¹ç›®">è·å– Vue é¡¹ç›®</h3>
<p>é¡¹ç›®åœ°å€ï¼šhttps://github.com/vuejs/vue</p>
<p>å½“å‰ç‰ˆæœ¬ï¼š2.6.11</p>
<h3 id="è°ƒè¯•æ–¹å¼">è°ƒè¯•æ–¹å¼</h3>
<ol>
<li>æµè§ˆå™¨è°ƒè¯•ï¼ˆæˆ‘ä»¬é€‰æ‹©è¿™ä¸€é¡¹ï¼‰</li>
<li>ä½¿ç”¨æ‹¦æˆªå™¨æˆ–å…¶ä»–å·¥å…·</li>
</ol>
<h3 id="è°ƒè¯•ç¯å¢ƒæ­å»º">è°ƒè¯•ç¯å¢ƒæ­å»º</h3>
<ul>
<li>
<p>å®‰è£…ä¾èµ–ï¼š<code>npm i</code></p>
</li>
<li>
<p>å®‰è£… rollupï¼š<code>npm i -g rollup</code></p>
</li>
</ul>
<blockquote>
<p>rollup æ˜¯æ‰“åŒ…å·¥å…·ï¼Œç”¨äºæ‰“åŒ…çº¯ä»£ç é¡¹ç›®ï¼Œvue ä½¿ç”¨äº† rollup æ‰“åŒ…</p>
</blockquote>
<ul>
<li>package.json ä¸­ä¿®æ”¹ dev è„šæœ¬ï¼Œæ·»åŠ  sourcemapï¼Œæ–¹ä¾¿è°ƒè¯•</li>
</ul>
<pre><code>&quot;dev&quot;: &quot;rollup -w -c scripts/config.js --sourcemap --environment TARGET:web-full-dev&quot;,
</code></pre>
<ul>
<li>è¿è¡Œå¼€å‘ç‰ˆæœ¬æ‰“åŒ…å‘½ä»¤ï¼š<code>npm run dev</code></li>
<li>åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­å¼•å…¥æ‰“åŒ…ç”Ÿæˆçš„æ–°çš„ vue.js</li>
</ul>
<blockquote>
<p>ç„¶åå°±å¯ä»¥æ„‰å¿«çš„æ‰“æ–­ç‚¹è°ƒè¯•äº†</p>
</blockquote>
<h2 id="å…¥å£æ–‡ä»¶åˆ†æ">å…¥å£æ–‡ä»¶åˆ†æ</h2>
<h3 id="ç›®å½•ç»“æ„">ç›®å½•ç»“æ„</h3>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583685102033.png" alt="" loading="lazy"></figure>
<blockquote>
<p>Vue æºç ä½¿ç”¨ flow ç¼–å†™ï¼Œæ‰€ä»¥è¿˜è¦é¢å¤–ç»´æŠ¤ TypeScript ç±»å‹å®šä¹‰ï¼ŒåŠ ä¸Š flow ç›®å‰å·²åœæ­¢ç»´æŠ¤ï¼Œæ‰€ä»¥ vue 3 ä½¿ç”¨ TypeScript é‡å†™ã€‚</p>
</blockquote>
<h3 id="æ‰¾åˆ°å…¥å£">æ‰¾åˆ°å…¥å£</h3>
<p>package.json ä¸­ï¼Œmain æ˜¯ require çš„å…¥å£ï¼Œmodule æ˜¯ import çš„å…¥å£</p>
<pre><code>&quot;main&quot;: &quot;dist/vue.runtime.common.js&quot;,
&quot;module&quot;: &quot;dist/vue.runtime.esm.js&quot;,
</code></pre>
<p>dist æ˜¯æ‰§è¡Œæ„å»ºè„šæœ¬<code>&quot;build&quot;: &quot;node scripts/build.js&quot;</code>åˆ›å»ºçš„ï¼Œæ‰€ä»¥<code>npm run build</code>æ‰§è¡Œçš„æ˜¯ scripts/build.jsã€‚</p>
<pre><code class="language-js">// è·å–æ‰€æœ‰æ‰“åŒ…é…ç½®
let builds = require('./config').getAllBuilds()

// æ ¹æ®å‚æ•°è¿‡æ»¤æ‰ä¸éœ€è¦çš„
if (process.argv[2]) {
  const filters = process.argv[2].split(',')
  builds = builds.filter(b =&gt; {
    return filters.some(f =&gt; b.output.file.indexOf(f) &gt; -1 || b._name.indexOf(f) &gt; -1)
  })
} else {
  // è¿‡æ»¤æ‰åŒ…å« weex çš„é…ç½®
  builds = builds.filter(b =&gt; {
    return b.output.file.indexOf('weex') === -1
  })
}

build(builds)
</code></pre>
<p>build.js ä¸­å¼•å…¥äº† script/config.jsï¼Œåœ¨é‡Œé¢å¯ä»¥æ‰¾åˆ°å„ä¸ªç‰ˆæœ¬çš„æ‰“åŒ…é…ç½®ã€‚</p>
<blockquote>
<h3 id="æœ¯è¯­è§£é‡Š">æœ¯è¯­è§£é‡Š</h3>
<p>runtimeï¼šä»…åŒ…å«è¿è¡Œæ—¶çš„ç‰ˆæœ¬ï¼ŒåŒ…å« vue è¿è¡Œçš„æ ¸å¿ƒä»£ç ï¼Œä½†æ²¡æœ‰æ¨¡æ¿ç¼–è¯‘å™¨ï¼Œå¦‚ vue.runtime.js</p>
<p>umdï¼šUniversal Module Definition è§„èŒƒï¼Œç”¨äºæµè§ˆå™¨çš„ script æ ‡ç­¾ï¼Œé»˜è®¤åŒ…å«è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨ï¼Œå¦‚ vue.js</p>
<p>commonjsï¼šcjs è§„èŒƒï¼Œç”¨äºæ—§ç‰ˆæ‰“åŒ…å™¨ï¼Œå¦‚ browserifyã€webpack 1ï¼Œå¦‚ vue.runtime.common.js</p>
<p>esmï¼šES module è§„èŒƒï¼Œç”¨äºç°ä»£æ‰“åŒ…å™¨ï¼Œå¦‚ webpack 2 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå¦‚ vue.runtime.esm.js</p>
<h3 id="compile-vs-runtime">Compile vs Runtime</h3>
<p>å¸¦ compiler ç‰ˆæœ¬æ”¯æŒ template é€‰é¡¹ï¼Œå¯ä»¥å®æ—¶ç¼–è¯‘æ¨¡æ¿</p>
<p>ä»… runtime ç‰ˆä¸æ”¯æŒ templateï¼Œä½“ç§¯å°ï¼Œéœ€è¦å€ŸåŠ© webpack æŠŠ template è§£ææˆ render å‡½æ•°</p>
</blockquote>
<p>å› ä¸ºæˆ‘ä»¬å¸Œæœ›åœ¨æµè§ˆå™¨ä¸­è°ƒè¯•ï¼Œæ‰€ä»¥æŸ¥çœ‹umdæ ¼å¼çš„ç‰ˆæœ¬ã€‚</p>
<pre><code class="language-js">  // Runtime+compiler development build (Browser)
  'web-full-dev': {
    entry: resolve('web/entry-runtime-with-compiler.js'),
    dest: resolve('dist/vue.js'),
    format: 'umd',
    env: 'development',
    alias: { he: './entity-decoder' },
    banner
  },
</code></pre>
<p>ç»“åˆscript/alias.jsä¸­çš„åˆ«åå¯ä»¥æ‰¾åˆ°å…¥å£æ–‡ä»¶ src/platforms/web/entry-runtime-with-compiler.js</p>
<pre><code class="language-js">// æ ¸å¿ƒä»£ç åœ¨è¿™é‡Œ
// æ‰©å±•é»˜è®¤çš„ $mount æ–¹æ³•ï¼Œèƒ½å¤Ÿç¼–è¯‘ template æˆ– el æŒ‡å®šçš„æ¨¡æ¿
const mount = Vue.prototype.$mount
Vue.prototype.$mount = function (
  el?: string | Element,
  hydrating?: boolean
): Component {
  el = el &amp;&amp; query(el)

  // ä¸èƒ½æŒ‚è½½åˆ° body æˆ–è€… html ä¸Š
  if (el === document.body || el === document.documentElement) {
    process.env.NODE_ENV !== 'production' &amp;&amp; warn(
      `Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.`
    )
    return this
  }
  
  // è·å–é€‰é¡¹
  const options = this.$options
  // å¦‚æœ options ä¸Šä¸å­˜åœ¨ render é€‰é¡¹ï¼Œåˆ™å°† template/el è½¬åŒ–ä¸º render å‡½æ•°ï¼ŒæŒ‚è½½åˆ° options ä¸Š
  // å¦‚æœ options ä¸Šå­˜åœ¨ renderï¼Œç›´æ¥æ¸²æŸ“
  if (!options.render) {
    let template = options.template
    if (template) {
      // å¦‚æœæœ‰ templateï¼Œè§£æ template é€‰é¡¹
      if (typeof template === 'string') {
        // å¦‚æœæ˜¯å­—ç¬¦ä¸² / æ¨¡æ¿å­—ç¬¦ä¸²
        if (template.charAt(0) === '#') {
          // å¦‚æœæ˜¯ '#app' ç­‰ id é€‰æ‹©å™¨ï¼Œè½¬åŒ–ä¸ºæ¨¡æ¿å­—ç¬¦ä¸²
          template = idToTemplate(template)
        }
      } else if (template.nodeType) {
        // å¦‚æœæ˜¯ DOM å…ƒç´ 
        template = template.innerHTML
      }
    } else if (el) {
      //å¦åˆ™è§£æ el
      template = getOuterHTML(el)
    }
    if (template) {
      // å¦‚æœæœ‰æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œéœ€è¦ç”¨ç¼–è¯‘å™¨ç¼–è¯‘ï¼Œå¾—åˆ° render å‡½æ•°
      const { render, staticRenderFns } = compileToFunctions(template, {
        outputSourceRange: process.env.NODE_ENV !== 'production',
        shouldDecodeNewlines,
        shouldDecodeNewlinesForHref,
        delimiters: options.delimiters,
        comments: options.comments
      }, this)
      options.render = render
      options.staticRenderFns = staticRenderFns
    }
  }
  // æ¸²æŸ“
  return mount.call(this, el, hydrating)
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ€»ç»“]]></title>
        <id>https://yuufen.com/blog/post/xYd9Z_Vfp/</id>
        <link href="https://yuufen.com/blog/post/xYd9Z_Vfp/">
        </link>
        <updated>2020-03-02T06:21:58.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<h2 id="æ–°ç©æ„prepack">æ–°ç©æ„ï¼šPrepack</h2>
<p>åœ¨ç¼–è¯‘é˜¶æ®µåšé¢„è®¡ç®—<br>
<a href="prepack.io">prepack.io</a></p>
</blockquote>
<h2 id="ä»è¾“å…¥-url-åˆ°æ˜¾ç¤ºé¡µé¢å‘ç”Ÿäº†ä»€ä¹ˆ">ä»è¾“å…¥ url åˆ°æ˜¾ç¤ºé¡µé¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>ä»è¾“å…¥ url åˆ°æ˜¾ç¤ºé¡µé¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li>ç”¨æˆ·è¾“å…¥ yuufen.com</li>
<li>æµè§ˆå™¨é€šè¿‡ DNSï¼ŒæŠŠ url è§£æä¸º IP</li>
<li>å’Œ IP åœ°å€å»ºç«‹ TCP è¿æ¥ï¼Œå‘é€ HTTP è¯·æ±‚</li>
<li>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼ŒæŸ¥åº“ï¼Œè¯»æ–‡ä»¶ç­‰ï¼Œæ‹¼æ¥å¥½è¿”å›çš„ HTTP å“åº”</li>
<li>æµè§ˆå™¨æ”¶åˆ°é¦–å± htmlï¼Œå¼€å§‹æ¸²æŸ“</li>
<li>è§£æ html ä¸º domï¼ˆåŒæ—¶åŠ è½½é¢å¤–çš„ css å’Œ jsï¼‰</li>
<li>è§£æ css ä¸º css-treeï¼ˆCSS é€‰æ‹©å™¨ä»<strong>å³</strong>å‘å·¦è¿‡æ»¤æŸ¥æ‰¾ï¼‰</li>
<li>dom + css ç”Ÿæˆ render-treeï¼Œç»˜å›¾</li>
</ol>
<p>è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„é¢è¯•é¢˜ï¼Œè¿™ä¸ªé¢˜çš„ç­”æ¡ˆåŒ…å«ç€æ•´ä¸ªäº’è”ç½‘è¿è¡Œçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ€§èƒ½ä¼˜åŒ–çš„ç­–ç•¥å°±æ˜¯åŸºäºå®ƒçš„ç­”æ¡ˆï¼Œé’ˆå¯¹æ¯ä¸€æ­¥ä¾æ¬¡è§£æï¼Œè®©æ•´ä½“çš„æ—¶é—´å˜çŸ­ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªå¤§æ–¹å‘ï¼š</p>
<ol>
<li>å°‘åŠ è½½æ–‡ä»¶</li>
<li>å°‘æ‰§è¡Œä»£ç </li>
</ol>
<h2 id="é›…è™å†›è§„">é›…è™å†›è§„</h2>
<blockquote>
<p>è™½ç„¶éšç€ Vueã€Reactã€Angular è¿™äº›æ¡†æ¶çš„æµï¨ˆï¼Œé›…è™å†›è§„å½“ä¸­ä¸€äº›ä¼˜åŒ–çš„æ–¹æ³•å·²ï¥§åœ¨é€‚ç”¨ï¼Œä½†æ˜¯ï¼Œï¤å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å­¦ä¹ è¿™äº›æ–¹æ³•èƒŒåçš„æ€æƒ³ï¼Œè€Œï¥§æ˜¯å»æ­»è®°ç¡¬èƒŒæŸä¸ªæ–¹æ³•ï¼ŒæŠ€æœ¯æ€»æ˜¯åœ¨ï¤è¿­ï¼Œåªæœ‰æ¡æ–¹æ³•èƒŒåçš„æ€æƒ³ï¼Œæ‰èƒ½å¤Ÿç«‹äºï¥§è´¥ä¹‹åœ°ã€‚</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583615829278.jpg" alt="" loading="lazy"></figure>
<p>https://developer.yahoo.com/performance/rules.html</p>
<p>https://juejin.im/post/5b73ef38f265da281e048e51</p>
<h2 id="æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</h2>
<blockquote>
<p>æŠ›å¼€åœºæ™¯è°ˆæ€§èƒ½ä¼˜åŒ–ï¼Œéƒ½æ˜¯è€æµæ°“</p>
</blockquote>
<h3 id="performance-api">Performance API</h3>
<p>æåˆ°æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡å°±ï¥§å¾—ï¥§è¯´ Performance APIï¼Œé¦–å…ˆæ¥çœ‹ MDN ä¸Šå…³äºè¿™ä¸ª API çš„ ä»‹ç»ï¼šPerformance æ¥å£å¯ä»¥è·å–åˆ°å½“å‰é¡µé¢ä¸­ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚å®ƒæ˜¯ High Resolution Time API çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ—¶ä¹Ÿèåˆï¦º Performance Timeline APIã€Navigation Timing APIã€ User Timing API å’Œ Resource Timing APIã€‚è¯¥ç±»å‹çš„å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒâ½¤ç”¨åªè¯»å±æ€§ Window.performance æ¥è·å¾—ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1583740522448.png" alt="" loading="lazy"></figure>
<pre><code class="language-js">const timingInfo = window.performance.timing
console.log({
  TCPè¿æ¥è€—æ—¶: timingInfo.connectEnd - timingInfo.connectStart,
  DNSæŸ¥è¯¢è€—æ—¶: timingInfo.domainLookupEnd - timingInfo.domainLookupStart,
  'è·å¾—é¦–å­—èŠ‚è€—è´¹æ—¶é—´ï¼Œä¹Ÿå«TTFB': timingInfo.responseStart - timingInfo.navigationStart,
  domReadyæ—¶é—´: timingInfo.domContentLoadedEventStart - timingInfo.navigationStart,
  DOMèµ„æºä¸‹è½½: timingInfo.responseEnd - timingInfo.responseStart,
})
</code></pre>
<ol>
<li>First Paint(ç®€ç§° FP)ï¼šè¡¨ç¤ºæ–‡æ¡£ä¸­ä»»ä¸€å…ƒç´ é¦–æ¬¡æ¸²æŸ“æ—¶é—´ã€‚</li>
<li>First Contentful Paint(ç®€ç§° FCP)ï¼šå½“æµè§ˆï¨¸é¦–æ¬¡æ¸²æŸ“ä»»ä½•æ–‡æœ¬ï¼Œå›¾åƒï¼ˆåŒ…æ‹¬èƒŒæ™¯å›¾åƒï¼‰ï¼Œéç™½è‰²ç”»å¸ƒæˆ– SVG æ—¶ã€‚è¿™ä¸ªæŒ‡æ ‡å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸è¯´çš„ç™½å±æ—¶é—´ã€‚</li>
<li>First Meaningful Paint(ç®€ç§° FMP)ï¼šé¦–æ¬¡æœ‰æ„ä¹‰çš„ç»˜åˆ¶ï¼Œè¿™ä¸ªæŒ‡æ ‡åæ˜ çš„æ˜¯ä¸»è¦å†…å®¹å‡ºç°åœ¨é¡µé¢ä¸Šæ‰€éœ€è¦çš„æ—¶é—´ï¼Œå¦‚æœ FMP æ—¶é—´è¿‡é•¿çš„è¯ï¼Œè¿™ï§©å°±è¦è€ƒè™‘æ˜¯ï¥§æ˜¯é™æ€æ–‡ä»¶é˜»å¡ï¦ºä¸»çº¿ç¨‹ã€‚</li>
<li>Time To Interactive(TTI)ï¼šå¯äº¤äº’æ—¶é—´ï¼Œç­‰åˆ°æœåŠ¡ï¨¸é€šè¿‡ HTTP åè®®å°†å“åº”å…¨éƒ¨è¿”å›ä¹‹åï¼Œï¥¥å¼€å§‹ DOM Tree çš„æ„å»ºï¼Œå®Œæˆä¹‹åï¼Œç½‘é¡µå˜æˆå¯äº¤äº’çŠ¶æ€ï¼Œåˆ°æ­¤ä¸ºæ­¢ä¾¿æ˜¯ç½‘é¡µçš„å¯äº¤äº’æ—¶é—´ã€‚ç”¨æˆ·å¯ä»¥è¿›ï¨ˆæ­£å¸¸çš„äº‹ä»¶è¾“å…¥äº¤äº’æ“ä½œï¼Œè¿™ä¸ªæŒ‡æ ‡æ˜¯æœ€é‡è¦çš„ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ï¼Œç”¨æˆ·æœ€å…³å¿ƒçš„å°±æ˜¯ï§½ä¹ˆæ—¶å€™å¯ä»¥è¿›ï¨ˆäº¤äº’ï¼Œæ‰€ä»¥é€šå¸¸è¿™ä¸ªæŒ‡æ ‡æ˜¯æˆ‘ä»¬ä¼˜åŒ–çš„é‡ç‚¹ã€‚</li>
</ol>
<h3 id="æµè§ˆå™¨-performance-å·¥å…·">æµè§ˆï¨¸ Performance å·¥å…·</h3>
<h3 id="lighthouse">Lighthouse</h3>
<ul>
<li>å®‰è£… chrome æ’ä»¶ ï¼ˆæˆ–è€…ï¼‰</li>
<li><code>npm install -g lighthouse</code></li>
</ul>
<pre><code>lighthouse https://yuufen.com/
</code></pre>
<h2 id="ç½‘ç»œ">ç½‘ç»œ</h2>
<h3 id="dns">DNS</h3>
<p>prefetch</p>
<figure data-type="image" tabindex="3"><img src="https://yuufen.com/blog/post-images/1583617452917.png" alt="" loading="lazy"></figure>
<h3 id="tcp">TCP</h3>
<h4 id="ip-tcp-http-çš„å…³ç³»">IPã€TCPã€HTTP çš„å…³ç³»</h4>
<ol>
<li>
<p>IP-é—¨ç‰Œå·ï¼Œé€šè¿‡ IP åè®®æ‰¾åˆ°å¯¹åº”æœºå™¨</p>
</li>
<li>
<p>TCP è´Ÿè´£æ•°æ®å®Œæ•´æ€§å’Œæœ‰åºæ€§ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€ç²˜åŒ…ã€æ»‘åŠ¨çª—å£ç­‰éå¸¸åºå¤§çš„ç½‘ç»œåè®®æœºåˆ¶</p>
</li>
<li>
<p>HTTP è´Ÿè´£åº”ç”¨å±‚æ•°æ®ï¼Œæ–‡ä»¶ç¼–ç ã€cookieã€ç¼“å­˜ã€æ•°æ®ç»ˆæ­¢æ—¶æœºç­‰</p>
</li>
</ol>
<h4 id="ä¼˜åŒ–tcpç­–ç•¥">ä¼˜åŒ–ï¼ˆTCPï¼‰ç­–ç•¥</h4>
<ol>
<li>é•¿è¿æ¥</li>
<li>å‡å°‘æ–‡ä»¶ä½“ç§¯
<ol>
<li>js æ‰“åŒ…å‹ç¼©</li>
<li>å›¾ç‰‡å‹ç¼©</li>
<li>gzip</li>
</ol>
</li>
<li>å‡å°‘æ–‡ä»¶è¯·æ±‚æ¬¡æ•°
<ol>
<li>é›ªç¢§å›¾</li>
<li>jsã€css æ‰“åŒ…</li>
<li>ç¼“å­˜æ§åˆ¶</li>
<li>æ‡’åŠ è½½</li>
</ol>
</li>
<li>å‡å°‘ç”¨æˆ·å’ŒæœåŠ¡å™¨çš„ä¸¾ä¾‹
<ol>
<li>cdn</li>
</ol>
</li>
<li>æœ¬åœ°å‚¨å­˜</li>
</ol>
<h2 id="å›¾ç‰‡">å›¾ç‰‡</h2>
<h3 id="é€‰æ‹©åˆé€‚æ ¼å¼">é€‰æ‹©åˆé€‚æ ¼å¼</h3>
<ol>
<li>PNG</li>
</ol>
<p>png-8 png-24 png-32</p>
<p>logoï¼Œé¢œè‰²ç®€å•ä½†å¯¹å›¾ç‰‡è´¨é‡è¦æ±‚é«˜ã€ç²¾çµå›¾</p>
<ol start="2">
<li>
<p>JPG/JPEG</p>
</li>
<li>
<p>GIF</p>
</li>
<li>
<p>SVG</p>
</li>
</ol>
<p>SVG å›¾åƒä¸­çš„æ–‡æœ¬æ—¶å¯é€‰å–å¯æœç´¢çš„ã€‚</p>
<p>å¸¸ç”¨æ¥ç»˜åˆ¶åœ°å›¾ã€è‚¡ç¥¨ k çº¿å›¾</p>
<p>ä¼šæŸè€—æ€§èƒ½</p>
<ol start="5">
<li>WebP</li>
</ol>
<p>å…¨èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œéœ€è¦æ ¹æ®æµè§ˆå™¨åˆ¤æ–­åŠ è½½æ ¼å¼</p>
<ol start="6">
<li>Base64</li>
</ol>
<p>å›¾ç‰‡ base64 ä¹‹åä¼šå˜å¤§ï¼Œé€‚åˆå°çš„çŸ¢é‡å›¾æ ‡</p>
<h3 id="å…¶ä»–">å…¶ä»–</h3>
<ol>
<li>å›¾ç‰‡æ¸è¿›æ˜¾ç¤º</li>
<li>æ‡’åŠ è½½</li>
<li>éª¨æ¶å›¾</li>
</ol>
<h2 id="ç¼“å­˜">ç¼“å­˜</h2>
<p>å¯ä»¥å°‘åŠ è½½æ–‡ä»¶</p>
<ol>
<li>cdn ç¼“å­˜</li>
<li>æœ¬åœ°ç¼“å­˜
<ol>
<li>localstorage</li>
<li>indexdb</li>
<li>cookie</li>
</ol>
</li>
<li>æµè§ˆå™¨ç¼“å­˜</li>
</ol>
<h3 id="cdn">CDN</h3>
<p>ç¼“å­˜+å›æº</p>
<p>åœ°ç†ä½ç½®æ›´è¿‘ï¼Œæ–°çš„åŸŸåè§„é¿ cookie</p>
<h3 id="æµè§ˆå™¨ç¼“å­˜">æµè§ˆå™¨ç¼“å­˜</h3>
<figure data-type="image" tabindex="4"><img src="https://yuufen.com/blog/post-images/1583741167549.png" alt="" loading="lazy"></figure>
<h4 id="æµç¨‹">æµç¨‹</h4>
<ol>
<li>è·å–æ–‡ä»¶</li>
<li>æ–‡ä»¶è¿”å› express æˆ–è€… cache-control è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”å¸¦ä¸Š etag æˆ–è€… lastModfied å­—æ®µ</li>
<li>å†æ¬¡è¯·æ±‚ï¼Œæµè§ˆå™¨å…ˆæŸ¥è¯¢ expres æˆ–è€… cache-control æ˜¯å¦è¿‡æœŸï¼Œè‹¥æ²¡è¿‡æœŸï¼Œå¼ºç¼“å­˜ç”Ÿæ•ˆï¼Œä¸å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜</li>
<li>è‹¥å¼ºç¼“å­˜å¤±æ•ˆï¼Œæµè§ˆå™¨ä¼šå¸¦ä¸Š etag æˆ–è€… lastModfied æ•°æ®ï¼Œä½¿ç”¨ if-none-match æˆ–è€… if-Modified-Since å­—æ®µï¼Œå’¨è¯¢åç«¯æ˜¯å¦è¿‡æœŸ</li>
<li>è‹¥æ²¡è¿‡æœŸï¼Œè¿”å› 304 çŠ¶æ€ç ï¼Œç›´æ¥ç”¨ç¼“å­˜</li>
<li>è‹¥è¿‡æœŸï¼ŒçŠ¶æ€ç  200ï¼Œè¿”å›æ–°èµ„æº</li>
</ol>
<h4 id="å¼ºç¼“å­˜">å¼ºç¼“å­˜</h4>
<h5 id="expires">expires</h5>
<p>http 1.0 ä¸­</p>
<h5 id="cache-control">Cache-Control</h5>
<p>http 1.1 ä¸­</p>
<h4 id="åå•†ç¼“å­˜">åå•†ç¼“å­˜</h4>
<h5 id="last-modified-if-modified-since">Last-Modified / If-Modified-Since</h5>
<p>æ ‡æ³¨æ—¶é—´ï¼ˆåªèƒ½ç²¾ç¡®åˆ°ç§’ï¼‰</p>
<h5 id="etag-if-none-match">Etag / If-None-Match</h5>
<p>æ ¹æ®æ–‡ä»¶å†…å®¹è®¡ç®— hash</p>
<h3 id="webpack-æ‰“åŒ…å’Œç¼“å­˜çš„å…³ç³»">webpack æ‰“åŒ…å’Œç¼“å­˜çš„å…³ç³»</h3>
<p>é€šè¿‡ hash æ¥åˆ¤æ–­æ˜¯å¦æœ‰æ›´æ–°ï¼š</p>
<ol>
<li>hashï¼šæ•´ä¸ªé¡¹ç›®ç›¸å…³çš„ hash</li>
<li>chunkhashï¼šå…¥å£æ–‡ä»¶ä¾èµ–çš„ chunkhash</li>
<li>contenthashï¼šæ–‡ä»¶å†…å®¹çš„ hash</li>
</ol>
<h3 id="å…¶ä»–-2">å…¶ä»–</h3>
<ol>
<li>memory cache å†…å­˜ç¼“å­˜ï¼Œæ¯”å¦‚å‚¨å­˜åœ¨å˜é‡é‡Œï¼Œå…³é—­ tab å°±æ²¡äº†</li>
<li>Disk cache ç¡¬ç›˜ä¸Šçš„ç¼“å­˜</li>
<li>Push cache æ¨é€ç¼“å­˜ http2</li>
<li>service worker æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹è¿›ç¨‹</li>
</ol>
<h2 id="æ¸²æŸ“">æ¸²æŸ“</h2>
<h3 id="æµè§ˆå™¨æ¸²æŸ“åŸç†">æµè§ˆå™¨æ¸²æŸ“åŸç†</h3>
<p>ç»å…¸æ–‡ç«  how browser works</p>
<p>https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/</p>
<figure data-type="image" tabindex="5"><img src="https://yuufen.com/blog/post-images/1583741367851.png" alt="" loading="lazy"></figure>
<p>é¦–å…ˆæ˜¯è§£æ HTMLã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯æŠŠ HTML æ–‡æ¡£è§£æä¸º DOM æ ‘çš„è¿‡ç¨‹ï¼Œå¦‚æœé‡åˆ°&lt;script&gt;æ ‡ç­¾ï¼Œåˆ™ä¼šåœæ­¢è§£æï¼Œå…ˆæ‰§è¡Œæ ‡ç­¾å½“ä¸­çš„ JavaScriptï¼›å¦‚æœæ˜¯å¤–è”æ–¹å¼ï¼Œä¹Ÿéœ€è¦ç­‰å¾…ä¸‹è½½å¹¶æ‰§è¡Œå®Œå¯¹åº”çš„ JavaScript ä»£ç ï¼Œç„¶åæ‰èƒ½ç»§ç»­æ‰§è¡Œè§£æ HTML çš„å·¥ä½œã€‚HTML è§£æå®Œæˆåè§¦å‘ DOMContentLoaded äº‹ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ“ä½œ DOM äº†ã€‚</p>
<p>ç”Ÿæˆå¯¹åº”çš„ DOM æ ‘ç»“æ„ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://yuufen.com/blog/post-images/1583741376936.png" alt="" loading="lazy"></figure>
<p>åŒæ—¶ä¼šè§£æ CSSã€‚è§£æ HTML å’Œè§£æ CSS æ˜¯å¹¶è¡Œå¤„ç†çš„ï¼Œä¸ç„¶ä¼šé€ æˆæ¸²æŸ“çš„å†…å®¹æ²¡æœ‰å¯¹åº”çš„æ ·å¼ã€‚è§£æ CSS é‡åˆ°&lt;script&gt;æ ‡ç­¾å’Œä¸Šé¢è§£æ HTML çš„å¤„ç†æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚CSS è§£æå™¨å°† CSS è§£ææˆ CSSStyleSheetï¼ˆä¹Ÿè¢«å«åš CSSOM æ ‘ï¼‰ï¼Œå’Œ DOM æ ‘ç»“æ„ç±»ä¼¼ã€‚</p>
<p>CSSOM æ ‘ï¼š</p>
<figure data-type="image" tabindex="7"><img src="https://yuufen.com/blog/post-images/1583741498395.png" alt="" loading="lazy"></figure>
<p>DOM æ ‘å’Œ CSSOM æ ‘ä¸€èµ·é™„ç€åˆæˆæ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://yuufen.com/blog/post-images/1583741581016.png" alt="" loading="lazy"></figure>
<p>å›¾ä¸­å·¦ä¾§ä¸º DOM æ ‘ï¼Œå³ä¾§æ˜¯ Render æ ‘ï¼Œå¯ä»¥çœ‹åˆ° Render æ ‘ç»“æ„ä¸ DOM æ ‘æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œä½†ï¥§æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª Render Objectï¼ŒåŒ…å«ï¦ºæˆ‘ä»¬åœ¨æ ·å¼è¡¨ä¸­è®¾ç½®çš„æ ·å¼ï¼Œæ ·å¼çš„å®½é«˜å’Œå…·ä½“ä½ç½®æ˜¯é€šè¿‡ Layout (é‡æ’)è®¡ç®—å¾—å‡ºã€‚</p>
<blockquote>
<h4 id="tips">Tips</h4>
<p>å…ƒç´ å¦‚æœè¢«è®¾ç½®ä¸º <code>display:none</code>ï¼Œåœ¨ DOM æ ‘ä¸­ä¾ç„¶ä¼šæ˜¾ç¤ºï¼Œä½†æ˜¯åœ¨ Render æ ‘ä¸­ä¸ä¼šæ˜¾ç¤ºï¼›å…ƒç´ å¦‚æœè¢«è®¾ç½®ä¸º <code>visibility:none</code>ï¼Œé‚£ä¹ˆ DOM æ ‘å’Œ Render æ ‘ä¸­éƒ½ä¼šæ˜¾ç¤ºï¼›æˆ‘ä»¬ç»å¸¸è¯´çš„è„±ç¦»â½‚æ–‡æ¡£æµï¼Œå…¶å®å°±æ˜¯è„±ç¦» Render Treeã€‚</p>
</blockquote>
<h3 id="ç™½å±åº”å¯¹">ç™½å±åº”å¯¹</h3>
<h4 id="éª¨æ¶å±">éª¨æ¶å±</h4>
<h5 id="è‡ªåŠ¨åŒ–æ–¹æ¡ˆ">è‡ªåŠ¨åŒ–æ–¹æ¡ˆ</h5>
<ul>
<li>page-skeleton-webpack-plugin</li>
<li>antd çš„ skeleton ç»„ä»¶</li>
</ul>
<h3 id="dom-æ€§èƒ½ä¼˜åŒ–">DOM æ€§èƒ½ä¼˜åŒ–</h3>
<p>å°‘æ“ä½œ domï¼Œä½¿ç”¨ fragment, è™šæ‹Ÿ dom</p>
<h3 id="å›æµé‡ç»˜">å›æµé‡ç»˜</h3>
<figure data-type="image" tabindex="9"><img src="https://yuufen.com/blog/post-images/1583741388259.png" alt="" loading="lazy"></figure>
<h3 id="event-loop">event-loop</h3>
<h4 id="æµç¨‹-2">æµç¨‹</h4>
<figure data-type="image" tabindex="10"><img src="https://yuufen.com/blog/post-images/1583742431195.png" alt="" loading="lazy"></figure>
<h4 id="macrotaskå®ä»»åŠ¡-microtaskå¾®ä»»åŠ¡">Macrotaskï¼ˆå®ä»»åŠ¡ï¼‰ / Microtaskï¼ˆå¾®ä»»åŠ¡ï¼‰</h4>
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°ï¦ºä»»åŠ¡é˜Ÿï¦œï¼Œé‚£ä¹ˆä»»åŠ¡é˜Ÿï¦œæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ Macrotaskï¼Œå¦å¤–ä¸€ç§æ˜¯ Microtaskã€‚ä»æœ€å¼€å§‹æˆ‘ç»™å‡ºçš„ Event Loop æ€»çš„æµç¨‹å›¾ï¼Œå¤§å®¶å¯ä»¥çœ‹å‡º Microtask ä¼˜å…ˆçº§æ˜¯é«˜äº Macrotask çš„ã€‚Microtask å½“ä¸­çš„ä»»åŠ¡ä¹Ÿæ˜¯åœ¨æ‰§ï¨ˆæ ˆå½“ä¸­çš„ä»»åŠ¡æ‰§ï¨ˆå®Œæˆåå†è¿›ï¨ˆæ‰§ï¨ˆï¼Œæ‰§ï¨ˆçš„æ—¶å€™å’Œ Macrotask æœ‰ä¸€äº›åŒºåˆ«ï¼ŒMicrotask å½“ä¸­ä»»åŠ¡ï¥§ä¼šä¸€ä¸ªâ¼€ä¸€ä¸ªå‹å…¥æ‰§â¾è¡Œï¨ˆæ ˆï¼Œè€Œæ˜¯æ‰€æœ‰ä»»åŠ¡ç›´æ¥å‹å…¥æ ˆä¸­ï¼Œ å½“ Microtask å½“ä¸­çš„ä»»åŠ¡æ‰§ï¨ˆå®Œæ¯•åï¼Œç„¶åæˆ‘ä»¬å†ä» Macrotask ä¸­å–æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªä»»åŠ¡è¿›ï¨ˆæ‰§ï¨ˆã€‚</p>
<p>é‚£ä¹ˆå“ªäº›ä»»åŠ¡å±äº Microtaskï¼Œå“ªäº›ä»»åŠ¡å±äº Macrotask å‘¢ï¼Œè¿™ï§©æœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ€»ç»“ï¼š</p>
<ul>
<li><strong>Macrotask</strong>ï¼š</li>
</ul>
<p>setTimeoutã€setIntervalã€I/Oã€UI Renderingã€script å½“ä¸­çš„æ‰€æœ‰ä»£ç ã€ setImmediate(Node)</p>
<ul>
<li><strong>Microtask</strong>ï¼š</li>
</ul>
<p>process.nextTick(node) ã€Promise ã€MutationObserver</p>
<blockquote>
<p>Microtask å½“ä¸­å„ç§ä»»åŠ¡çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š process.nextTick &gt; Promise &gt; MutationOberse</p>
</blockquote>
<blockquote>
<p>æ‰¹é‡æ›´æ–°ï¼Œå¯ä»¥åˆ©ç”¨ event-loopï¼Œåœ¨å½“å‰æ•°æ®ä¿®æ”¹ä¹‹åï¼Œæ±‡æ€»æ•°æ®ï¼Œç»Ÿä¸€ä¿®æ”¹ï¼Œå¦‚ React çš„<code>setState</code></p>
</blockquote>
<h2 id="é˜²æŠ–èŠ‚æµ">é˜²æŠ–èŠ‚æµ</h2>
<h3 id="èŠ‚æµ">èŠ‚æµ</h3>
<pre><code class="language-js">function throttle(fn, wait = 500) {
  let lastTime = 0
  return function(...args) {
    let now = new Date()
    if (now - lastTime &gt; wait) {
      lastTime = now
      fn(...args)
    }
  }
}
window.onscroll = throttle(function() {
  console.log('æ‡’åŠ è½½åˆ¤å®šã€æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨åˆ¤å®šâ€¦â€¦')
})
</code></pre>
<h3 id="é˜²æŠ–">é˜²æŠ–</h3>
<pre><code class="language-js">function debounce(fn, wait = 500) {
  let timer = 0
  return function(...arg) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() =&gt; {
      fn(...arg)
    }, wait)
  }
}

window.onscroll = debounce(function() {
  console.log('æ‡’åŠ è½½åˆ¤å®šã€æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨åˆ¤å®šâ€¦â€¦')
})
</code></pre>
<h2 id="æ‡’åŠ è½½">æ‡’åŠ è½½</h2>
<h3 id="å›¾ç‰‡æ‡’åŠ è½½">å›¾ç‰‡æ‡’åŠ è½½</h3>
<pre><code class="language-html">&lt;body&gt;
  &lt;div id=&quot;container&quot;&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img
        data-src=&quot;https://i0.hdslb.com/bfs/album/8e10328d8a35d3acb957bb521170711d02fdece8.jpg@518w_1e_1c.jpg&quot;
        alt=&quot;&quot;
      /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img data-src=&quot;https://i0.hdslb.com/bfs/album/3f9b4b9f8a91806c1daf2ab187f2faec8174d7ae.jpg&quot; alt=&quot;&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img
        data-src=&quot;https://i0.hdslb.com/bfs/album/f14aec7ef14f0c95d359914e0927f9e1f1c3625b.png@518w_1e_1c.png&quot;
        alt=&quot;&quot;
      /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;script&gt;
    const imgs = document.querySelectorAll('img')
    // è·å–å¯è§†åŒºåŸŸé«˜åº¦
    const viewHeight = window.innerHeight || window.documentElement.clientHeight
    console.log(viewHeight, imgs)
    num = 0
    function loadImg() {
      for (let i = 0; i &lt; imgs.length; i++) {
        console.log(imgs[i].getBoundingClientRect().top)
        let dis = viewHeight - imgs[i].getBoundingClientRect().top
        if (dis &gt; 0) {
          imgs[i].src = imgs[i].getAttribute('data-src')
          num = i + 1
        }
      }
    }
    loadImg()
    // èŠ‚æµ
    window.addEventListener(
      'scroll',
      (function(fn, wait = 500) {
        let lastTime = 0
        return function(...args) {
          let now = new Date()
          if (now - lastTime &gt; wait) {
            lastTime = now
            fn(...args)
          }
        }
      })(loadImg),
    )
  &lt;/script&gt;
&lt;/body&gt;
</code></pre>
<h3 id="ç»„ä»¶è·¯ç”±æ‡’åŠ è½½">ç»„ä»¶ï¼ˆè·¯ç”±ï¼‰æ‡’åŠ è½½</h3>
<p>webpack</p>
<h2 id="æœåŠ¡ç«¯æ¸²æŸ“-åŒæ„">æœåŠ¡ç«¯æ¸²æŸ“ &amp;&amp; åŒæ„</h2>
<ol>
<li>æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå°±æ˜¯åœ¨æœåŠ¡ç«¯è§£æé¦–å±çš„ç»„ä»¶ï¼Œäº§å‡º HTMLï¼Œç›´æ¥è¿”å›</li>
<li>å¦‚æœç”¨æˆ·è·³è½¬é¡µé¢ï¼ŒåŒæ„ã€‚æ•´ä¸ªåº”ç”¨æœ‰ä¸¤ä¸ªå…¥å£ï¼š
<ol>
<li>server-entry é¦–æ¬¡è¿›å…¥çš„å…¥å£ï¼Œä½¿ç”¨ ssr</li>
<li>ç”¨æˆ·ç‚¹å‡»è·³è½¬ï¼Œå¦‚æœæ˜¯å•é¡µåº”ç”¨ï¼Œç‚¹å‡»ä¸åˆ·æ–°ï¼Œèµ° js å•é¡µå…¥å£ï¼Œæˆ–è€…å®¢æˆ·ç«¯æ¸²æŸ“å…¥å£</li>
</ol>
</li>
</ol>
<h2 id="ç§»åŠ¨ç«¯ä¼˜åŒ–">ç§»åŠ¨ç«¯ä¼˜åŒ–</h2>
<p>svgã€è™šæ‹Ÿåˆ—è¡¨ã€300ms å»¶è¿Ÿï¼ˆç¦ç”¨ç¼©æ”¾è§£å†³ï¼‰</p>
<p>https://bvaughn.github.io/react-virtualized/#/components/List</p>
<h3 id="vue">Vue</h3>
<p>async-componentã€v-if / v-show</p>
<h3 id="react">React</h3>
<p>purecomponentã€suspense</p>
<h2 id="webpack">webpack</h2>
<ul>
<li>å¯è§†åŒ–ä¼˜åŒ–</li>
</ul>
<pre><code class="language-js">const BundleAnalyzerPlugin = require('webpack-bundleanalyzer').BundleAnalyzerPlugin

module.exports = {
  plugins: [new BundleAnalyzerPlugin()],
}
</code></pre>
<ul>
<li>tree-shaking åˆ é™¤å†—ä½™ä»£ç </li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¸¸è§è®¾è®¡æ¨¡å¼æ€»ç»“]]></title>
        <id>https://yuufen.com/blog/post/_lKjmwEdd/</id>
        <link href="https://yuufen.com/blog/post/_lKjmwEdd/">
        </link>
        <updated>2020-02-27T06:51:31.000Z</updated>
        <content type="html"><![CDATA[<p>åˆ›å»ºè®¾è®¡æ¨¡å¼ï¼šå•ä¾‹ã€å·¥å‚ã€å»ºé€ è€…</p>
<p>ç»“æ„åŒ–è®¾è®¡æ¨¡å¼ï¼šä»£ç†ã€è£…é¥°å™¨ã€å¤–è§‚ã€äº«å…ƒã€é€‚é…å™¨ã€</p>
<p>è¡Œä¸ºå‹ï¼šè§‚å¯Ÿè€…ã€ç­–ç•¥ã€ä¸­ä»‹è€…ã€è¿­ä»£å™¨ã€è´£ä»»é“¾ã€æ¨¡æ¿æ–¹æ³•ã€å¤‡å¿˜å½•</p>
<p>vue &amp; element / react &amp; redux çš„æºç å€¼å¾—å­¦ä¹ </p>
<h2 id="pub-subè®¢é˜…-å‘å¸ƒæ¨¡å¼è§‚å¯Ÿè€…æ¨¡å¼">pub / subï¼ˆè®¢é˜… / å‘å¸ƒæ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼‰</h2>
<h3 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h3>
<p>è§£è€¦ï¼Œé™ä½ä»£ç å…¥ä¾µæ€§</p>
<pre><code class="language-js">åŸå§‹ï¼š
ModuleA
  import B
  B.action()
ModuleB
  action() {
    import C
    C.action()
  }
ModuleC
  action() {
    doSomething()
  }
è§‚å¯Ÿè€…ï¼š
Event
ModuleA
event.emit()
ModuleB
  event.emit()ModuleBevent.on()
event.emit()
ModuleC
  event.emit()ModuleCevent.on()
</code></pre>
<h3 id="ç›®æ ‡-å®ç°">ç›®æ ‡ &amp; å®ç°</h3>
<p>å‚è€ƒ vue</p>
<pre><code class="language-js">// å®ç°ï¼š
class Event {
  constructor() {
    this.callback = {}
  }
  $on(name, fn) {
    ;(this.callback[name] || (this.callback[name] = [])).push(fn)
  }
  $emit(name, ...args) {
    const cbs = this.callback[name]
    if (cbs) {
      cbs.forEach((cb) =&gt; {
        cb.call(this, ...args)
      })
    }
  }
  $off(name) {
    this.callback[name] = null
  }
}
// ç›®æ ‡ï¼š
let event = new Event()
// ç›‘å¬
event.on('event1', (...args) =&amp;gt; {
  console.log('event1', ...args)
})
event.on('event1', (...args) =&gt; {
console.log('event1 again', ...args)
})
// è§¦å‘
event.emit('event1', 1, 2, 3)
// è§£ç»‘
console.log('-'.repeat(20))
event.emit(â€²event1â€²,1,2,3)//è§£ç»‘console.log(â€²âˆ’â€².repeat(20))event.off('event1')
event.$emit('event1', 1, 2, 3) // æµ‹è¯•
</code></pre>
<h2 id="å•ä¾‹æ¨¡å¼">å•ä¾‹æ¨¡å¼</h2>
<p>ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚</p>
<h3 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h3>
<p>å¦‚ï¼š</p>
<ol>
<li>å¼¹çª—ï¼Œæ— è®ºç‚¹å‡»å¤šå°‘æ¬¡éƒ½åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚</li>
<li>redux çš„ storeï¼Œå…¨å±€å”¯ä¸€</li>
</ol>
<h3 id="ç®€å•ä¸¾ä¾‹">ç®€å•ä¸¾ä¾‹</h3>
<pre><code class="language-js">// æ–°å»ºå¼¹çª—ï¼ŒæœŸæœ›å¼¹çª—å…¨å±€å”¯ä¸€
// ä¼ªä»£ç :
// function createModalLayer() {
//   // é—­åŒ…å‚¨å­˜å•ä¾‹å®ä¾‹
//   let result
//   return function() {
//     return result || (result = æ–°å»ºå¼¹çª—)
//   }
// }
// æå–ï¼š
// é«˜é˜¶å‡½æ•°ï¼š
function getSingle(fn) {
  let result
  return function() {
    return result || (result = fn.apply(this, arguments))
  }
}
function createModalLayer() {
  console.log('æ–°å»ºå¼¹çª—')
  const div = document.createElement('div')
  div.innerHTML = new Date()
  div.className = 'modal'
  div.style.display = 'none'
  document.body.appendChild(div)
  div.addEventListener(
    'click',
    function() {
      div.style.display = 'none'
    },
    false,
  )
  return div
}
createModalLayer = getSingle(createModalLayer)
document.getElementById('modal-btn').addEventListener('click', function() {
  // æ–°å»ºå¼¹çª—
  const modalLayer = createModalLayer()
  modalLayer.style.display = 'block'
})
</code></pre>
<h2 id="ç­–ç•¥æ¨¡å¼">ç­–ç•¥æ¨¡å¼</h2>
<h3 id="åˆ†æ">åˆ†æ</h3>
<p>KISS åŸåˆ™ keep it simple and stupid</p>
<p>ç­–ç•¥æ¨¡å¼æŒ‡å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠä»–ä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä½¿ä»–ä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚</p>
<p>ç›®çš„æ˜¯å°†ç®—æ³•çš„ä½¿ç”¨å’Œå®ç°åˆ†ç¦»ã€‚</p>
<p>ä¸€ä¸ªåŸºäºç­–ç•¥æ¨¡å¼çš„ç¨‹åºè‡³å°‘ç”±ä¸¤éƒ¨åˆ†ç»„æˆã€‚ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸€ç»„ç­–ç•¥ç±»ï¼ˆå¯å˜ï¼‰ï¼Œå°è£…äº†å…·ä½“çš„ç®—æ³•ï¼Œè´Ÿè´£å…·ä½“çš„è®¡ç®—è¿‡ç¨‹ï¼›ç¬¬äºŒéƒ¨åˆ†æ˜¯ç¯å¢ƒç±» Contextï¼ˆä¸å˜ï¼‰ï¼ŒContext æ¥æ”¶å®¢æˆ·çš„è¯·æ±‚ï¼Œéšåå°†è¯·æ±‚å§”æ‰˜ç»™æŸä¸€ä¸ªç­–ç•¥ç±»ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯´æ˜ Context ä¸­è¦ç»´æŒå¯¹æŸä¸ªç­–ç•¥å¯¹è±¡çš„å¼•ç”¨ã€‚</p>
<h3 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h3>
<p>åŸå§‹ï¼ˆé¢æ¡å¼ä»£ç ï¼‰ï¼š</p>
<pre><code class="language-js">let form = è·å–è¡¨å•
form.onSubmit = function() {
  if (form.name.value === '') {
    å¼¹å‡ºé”™è¯¯æ¶ˆæ¯
  }
  if (form.password.value === '') {
    å¼¹å‡ºé”™è¯¯æ¶ˆæ¯
  }
  if (form.password.value.length &lt; 5) {
    å¼¹å‡ºé”™è¯¯æ¶ˆæ¯
  }
  æ­£åˆ™ç­‰ç­‰
}
</code></pre>
<p>ç­–ç•¥æ¨¡å¼ï¼ˆå…·ä½“çœ‹ element çš„è¡¨å•éªŒè¯ https://github.com/ElemeFE/element/blob/dev/packages/form/src/form.vue ï¼‰ï¼Œå…¶ä»–ä¾‹å­ï¼š</p>
<pre><code class="language-js">// 1. ç­–ç•¥
// å¯ä»¥ä½¿ç”¨é…ç½®
const policy = {
  S: function(salary) {
    return salary * 4
  },
  A: function(salary) {
    return salary * 3
  },
  B: function(salary) {
    return salary * 2
  },
  C: function(salary) {
    return salary
  },
}
// 2. ä½¿ç”¨
function calculate(level, salary) {
  return policy[level] ? policy[level](salary) : 0
}
</code></pre>
<h2 id="ä»£ç†æ¨¡å¼">ä»£ç†æ¨¡å¼</h2>
<p>å®šä¹‰ï¼šä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªå ç”¨å“æˆ–å ä½ç¬¦ï¼Œä»¥ä¾¿æ§åˆ¶å¯¹å®ƒçš„è®¿é—®ã€‚</p>
<p>å¸¸ç”¨çš„è™šæ‹Ÿä»£ç†å½¢å¼ï¼šæŸèŠ±é”€å¾ˆå¤§çš„æ“ä½œï¼Œå¯é€šè¿‡è™šæ‹Ÿä»£ç†çš„æ–¹å¼å»¶è¿Ÿåˆ°éœ€è¦å®ƒçš„æ—¶å€™å†åˆ›å»ºï¼ˆå¦‚ä½¿ç”¨è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡æ‡’åŠ è½½ï¼‰ã€‚</p>
<h3 id="é€‚ç”¨åœºæ™¯-2">é€‚ç”¨åœºæ™¯</h3>
<ol>
<li>å›¾ç‰‡æ‡’åŠ è½½çš„æ–¹å¼ï¼šå…ˆé€šè¿‡ä¸€å¼  loading å›¾å ä½ï¼Œç„¶ååŒé€šè¿‡å¼‚æ­¥çš„æ–¹å¼åŠ è½½å›¾ç‰‡ï¼Œç­‰å›¾ç‰‡åŠ è½½å¥½äº†å†æŠŠå®Œæˆçš„å›¾ç‰‡åŠ è½½åˆ° img æ ‡ç­¾é‡Œé¢ã€‚</li>
</ol>
<pre><code class="language-js">// ç»™å›¾ç‰‡å®ä¾‹ä¸€ä¸ªsetSrcæ–¹æ³•ï¼Œå…ˆè®¾ç½®loadingï¼Œå†æ˜¾ç¤ºå›¾ç‰‡
const imgFunc = (function() {
  let imgNode = document.createElement('img')
  document.body.appendChild(imgNode)
  return {
    setSrc: function(src) {
      // è€—æ—¶
      imgNode.src = src
    },
  }
})()
// ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œå¢åŠ  loading
const proxyImage = (function() {
  let img = new Image()
  // åŠ è½½å®Œæ¯•ï¼Œå†è®¾ç½®
  img.onload = function() {
    setTimeout(() =&gt; {
      imgFunc.setSrc(this.src)
    }, 500)
  }
  return {
    setSrc(src) {
      // å…ˆè®¾ç½® loading
      imgFunc.setSrc('loading.gif')
      img.src = src
    },
  }
})()
proxyImage.setSrc('https://yuufen.com/album/photography/2.jpg')
</code></pre>
<ol>
<li>é€šè¿‡ä¸€ä¸ªä»£ç†å‡½æ•°æ”¶é›†ä¸€æ®µæ—¶é—´ä¹‹å†…çš„è¯·æ±‚ï¼Œæœ€åä¸€æ¬¡æ€§å‘é€ç»™æœåŠ¡å™¨ã€‚</li>
</ol>
<pre><code class="language-js">var synchronousFile = function(id) {
  console.log('å¼€å§‹åŒæ­¥â½‚æ–‡ä»¶ï¼Œid ä¸º: ' + id)
}
var proxySynchronousFile = (function() {
  var cache = [], // ä¿å­˜â¼€ä¸€æ®µæ—¶é—´å†…éœ€è¦åŒæ­¥çš„ ID
    timer // å®šæ—¶å™¨
  return function(id) {
    cache.push(id)
    if (timer) {
      // ä¿è¯ä¸ï¥§ä¼šè¦†ç›–å·²ç»å¯åŠ¨çš„å®šæ—¶å™¨ï¨¸
      return
    }
    timer = setTimeout(function() {
      synchronousFile(cache.join(','))
      clearTimeout(timer) // æ¸…ç©ºå®šæ—¶å™¨ï¨¸
      timer = null
      cache.length = 0 // æ¸…ç©º ID é›†åˆ
    }, 2000)
  } // 2 ç§’åå‘æœ¬ä½“å‘é€éœ€è¦åŒæ­¥çš„ ID é›†åˆ
})()
var checkbox = document.getElementsByTagName('input')
for (var i = 0, c; (c = checkbox[i++]); ) {
  c.onclick = function() {
    if (this.checked === true) {
      proxySynchronousFile(this.id)
    }
  }
}
</code></pre>
<ol>
<li>å‡½æ•°çš„é˜²æŠ–èŠ‚æµã€‚</li>
<li>React çš„ CSS ä»£ç†ã€‚</li>
</ol>
<h2 id="ä¸­ä»‹è€…æ¨¡å¼">ä¸­ä»‹è€…æ¨¡å¼</h2>
<p>å¦‚ redux / vuexï¼ŒæŠŠå…±äº«çš„æ•°æ®æŠ½ç¦»æˆä¸€ä¸ªå•ç‹¬çš„ storeï¼Œæ¯ä¸ªéƒ½é€šè¿‡ store è¿™ä¸ªä¸­ä»‹æ¥æ“ä½œå¯¹è±¡ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šå¦‚è´­ç‰©è½¦éœ€æ±‚ï¼Œå­˜åœ¨å•†å“é€‰æ‹©è¡¨å•ã€é¢œè‰²é€‰æ‹©è¡¨å•ã€è´­ä¹°æ•°é‡è¡¨å•ç­‰ï¼Œéƒ½ä¼šè§¦å‘ change äº‹ä»¶ã€‚</p>
<p>é€šè¿‡ä¸­ä»‹è€…æ¥è½¬å‘å¤„ç†è¿™äº›äº‹ä»¶ï¼Œå®ç°å„ä¸ªäº‹ä»¶ä¹‹é—´çš„è§£è€¦ï¼Œä»…ä»…ç»´æŠ¤ä¸­ä»‹è€…å¯¹è±¡å³å¯ã€‚</p>
<h2 id="è£…é¥°å™¨æ¨¡å¼">è£…é¥°å™¨æ¨¡å¼</h2>
<h3 id="å’Œä»£ç†æ¨¡å¼çš„å¼‚åŒ">å’Œä»£ç†æ¨¡å¼çš„å¼‚åŒ</h3>
<p>ä¸¤ç§æ¨¡å¼éƒ½æè¿°äº†æ€æ ·ä¸ºå¯¹è±¡æä¾›ä¸€å®šç¨‹åº¦ä¸Šçš„é—´æ¥å¼•ç”¨ï¼Œä»–ä»¬çš„å®ç°éƒ¨åˆ†éƒ½ä¿ç•™äº†å¯¹å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”å‘é‚£ä¸ªå¯¹è±¡å‘é€è¯·æ±‚ã€‚</p>
<p>ä»£ç†æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼æœ€é‡è¦çš„åŒºåˆ«åœ¨äºå®ƒä»¬çš„æ„å›¾å’Œè®¾è®¡ç›®çš„ã€‚</p>
<p>ä»£ç†æ¨¡å¼çš„ç›®çš„æ˜¯ï¼Œå½“ç›´æ¥è®¿é—®æœ¬ä½“ä¸æ–¹ä¾¿æˆ–è€…ä¸ç¬¦åˆéœ€è¦æ—¶ï¼Œä¸ºè¿™ä¸ªæœ¬ä½“æä¾›ä¸€ä¸ªæ›¿ä»£è€…ã€‚æœ¬ä½“å®šä¹‰äº†å…³é”®åŠŸèƒ½ï¼Œè€Œä»£ç†æä¾›æˆ–æ‹’ç»å¯¹å®ƒçš„è®¿é—®ï¼Œæˆ–è€…åœ¨è®¿é—®æœ¬ä½“ä¹‹å‰åšä¸€äº›é¢å¤–çš„äº‹æƒ…ã€‚</p>
<p>è£…é¥°å™¨æ¨¡å¼çš„ä½œç”¨åˆ™æ˜¯ä¸ºå¯¹è±¡åŠ¨æ€çš„åŠ å…¥è¡Œä¸ºã€‚</p>
<h3 id="ä¸¾ä¾‹-2">ä¸¾ä¾‹</h3>
<p>å¦‚ React çš„é«˜é˜¶ç»„ä»¶</p>
<pre><code class="language-js">import React from 'react'
// ç»Ÿè®¡æ¸²æŸ“æ—¥å¿—
const withLog = (Component) =&gt; {
  class NewComponent extends React.Component {
    componentWillMount() {
      console.time('componentRender')
    }
    render() {
      return &lt;Component {...this.props}&gt;&lt;/Component&gt;
    }
    componentDidMount() {
      console.timeEnd('componentRender')
    }
  }
  return NewComponent
}
export {withLog}
// è£…é¥°
@withLog
class XXX
// æˆ–è€…
// class XXX
// XXX = withLog(XXX)
</code></pre>
<pre><code class="language-js">// ä¾æ­¤å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­å®ç°ç»Ÿä¸€é…ç½®
Function.prototype.before = function(beforefn) {
  var __self = this // ä¿å­˜å¯¹åŸå‡½æ•°çš„å¼•ç”¨
  return function() {
    //è¿”å›åŒ…å«åŸå‡½æ•°å’Œæ–°å‡½æ•°çš„â€œä»£ç†â€å‡½æ•°
    beforefn.apply(this, arguments) // æ–°å‡½æ•°åœ¨åŸå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œå¹¶ä¿è¯ this ä¸è¢«åŠ«æŒ
    return __self.apply(this, arguments) // è¿”å›åŸå‡½æ•°çš„æ‰§è¡Œç»“æ„ï¼Œå¹¶ä¿è¯ this ä¸è¢«åŠ«æŒ
  }
}
Function.prototype.after = function(afterfn) {
  var __self = this
  return function() {
    var ret = __self.apply(this, arguments)
    afterfn.apply(this, arguments)
    return ret
  }
}
</code></pre>
<h2 id="å¤–è§‚æ¨¡å¼">å¤–è§‚æ¨¡å¼</h2>
<p>æ¶‰åŠåˆ°å…¼å®¹æ€§ã€å‚æ•°æ”¯æŒå¤šæ ¼å¼ç­‰ï¼Œå¯¹å¤–æš´éœ²ç»Ÿä¸€çš„ APIï¼Œå†…éƒ¨åˆ¤æ–­å®ç°ã€‚è®© API æ›´ç²¾ç®€ã€‚</p>
<h2 id="å·¥å‚æ¨¡å¼">å·¥å‚æ¨¡å¼</h2>
<p>æä¾›åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼ŒæŠŠæˆå‘˜å¯¹è±¡çš„åˆ›å»ºå·¥ä½œè½¬äº¤ç»™ä¸€ä¸ªå¤–éƒ¨å¯¹è±¡ã€‚å¥½å¤„åœ¨äºæ¶ˆé™¤å¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼ˆä¹Ÿå°±æ˜¯ç›¸äº’å½±å“ï¼‰ã€‚å¸¸è§çš„ä¾‹å­ï¼šå¼¹çª—ã€Messageï¼Œå¯¹å¤–æä¾› apiï¼Œè°ƒç”¨ api æ–°å»ºä¸€ä¸ªå¼¹çª—æˆ–è€… Message çš„å®ä¾‹ã€‚</p>
<h3 id="ä¸¾ä¾‹-3">ä¸¾ä¾‹</h3>
<p>https://github.com/ElemeFE/element/blob/dev/packages/notification/src/main.js</p>
<h2 id="å»ºé€ è€…æ¨¡å¼-builder">å»ºé€ è€…æ¨¡å¼ builder</h2>
<p>å’Œå·¥å‚æ¨¡å¼ç›¸æ¯”ï¼Œå‚ä¸äº†æ›´å¤šæˆ–æ›´å¤æ‚çš„åˆ›å»ºçš„è¿‡ç¨‹ã€‚</p>
<pre><code class="language-js">var Person = function(name, work) {
  var _person = new Human()
  _person.name = new Named(name)
  _person.work = new Work(work)
  return _person
}
var person = new Person('Ming', 'code')
console.log(person)
</code></pre>
<h2 id="è¿­ä»£å™¨æ¨¡å¼">è¿­ä»£å™¨æ¨¡å¼</h2>
<blockquote>
<p>è¿­ä»£å™¨ï¨¸æ¨¡å¼æ˜¯æŒ‡æä¾›â¼€ç§â½…æ³•é¡ºåºè®¿é—®â¼€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œâ½½åˆï¥§è¦ï¨†ï¤¸è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚è¿­ä»£å™¨æ¨¡å¼å¯ä»¥æŠŠè¿­ä»£çš„è¿‡ç¨‹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥,åœ¨ä½¿ç”¨è¿­ä»£ï¨¸æ¨¡å¼ä¹‹åï¼Œå³ä½¿ä¸å…³å¿ƒå¯¹è±¡çš„å†…éƒ¨æ„é€ ï¼Œä¹Ÿå¯ä»¥æŒ‰é¡ºåºè®¿é—®å…¶ä¸­çš„æ¯ä¸ªå…ƒç´ </p>
</blockquote>
<p>eachã€map ç­‰ç­‰ç­‰ç­‰å¤ªå¤šäº†</p>
<pre><code class="language-js">var each = function(ary, callback) {
  for (var i = 0, l = ary.length; i &lt; l; i++) {
    callback.call(ary[i], i, ary[i])
  }
}
each([1, 2, 3], function(i, n) {
  alert([i, n])
})
</code></pre>
<h2 id="äº«å…ƒæ¨¡å¼">äº«å…ƒæ¨¡å¼</h2>
<blockquote>
<p>äº«å…ƒ(ï¬‚yweight)æ¨¡å¼æ˜¯â¼€ç§ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„æ¨¡å¼ï¼Œâ€œï¬‚yâ€åœ¨è¿™â¾¥æ˜¯è‹è‡çš„æ„æ€ï¼Œæ„ä¸ºè‡ï¥¾çº§ã€‚äº«å…ƒæ¨¡å¼çš„æ ¸â¼¼æ˜¯è¿â½¤å…±äº«æŠ€æœ¯æ¥æœ‰æ•ˆâ½€æŒâ¼¤é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚ å¦‚æœç³»ç»Ÿä¸­å› ä¸ºåˆ›å»ºäº†â¼¤é‡ç±»ä¼¼çš„å¯¹è±¡è€Œå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ï¼Œäº«å…ƒæ¨¡å¼å°±éå¸¸æœ‰â½¤äº†ã€‚åœ¨ JavaScript ä¸­ï¼Œæµè§ˆï¨¸ç‰¹åˆ«æ˜¯ç§»åŠ¨ç«¯çš„æµè§ˆå™¨åˆ†é…çš„å†…å­˜å¹¶ï¥§ç®—å¤šï¼Œå¦‚ä½•èŠ‚çœå†…å­˜å°±æˆï¦ºä¸€ä»¶â¾®å¸¸æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚</p>
</blockquote>
<p>æ¯”å¦‚åªåˆ›å»ºå°‘æ•°å¼¹çª—å¯¹è±¡ï¼ŒåŠ¨æ€ä¿®æ”¹å¼¹çª—å†…å®¹ã€‚</p>
<ul>
<li>å†…éƒ¨çŠ¶æ€å‚¨å­˜äºå¯¹è±¡å†…éƒ¨ ï¼ˆå¦‚å¼¹çª—çš„ä½ç½®ã€border ç­‰ï¼‰</li>
<li>å†…éƒ¨çŠ¶æ€å¯ä»¥è¢«ä¸€äº›å¯¹è±¡å…±äº«</li>
<li>å†…éƒ¨çŠ¶æ€ç‹¬ç«‹äºå…·ä½“çš„åœºæ™¯ï¼Œé€šå¸¸ä¸ä¼šæ”¹å˜</li>
<li>å¤–éƒ¨çŠ¶æ€å–å†³äºå…·ä½“çš„åœºæ™¯ï¼Œå¹¶æ ¹æ®åœºæ™¯è€Œå˜åŒ–ï¼Œå¤–éƒ¨çŠ¶æ€ä¸èƒ½è¢«å…±äº« ï¼ˆå¦‚å¼¹çª—æ–‡æ¡ˆï¼‰</li>
</ul>
<h2 id="è´£ä»»é“¾æ¨¡å¼">è´£ä»»é“¾æ¨¡å¼</h2>
<ul>
<li>ä¸­é—´ä»¶æœºåˆ¶</li>
</ul>
<blockquote>
<p>ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»â½½é¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œ å°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰â¼€ä¸ªå¯¹è±¡å¤„ï§¤å®ƒä¸ºæ­¢ã€‚ èŒè´£é“¾æ¨¡å¼çš„åå­—â¾®å¸¸å½¢è±¡ï¼Œâ¼€ç³»åˆ—å¯èƒ½ä¼šå¤„ç†è¯·æ±‚çš„å¯¹è±¡è¢«è¿æ¥æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚åœ¨è¿™äº›å¯¹è±¡ä¹‹é—´ä¾æ¬¡ä¼ é€’ï¼Œç›´åˆ°é‡åˆ°â¼€ä¸ª å¯ä»¥å¤„ï§¤å®ƒçš„å¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠè¿™äº›å¯¹è±¡ç§°ä¸ºé“¾ä¸­çš„èŠ‚ç‚¹</p>
</blockquote>
<ul>
<li>å‡è®¾æˆ‘ä»¬è´Ÿè´£â¼€ä¸ªå”®å–â¼¿æ‰‹æœºçš„ç”µå•†ç½‘ç«™ï¼Œç»è¿‡åˆ†åˆ«äº¤çº³ 500 å…ƒå®šï¤Šå’Œ 200 å…ƒå®šï¤Šçš„ä¸¤è½®é¢„å®šå(è®¢å•å·²åœ¨æ­¤æ—¶ç”Ÿæˆ)ï¼Œç°åœ¨å·²ç»åˆ°äº†æ­£å¼è´­ä¹°çš„é˜¶æ®µã€‚ å…¬å¸é’ˆå¯¹â½€ä»˜è¿‡å®šï¤Šçš„ç”¨æˆ·æœ‰ä¸€å®šçš„ä¼˜æƒ æ”¿ç­–ã€‚åœ¨æ­£å¼è´­ä¹°åï¼Œå·²ç»æ”¯ä»˜è¿‡ 500 å…ƒå®šï¤Šçš„ç”¨æˆ·ä¼šæ”¶åˆ° 100 å…ƒçš„å•†åŸä¼˜æƒ åˆ¸ï¼Œ200 å…ƒå®šï¤Šçš„ç”¨æˆ·å¯ä»¥æ”¶åˆ° 50 å…ƒçš„ä¼˜æƒ åˆ¸ï¼Œè€Œä¹‹å‰æ²¡æœ‰æ”¯ä»˜å®šï¤Šçš„ç”¨æˆ·åªèƒ½è¿›å…¥æ™®é€šè´­ä¹°æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä¼˜æƒ åˆ¸ï¼Œä¸”åœ¨åº“å­˜æœ‰é™çš„æƒ…å†µä¸‹ï¼Œä¸ä¸€å®šä¿è¯èƒ½ä¹°åˆ°ã€‚</li>
<li>æ¯”èµ· if åµŒå¥—ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæŠŠ 500 å…ƒè®¢å•ã€200 å…ƒè®¢å•ä»¥åŠæ™®é€šè´­ä¹°åˆ†æˆ 3 ä¸ªå‡½æ•°ã€‚æ¥ä¸‹æ¥æŠŠ orderTypeã€payã€stock è¿™ 3 ä¸ªå­—æ®µå½“ä½œå‚æ•°ä¼ é€’ç»™ 500 å…ƒè®¢å•å‡½æ•°ï¼Œå¦‚æœè¯¥å‡½æ•°ï¥§ç¬¦åˆå¤„ï§¤æ¡ä»¶ï¼Œåˆ™æŠŠè¿™ä¸ªè¯·æ±‚ä¼ é€’ç»™åé¢çš„ 200 å…ƒè®¢å•å‡½æ•°ï¼Œå¦‚æœ 200 å…ƒè®¢å•å‡½æ•°ä¾ç„¶ä¸èƒ½å¤„ï§¤è¯¥è¯·æ±‚ï¼Œåˆ™ç»§ç»­ä¼ é€’è¯·æ±‚ç»™æ™®é€šè´­ä¹°å‡½æ•°</li>
<li>è¿™æ ·æˆ‘ä»¬å¯ä»¥è‡ªç”±çµæ´»åœ°å¢åŠ ã€ç§»é™¤å’Œä¿®æ”¹é“¾ä¸­çš„èŠ‚ç‚¹é¡ºåºï¼Œå‡å¦‚æŸå¤©ç½‘ç«™è¿è¥äººå‘˜ åˆæƒ³å‡ºï¦ºæ”¯æŒ 300 å…ƒå®šï¤Šè´­ä¹°ï¼Œé‚£æˆ‘ä»¬å°±åœ¨è¯¥é“¾ä¸­å¢åŠ â¼€ä¸ªèŠ‚ç‚¹å³å¯</li>
</ul>
<pre><code class="language-js">var order500 = function(orderType, pay, stock) {
  if (orderType === 1 &amp;&amp; pay === true) {
    console.log('500 å…ƒå®šé‡‘é¢„è´­ï¼Œå¾— 100 å…ƒä¼˜æƒ ')
  } else {
    return 'nextSuccessor' // æˆ‘ä¸çŸ¥é“ä¸‹ä¸ªèŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œåæ­£æŠŠè¯·æ±‚å¾€åä¼ 
  }
}
var order200 = function(orderType, pay, stock) {
  if (orderType === 2 &amp;&amp; pay === true) {
    console.log('200 å…ƒå®šé‡‘é¢„è´­ï¼Œå¾— 50 å…ƒä¼˜æƒ ')
  } else {
    return 'nextSuccessor' // æˆ‘ä¸çŸ¥é“ä¸‹ä¸ªèŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œåæ­£æŠŠè¯·æ±‚å¾€åä¼ 
  }
}
var orderNormal = function(orderType, pay, stock) {
  if (stock &gt; 0) {
    console.log('æ™®é€šè´­ä¹°')
  } else {
    console.log('æ²¡åº“å­˜äº†')
  }
}
// Chain.prototype.setNextSuccessor æŒ‡å®šåœ¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
// Chain.prototype.passRequest ä¼ é€’è¯·æ±‚ç»™æŸä¸ªèŠ‚ç‚¹
var Chain = function(fn) {
  this.fn = fn
  this.successor = null
}
Chain.prototype.setNextSuccessor = function(successor) {
  return (this.successor = successor)
}
Chain.prototype.passRequest = function() {
  var ret = this.fn.apply(this, arguments)
  if (ret === 'nextSuccessor') {
    return this.successor &amp;&amp; this.successor.passRequest.apply(this.successor, arguments)
  }
  return ret
}
var chainOrder500 = new Chain(order500)
var chainOrder200 = new Chain(order200)
var chainOrderNormal = new Chain(orderNormal)
chainOrder500.setNextSuccessor(chainOrder200)
chainOrder200.setNextSuccessor(chainOrderNormal)
chainOrder500.passRequest(1, true, 500) // 500 å…ƒå®šé‡‘é¢„è´­ï¼Œå¾— 100 å…ƒä¼˜æƒ 
chainOrder500.passRequest(2, true, 500) // 200 å…ƒå®šé‡‘é¢„è´­ï¼Œå¾— 50 å…ƒä¼˜æƒ 
chainOrder500.passRequest(3, true, 500) // æ™®é€šè´­ä¹°
chainOrder500.passRequest(1, false, 0) // æ²¡åº“å­˜äº†
</code></pre>
<p>koa æºç è¿˜å°†æ•´ä¸ªé“¾æ¡åˆå¹¶ä¸ºä¸€ä¸ªå‡½æ•°ã€‚</p>
<h2 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</h2>
<blockquote>
<p>é€‚é…å™¨æ¨¡å¼çš„ä½œç”¨æ˜¯è§£å†³ä¸¤ä¸ªè½¯ä»¶å®ä½“é—´çš„æ¥å£ï¥§å…¼å®¹çš„é—®é¢˜ã€‚ä½¿ç”¨é€‚é…ï¨¸æ¨¡å¼ä¹‹åï¼ŒåŸæœ¬ç”±äºæ¥å£ï¥§å…¼å®¹è€Œï¥§èƒ½å·¥ä½œçš„ä¸¤ä¸ªè½¯ä»¶å®ä½“å¯ä»¥ä¸€èµ·å·¥ä½œã€‚ é€‚é…ï¨¸çš„åˆ«åæ˜¯åŒ…è£…ï¨¸(wrapper)ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„æ¨¡å¼ã€‚åœ¨ç¨‹åºå¼€å‘ä¸­æœ‰è®¸å¤šè¿™æ ·çš„åœºæ™¯ï¼šå½“æˆ‘ä»¬è¯•å›¾è°ƒç”¨æ¨¡å—æˆ–è€…å¯¹è±¡çš„æŸä¸ªæ¥å£ æ—¶ï¼Œå´å‘ç°è¿™ä¸ªæ¥å£çš„æ ¼å¼å¹¶ï¥§ç¬¦åˆç›®å‰çš„éœ€æ±‚ã€‚ è¿™æ—¶å€™æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼Œç¬¬ä¸€ç§æ˜¯ä¿®æ”¹åŸæ¥çš„æ¥å£å®ç°ï¼Œä½†å¦‚æœåŸæ¥çš„æ¨¡å—å¾ˆå¤æ‚ï¼Œæˆ–è€…æˆ‘ä»¬æ‹¿åˆ°çš„æ¨¡å—æ˜¯ä¸€æ®µåˆ«äººç¼–å†™çš„ç»è¿‡å‹ç¼©çš„ä»£ç ï¼Œ ä¿®æ”¹åŸæ¥å£å°±æ˜¾å¾—ï¥§å¤ªç°å®ï¦ºã€‚ç¬¬äºŒç§åŠæ³•æ˜¯åˆ›å»ºä¸€ä¸ªé€‚é…ï¨¸ï¼Œå°†åŸæ¥å£è½¬æ¢ä¸ºå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œå®¢æˆ·åªéœ€è¦å’Œé€‚é…ï¨¸æ‰“äº¤é“ã€‚</p>
</blockquote>
<p>å¦‚ JSONï¼Œæ•°æ®äº¤æ¢çš„æ ¼å¼ï¼Œå¤šè¯­è¨€é—´æ•°æ®äº¤æ¢çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>é€‚é…å™¨ä¸å…³å¿ƒæ¥å£æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä¼šæ€æ ·æ¼”åŒ–ï¼Œä¹Ÿä¸æ”¹å˜å·²æœ‰æ¥å£ã€‚</p>
<p>è£…é¥°å™¨æ¨¡å¼å’Œä»£ç†æ¨¡å¼ä¹Ÿä¸ä¼šæ”¹å˜åŸæœ‰å¯¹è±¡çš„æ¥å£ï¼Œä½†è£…é¥°å™¨çš„ä½œç”¨æ˜¯ç»™å¯¹è±¡å¢åŠ åŠŸèƒ½ï¼Œå¸¸å¸¸å½¢æˆä¸€æ¡é•¿çš„è£…é¥°é“¾ï¼›è€Œé€‚é…å™¨æ¨¡å¼é€šå¸¸åªåŒ…è£…ä¸€æ¬¡ï¼›ä»£ç†æ¨¡å¼æ˜¯ä¸ºäº†æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®ï¼Œé€šå¸¸ä¹ŸåªåŒ…è£…ä¸€æ¬¡ã€‚</p>
<p>å¤–è§‚æ¨¡å¼çš„ä½œç”¨ä¸é€‚é…å™¨è¾ƒç›¸ä¼¼ï¼Œæœ‰äººæŠŠå¤–è§‚æ¨¡å¼çœ‹æˆä¸€ç»„å¯¹è±¡çš„é€‚é…å™¨ï¼Œä½†å¤–è§‚æ¨¡å¼æœ€æ˜¾è‘—çš„ç‰¹ç‚¹æ˜¯å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ¥å£ã€‚</p>
<pre><code class="language-js">var googleMap = {
  show: function() {},
}
var baiduMap = {
  display: function() {},
}
var baiduMapAdapter = {
  show: function() {
    return baiduMap.display()
  },
}
renderMap(googleMap)
renderMap(baiduMapAdapter)
</code></pre>
<h2 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼">æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h2>
<blockquote>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³• ä½¿å¾—å­ç±»å¯ä»¥åœ¨ï¥§æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•ä¸­æŸäº›æ­¥éª¤çš„å…·ä½“å®ç°</p>
</blockquote>
<p>å¦‚æ’æ§½ï¼ˆvue ä¸­çš„ slotã€react ä¸­çš„ childrenï¼‰</p>
<pre><code class="language-js">class Parent {
  constructor() {}
  render() {
    ;&lt;div&gt;
      &lt;div&gt;{this.props.children}&lt;/div&gt;
    &lt;/div&gt;
  }
}
class Stage {
  constructor() {}
  render() {
    // åœ¨ Parent ä¸­å·²ç»è®¾å®šäº† children çš„æ¸²æŸ“ä½ç½®ç®—æ³•
    ;&lt;Parent&gt;
      // children çš„å…·ä½“å®ç°
      &lt;div&gt;child&lt;/div&gt;
    &lt;/Parent&gt;
  }
}
</code></pre>
<h2 id="å¤‡å¿˜å½•æ¨¡å¼">å¤‡å¿˜å½•æ¨¡å¼</h2>
<p>å¯ä»¥æ¢å¤å¯¹è±¡åˆ°ä¹‹å‰çš„æŸä¸ªçŠ¶æ€ã€‚</p>
<p>å¦‚ react æˆ– redux çš„æ—¶é—´æ—…è¡Œã€‚</p>
<p>https://zh-hans.reactjs.org/tutorial/tutorial.html#implementing-time-travel</p>
]]></content>
    </entry>
</feed>