<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://yuufen.com/blog</id>
    <title>YuuFen</title>
    <updated>2020-03-09T18:28:19.200Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://yuufen.com/blog"/>
    <link rel="self" href="https://yuufen.com/blog/atom.xml"/>
    <subtitle>å¸Œæœ›ä½ å¯ä»¥è®°ä½æˆ‘</subtitle>
    <logo>https://yuufen.com/blog/images/avatar.png</logo>
    <icon>https://yuufen.com/blog/favicon.ico</icon>
    <rights>All rights reserved 2020, YuuFen</rights>
    <entry>
        <title type="html"><![CDATA[ä½ å¥½å‘€ï¼Œé™Œç”Ÿäºº]]></title>
        <id>https://yuufen.com/blog/post/about/</id>
        <link href="https://yuufen.com/blog/post/about/">
        </link>
        <updated>2024-02-28T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤</p>
</blockquote>
<h2 id="å…³äºæœ¬ç«™">ğŸ  å…³äºæœ¬ç«™</h2>
<p>å› ä¸ºç¬”è®°å¤ªå¤šå¤ªæ‚ï¼Œå†³å®šå®šæœŸå†™å†™åšå®¢æ•´ç†æ•´ç†ç¬”è®°ã€‚</p>
<p><s>ç„¶åå› ä¸ºå„ç§åŸå› å¤±å»äº†åŠ¨åŠ›</s></p>
<p><s>å› æ­¤æä¸¢äº†å¥½å¤šç¬”è®°å•Šå•Šå•Šå•Šå•Šå•Šå•ŠğŸ˜­ğŸ˜­ğŸ˜­</s></p>
<p><s>çœ‹äº†çœ‹ä¸€å¹´å‰çš„åšæ–‡å‘ç°è‡ªå·±çœŸçš„å˜åŒ–äº†è›®å¤šçš„ï¼ˆåŠ æ²¹ğŸ’ªï¼‰</s></p>
<p>æ€»ä¹‹ç°åœ¨åˆå¼€å§‹äº†</p>
<h2 id="å…³äºæˆ‘">ğŸŸ å…³äºæˆ‘</h2>
<p>æˆ‘ç›®å‰å¤§äºŒåœ¨è¯»ï¼Œæˆ‘çš„èŒä¸šè§„åˆ’æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œæˆ‘çš„ä¸“ä¸šæ˜¯ç”µå­ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘è¿˜äº†è§£ä¸€äº›åµŒå…¥å¼å¼€å‘ï¼ˆå½“ç„¶åªæ˜¯ä¸€äº›äº›ï¼‰ï¼Œå¯¹Pythonå’ŒTensorFlowä¹Ÿæœ‰ä¸€å®šçš„æ¶‰çŒã€‚æˆ‘æ­£åœ¨åŠªåŠ›å¯»æ‰¾æš‘æœŸå®ä¹ ï¼</p>
<p>åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æœ‰å…³æˆ‘çš„æ›´å¤šä¿¡æ¯ï¼š</p>
<p><a href="https://yuufen.com/" target="_blank" class="text-button">ä¸»é¡µ</a><a href="https://yuufen.com/blog" target="_blank" class="text-button">åšå®¢</a><a href="https://github.com/yuuFen" target="_blank" class="text-button">é¡¹ç›®</a><a href="mailto:me@yuufen.com" class="text-button">ç»™æˆ‘å‘é‚®ä»¶</a></p>
<h2 id="å…´è¶£çˆ±å¥½">ğŸ¨ å…´è¶£çˆ±å¥½</h2>
<p><strong>æ‘„å½±</strong>ã€ç¾½æ¯›çƒã€è½®æ»‘ï¼Œand playing!</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è™šæ‹Ÿ DOM æ·±å…¥ä¸ç®€å•å®ç°]]></title>
        <id>https://yuufen.com/blog/post/M0Xa7RsWm/</id>
        <link href="https://yuufen.com/blog/post/M0Xa7RsWm/">
        </link>
        <updated>2020-03-07T20:24:31.000Z</updated>
        <content type="html"><![CDATA[<ul>
<li></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æºç è§£æ]]></title>
        <id>https://yuufen.com/blog/post/jD_rI1NpH/</id>
        <link href="https://yuufen.com/blog/post/jD_rI1NpH/">
        </link>
        <updated>2020-03-04T18:22:09.000Z</updated>
        <content type="html"><![CDATA[<center>
        <a href="https://yuufen.com/blog/post/28tbvr2E1/">å¯åŠ¨é¡¹ç›®ä¸å…¥å£æ–‡ä»¶åˆ†æ</a>
</center>
<center>
        <a href="https://yuufen.com/blog/post/sW2ztpxVO/">ä» Vue å£°æ˜å‘æ•£</a>
</center>]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ€»ç»“]]></title>
        <id>https://yuufen.com/blog/post/xYd9Z_Vfp/</id>
        <link href="https://yuufen.com/blog/post/xYd9Z_Vfp/">
        </link>
        <updated>2020-03-02T06:21:58.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<h2 id="æ–°ç©æ„prepack">æ–°ç©æ„ï¼šPrepack</h2>
<p>åœ¨ç¼–è¯‘é˜¶æ®µåšé¢„è®¡ç®—<br>
<a href="prepack.io">prepack.io</a></p>
</blockquote>
<h2 id="ä»è¾“å…¥-url-åˆ°æ˜¾ç¤ºé¡µé¢å‘ç”Ÿäº†ä»€ä¹ˆ">ä»è¾“å…¥ url åˆ°æ˜¾ç¤ºé¡µé¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>ä»è¾“å…¥ url åˆ°æ˜¾ç¤ºé¡µé¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li>ç”¨æˆ·è¾“å…¥ yuufen.com</li>
<li>æµè§ˆå™¨é€šè¿‡ DNSï¼ŒæŠŠ url è§£æä¸º IP</li>
<li>å’Œ IP åœ°å€å»ºç«‹ TCP è¿æ¥ï¼Œå‘é€ HTTP è¯·æ±‚</li>
<li>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼ŒæŸ¥åº“ï¼Œè¯»æ–‡ä»¶ç­‰ï¼Œæ‹¼æ¥å¥½è¿”å›çš„ HTTP å“åº”</li>
<li>æµè§ˆå™¨æ”¶åˆ°é¦–å± htmlï¼Œå¼€å§‹æ¸²æŸ“</li>
<li>è§£æ html ä¸º domï¼ˆåŒæ—¶åŠ è½½é¢å¤–çš„ css å’Œ jsï¼‰</li>
<li>è§£æ css ä¸º css-treeï¼ˆCSS é€‰æ‹©å™¨ä»<strong>å³</strong>å‘å·¦è¿‡æ»¤æŸ¥æ‰¾ï¼‰</li>
<li>dom + css ç”Ÿæˆ render-treeï¼Œç»˜å›¾</li>
</ol>
<p>è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„é¢è¯•é¢˜ï¼Œè¿™ä¸ªé¢˜çš„ç­”æ¡ˆåŒ…å«ç€æ•´ä¸ªäº’è”ç½‘è¿è¡Œçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ€§èƒ½ä¼˜åŒ–çš„ç­–ç•¥å°±æ˜¯åŸºäºå®ƒçš„ç­”æ¡ˆï¼Œé’ˆå¯¹æ¯ä¸€æ­¥ä¾æ¬¡è§£æï¼Œè®©æ•´ä½“çš„æ—¶é—´å˜çŸ­ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªå¤§æ–¹å‘ï¼š</p>
<ol>
<li>å°‘åŠ è½½æ–‡ä»¶</li>
<li>å°‘æ‰§è¡Œä»£ç </li>
</ol>
<h2 id="é›…è™å†›è§„">é›…è™å†›è§„</h2>
<blockquote>
<p>è™½ç„¶éšç€ Vueã€Reactã€Angular è¿™äº›æ¡†æ¶çš„æµï¨ˆï¼Œé›…è™å†›è§„å½“ä¸­ä¸€äº›ä¼˜åŒ–çš„æ–¹æ³•å·²ï¥§åœ¨é€‚ç”¨ï¼Œä½†æ˜¯ï¼Œï¤å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å­¦ä¹ è¿™äº›æ–¹æ³•èƒŒåçš„æ€æƒ³ï¼Œè€Œï¥§æ˜¯å»æ­»è®°ç¡¬èƒŒæŸä¸ªæ–¹æ³•ï¼ŒæŠ€æœ¯æ€»æ˜¯åœ¨ï¤è¿­ï¼Œåªæœ‰æ¡æ–¹æ³•èƒŒåçš„æ€æƒ³ï¼Œæ‰èƒ½å¤Ÿç«‹äºï¥§è´¥ä¹‹åœ°ã€‚</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583615829278.jpg" alt="" loading="lazy"></figure>
<p>https://developer.yahoo.com/performance/rules.html</p>
<p>https://juejin.im/post/5b73ef38f265da281e048e51</p>
<h2 id="æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</h2>
<blockquote>
<p>æŠ›å¼€åœºæ™¯è°ˆæ€§èƒ½ä¼˜åŒ–ï¼Œéƒ½æ˜¯è€æµæ°“</p>
</blockquote>
<h3 id="performance-api">Performance API</h3>
<p>æåˆ°æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡å°±ï¥§å¾—ï¥§è¯´ Performance APIï¼Œé¦–å…ˆæ¥çœ‹ MDN ä¸Šå…³äºè¿™ä¸ª API çš„ ä»‹ç»ï¼šPerformance æ¥å£å¯ä»¥è·å–åˆ°å½“å‰é¡µé¢ä¸­ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚å®ƒæ˜¯ High Resolution Time API çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ—¶ä¹Ÿèåˆï¦º Performance Timeline APIã€Navigation Timing APIã€ User Timing API å’Œ Resource Timing APIã€‚è¯¥ç±»å‹çš„å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒâ½¤ç”¨åªè¯»å±æ€§ Window.performance æ¥è·å¾—ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1583740522448.png" alt="" loading="lazy"></figure>
<pre><code class="language-js">const timingInfo = window.performance.timing
console.log({
  TCPè¿æ¥è€—æ—¶: timingInfo.connectEnd - timingInfo.connectStart,
  DNSæŸ¥è¯¢è€—æ—¶: timingInfo.domainLookupEnd - timingInfo.domainLookupStart,
  'è·å¾—é¦–å­—èŠ‚è€—è´¹æ—¶é—´ï¼Œä¹Ÿå«TTFB': timingInfo.responseStart - timingInfo.navigationStart,
  domReadyæ—¶é—´: timingInfo.domContentLoadedEventStart - timingInfo.navigationStart,
  DOMèµ„æºä¸‹è½½: timingInfo.responseEnd - timingInfo.responseStart,
})
</code></pre>
<ol>
<li>First Paint(ç®€ç§° FP)ï¼šè¡¨ç¤ºæ–‡æ¡£ä¸­ä»»ä¸€å…ƒç´ é¦–æ¬¡æ¸²æŸ“æ—¶é—´ã€‚</li>
<li>First Contentful Paint(ç®€ç§° FCP)ï¼šå½“æµè§ˆï¨¸é¦–æ¬¡æ¸²æŸ“ä»»ä½•æ–‡æœ¬ï¼Œå›¾åƒï¼ˆåŒ…æ‹¬èƒŒæ™¯å›¾åƒï¼‰ï¼Œéç™½è‰²ç”»å¸ƒæˆ– SVG æ—¶ã€‚è¿™ä¸ªæŒ‡æ ‡å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸è¯´çš„ç™½å±æ—¶é—´ã€‚</li>
<li>First Meaningful Paint(ç®€ç§° FMP)ï¼šé¦–æ¬¡æœ‰æ„ä¹‰çš„ç»˜åˆ¶ï¼Œè¿™ä¸ªæŒ‡æ ‡åæ˜ çš„æ˜¯ä¸»è¦å†…å®¹å‡ºç°åœ¨é¡µé¢ä¸Šæ‰€éœ€è¦çš„æ—¶é—´ï¼Œå¦‚æœ FMP æ—¶é—´è¿‡é•¿çš„è¯ï¼Œè¿™ï§©å°±è¦è€ƒè™‘æ˜¯ï¥§æ˜¯é™æ€æ–‡ä»¶é˜»å¡ï¦ºä¸»çº¿ç¨‹ã€‚</li>
<li>Time To Interactive(TTI)ï¼šå¯äº¤äº’æ—¶é—´ï¼Œç­‰åˆ°æœåŠ¡ï¨¸é€šè¿‡ HTTP åè®®å°†å“åº”å…¨éƒ¨è¿”å›ä¹‹åï¼Œï¥¥å¼€å§‹ DOM Tree çš„æ„å»ºï¼Œå®Œæˆä¹‹åï¼Œç½‘é¡µå˜æˆå¯äº¤äº’çŠ¶æ€ï¼Œåˆ°æ­¤ä¸ºæ­¢ä¾¿æ˜¯ç½‘é¡µçš„å¯äº¤äº’æ—¶é—´ã€‚ç”¨æˆ·å¯ä»¥è¿›ï¨ˆæ­£å¸¸çš„äº‹ä»¶è¾“å…¥äº¤äº’æ“ä½œï¼Œè¿™ä¸ªæŒ‡æ ‡æ˜¯æœ€é‡è¦çš„ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ï¼Œç”¨æˆ·æœ€å…³å¿ƒçš„å°±æ˜¯ï§½ä¹ˆæ—¶å€™å¯ä»¥è¿›ï¨ˆäº¤äº’ï¼Œæ‰€ä»¥é€šå¸¸è¿™ä¸ªæŒ‡æ ‡æ˜¯æˆ‘ä»¬ä¼˜åŒ–çš„é‡ç‚¹ã€‚</li>
</ol>
<h3 id="æµè§ˆå™¨-performance-å·¥å…·">æµè§ˆï¨¸ Performance å·¥å…·</h3>
<h3 id="lighthouse">Lighthouse</h3>
<ul>
<li>å®‰è£… chrome æ’ä»¶ ï¼ˆæˆ–è€…ï¼‰</li>
<li><code>npm install -g lighthouse</code></li>
</ul>
<pre><code>lighthouse https://yuufen.com/
</code></pre>
<h2 id="ç½‘ç»œ">ç½‘ç»œ</h2>
<h3 id="dns">DNS</h3>
<p>prefetch</p>
<figure data-type="image" tabindex="3"><img src="https://yuufen.com/blog/post-images/1583617452917.png" alt="" loading="lazy"></figure>
<h3 id="tcp">TCP</h3>
<h4 id="ip-tcp-http-çš„å…³ç³»">IPã€TCPã€HTTP çš„å…³ç³»</h4>
<ol>
<li>
<p>IP-é—¨ç‰Œå·ï¼Œé€šè¿‡ IP åè®®æ‰¾åˆ°å¯¹åº”æœºå™¨</p>
</li>
<li>
<p>TCP è´Ÿè´£æ•°æ®å®Œæ•´æ€§å’Œæœ‰åºæ€§ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€ç²˜åŒ…ã€æ»‘åŠ¨çª—å£ç­‰éå¸¸åºå¤§çš„ç½‘ç»œåè®®æœºåˆ¶</p>
</li>
<li>
<p>HTTP è´Ÿè´£åº”ç”¨å±‚æ•°æ®ï¼Œæ–‡ä»¶ç¼–ç ã€cookieã€ç¼“å­˜ã€æ•°æ®ç»ˆæ­¢æ—¶æœºç­‰</p>
</li>
</ol>
<h4 id="ä¼˜åŒ–tcpç­–ç•¥">ä¼˜åŒ–ï¼ˆTCPï¼‰ç­–ç•¥</h4>
<ol>
<li>é•¿è¿æ¥</li>
<li>å‡å°‘æ–‡ä»¶ä½“ç§¯
<ol>
<li>js æ‰“åŒ…å‹ç¼©</li>
<li>å›¾ç‰‡å‹ç¼©</li>
<li>gzip</li>
</ol>
</li>
<li>å‡å°‘æ–‡ä»¶è¯·æ±‚æ¬¡æ•°
<ol>
<li>é›ªç¢§å›¾</li>
<li>jsã€css æ‰“åŒ…</li>
<li>ç¼“å­˜æ§åˆ¶</li>
<li>æ‡’åŠ è½½</li>
</ol>
</li>
<li>å‡å°‘ç”¨æˆ·å’ŒæœåŠ¡å™¨çš„ä¸¾ä¾‹
<ol>
<li>cdn</li>
</ol>
</li>
<li>æœ¬åœ°å‚¨å­˜</li>
</ol>
<h2 id="å›¾ç‰‡">å›¾ç‰‡</h2>
<h3 id="é€‰æ‹©åˆé€‚æ ¼å¼">é€‰æ‹©åˆé€‚æ ¼å¼</h3>
<ol>
<li>PNG</li>
</ol>
<p>png-8 png-24 png-32</p>
<p>logoï¼Œé¢œè‰²ç®€å•ä½†å¯¹å›¾ç‰‡è´¨é‡è¦æ±‚é«˜ã€ç²¾çµå›¾</p>
<ol start="2">
<li>
<p>JPG/JPEG</p>
</li>
<li>
<p>GIF</p>
</li>
<li>
<p>SVG</p>
</li>
</ol>
<p>SVG å›¾åƒä¸­çš„æ–‡æœ¬æ—¶å¯é€‰å–å¯æœç´¢çš„ã€‚</p>
<p>å¸¸ç”¨æ¥ç»˜åˆ¶åœ°å›¾ã€è‚¡ç¥¨ k çº¿å›¾</p>
<p>ä¼šæŸè€—æ€§èƒ½</p>
<ol start="5">
<li>WebP</li>
</ol>
<p>å…¨èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œéœ€è¦æ ¹æ®æµè§ˆå™¨åˆ¤æ–­åŠ è½½æ ¼å¼</p>
<ol start="6">
<li>Base64</li>
</ol>
<p>å›¾ç‰‡ base64 ä¹‹åä¼šå˜å¤§ï¼Œé€‚åˆå°çš„çŸ¢é‡å›¾æ ‡</p>
<h3 id="å…¶ä»–">å…¶ä»–</h3>
<ol>
<li>å›¾ç‰‡æ¸è¿›æ˜¾ç¤º</li>
<li>æ‡’åŠ è½½</li>
<li>éª¨æ¶å›¾</li>
</ol>
<h2 id="ç¼“å­˜">ç¼“å­˜</h2>
<p>å¯ä»¥å°‘åŠ è½½æ–‡ä»¶</p>
<ol>
<li>cdn ç¼“å­˜</li>
<li>æœ¬åœ°ç¼“å­˜
<ol>
<li>localstorage</li>
<li>indexdb</li>
<li>cookie</li>
</ol>
</li>
<li>æµè§ˆå™¨ç¼“å­˜</li>
</ol>
<h3 id="cdn">CDN</h3>
<p>ç¼“å­˜+å›æº</p>
<p>åœ°ç†ä½ç½®æ›´è¿‘ï¼Œæ–°çš„åŸŸåè§„é¿ cookie</p>
<h3 id="æµè§ˆå™¨ç¼“å­˜">æµè§ˆå™¨ç¼“å­˜</h3>
<figure data-type="image" tabindex="4"><img src="https://yuufen.com/blog/post-images/1583741167549.png" alt="" loading="lazy"></figure>
<h4 id="æµç¨‹">æµç¨‹</h4>
<ol>
<li>è·å–æ–‡ä»¶</li>
<li>æ–‡ä»¶è¿”å› express æˆ–è€… cache-control è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”å¸¦ä¸Š etag æˆ–è€… lastModfied å­—æ®µ</li>
<li>å†æ¬¡è¯·æ±‚ï¼Œæµè§ˆå™¨å…ˆæŸ¥è¯¢ expres æˆ–è€… cache-control æ˜¯å¦è¿‡æœŸï¼Œè‹¥æ²¡è¿‡æœŸï¼Œå¼ºç¼“å­˜ç”Ÿæ•ˆï¼Œä¸å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜</li>
<li>è‹¥å¼ºç¼“å­˜å¤±æ•ˆï¼Œæµè§ˆå™¨ä¼šå¸¦ä¸Š etag æˆ–è€… lastModfied æ•°æ®ï¼Œä½¿ç”¨ if-none-match æˆ–è€… if-Modified-Since å­—æ®µï¼Œå’¨è¯¢åç«¯æ˜¯å¦è¿‡æœŸ</li>
<li>è‹¥æ²¡è¿‡æœŸï¼Œè¿”å› 304 çŠ¶æ€ç ï¼Œç›´æ¥ç”¨ç¼“å­˜</li>
<li>è‹¥è¿‡æœŸï¼ŒçŠ¶æ€ç  200ï¼Œè¿”å›æ–°èµ„æº</li>
</ol>
<h4 id="å¼ºç¼“å­˜">å¼ºç¼“å­˜</h4>
<h5 id="expires">expires</h5>
<p>http 1.0 ä¸­</p>
<h5 id="cache-control">Cache-Control</h5>
<p>http 1.1 ä¸­</p>
<h4 id="åå•†ç¼“å­˜">åå•†ç¼“å­˜</h4>
<h5 id="last-modified-if-modified-since">Last-Modified / If-Modified-Since</h5>
<p>æ ‡æ³¨æ—¶é—´ï¼ˆåªèƒ½ç²¾ç¡®åˆ°ç§’ï¼‰</p>
<h5 id="etag-if-none-match">Etag / If-None-Match</h5>
<p>æ ¹æ®æ–‡ä»¶å†…å®¹è®¡ç®— hash</p>
<h3 id="webpack-æ‰“åŒ…å’Œç¼“å­˜çš„å…³ç³»">webpack æ‰“åŒ…å’Œç¼“å­˜çš„å…³ç³»</h3>
<p>é€šè¿‡ hash æ¥åˆ¤æ–­æ˜¯å¦æœ‰æ›´æ–°ï¼š</p>
<ol>
<li>hashï¼šæ•´ä¸ªé¡¹ç›®ç›¸å…³çš„ hash</li>
<li>chunkhashï¼šå…¥å£æ–‡ä»¶ä¾èµ–çš„ chunkhash</li>
<li>contenthashï¼šæ–‡ä»¶å†…å®¹çš„ hash</li>
</ol>
<h3 id="å…¶ä»–-2">å…¶ä»–</h3>
<ol>
<li>memory cache å†…å­˜ç¼“å­˜ï¼Œæ¯”å¦‚å‚¨å­˜åœ¨å˜é‡é‡Œï¼Œå…³é—­ tab å°±æ²¡äº†</li>
<li>Disk cache ç¡¬ç›˜ä¸Šçš„ç¼“å­˜</li>
<li>Push cache æ¨é€ç¼“å­˜ http2</li>
<li>service worker æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹è¿›ç¨‹</li>
</ol>
<h2 id="æ¸²æŸ“">æ¸²æŸ“</h2>
<h3 id="æµè§ˆå™¨æ¸²æŸ“åŸç†">æµè§ˆå™¨æ¸²æŸ“åŸç†</h3>
<p>ç»å…¸æ–‡ç«  how browser works</p>
<p>https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/</p>
<figure data-type="image" tabindex="5"><img src="https://yuufen.com/blog/post-images/1583741367851.png" alt="" loading="lazy"></figure>
<p>é¦–å…ˆæ˜¯è§£æ HTMLã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯æŠŠ HTML æ–‡æ¡£è§£æä¸º DOM æ ‘çš„è¿‡ç¨‹ï¼Œå¦‚æœé‡åˆ°&lt;script&gt;æ ‡ç­¾ï¼Œåˆ™ä¼šåœæ­¢è§£æï¼Œå…ˆæ‰§è¡Œæ ‡ç­¾å½“ä¸­çš„ JavaScriptï¼›å¦‚æœæ˜¯å¤–è”æ–¹å¼ï¼Œä¹Ÿéœ€è¦ç­‰å¾…ä¸‹è½½å¹¶æ‰§è¡Œå®Œå¯¹åº”çš„ JavaScript ä»£ç ï¼Œç„¶åæ‰èƒ½ç»§ç»­æ‰§è¡Œè§£æ HTML çš„å·¥ä½œã€‚HTML è§£æå®Œæˆåè§¦å‘ DOMContentLoaded äº‹ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ“ä½œ DOM äº†ã€‚</p>
<p>ç”Ÿæˆå¯¹åº”çš„ DOM æ ‘ç»“æ„ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://yuufen.com/blog/post-images/1583741376936.png" alt="" loading="lazy"></figure>
<p>åŒæ—¶ä¼šè§£æ CSSã€‚è§£æ HTML å’Œè§£æ CSS æ˜¯å¹¶è¡Œå¤„ç†çš„ï¼Œä¸ç„¶ä¼šé€ æˆæ¸²æŸ“çš„å†…å®¹æ²¡æœ‰å¯¹åº”çš„æ ·å¼ã€‚è§£æ CSS é‡åˆ°&lt;script&gt;æ ‡ç­¾å’Œä¸Šé¢è§£æ HTML çš„å¤„ç†æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚CSS è§£æå™¨å°† CSS è§£ææˆ CSSStyleSheetï¼ˆä¹Ÿè¢«å«åš CSSOM æ ‘ï¼‰ï¼Œå’Œ DOM æ ‘ç»“æ„ç±»ä¼¼ã€‚</p>
<p>CSSOM æ ‘ï¼š</p>
<figure data-type="image" tabindex="7"><img src="https://yuufen.com/blog/post-images/1583741498395.png" alt="" loading="lazy"></figure>
<p>DOM æ ‘å’Œ CSSOM æ ‘ä¸€èµ·é™„ç€åˆæˆæ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://yuufen.com/blog/post-images/1583741581016.png" alt="" loading="lazy"></figure>
<p>å›¾ä¸­å·¦ä¾§ä¸º DOM æ ‘ï¼Œå³ä¾§æ˜¯ Render æ ‘ï¼Œå¯ä»¥çœ‹åˆ° Render æ ‘ç»“æ„ä¸ DOM æ ‘æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œä½†ï¥§æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª Render Objectï¼ŒåŒ…å«ï¦ºæˆ‘ä»¬åœ¨æ ·å¼è¡¨ä¸­è®¾ç½®çš„æ ·å¼ï¼Œæ ·å¼çš„å®½é«˜å’Œå…·ä½“ä½ç½®æ˜¯é€šè¿‡ Layout (é‡æ’)è®¡ç®—å¾—å‡ºã€‚</p>
<blockquote>
<h4 id="tips">Tips</h4>
<p>å…ƒç´ å¦‚æœè¢«è®¾ç½®ä¸º <code>display:none</code>ï¼Œåœ¨ DOM æ ‘ä¸­ä¾ç„¶ä¼šæ˜¾ç¤ºï¼Œä½†æ˜¯åœ¨ Render æ ‘ä¸­ä¸ä¼šæ˜¾ç¤ºï¼›å…ƒç´ å¦‚æœè¢«è®¾ç½®ä¸º <code>visibility:none</code>ï¼Œé‚£ä¹ˆ DOM æ ‘å’Œ Render æ ‘ä¸­éƒ½ä¼šæ˜¾ç¤ºï¼›æˆ‘ä»¬ç»å¸¸è¯´çš„è„±ç¦»â½‚æ–‡æ¡£æµï¼Œå…¶å®å°±æ˜¯è„±ç¦» Render Treeã€‚</p>
</blockquote>
<h3 id="ç™½å±åº”å¯¹">ç™½å±åº”å¯¹</h3>
<h4 id="éª¨æ¶å±">éª¨æ¶å±</h4>
<h5 id="è‡ªåŠ¨åŒ–æ–¹æ¡ˆ">è‡ªåŠ¨åŒ–æ–¹æ¡ˆ</h5>
<ul>
<li>page-skeleton-webpack-plugin</li>
<li>antd çš„ skeleton ç»„ä»¶</li>
</ul>
<h3 id="dom-æ€§èƒ½ä¼˜åŒ–">DOM æ€§èƒ½ä¼˜åŒ–</h3>
<p>å°‘æ“ä½œ domï¼Œä½¿ç”¨ fragment, è™šæ‹Ÿ dom</p>
<h3 id="å›æµé‡ç»˜">å›æµé‡ç»˜</h3>
<figure data-type="image" tabindex="9"><img src="https://yuufen.com/blog/post-images/1583741388259.png" alt="" loading="lazy"></figure>
<h3 id="event-loop">event-loop</h3>
<h4 id="æµç¨‹-2">æµç¨‹</h4>
<figure data-type="image" tabindex="10"><img src="https://yuufen.com/blog/post-images/1583742431195.png" alt="" loading="lazy"></figure>
<h4 id="macrotaskå®ä»»åŠ¡-microtaskå¾®ä»»åŠ¡">Macrotaskï¼ˆå®ä»»åŠ¡ï¼‰ / Microtaskï¼ˆå¾®ä»»åŠ¡ï¼‰</h4>
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°ï¦ºä»»åŠ¡é˜Ÿï¦œï¼Œé‚£ä¹ˆä»»åŠ¡é˜Ÿï¦œæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ Macrotaskï¼Œå¦å¤–ä¸€ç§æ˜¯ Microtaskã€‚ä»æœ€å¼€å§‹æˆ‘ç»™å‡ºçš„ Event Loop æ€»çš„æµç¨‹å›¾ï¼Œå¤§å®¶å¯ä»¥çœ‹å‡º Microtask ä¼˜å…ˆçº§æ˜¯é«˜äº Macrotask çš„ã€‚Microtask å½“ä¸­çš„ä»»åŠ¡ä¹Ÿæ˜¯åœ¨æ‰§ï¨ˆæ ˆå½“ä¸­çš„ä»»åŠ¡æ‰§ï¨ˆå®Œæˆåå†è¿›ï¨ˆæ‰§ï¨ˆï¼Œæ‰§ï¨ˆçš„æ—¶å€™å’Œ Macrotask æœ‰ä¸€äº›åŒºåˆ«ï¼ŒMicrotask å½“ä¸­ä»»åŠ¡ï¥§ä¼šä¸€ä¸ªâ¼€ä¸€ä¸ªå‹å…¥æ‰§â¾è¡Œï¨ˆæ ˆï¼Œè€Œæ˜¯æ‰€æœ‰ä»»åŠ¡ç›´æ¥å‹å…¥æ ˆä¸­ï¼Œ å½“ Microtask å½“ä¸­çš„ä»»åŠ¡æ‰§ï¨ˆå®Œæ¯•åï¼Œç„¶åæˆ‘ä»¬å†ä» Macrotask ä¸­å–æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªä»»åŠ¡è¿›ï¨ˆæ‰§ï¨ˆã€‚</p>
<p>é‚£ä¹ˆå“ªäº›ä»»åŠ¡å±äº Microtaskï¼Œå“ªäº›ä»»åŠ¡å±äº Macrotask å‘¢ï¼Œè¿™ï§©æœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ€»ç»“ï¼š</p>
<ul>
<li><strong>Macrotask</strong>ï¼š</li>
</ul>
<p>setTimeoutã€setIntervalã€I/Oã€UI Renderingã€script å½“ä¸­çš„æ‰€æœ‰ä»£ç ã€ setImmediate(Node)</p>
<ul>
<li><strong>Microtask</strong>ï¼š</li>
</ul>
<p>process.nextTick(node) ã€Promise ã€MutationObserver</p>
<blockquote>
<p>Microtask å½“ä¸­å„ç§ä»»åŠ¡çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š process.nextTick &gt; Promise &gt; MutationOberse</p>
</blockquote>
<blockquote>
<p>æ‰¹é‡æ›´æ–°ï¼Œå¯ä»¥åˆ©ç”¨ event-loopï¼Œåœ¨å½“å‰æ•°æ®ä¿®æ”¹ä¹‹åï¼Œæ±‡æ€»æ•°æ®ï¼Œç»Ÿä¸€ä¿®æ”¹ï¼Œå¦‚ React çš„<code>setState</code></p>
</blockquote>
<h2 id="é˜²æŠ–èŠ‚æµ">é˜²æŠ–èŠ‚æµ</h2>
<h3 id="èŠ‚æµ">èŠ‚æµ</h3>
<pre><code class="language-js">function throttle(fn, wait = 500) {
  let lastTime = 0
  return function(...args) {
    let now = new Date()
    if (now - lastTime &gt; wait) {
      lastTime = now
      fn(...args)
    }
  }
}
window.onscroll = throttle(function() {
  console.log('æ‡’åŠ è½½åˆ¤å®šã€æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨åˆ¤å®šâ€¦â€¦')
})
</code></pre>
<h3 id="é˜²æŠ–">é˜²æŠ–</h3>
<pre><code class="language-js">function debounce(fn, wait = 500) {
  let timer = 0
  return function(...arg) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() =&gt; {
      fn(...arg)
    }, wait)
  }
}

window.onscroll = debounce(function() {
  console.log('æ‡’åŠ è½½åˆ¤å®šã€æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨åˆ¤å®šâ€¦â€¦')
})
</code></pre>
<h2 id="æ‡’åŠ è½½">æ‡’åŠ è½½</h2>
<h3 id="å›¾ç‰‡æ‡’åŠ è½½">å›¾ç‰‡æ‡’åŠ è½½</h3>
<pre><code class="language-html">&lt;body&gt;
  &lt;div id=&quot;container&quot;&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img
        data-src=&quot;https://i0.hdslb.com/bfs/album/8e10328d8a35d3acb957bb521170711d02fdece8.jpg@518w_1e_1c.jpg&quot;
        alt=&quot;&quot;
      /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img data-src=&quot;https://i0.hdslb.com/bfs/album/3f9b4b9f8a91806c1daf2ab187f2faec8174d7ae.jpg&quot; alt=&quot;&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img
        data-src=&quot;https://i0.hdslb.com/bfs/album/f14aec7ef14f0c95d359914e0927f9e1f1c3625b.png@518w_1e_1c.png&quot;
        alt=&quot;&quot;
      /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;script&gt;
    const imgs = document.querySelectorAll('img')
    // è·å–å¯è§†åŒºåŸŸé«˜åº¦
    const viewHeight = window.innerHeight || window.documentElement.clientHeight
    console.log(viewHeight, imgs)
    num = 0
    function loadImg() {
      for (let i = 0; i &lt; imgs.length; i++) {
        console.log(imgs[i].getBoundingClientRect().top)
        let dis = viewHeight - imgs[i].getBoundingClientRect().top
        if (dis &gt; 0) {
          imgs[i].src = imgs[i].getAttribute('data-src')
          num = i + 1
        }
      }
    }
    loadImg()
    // èŠ‚æµ
    window.addEventListener(
      'scroll',
      (function(fn, wait = 500) {
        let lastTime = 0
        return function(...args) {
          let now = new Date()
          if (now - lastTime &gt; wait) {
            lastTime = now
            fn(...args)
          }
        }
      })(loadImg),
    )
  &lt;/script&gt;
&lt;/body&gt;
</code></pre>
<h3 id="ç»„ä»¶è·¯ç”±æ‡’åŠ è½½">ç»„ä»¶ï¼ˆè·¯ç”±ï¼‰æ‡’åŠ è½½</h3>
<p>webpack</p>
<h2 id="æœåŠ¡ç«¯æ¸²æŸ“-åŒæ„">æœåŠ¡ç«¯æ¸²æŸ“ &amp;&amp; åŒæ„</h2>
<ol>
<li>æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå°±æ˜¯åœ¨æœåŠ¡ç«¯è§£æé¦–å±çš„ç»„ä»¶ï¼Œäº§å‡º HTMLï¼Œç›´æ¥è¿”å›</li>
<li>å¦‚æœç”¨æˆ·è·³è½¬é¡µé¢ï¼ŒåŒæ„ã€‚æ•´ä¸ªåº”ç”¨æœ‰ä¸¤ä¸ªå…¥å£ï¼š
<ol>
<li>server-entry é¦–æ¬¡è¿›å…¥çš„å…¥å£ï¼Œä½¿ç”¨ ssr</li>
<li>ç”¨æˆ·ç‚¹å‡»è·³è½¬ï¼Œå¦‚æœæ˜¯å•é¡µåº”ç”¨ï¼Œç‚¹å‡»ä¸åˆ·æ–°ï¼Œèµ° js å•é¡µå…¥å£ï¼Œæˆ–è€…å®¢æˆ·ç«¯æ¸²æŸ“å…¥å£</li>
</ol>
</li>
</ol>
<h2 id="ç§»åŠ¨ç«¯ä¼˜åŒ–">ç§»åŠ¨ç«¯ä¼˜åŒ–</h2>
<p>svgã€è™šæ‹Ÿåˆ—è¡¨ã€300ms å»¶è¿Ÿï¼ˆç¦ç”¨ç¼©æ”¾è§£å†³ï¼‰</p>
<p>https://bvaughn.github.io/react-virtualized/#/components/List</p>
<h3 id="vue">Vue</h3>
<p>async-componentã€v-if / v-show</p>
<h3 id="react">React</h3>
<p>purecomponentã€suspense</p>
<h2 id="webpack">webpack</h2>
<ul>
<li>å¯è§†åŒ–ä¼˜åŒ–</li>
</ul>
<pre><code class="language-js">const BundleAnalyzerPlugin = require('webpack-bundleanalyzer').BundleAnalyzerPlugin

module.exports = {
  plugins: [new BundleAnalyzerPlugin()],
}
</code></pre>
<ul>
<li>tree-shaking åˆ é™¤å†—ä½™ä»£ç </li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä»¿ç…§ Vue å®ç°ç®€å•çš„ MVVM æ¨¡å¼]]></title>
        <id>https://yuufen.com/blog/post/_IR3q9jGE/</id>
        <link href="https://yuufen.com/blog/post/_IR3q9jGE/">
        </link>
        <updated>2020-02-27T17:13:55.000Z</updated>
        <content type="html"><![CDATA[<p><a href="https://github.com/yuuFen/vue-reimplement">https://github.com/yuuFen/vue-reimplement</a></p>
<h2 id="vue-å·¥ä½œæœºåˆ¶">Vue å·¥ä½œæœºåˆ¶</h2>
<p>åœ¨ <code>new Vue()</code> æ—¶ä¼šè°ƒç”¨ _init() è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šåˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸã€äº‹ä»¶ã€propsã€methodsã€dataã€computed å’Œ watch ç­‰ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯ <code>Object.defineProperty</code> è®¾ç½® <code>setter</code> ä¸ <code>getter</code> ï¼Œç”¨æ¥å®ç°<strong>å“åº”å¼</strong>ä»¥åŠ<strong>ä¾èµ–æ”¶é›†</strong>ã€‚</p>
<p>åˆå§‹åŒ–åè°ƒç”¨ <code>$mount</code> æŒ‚è½½ç»„ä»¶ï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583512098725.png" alt="" loading="lazy"></figure>
<p>åŒ–ç®€ç‰ˆï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1583502362745.png" alt="" loading="lazy"></figure>
<h2 id="å“åº”å¼">å“åº”å¼</h2>
<h3 id="å®ç°">å®ç°</h3>
<pre><code class="language-js">class Vue {
  constructor(options) {
    this.$options = options

    this.$data = options.data

    // å“åº”åŒ–å¤„ç†
    this.observe(this.$data)

    Object.keys(this.$data).forEach((key) =&gt; {
      // åªéœ€è¦ç»™ data çš„ç¬¬ä¸€å±‚è®¾ç½®ä»£ç†
      // ä¸ç„¶ set å¤šä½™çš„é”®æ—¶ä¼šç»™ data æ·»åŠ å±æ€§
      this.proxyData(key)
    })
  }

  observe(value) {
    if (!value || typeof value !== 'object') {
      return
    }

    Object.keys(value).forEach((key) =&gt; {
      // setter å’Œ getter ä½¿ç”¨ä¸­ä»‹ valï¼Œé˜²æ­¢æ— é™å¾ªç¯
      // éœ€è¦æ–°å»ºä¸€ä¸ªä½œç”¨åŸŸï¼ˆé—­åŒ…ï¼‰æ¥ä¿å­˜ val,
      // Object.defineProperty(obj, key, { // val })
      this.defineReactive(value, key, value[key])
    })
  }

  defineReactive(obj, key, val) {
    // é€’å½’ï¼Œå¤„ç†å¯¹è±¡
    this.observe(val)

    // ä¼šåœ¨ obj ä¸Šæ·»åŠ æ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ç°æœ‰å±æ€§
    // æ‰€ä»¥æ˜¯ä¸ªå¼•ç”¨å˜é‡
    Object.defineProperty(obj, key, {
      get() {
        return val
      },
      set(newVal) {
        if (newVal !== val) {
          val = newVal
        }
      },
    })
  }

  // åœ¨ Vue å®ä¾‹æ ¹ä¸Šå®šä¹‰å±æ€§è½¬å‘è‡³ data ä¸­çš„æ•°æ®
  proxyData(key) {
    // this æŒ‡ Vue å®ä¾‹
    Object.defineProperty(this, key, {
      get() {
        return this.$data[key]
      },
      set(newVal) {
        this.$data[key] = newVal
      },
    })
  }
}
</code></pre>
<h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<pre><code class="language-html">&lt;script src=&quot;vue.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
  const app = new Vue({
    data: {
      foo: 'foooooo',
      bar: {
        doo: 'dooooooo',
      },
    },
  })

  console.log(app.bar)
  app.bar = 'baaaar'
  console.log(app.bar)
&lt;/script&gt;
</code></pre>
<h2 id="ä¾èµ–æ”¶é›†ä¸è¿½è¸ª">ä¾èµ–æ”¶é›†ä¸è¿½è¸ª</h2>
<p>æµç¨‹ï¼š</p>
<figure data-type="image" tabindex="3"><img src="https://yuufen.com/blog/post-images/1583577271564.png" alt="" loading="lazy"></figure>
<p>å…³ç³»ï¼š</p>
<figure data-type="image" tabindex="4"><img src="https://yuufen.com/blog/post-images/1583579033936.png" alt="" loading="lazy"></figure>
<h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3>
<pre><code class="language-js">new Vue({
  template: `
    &lt;div&gt;
      &lt;span&gt;{{name1}}&lt;/span&gt;  
      &lt;span&gt;{{name2}}&lt;/span&gt;  
      &lt;span&gt;{{name1}}&lt;/span&gt;  
    &lt;/div&gt;
  `,
  data: {
    name1: 'name1',
    name2: 'name2',
    name3: 'name3',
  },
})
</code></pre>
<blockquote>
<p>ä¿®æ”¹ name1ï¼Œè§†å›¾æ›´æ–°ï¼Œä¸”è¦æ›´æ–°ä¸¤å¤„ï¼›</p>
<p>ä¿®æ”¹ name2ï¼Œè§†å›¾æ›´æ–°ï¼›</p>
<p>ä¿®æ”¹ name3ï¼Œæ²¡æœ‰ä½¿ç”¨ï¼Œè§†å›¾ä¸æ›´æ–°ã€‚</p>
<p>éœ€è¦æ‰«æè§†å›¾æ”¶é›†ä¾èµ–ï¼ŒçŸ¥é“è§†å›¾ä¸­åˆ°åº•é‚£äº›åœ°æ–¹å¯¹æ•°æ®æœ‰ä¾èµ–ã€‚</p>
</blockquote>
<h3 id="å®ç°-2">å®ç°</h3>
<pre><code class="language-js">class Vue {
  constructor(options) {
    this.$options = options

    this.$data = options.data

    // å“åº”åŒ–å¤„ç†
    this.observe(this.$data)

    Object.keys(this.$data).forEach((key) =&gt; {
      // åªéœ€è¦ç»™ data çš„ç¬¬ä¸€å±‚è®¾ç½®ä»£ç†
      // ä¸ç„¶ set å¤šä½™çš„é”®æ—¶ä¼šç»™ data æ·»åŠ å±æ€§
      this.proxyData(key)
    })

    // æµ‹è¯•
    new Watcher(this, 'foo')
    new Watcher(this, 'bar.doo')
  }

  observe(value) {
    if (!value || typeof value !== 'object') {
      return
    }

    Object.keys(value).forEach((key) =&gt; {
      // setter å’Œ getter ä½¿ç”¨ä¸­ä»‹ valï¼Œé˜²æ­¢æ— é™å¾ªç¯
      // éœ€è¦æ–°å»ºä¸€ä¸ªä½œç”¨åŸŸï¼ˆé—­åŒ…ï¼‰æ¥ä¿å­˜ val,
      // Object.defineProperty(obj, key, { // val })
      this.defineReactive(value, key, value[key])
    })
  }

  defineReactive(obj, key, val) {
    // é€’å½’ï¼Œå¤„ç†å¯¹è±¡
    this.observe(val)

    const dep = new Dep()

    // ä¼šåœ¨ obj ä¸Šæ·»åŠ æ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ç°æœ‰å±æ€§ï¼Œæ˜¯ä¸ªå¼•ç”¨å˜é‡
    // è¿™é‡Œå¯¼è‡´å½¢æˆé—­åŒ…
    Object.defineProperty(obj, key, {
      get() {
        // è‹¥å­˜åœ¨ targetWatcherï¼ˆwatcherçš„æ„é€ é˜¶æ®µï¼‰ï¼Œåˆ™æ·»åŠ 
        Dep.targetWatcher &amp;&amp; dep.addWatcher(Dep.targetWatcher)
        return val
      },
      set(newVal) {
        if (newVal !== val) {
          val = newVal
          // é€šçŸ¥æ›´æ–°
          dep.notify()
        }
      },
    })
  }

  // åœ¨ Vue å®ä¾‹æ ¹ä¸Šå®šä¹‰å±æ€§è½¬å‘è‡³ data ä¸­çš„æ•°æ®
  proxyData(key) {
    // this æŒ‡ Vue å®ä¾‹
    Object.defineProperty(this, key, {
      get() {
        return this.$data[key]
      },
      set(newVal) {
        this.$data[key] = newVal
      },
    })
  }
}

// åˆ›å»º Dep: ç®¡ç†æ‰€æœ‰çš„ Watcher
class Dep {
  constructor() {
    this.watchers = []
  }
  addWatcher(watcher) {
    this.watchers.push(watcher)
  }
  notify() {
    this.watchers.forEach((watcher) =&gt; {
      watcher.update()
    })
  }
}

// åˆ›å»º Watcherï¼šä¸è§†å›¾ä¸­çš„å˜é‡å¯¹åº”(å‡ºç°ä¸€æ¬¡å°±åˆ›å»ºä¸€ä¸ª Watcher å®ä¾‹)
class Watcher {
  constructor(vm, key) {
    this.vm = vm
    this.key = key

    Dep.targetWatcher = this
    this.vm[this.key] // keyè§£æå‡ºæ¥ä¹‹åä¸ºå­—ç¬¦ä¸²ï¼Œ ä½†æ˜¯è‹¥å¦‚ 'bar.doo'ï¼Œéœ€è¦é¢å¤–æ“ä½œ
    Dep.targetWatcher = null
  }
  update() {
    console.log(this.key, 'æ›´æ–°â€”â€”æ¥è‡ª watcher')
    // do something
  }
}
</code></pre>
<h2 id="ç¼–è¯‘-compile">ç¼–è¯‘ compile</h2>
<figure data-type="image" tabindex="5"><img src="https://yuufen.com/blog/post-images/1583580639945.png" alt="" loading="lazy"></figure>
<ol>
<li>è·å–å¹¶éå† DOM æ ‘</li>
<li>æ–‡æœ¬èŠ‚ç‚¹ï¼šè·å– <code>{{}}</code> æ ¼å¼çš„å†…å®¹å¹¶è§£æ</li>
<li>å…ƒç´ èŠ‚ç‚¹ï¼šè®¿é—®èŠ‚ç‚¹ç‰¹æ€§ï¼Œæˆªè· <code>v-</code> å¼€å¤´å’Œ <code>@</code> å¼€å¤´å†…å®¹å¹¶è§£æ</li>
</ol>
<h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3>
<pre><code>new Vue {
  el: '#app',
}
</code></pre>
<pre><code class="language-js">class Vue {
  constructor(options) {
    // ...
    new Compile(this, options.el)
  }
  // ...
}
</code></pre>
<h3 id="éå†èŠ‚ç‚¹">éå†èŠ‚ç‚¹</h3>
<pre><code class="language-js">class Compile {
  constructor(vm, el) {
    // new Watcher éœ€è¦ vm
    this.$vm = vm
    this.$el = document.querySelector(el)

    if (this.$el) {
      // æå–å®¿ä¸»ä¸­æ¨¡æ¿å†…å®¹åˆ° fragment æ ‡ç­¾ï¼ˆç»“æŸå $el ä¸­æ²¡æœ‰å­å…ƒç´ ï¼‰
      // ä¸ä¼šå¼•èµ·é¡µé¢å›æµï¼ˆå¯¹å…ƒç´ ä½ç½®å’Œå‡ ä½•ä¸Šçš„è®¡ç®—ï¼‰ï¼Œæ€§èƒ½æ›´å¥½
      this.$fragment = this.node2Fragment(this.$el)
      // ç¼–è¯‘ï¼Œå¹¶è¿›è¡Œä¾èµ–æ”¶é›†
      this.compile(this.$fragment)
      // ç¼–è¯‘ç»“æŸåæŠŠ fragment å†æ·»åŠ åˆ° el ä¸­
      this.$el.appendChild(this.$fragment)
    }
  }

  node2Fragment(el) {
    const fragment = document.createDocumentFragment()
    let child
    while ((child = el.firstChild)) {
      fragment.appendChild(child)
    }
    return fragment
  }

  compile(el) {
    const childNodes = el.childNodes

    Array.from(childNodes).forEach((node) =&gt; {
      // åˆ¤æ–­èŠ‚ç‚¹ç±»å‹
      if (node.nodeType === 1) {
        // Element èŠ‚ç‚¹
        console.log('éå†åˆ°èŠ‚ç‚¹', node.nodeName)
      } else if (this.isInterpolation(node)) {
        // æ’å€¼è¡¨è¾¾å¼
        console.log('éå†åˆ°æ’å€¼è¡¨è¾¾å¼', node.textContent)
      }
      // å¦‚æœæœ‰å­èŠ‚ç‚¹
      if (node.children &amp;&amp; node.childNodes.length &gt; 0) {
        this.compile(node)
      }
    })
  }

  isInterpolation(node) {
    // æ˜¯æ–‡æœ¬ä¸”ç¬¦åˆ{{...}}
    return node.nodeType === 3 &amp;&amp; /\{\{(.*)\}\}/.test(node.textContent)
  }
}
</code></pre>
<h3 id="æ’å€¼è¡¨è¾¾å¼çš„å“åº”å¼æ›´æ–°">æ’å€¼è¡¨è¾¾å¼çš„å“åº”å¼æ›´æ–°</h3>
<p>Compileï¼š</p>
<pre><code class="language-js">  // ...
  // éå†åˆ°æ’å€¼è¡¨è¾¾å¼æ—¶
  compileText(node) {
    // console.log(RegExp.$1)
    const exp = RegExp.$1
    this.update(node, exp, 'text')
  }

  update(node, exp, dir) {
    const updater = this[dir + 'Updater']
    updater &amp;&amp; updater(node, exp)
    // æ³¨æ„ this
    const get = this.getContent
    // å½¢æˆé—­åŒ…ï¼Œå’Œä¸€ä¸ª Watcher å®ä¾‹å¯¹åº”
    new Watcher(
      this.$vm,
      // exp, // åœ¨é—­åŒ…ä¸­å¤„ç†
      function() {
        get(exp)
      },
      function() {
        updater &amp;&amp; updater(node, exp)
      },
    )
  }

  // æ³¨æ„ this
  textUpdater = (node, exp) =&gt; {
    node.textContent = this.getContent(exp)
  }

  // æ³¨æ„ this
  getContent = (exp) =&gt; {
    // è§£å†³åµŒå¥—ï¼Œget åµŒå¥—å±æ€§çš„å€¼
    const p = exp.split('.')
    let content = this.$vm[p[0]]
    for (let i = 1; i &lt; p.length; i++) {
      content = content[p[i]]
    }
    return content
  }
}
</code></pre>
<p>Watcherï¼š</p>
<pre><code class="language-js">// åˆå§‹åŒ–æ—¶å†æ¥å— get å’Œ updaterï¼Œä¸å†éœ€è¦ key å’Œ vm
// å¯¹åº”çš„ update(node, keys, dir) {...} å½¢æˆé—­åŒ…

class Watcher {
  constructor(get, cb) {
    // this.vm = vm
    // this.key = key
    this.cb = cb

    this.get = get // è·å–åµŒå¥—å±æ€§çš„æ–¹æ³•

    Dep.targetWatcher = this
    // keyè§£æå‡ºæ¥ä¹‹åä¸ºå­—ç¬¦ä¸²ï¼Œ ä½†æ˜¯è‹¥å¦‚ 'bar.doo'ï¼Œéœ€è¦é¢å¤–æ“ä½œ
    // è®¿é—® bar.dooï¼Œä¼šå°†å®ƒåŒæ—¶æŒ‚è½½åˆ° bar å’Œ doo çš„ Dep å®ä¾‹ï¼ˆä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼‰
    // è¿™é‡Œç›´æ¥åœ¨é—­åŒ…ä¸­å¤„ç†
    this.get()
    Dep.targetWatcher = null
  }
  update() {
    // æ›´æ–°è§†å›¾
    this.cb()
  }
}
</code></pre>
<blockquote>
<p>Watcher å®ä¾‹å¯¹åº”çš„ update å½¢æˆé—­åŒ…ï¼Œå­˜æœ‰ getã€updaterã€nodeã€expã€‚</p>
<p>ä¹Ÿå¯ä»¥æŠŠ update çš„ç›¸å…³å†…å®¹ç›´æ¥æ”¾åœ¨ watcher é‡Œé¢ï¼Œæ›´ç›´è§‚ä¸€ç‚¹ï¼Œä½†æ˜¯ Watcher å¤ªè‡ƒè‚¿ã€‚</p>
</blockquote>
<pre><code class="language-js">class Watcher {
  constructor(vm, node, exp, dir) {
    this.vm = vm
    this.node = node
    this.exp = exp
    this.dir = dir

    this.updater = this[dir + 'Updater']

    Dep.targetWatcher = this
    this.getContent()
    Dep.targetWatcher = null

    this.updater()
  }
  update() {
    this.updater()
  }

  textUpdater() {
    this.node.textContent = this.getContent(this.exp)
  }

  // ...

  getContent() {
    // è§£å†³åµŒå¥—ï¼Œget åµŒå¥—å±æ€§çš„å€¼
    const p = this.exp.split('.')
    let content = this.vm[p[0]]
    for (let i = 1; i &lt; p.length; i++) {
      content = content[p[i]]
    }
    return content
  }
}
</code></pre>
<h3 id="å…ƒç´ å±æ€§çš„å“åº”å¼">å…ƒç´ å±æ€§çš„å“åº”å¼</h3>
<h4 id="v-text">v-text</h4>
<pre><code class="language-js">  compileElement(node) {
    const nodeAttrs = node.attributes
    Array.from(nodeAttrs).forEach((attr) =&gt; {
      const attrName = attr.name
      const exp = attr.value
      if (attrName.indexOf('v-') === 0) {
        const dir = attrName.substring(2)
        this[dir] &amp;&amp; this[dir](node, exp)
      }
    })
  }

  text(node, exp) {
    this.update(node, exp, 'text')
  }
</code></pre>
<h4 id="v-html">v-html</h4>
<p>å’Œ text ä¸€æ ·ï¼ŒæŠŠ node.textContent æ”¹ä¸º node.innerHTML</p>
<h4 id="v-model">v-model</h4>
<p>ä¿®æ”¹ node.valueï¼Œç›‘å¬ node çš„ input äº‹ä»¶</p>
<p>æ–°å»º set æ–¹æ³•ï¼Œè§£å†³åµŒå¥—å±æ€§çš„ set é—®é¢˜</p>
<pre><code class="language-js">setContent = (exp, value) =&gt; {
  const p = exp.split('.')
  if (p.length === 1) {
    this.$vm[p] = value
  } else if (p.length &gt; 1) {
    let content = this.$vm[p[0]]
    for (let i = 1; i &lt; p.length - 1; i++) {
      content = content[p[i]]
    }
    content[p[p.length - 1]] = value
  }
}
</code></pre>
<h4 id="äº‹ä»¶ç»‘å®š">@ äº‹ä»¶ç»‘å®š</h4>
<pre><code>@click=&quot;handleClick&quot;
</code></pre>
<p>è·å–åˆ° clickã€handleClickï¼Œç»‘å®šåˆ° node ä¸Šï¼Œæ³¨æ„ thisã€‚</p>
<h2 id="æ±‡æ€»">æ±‡æ€»</h2>
<h3 id="compilejs">compile.js</h3>
<pre><code class="language-js">class Compile {
  constructor(vm) {
    // new Watcher éœ€è¦ vm
    this.$vm = vm
    this.$el = document.querySelector(this.$vm.$options.el)

    if (this.$el) {
      // æå–å®¿ä¸»ä¸­æ¨¡æ¿å†…å®¹åˆ° fragment æ ‡ç­¾ï¼ˆç»“æŸå $el ä¸­æ²¡æœ‰å­å…ƒç´ ï¼‰
      // ä¸ä¼šå¼•èµ·é¡µé¢å›æµï¼ˆå¯¹å…ƒç´ ä½ç½®å’Œå‡ ä½•ä¸Šçš„è®¡ç®—ï¼‰ï¼Œæ€§èƒ½æ›´å¥½
      this.$fragment = this.node2Fragment(this.$el)
      // ç¼–è¯‘ï¼Œå¹¶è¿›è¡Œä¾èµ–æ”¶é›†
      this.compile(this.$fragment)
      // ç¼–è¯‘ç»“æŸåæŠŠ fragment å†æ·»åŠ åˆ° el ä¸­
      this.$el.appendChild(this.$fragment)
    }
  }

  node2Fragment(el) {
    const fragment = document.createDocumentFragment()
    let child
    while ((child = el.firstChild)) {
      fragment.appendChild(child)
    }
    return fragment
  }

  compile(el) {
    const childNodes = el.childNodes

    Array.from(childNodes).forEach((node) =&gt; {
      // åˆ¤æ–­èŠ‚ç‚¹ç±»å‹
      if (node.nodeType === 1) {
        // Element èŠ‚ç‚¹
        console.log('éå†åˆ°èŠ‚ç‚¹', node.nodeName)
        this.compileElement(node)
      } else if (this.isInterpolation(node)) {
        // æ’å€¼è¡¨è¾¾å¼
        console.log('éå†åˆ°æ’å€¼è¡¨è¾¾å¼', node.textContent)
        this.compileText(node)
      }
      // å¦‚æœæœ‰å­èŠ‚ç‚¹
      if (node.children &amp;&amp; node.childNodes.length &gt; 0) {
        this.compile(node)
      }
    })
  }

  isInterpolation(node) {
    // æ˜¯æ–‡æœ¬ä¸”ç¬¦åˆ{{...}}
    return node.nodeType === 3 &amp;&amp; /\{\{(.*)\}\}/.test(node.textContent)
  }

  compileText(node) {
    // console.log(RegExp.$1)
    const exp = RegExp.$1
    this.update(this.$vm, node, exp, 'text')
  }

  update(vm, node, exp, dir) {
    const updater = this[dir + 'Updater']
    // ä¹Ÿå¯ä»¥æŠŠ updater çš„å®ç°ç›´æ¥æ”¾åœ¨ watcher é‡Œé¢
    // å°±ä¸ç”¨å½¢æˆé—­åŒ…ï¼Œä½†æ˜¯è¿™æ · watcher å°±å¤ªè‡ƒè‚¿äº†ã€‚
    updater &amp;&amp; updater(node, exp)
    // æ³¨æ„ this
    const get = this.getContent
    // å½¢æˆé—­åŒ…ï¼Œå’Œä¸€ä¸ª Watcher å®ä¾‹å¯¹åº”
    new Watcher(
      // vm, // åœ¨è¿™é‡Œå¤„ç†
      // exp, // åœ¨è¿™é‡Œå¤„ç†
      function() {
        get(exp)
      },
      function() {
        updater &amp;&amp; updater(node, exp)
      },
    )
  }

  // æ³¨æ„ this
  textUpdater = (node, exp) =&gt; {
    node.textContent = this.getContent(exp)
  }
  htmlUpdater = (node, exp) =&gt; {
    node.innerHTML = this.getContent(exp)
  }
  modelUpdater = (node, exp) =&gt; {
    node.value = this.getContent(exp)
  }

  // æ³¨æ„ this
  getContent = (exp) =&gt; {
    // è§£å†³åµŒå¥—ï¼Œget åµŒå¥—å±æ€§çš„å€¼
    const p = exp.split('.')
    let content = this.$vm[p[0]]
    for (let i = 1; i &lt; p.length; i++) {
      content = content[p[i]]
    }
    return content
  }
  setContent = (exp, value) =&gt; {
    const p = exp.split('.')
    if (p.length === 1) {
      this.$vm[p] = value
    } else if (p.length &gt; 1) {
      let content = this.$vm[p[0]]
      for (let i = 1; i &lt; p.length - 1; i++) {
        content = content[p[i]]
      }
      content[p[p.length - 1]] = value
    }
  }

  compileElement(node) {
    const nodeAttrs = node.attributes
    Array.from(nodeAttrs).forEach((attr) =&gt; {
      const attrName = attr.name
      const exp = attr.value
      if (attrName.indexOf('v-') === 0) {
        const dir = attrName.substring(2)
        this[dir] &amp;&amp; this[dir](this.$vm, node, exp)
      } else if (attrName.indexOf('@') === 0) {
        // @click=&quot;handleClick&quot;
        const dir = attrName.substring(1)
        this.eventHandler(this.$vm, node, exp, dir)
      }
    })
  }

  text(vm, node, exp) {
    this.update(vm, node, exp, 'text')
  }

  html(vm, node, exp) {
    this.update(vm, node, exp, 'html')
  }

  model(vm, node, exp) {
    this.update(vm, node, exp, 'model')
    node.addEventListener('input', (e) =&gt; {
      this.setContent(exp, e.target.value)
    })
  }

  eventHandler(vm, node, exp, dir) {
    const fn = vm.$options.methods &amp;&amp; vm.$options.methods[exp]
    // console.log(node, exp, dir, fn)
    if (dir &amp;&amp; fn) {
      // æ³¨æ„ this
      node.addEventListener(dir, fn.bind(vm))
    }
  }
}
</code></pre>
<h3 id="vuejs">vue.js</h3>
<pre><code class="language-js">class Vue {
  constructor(options) {
    this.$options = options

    this.$data = options.data

    // å“åº”åŒ–å¤„ç†
    this.observe(this.$data)

    Object.keys(this.$data).forEach((key) =&gt; {
      // åªéœ€è¦ç»™ data çš„ç¬¬ä¸€å±‚è®¾ç½®ä»£ç†
      // ä¸ç„¶ set å¤šä½™çš„é”®æ—¶ä¼šç»™ data æ·»åŠ å±æ€§
      this.proxyData(key)
    })

    // new Watcher(this, 'foo')
    // new Watcher(this, 'bar.doo')

    new Compile(this)
  }

  observe(value) {
    if (!value || typeof value !== 'object') {
      return
    }

    Object.keys(value).forEach((key) =&gt; {
      // setter å’Œ getter ä½¿ç”¨ä¸­ä»‹ valï¼Œé˜²æ­¢æ— é™å¾ªç¯
      // éœ€è¦æ–°å»ºä¸€ä¸ªä½œç”¨åŸŸï¼ˆé—­åŒ…ï¼‰æ¥ä¿å­˜ val,
      // Object.defineProperty(obj, key, { // val })
      this.defineReactive(value, key, value[key])
    })
  }

  defineReactive(obj, key, val) {
    // é€’å½’ï¼Œå¤„ç†å¯¹è±¡
    this.observe(val)

    const dep = new Dep()

    // ä¼šåœ¨ obj ä¸Šæ·»åŠ æ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ç°æœ‰å±æ€§ï¼Œæ˜¯ä¸ªå¼•ç”¨å˜é‡
    // è¿™é‡Œå¯¼è‡´å½¢æˆé—­åŒ…
    Object.defineProperty(obj, key, {
      get() {
        // è‹¥å­˜åœ¨ targetWatcherï¼ˆwatcherçš„æ„é€ é˜¶æ®µï¼‰ï¼Œåˆ™æ·»åŠ 
        Dep.targetWatcher &amp;&amp; dep.addWatcher(Dep.targetWatcher)
        // console.log('get');
        return val
      },
      set(newVal) {
        if (newVal !== val) {
          // console.log('set');
          val = newVal
          // é€šçŸ¥æ›´æ–°
          dep.notify()
        }
      },
    })
  }

  // åœ¨ Vue å®ä¾‹æ ¹ä¸Šå®šä¹‰å±æ€§è½¬å‘è‡³ data ä¸­çš„æ•°æ®
  proxyData(key) {
    // this æŒ‡ Vue å®ä¾‹
    Object.defineProperty(this, key, {
      get() {
        return this.$data[key]
      },
      set(newVal) {
        this.$data[key] = newVal
      },
    })
  }
}

// åˆ›å»º Dep: ç®¡ç†æ‰€æœ‰çš„ Watcher
class Dep {
  constructor() {
    this.watchers = []
  }
  addWatcher(watcher) {
    this.watchers.push(watcher)
  }
  notify() {
    this.watchers.forEach((watcher) =&gt; {
      watcher.update()
    })
  }
}

// åˆ›å»º Watcherï¼šä¸è§†å›¾ä¸­çš„å˜é‡å¯¹åº”(å‡ºç°ä¸€æ¬¡å°±åˆ›å»ºä¸€ä¸ª Watcher å®ä¾‹)
class Watcher {
  constructor(get, cb) {
    // this.vm = vm
    // this.key = key
    this.cb = cb

    this.get = get // è·å–åµŒå¥—å±æ€§çš„æ–¹æ³•

    Dep.targetWatcher = this
    // keyè§£æå‡ºæ¥ä¹‹åä¸ºå­—ç¬¦ä¸²ï¼Œ ä½†æ˜¯è‹¥å¦‚ 'bar.doo'ï¼Œéœ€è¦é¢å¤–æ“ä½œ
    // è®¿é—® bar.dooï¼Œä¼šå°†å®ƒåŒæ—¶æŒ‚è½½åˆ° bar å’Œ doo çš„ Dep å®ä¾‹ï¼ˆä¹Ÿæ˜¯æœ‰å¿…è¦çš„ï¼‰
    // è¿™é‡Œç›´æ¥åœ¨é—­åŒ…ä¸­å¤„ç†
    this.get()
    Dep.targetWatcher = null
  }
  update() {
    // æ›´æ–°è§†å›¾
    this.cb()
  }
}
</code></pre>
<h3 id="indexhtml">index.html</h3>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;
    &lt;title&gt;Document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
      &lt;p&gt;{{name}}&lt;/p&gt;
      &lt;p v-text=&quot;name&quot;&gt;&lt;/p&gt;
      &lt;p&gt;{{age}}&lt;/p&gt;
      &lt;p&gt;{{doubleAge}}&lt;/p&gt;
      &lt;p&gt;{{bar}}&lt;/p&gt;
      &lt;p&gt;{{bar.doo}}&lt;/p&gt;
      &lt;div&gt;{{}}&lt;/div&gt;
      &lt;input type=&quot;text&quot; v-model=&quot;name&quot; /&gt; &lt;button @click=&quot;changeName&quot;&gt;ä¿®æ”¹name&lt;/button&gt;
      &lt;input type=&quot;text&quot; v-model=&quot;bar.doo&quot; /&gt; &lt;button @click=&quot;changeDoo&quot;&gt;ä¿®æ”¹doo&lt;/button&gt;
      &lt;div v-html=&quot;html&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;script src=&quot;compile.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;vue.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
      const app = new Vue({
        el: '#app',
        data: {
          name: 'I am test.',
          age: 12,
          html: '&lt;button&gt;htmlæµ‹è¯•&lt;/button&gt;',
          foo: 'foooooo',
          bar: {
            doo: 'åµŒå¥—å±æ€§',
          },
        },
        methods: {
          changeName() {
            // console.log('æ‰§è¡Œäº†å—')
            // æ³¨æ„ this
            this.name = 'è°ƒç”¨äº†methods'
          },
          changeDoo() {
            this.bar.doo = 'è°ƒç”¨äº†methods'
          },
        },
      })

      setTimeout(() =&gt; {
        app.name = '666666666666'
        app.bar.doo = 'oooo'
        // console.log(app.bar.doo)
        // app.bar = 'oooo'
      }, 1000)

      // console.log(app['bar.doo'])
      // app.foo = 'ffff'
      // console.log(app.bar)
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¸¸è§è®¾è®¡æ¨¡å¼æ€»ç»“]]></title>
        <id>https://yuufen.com/blog/post/_lKjmwEdd/</id>
        <link href="https://yuufen.com/blog/post/_lKjmwEdd/">
        </link>
        <updated>2020-02-27T06:51:31.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ä»è¾“å…¥-url-åˆ°æ˜¾ç¤ºé¡µé¢å‘ç”Ÿäº†ä»€ä¹ˆ">ä»è¾“å…¥ url åˆ°æ˜¾ç¤ºé¡µé¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h2>
<p><strong>ä»è¾“å…¥ url åˆ°æ˜¾ç¤ºé¡µé¢ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p>
<ol>
<li>ç”¨æˆ·è¾“å…¥ yuufen.com</li>
<li>æµè§ˆå™¨é€šè¿‡ DNSï¼ŒæŠŠ url è§£æä¸º IP</li>
<li>å’Œ IP åœ°å€å»ºç«‹ TCP è¿æ¥ï¼Œå‘é€ HTTP è¯·æ±‚</li>
<li>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼ŒæŸ¥åº“ï¼Œè¯»æ–‡ä»¶ç­‰ï¼Œæ‹¼æ¥å¥½è¿”å›çš„ HTTP å“åº”</li>
<li>æµè§ˆå™¨æ”¶åˆ°é¦–å± htmlï¼Œå¼€å§‹æ¸²æŸ“</li>
<li>è§£æ html ä¸º domï¼ˆåŒæ—¶åŠ è½½é¢å¤–çš„ css å’Œ jsï¼‰</li>
<li>è§£æ css ä¸º css-treeï¼ˆCSS é€‰æ‹©å™¨ä»<strong>å³</strong>å‘å·¦è¿‡æ»¤æŸ¥æ‰¾ï¼‰</li>
<li>dom + css ç”Ÿæˆ render-treeï¼Œç»˜å›¾</li>
</ol>
<p>è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„é¢è¯•é¢˜ï¼Œè¿™ä¸ªé¢˜çš„ç­”æ¡ˆåŒ…å«ç€æ•´ä¸ªäº’è”ç½‘è¿è¡Œçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ€§èƒ½ä¼˜åŒ–çš„ç­–ç•¥å°±æ˜¯åŸºäºå®ƒçš„ç­”æ¡ˆï¼Œé’ˆå¯¹æ¯ä¸€æ­¥ä¾æ¬¡è§£æï¼Œè®©æ•´ä½“çš„æ—¶é—´å˜çŸ­ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªå¤§æ–¹å‘ï¼š</p>
<ol>
<li>å°‘åŠ è½½æ–‡ä»¶</li>
<li>å°‘æ‰§è¡Œä»£ç </li>
</ol>
<h2 id="é›…è™å†›è§„">é›…è™å†›è§„</h2>
<blockquote>
<p>è™½ç„¶éšç€ Vueã€Reactã€Angular è¿™äº›æ¡†æ¶çš„æµï¨ˆï¼Œé›…è™å†›è§„å½“ä¸­ä¸€äº›ä¼˜åŒ–çš„æ–¹æ³•å·²ï¥§åœ¨é€‚ç”¨ï¼Œä½†æ˜¯ï¼Œï¤å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å­¦ä¹ è¿™äº›æ–¹æ³•èƒŒåçš„æ€æƒ³ï¼Œè€Œï¥§æ˜¯å»æ­»è®°ç¡¬èƒŒæŸä¸ªæ–¹æ³•ï¼ŒæŠ€æœ¯æ€»æ˜¯åœ¨ï¤è¿­ï¼Œåªæœ‰æ¡æ–¹æ³•èƒŒåçš„æ€æƒ³ï¼Œæ‰èƒ½å¤Ÿç«‹äºï¥§è´¥ä¹‹åœ°ã€‚</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583615829278.jpg" alt="" loading="lazy"></figure>
<p>https://developer.yahoo.com/performance/rules.html</p>
<p>https://juejin.im/post/5b73ef38f265da281e048e51</p>
<h2 id="æ€§èƒ½æŒ‡æ ‡">æ€§èƒ½æŒ‡æ ‡</h2>
<blockquote>
<p>æŠ›å¼€åœºæ™¯è°ˆæ€§èƒ½ä¼˜åŒ–ï¼Œéƒ½æ˜¯è€æµæ°“</p>
</blockquote>
<h3 id="performance-api">Performance API</h3>
<p>æåˆ°æ€§èƒ½ä¼˜åŒ–æŒ‡æ ‡å°±ï¥§å¾—ï¥§è¯´ Performance APIï¼Œé¦–å…ˆæ¥çœ‹ MDN ä¸Šå…³äºè¿™ä¸ª API çš„ ä»‹ç»ï¼šPerformance æ¥å£å¯ä»¥è·å–åˆ°å½“å‰é¡µé¢ä¸­ä¸æ€§èƒ½ç›¸å…³çš„ä¿¡æ¯ã€‚å®ƒæ˜¯ High Resolution Time API çš„ä¸€éƒ¨åˆ†ï¼ŒåŒæ—¶ä¹Ÿèåˆï¦º Performance Timeline APIã€Navigation Timing APIã€ User Timing API å’Œ Resource Timing APIã€‚è¯¥ç±»å‹çš„å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒâ½¤ç”¨åªè¯»å±æ€§ Window.performance æ¥è·å¾—ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1583740522448.png" alt="" loading="lazy"></figure>
<pre><code class="language-js">const timingInfo = window.performance.timing
console.log({
  TCPè¿æ¥è€—æ—¶: timingInfo.connectEnd - timingInfo.connectStart,
  DNSæŸ¥è¯¢è€—æ—¶: timingInfo.domainLookupEnd - timingInfo.domainLookupStart,
  'è·å¾—é¦–å­—èŠ‚è€—è´¹æ—¶é—´ï¼Œä¹Ÿå«TTFB': timingInfo.responseStart - timingInfo.navigationStart,
  domReadyæ—¶é—´: timingInfo.domContentLoadedEventStart - timingInfo.navigationStart,
  DOMèµ„æºä¸‹è½½: timingInfo.responseEnd - timingInfo.responseStart,
})
</code></pre>
<ol>
<li>First Paint(ç®€ç§° FP)ï¼šè¡¨ç¤ºæ–‡æ¡£ä¸­ä»»ä¸€å…ƒç´ é¦–æ¬¡æ¸²æŸ“æ—¶é—´ã€‚</li>
<li>First Contentful Paint(ç®€ç§° FCP)ï¼šå½“æµè§ˆï¨¸é¦–æ¬¡æ¸²æŸ“ä»»ä½•æ–‡æœ¬ï¼Œå›¾åƒï¼ˆåŒ…æ‹¬èƒŒæ™¯å›¾åƒï¼‰ï¼Œéç™½è‰²ç”»å¸ƒæˆ– SVG æ—¶ã€‚è¿™ä¸ªæŒ‡æ ‡å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸è¯´çš„ç™½å±æ—¶é—´ã€‚</li>
<li>First Meaningful Paint(ç®€ç§° FMP)ï¼šé¦–æ¬¡æœ‰æ„ä¹‰çš„ç»˜åˆ¶ï¼Œè¿™ä¸ªæŒ‡æ ‡åæ˜ çš„æ˜¯ä¸»è¦å†…å®¹å‡ºç°åœ¨é¡µé¢ä¸Šæ‰€éœ€è¦çš„æ—¶é—´ï¼Œå¦‚æœ FMP æ—¶é—´è¿‡é•¿çš„è¯ï¼Œè¿™ï§©å°±è¦è€ƒè™‘æ˜¯ï¥§æ˜¯é™æ€æ–‡ä»¶é˜»å¡ï¦ºä¸»çº¿ç¨‹ã€‚</li>
<li>Time To Interactive(TTI)ï¼šå¯äº¤äº’æ—¶é—´ï¼Œç­‰åˆ°æœåŠ¡ï¨¸é€šè¿‡ HTTP åè®®å°†å“åº”å…¨éƒ¨è¿”å›ä¹‹åï¼Œï¥¥å¼€å§‹ DOM Tree çš„æ„å»ºï¼Œå®Œæˆä¹‹åï¼Œç½‘é¡µå˜æˆå¯äº¤äº’çŠ¶æ€ï¼Œåˆ°æ­¤ä¸ºæ­¢ä¾¿æ˜¯ç½‘é¡µçš„å¯äº¤äº’æ—¶é—´ã€‚ç”¨æˆ·å¯ä»¥è¿›ï¨ˆæ­£å¸¸çš„äº‹ä»¶è¾“å…¥äº¤äº’æ“ä½œï¼Œè¿™ä¸ªæŒ‡æ ‡æ˜¯æœ€é‡è¦çš„ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ï¼Œç”¨æˆ·æœ€å…³å¿ƒçš„å°±æ˜¯ï§½ä¹ˆæ—¶å€™å¯ä»¥è¿›ï¨ˆäº¤äº’ï¼Œæ‰€ä»¥é€šå¸¸è¿™ä¸ªæŒ‡æ ‡æ˜¯æˆ‘ä»¬ä¼˜åŒ–çš„é‡ç‚¹ã€‚</li>
</ol>
<h3 id="æµè§ˆå™¨-performance-å·¥å…·">æµè§ˆï¨¸ Performance å·¥å…·</h3>
<h3 id="lighthouse">Lighthouse</h3>
<ul>
<li>å®‰è£… chrome æ’ä»¶ ï¼ˆæˆ–è€…ï¼‰</li>
<li><code>npm install -g lighthouse</code></li>
</ul>
<pre><code>lighthouse https://yuufen.com/
</code></pre>
<h2 id="ç½‘ç»œ">ç½‘ç»œ</h2>
<h3 id="dns">DNS</h3>
<p>prefetch</p>
<figure data-type="image" tabindex="3"><img src="https://yuufen.com/blog/post-images/1583617452917.png" alt="" loading="lazy"></figure>
<h3 id="tcp">TCP</h3>
<h4 id="ip-tcp-http-çš„å…³ç³»">IPã€TCPã€HTTP çš„å…³ç³»</h4>
<ol>
<li>
<p>IP-é—¨ç‰Œå·ï¼Œé€šè¿‡ IP åè®®æ‰¾åˆ°å¯¹åº”æœºå™¨</p>
</li>
<li>
<p>TCP è´Ÿè´£æ•°æ®å®Œæ•´æ€§å’Œæœ‰åºæ€§ï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€ç²˜åŒ…ã€æ»‘åŠ¨çª—å£ç­‰éå¸¸åºå¤§çš„ç½‘ç»œåè®®æœºåˆ¶</p>
</li>
<li>
<p>HTTP è´Ÿè´£åº”ç”¨å±‚æ•°æ®ï¼Œæ–‡ä»¶ç¼–ç ã€cookieã€ç¼“å­˜ã€æ•°æ®ç»ˆæ­¢æ—¶æœºç­‰</p>
</li>
</ol>
<h4 id="ä¼˜åŒ–tcpç­–ç•¥">ä¼˜åŒ–ï¼ˆTCPï¼‰ç­–ç•¥</h4>
<ol>
<li>é•¿è¿æ¥</li>
<li>å‡å°‘æ–‡ä»¶ä½“ç§¯
<ol>
<li>js æ‰“åŒ…å‹ç¼©</li>
<li>å›¾ç‰‡å‹ç¼©</li>
<li>gzip</li>
</ol>
</li>
<li>å‡å°‘æ–‡ä»¶è¯·æ±‚æ¬¡æ•°
<ol>
<li>é›ªç¢§å›¾</li>
<li>jsã€css æ‰“åŒ…</li>
<li>ç¼“å­˜æ§åˆ¶</li>
<li>æ‡’åŠ è½½</li>
</ol>
</li>
<li>å‡å°‘ç”¨æˆ·å’ŒæœåŠ¡å™¨çš„ä¸¾ä¾‹
<ol>
<li>cdn</li>
</ol>
</li>
<li>æœ¬åœ°å‚¨å­˜</li>
</ol>
<h2 id="å›¾ç‰‡">å›¾ç‰‡</h2>
<h3 id="é€‰æ‹©åˆé€‚æ ¼å¼">é€‰æ‹©åˆé€‚æ ¼å¼</h3>
<ol>
<li>PNG</li>
</ol>
<p>png-8 png-24 png-32</p>
<p>logoï¼Œé¢œè‰²ç®€å•ä½†å¯¹å›¾ç‰‡è´¨é‡è¦æ±‚é«˜ã€ç²¾çµå›¾</p>
<ol start="2">
<li>
<p>JPG/JPEG</p>
</li>
<li>
<p>GIF</p>
</li>
<li>
<p>SVG</p>
</li>
</ol>
<p>SVG å›¾åƒä¸­çš„æ–‡æœ¬æ—¶å¯é€‰å–å¯æœç´¢çš„ã€‚</p>
<p>å¸¸ç”¨æ¥ç»˜åˆ¶åœ°å›¾ã€è‚¡ç¥¨ k çº¿å›¾</p>
<p>ä¼šæŸè€—æ€§èƒ½</p>
<ol start="5">
<li>WebP</li>
</ol>
<p>å…¨èƒ½çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œéœ€è¦æ ¹æ®æµè§ˆå™¨åˆ¤æ–­åŠ è½½æ ¼å¼</p>
<ol start="6">
<li>Base64</li>
</ol>
<p>å›¾ç‰‡ base64 ä¹‹åä¼šå˜å¤§ï¼Œé€‚åˆå°çš„çŸ¢é‡å›¾æ ‡</p>
<h3 id="å…¶ä»–">å…¶ä»–</h3>
<ol>
<li>å›¾ç‰‡æ¸è¿›æ˜¾ç¤º</li>
<li>æ‡’åŠ è½½</li>
<li>éª¨æ¶å›¾</li>
</ol>
<h2 id="ç¼“å­˜">ç¼“å­˜</h2>
<p>å¯ä»¥å°‘åŠ è½½æ–‡ä»¶</p>
<ol>
<li>cdn ç¼“å­˜</li>
<li>æœ¬åœ°ç¼“å­˜
<ol>
<li>localstorage</li>
<li>indexdb</li>
<li>cookie</li>
</ol>
</li>
<li>æµè§ˆå™¨ç¼“å­˜</li>
</ol>
<h3 id="cdn">CDN</h3>
<p>ç¼“å­˜+å›æº</p>
<p>åœ°ç†ä½ç½®æ›´è¿‘ï¼Œæ–°çš„åŸŸåè§„é¿ cookie</p>
<h3 id="æµè§ˆå™¨ç¼“å­˜">æµè§ˆå™¨ç¼“å­˜</h3>
<figure data-type="image" tabindex="4"><img src="https://yuufen.com/blog/post-images/1583741167549.png" alt="" loading="lazy"></figure>
<h4 id="æµç¨‹">æµç¨‹</h4>
<ol>
<li>è·å–æ–‡ä»¶</li>
<li>æ–‡ä»¶è¿”å› express æˆ–è€… cache-control è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¹¶ä¸”å¸¦ä¸Š etag æˆ–è€… lastModfied å­—æ®µ</li>
<li>å†æ¬¡è¯·æ±‚ï¼Œæµè§ˆå™¨å…ˆæŸ¥è¯¢ expres æˆ–è€… cache-control æ˜¯å¦è¿‡æœŸï¼Œè‹¥æ²¡è¿‡æœŸï¼Œå¼ºç¼“å­˜ç”Ÿæ•ˆï¼Œä¸å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜</li>
<li>è‹¥å¼ºç¼“å­˜å¤±æ•ˆï¼Œæµè§ˆå™¨ä¼šå¸¦ä¸Š etag æˆ–è€… lastModfied æ•°æ®ï¼Œä½¿ç”¨ if-none-match æˆ–è€… if-Modified-Since å­—æ®µï¼Œå’¨è¯¢åç«¯æ˜¯å¦è¿‡æœŸ</li>
<li>è‹¥æ²¡è¿‡æœŸï¼Œè¿”å› 304 çŠ¶æ€ç ï¼Œç›´æ¥ç”¨ç¼“å­˜</li>
<li>è‹¥è¿‡æœŸï¼ŒçŠ¶æ€ç  200ï¼Œè¿”å›æ–°èµ„æº</li>
</ol>
<h4 id="å¼ºç¼“å­˜">å¼ºç¼“å­˜</h4>
<h5 id="expires">expires</h5>
<p>http 1.0 ä¸­</p>
<h5 id="cache-control">Cache-Control</h5>
<p>http 1.1 ä¸­</p>
<h4 id="åå•†ç¼“å­˜">åå•†ç¼“å­˜</h4>
<h5 id="last-modified-if-modified-since">Last-Modified / If-Modified-Since</h5>
<p>æ ‡æ³¨æ—¶é—´ï¼ˆåªèƒ½ç²¾ç¡®åˆ°ç§’ï¼‰</p>
<h5 id="etag-if-none-match">Etag / If-None-Match</h5>
<p>æ ¹æ®æ–‡ä»¶å†…å®¹è®¡ç®— hash</p>
<h3 id="webpack-æ‰“åŒ…å’Œç¼“å­˜çš„å…³ç³»">webpack æ‰“åŒ…å’Œç¼“å­˜çš„å…³ç³»</h3>
<p>é€šè¿‡ hash æ¥åˆ¤æ–­æ˜¯å¦æœ‰æ›´æ–°ï¼š</p>
<ol>
<li>hashï¼šæ•´ä¸ªé¡¹ç›®ç›¸å…³çš„ hash</li>
<li>chunkhashï¼šå…¥å£æ–‡ä»¶ä¾èµ–çš„ chunkhash</li>
<li>contenthashï¼šæ–‡ä»¶å†…å®¹çš„ hash</li>
</ol>
<h3 id="å…¶ä»–-2">å…¶ä»–</h3>
<ol>
<li>memory cache å†…å­˜ç¼“å­˜ï¼Œæ¯”å¦‚å‚¨å­˜åœ¨å˜é‡é‡Œï¼Œå…³é—­ tab å°±æ²¡äº†</li>
<li>Disk cache ç¡¬ç›˜ä¸Šçš„ç¼“å­˜</li>
<li>Push cache æ¨é€ç¼“å­˜ http2</li>
<li>service worker æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹è¿›ç¨‹</li>
</ol>
<h2 id="æ¸²æŸ“">æ¸²æŸ“</h2>
<h3 id="æµè§ˆå™¨æ¸²æŸ“åŸç†">æµè§ˆå™¨æ¸²æŸ“åŸç†</h3>
<p>ç»å…¸æ–‡ç«  how browser works</p>
<p>https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork/</p>
<figure data-type="image" tabindex="5"><img src="https://yuufen.com/blog/post-images/1583741367851.png" alt="" loading="lazy"></figure>
<p>é¦–å…ˆæ˜¯è§£æ HTMLã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯æŠŠ HTML æ–‡æ¡£è§£æä¸º DOM æ ‘çš„è¿‡ç¨‹ï¼Œå¦‚æœé‡åˆ°&lt;script&gt;æ ‡ç­¾ï¼Œåˆ™ä¼šåœæ­¢è§£æï¼Œå…ˆæ‰§è¡Œæ ‡ç­¾å½“ä¸­çš„ JavaScriptï¼›å¦‚æœæ˜¯å¤–è”æ–¹å¼ï¼Œä¹Ÿéœ€è¦ç­‰å¾…ä¸‹è½½å¹¶æ‰§è¡Œå®Œå¯¹åº”çš„ JavaScript ä»£ç ï¼Œç„¶åæ‰èƒ½ç»§ç»­æ‰§è¡Œè§£æ HTML çš„å·¥ä½œã€‚HTML è§£æå®Œæˆåè§¦å‘ DOMContentLoaded äº‹ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥æ“ä½œ DOM äº†ã€‚</p>
<p>ç”Ÿæˆå¯¹åº”çš„ DOM æ ‘ç»“æ„ï¼š</p>
<figure data-type="image" tabindex="6"><img src="https://yuufen.com/blog/post-images/1583741376936.png" alt="" loading="lazy"></figure>
<p>åŒæ—¶ä¼šè§£æ CSSã€‚è§£æ HTML å’Œè§£æ CSS æ˜¯å¹¶è¡Œå¤„ç†çš„ï¼Œä¸ç„¶ä¼šé€ æˆæ¸²æŸ“çš„å†…å®¹æ²¡æœ‰å¯¹åº”çš„æ ·å¼ã€‚è§£æ CSS é‡åˆ°&lt;script&gt;æ ‡ç­¾å’Œä¸Šé¢è§£æ HTML çš„å¤„ç†æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚CSS è§£æå™¨å°† CSS è§£ææˆ CSSStyleSheetï¼ˆä¹Ÿè¢«å«åš CSSOM æ ‘ï¼‰ï¼Œå’Œ DOM æ ‘ç»“æ„ç±»ä¼¼ã€‚</p>
<p>CSSOM æ ‘ï¼š</p>
<figure data-type="image" tabindex="7"><img src="https://yuufen.com/blog/post-images/1583741498395.png" alt="" loading="lazy"></figure>
<p>DOM æ ‘å’Œ CSSOM æ ‘ä¸€èµ·é™„ç€åˆæˆæ¸²æŸ“æ ‘ï¼ˆRender Treeï¼‰ï¼š</p>
<figure data-type="image" tabindex="8"><img src="https://yuufen.com/blog/post-images/1583741581016.png" alt="" loading="lazy"></figure>
<p>å›¾ä¸­å·¦ä¾§ä¸º DOM æ ‘ï¼Œå³ä¾§æ˜¯ Render æ ‘ï¼Œå¯ä»¥çœ‹åˆ° Render æ ‘ç»“æ„ä¸ DOM æ ‘æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œä½†ï¥§æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ª Render Objectï¼ŒåŒ…å«ï¦ºæˆ‘ä»¬åœ¨æ ·å¼è¡¨ä¸­è®¾ç½®çš„æ ·å¼ï¼Œæ ·å¼çš„å®½é«˜å’Œå…·ä½“ä½ç½®æ˜¯é€šè¿‡ Layout (é‡æ’)è®¡ç®—å¾—å‡ºã€‚</p>
<blockquote>
<h4 id="tips">Tips</h4>
<p>å…ƒç´ å¦‚æœè¢«è®¾ç½®ä¸º <code>display:none</code>ï¼Œåœ¨ DOM æ ‘ä¸­ä¾ç„¶ä¼šæ˜¾ç¤ºï¼Œä½†æ˜¯åœ¨ Render æ ‘ä¸­ä¸ä¼šæ˜¾ç¤ºï¼›å…ƒç´ å¦‚æœè¢«è®¾ç½®ä¸º <code>visibility:none</code>ï¼Œé‚£ä¹ˆ DOM æ ‘å’Œ Render æ ‘ä¸­éƒ½ä¼šæ˜¾ç¤ºï¼›æˆ‘ä»¬ç»å¸¸è¯´çš„è„±ç¦»â½‚æ–‡æ¡£æµï¼Œå…¶å®å°±æ˜¯è„±ç¦» Render Treeã€‚</p>
</blockquote>
<h3 id="ç™½å±åº”å¯¹">ç™½å±åº”å¯¹</h3>
<h4 id="éª¨æ¶å±">éª¨æ¶å±</h4>
<h5 id="è‡ªåŠ¨åŒ–æ–¹æ¡ˆ">è‡ªåŠ¨åŒ–æ–¹æ¡ˆ</h5>
<ul>
<li>page-skeleton-webpack-plugin</li>
<li>antd çš„ skeleton ç»„ä»¶</li>
</ul>
<h3 id="dom-æ€§èƒ½ä¼˜åŒ–">DOM æ€§èƒ½ä¼˜åŒ–</h3>
<p>å°‘æ“ä½œ domï¼Œä½¿ç”¨ fragment, è™šæ‹Ÿ dom</p>
<h3 id="å›æµé‡ç»˜">å›æµé‡ç»˜</h3>
<figure data-type="image" tabindex="9"><img src="https://yuufen.com/blog/post-images/1583741388259.png" alt="" loading="lazy"></figure>
<h3 id="event-loop">event-loop</h3>
<h4 id="æµç¨‹-2">æµç¨‹</h4>
<figure data-type="image" tabindex="10"><img src="https://yuufen.com/blog/post-images/1583742431195.png" alt="" loading="lazy"></figure>
<h4 id="macrotaskå®ä»»åŠ¡-microtaskå¾®ä»»åŠ¡">Macrotaskï¼ˆå®ä»»åŠ¡ï¼‰ / Microtaskï¼ˆå¾®ä»»åŠ¡ï¼‰</h4>
<p>ä¸Šé¢æˆ‘ä»¬æåˆ°ï¦ºä»»åŠ¡é˜Ÿï¦œï¼Œé‚£ä¹ˆä»»åŠ¡é˜Ÿï¦œæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ Macrotaskï¼Œå¦å¤–ä¸€ç§æ˜¯ Microtaskã€‚ä»æœ€å¼€å§‹æˆ‘ç»™å‡ºçš„ Event Loop æ€»çš„æµç¨‹å›¾ï¼Œå¤§å®¶å¯ä»¥çœ‹å‡º Microtask ä¼˜å…ˆçº§æ˜¯é«˜äº Macrotask çš„ã€‚Microtask å½“ä¸­çš„ä»»åŠ¡ä¹Ÿæ˜¯åœ¨æ‰§ï¨ˆæ ˆå½“ä¸­çš„ä»»åŠ¡æ‰§ï¨ˆå®Œæˆåå†è¿›ï¨ˆæ‰§ï¨ˆï¼Œæ‰§ï¨ˆçš„æ—¶å€™å’Œ Macrotask æœ‰ä¸€äº›åŒºåˆ«ï¼ŒMicrotask å½“ä¸­ä»»åŠ¡ï¥§ä¼šä¸€ä¸ªâ¼€ä¸€ä¸ªå‹å…¥æ‰§â¾è¡Œï¨ˆæ ˆï¼Œè€Œæ˜¯æ‰€æœ‰ä»»åŠ¡ç›´æ¥å‹å…¥æ ˆä¸­ï¼Œ å½“ Microtask å½“ä¸­çš„ä»»åŠ¡æ‰§ï¨ˆå®Œæ¯•åï¼Œç„¶åæˆ‘ä»¬å†ä» Macrotask ä¸­å–æ ˆé¡¶çš„ç¬¬ä¸€ä¸ªä»»åŠ¡è¿›ï¨ˆæ‰§ï¨ˆã€‚</p>
<p>é‚£ä¹ˆå“ªäº›ä»»åŠ¡å±äº Microtaskï¼Œå“ªäº›ä»»åŠ¡å±äº Macrotask å‘¢ï¼Œè¿™ï§©æœ‰ä¸€ä¸ªå¤§æ¦‚çš„æ€»ç»“ï¼š</p>
<ul>
<li><strong>Macrotask</strong>ï¼š</li>
</ul>
<p>setTimeoutã€setIntervalã€I/Oã€UI Renderingã€script å½“ä¸­çš„æ‰€æœ‰ä»£ç ã€ setImmediate(Node)</p>
<ul>
<li><strong>Microtask</strong>ï¼š</li>
</ul>
<p>process.nextTick(node) ã€Promise ã€MutationObserver</p>
<blockquote>
<p>Microtask å½“ä¸­å„ç§ä»»åŠ¡çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š process.nextTick &gt; Promise &gt; MutationOberse</p>
</blockquote>
<blockquote>
<p>æ‰¹é‡æ›´æ–°ï¼Œå¯ä»¥åˆ©ç”¨ event-loopï¼Œåœ¨å½“å‰æ•°æ®ä¿®æ”¹ä¹‹åï¼Œæ±‡æ€»æ•°æ®ï¼Œç»Ÿä¸€ä¿®æ”¹ï¼Œå¦‚ React çš„<code>setState</code></p>
</blockquote>
<h2 id="é˜²æŠ–èŠ‚æµ">é˜²æŠ–èŠ‚æµ</h2>
<h3 id="èŠ‚æµ">èŠ‚æµ</h3>
<pre><code class="language-js">function throttle(fn, wait = 500) {
  let lastTime = 0
  return function(...args) {
    let now = new Date()
    if (now - lastTime &gt; wait) {
      lastTime = now
      fn(...args)
    }
  }
}
window.onscroll = throttle(function() {
  console.log('æ‡’åŠ è½½åˆ¤å®šã€æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨åˆ¤å®šâ€¦â€¦')
})
</code></pre>
<h3 id="é˜²æŠ–">é˜²æŠ–</h3>
<pre><code class="language-js">function debounce(fn, wait = 500) {
  let timer = 0
  return function(...arg) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() =&gt; {
      fn(...arg)
    }, wait)
  }
}

window.onscroll = debounce(function() {
  console.log('æ‡’åŠ è½½åˆ¤å®šã€æ˜¾ç¤ºå›åˆ°é¡¶éƒ¨åˆ¤å®šâ€¦â€¦')
})
</code></pre>
<h2 id="æ‡’åŠ è½½">æ‡’åŠ è½½</h2>
<h3 id="å›¾ç‰‡æ‡’åŠ è½½">å›¾ç‰‡æ‡’åŠ è½½</h3>
<pre><code class="language-html">&lt;body&gt;
  &lt;div id=&quot;container&quot;&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img
        data-src=&quot;https://i0.hdslb.com/bfs/album/8e10328d8a35d3acb957bb521170711d02fdece8.jpg@518w_1e_1c.jpg&quot;
        alt=&quot;&quot;
      /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img data-src=&quot;https://i0.hdslb.com/bfs/album/3f9b4b9f8a91806c1daf2ab187f2faec8174d7ae.jpg&quot; alt=&quot;&quot; /&gt;
    &lt;/div&gt;
    &lt;div class=&quot;img-container&quot;&gt;
      &lt;img
        data-src=&quot;https://i0.hdslb.com/bfs/album/f14aec7ef14f0c95d359914e0927f9e1f1c3625b.png@518w_1e_1c.png&quot;
        alt=&quot;&quot;
      /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;script&gt;
    const imgs = document.querySelectorAll('img')
    // è·å–å¯è§†åŒºåŸŸé«˜åº¦
    const viewHeight = window.innerHeight || window.documentElement.clientHeight
    console.log(viewHeight, imgs)
    num = 0
    function loadImg() {
      for (let i = 0; i &lt; imgs.length; i++) {
        console.log(imgs[i].getBoundingClientRect().top)
        let dis = viewHeight - imgs[i].getBoundingClientRect().top
        if (dis &gt; 0) {
          imgs[i].src = imgs[i].getAttribute('data-src')
          num = i + 1
        }
      }
    }
    loadImg()
    // èŠ‚æµ
    window.addEventListener(
      'scroll',
      (function(fn, wait = 500) {
        let lastTime = 0
        return function(...args) {
          let now = new Date()
          if (now - lastTime &gt; wait) {
            lastTime = now
            fn(...args)
          }
        }
      })(loadImg),
    )
  &lt;/script&gt;
&lt;/body&gt;
</code></pre>
<h3 id="ç»„ä»¶è·¯ç”±æ‡’åŠ è½½">ç»„ä»¶ï¼ˆè·¯ç”±ï¼‰æ‡’åŠ è½½</h3>
<p>webpack</p>
<h2 id="æœåŠ¡ç«¯æ¸²æŸ“-åŒæ„">æœåŠ¡ç«¯æ¸²æŸ“ &amp;&amp; åŒæ„</h2>
<ol>
<li>æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå°±æ˜¯åœ¨æœåŠ¡ç«¯è§£æé¦–å±çš„ç»„ä»¶ï¼Œäº§å‡º HTMLï¼Œç›´æ¥è¿”å›</li>
<li>å¦‚æœç”¨æˆ·è·³è½¬é¡µé¢ï¼ŒåŒæ„ã€‚æ•´ä¸ªåº”ç”¨æœ‰ä¸¤ä¸ªå…¥å£ï¼š
<ol>
<li>server-entry é¦–æ¬¡è¿›å…¥çš„å…¥å£ï¼Œä½¿ç”¨ ssr</li>
<li>ç”¨æˆ·ç‚¹å‡»è·³è½¬ï¼Œå¦‚æœæ˜¯å•é¡µåº”ç”¨ï¼Œç‚¹å‡»ä¸åˆ·æ–°ï¼Œèµ° js å•é¡µå…¥å£ï¼Œæˆ–è€…å®¢æˆ·ç«¯æ¸²æŸ“å…¥å£</li>
</ol>
</li>
</ol>
<h2 id="ç§»åŠ¨ç«¯ä¼˜åŒ–">ç§»åŠ¨ç«¯ä¼˜åŒ–</h2>
<p>svgã€è™šæ‹Ÿåˆ—è¡¨ã€300ms å»¶è¿Ÿï¼ˆç¦ç”¨ç¼©æ”¾è§£å†³ï¼‰</p>
<p>https://bvaughn.github.io/react-virtualized/#/components/List</p>
<h3 id="vue">Vue</h3>
<p>async-componentã€v-if / v-show</p>
<h3 id="react">React</h3>
<p>purecomponentã€suspense</p>
<h2 id="webpack">webpack</h2>
<ul>
<li>å¯è§†åŒ–ä¼˜åŒ–</li>
</ul>
<pre><code class="language-js">const BundleAnalyzerPlugin = require('webpack-bundleanalyzer').BundleAnalyzerPlugin

module.exports = {
  plugins: [new BundleAnalyzerPlugin()],
}
</code></pre>
<ul>
<li>tree-shaking åˆ é™¤å†—ä½™ä»£ç </li>
</ul>
<h2 id="prepack">Prepack</h2>
<p>åœ¨ç¼–è¯‘é˜¶æ®µåšé¢„è®¡ç®—</p>
<p><a href="prepack.io">prepack.io</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vuex æ€»ç»“ä¸ç®€å•å®ç°]]></title>
        <id>https://yuufen.com/blog/post/pgLxFgJc5/</id>
        <link href="https://yuufen.com/blog/post/pgLxFgJc5/">
        </link>
        <updated>2020-02-26T06:28:50.000Z</updated>
        <content type="html"><![CDATA[<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583426923830.png" alt="" loading="lazy"></figure>
<p><a href="https://github.com/yuuFen/vuex-reimplement">https://github.com/yuuFen/vuex-reimplement</a></p>
<h2 id="åŸºç¡€æ€»ç»“">åŸºç¡€æ€»ç»“</h2>
<h3 id="æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆ</h3>
<p>Vuex æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨å¼€å‘çš„<strong>çŠ¶æ€ç®¡ï§¤æ¨¡å¼</strong>ï¼Œé›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”â½¤æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ã€‚</p>
<p>Vuexéµå¾ªâ€œå•å‘æ•°æ®æµâ€ï§¤å¿µï¼Œï§ äºé—®é¢˜è¿½è¸ªä»¥åŠæé«˜ä»£ç å¯ç»´æŠ¤æ€§ã€‚</p>
<p>Vueä¸­å¤šä¸ªè§†å›¾ä¾èµ–äºåŒä¸€çŠ¶æ€æ—¶ï¼Œè§†å›¾é—´ä¼ å‚å’ŒçŠ¶æ€åŒæ­¥æ¯”è¾ƒå›°éš¾ï¼ŒVuexèƒ½å¤Ÿå¾ˆå¥½è§£å†³è¯¥é—®é¢˜ã€‚</p>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h3>
<ul>
<li>state çŠ¶æ€ã€æ•°æ®</li>
<li>getters æ´¾ç”ŸçŠ¶æ€ ï¼Œä»stateæ´¾ç”Ÿå‡ºæ–°çŠ¶æ€ï¼Œç±»ä¼¼è®¡ç®—å±æ€§</li>
<li>mutations ï¤æ”¹çŠ¶æ€çš„å‡½æ•°</li>
<li>actions å¼‚æ­¥æ“ä½œ ï¼Œå¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œç±»ä¼¼äºcontroller</li>
<li>store åŒ…å«ä»¥ä¸Šæ¦‚å¿µçš„å®¹ï¨¸</li>
</ul>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<h4 id="æ™®é€šä½¿ç”¨">æ™®é€šä½¿ç”¨</h4>
<pre><code class="language-js">// store
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
  state: {
    count: 0,
  },
  mutations: {
    add(state, num = 1) {
      state.count += num
    },
  },
  getters: {
    // ç±»ä¼¼äº computer
    score(state) {
      return 'score: ' + state.count * 2
    },
  },
  actions: {
    // å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œç±»ä¼¼äº controller
    // å¦‚ ajax è¯·æ±‚ã€åŒæ—¶è°ƒç”¨å¤šæ¬¡ commit
    asyncAdd({ commit }, num) {
      return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
          commit('add', num)
          resolve({ ok: 1 })
        }, 1000)
      })
    },
  },
  modules: {},
})
</code></pre>
<pre><code class="language-js">// vue
  &lt;h3&gt;{{ $store.state.count }}&lt;/h3&gt;
  &lt;h3&gt;{{ $store.getters.score }}&lt;/h3&gt;

  methods: {
    add() {
      this.$store.commit('add')
    },
    asyncAdd() {
      this.$store.dispatch('asyncAdd').then((res) =&gt; {
        if (res.ok === 1) {
          alert('ok')
        }
      })
    },
</code></pre>
<h4 id="æ¨¡å—åŒ–">æ¨¡å—åŒ–</h4>
<p>/store/count.js</p>
<pre><code class="language-js">export default {
  namespaced: true, // å•ç‹¬çš„å‘½åç©ºé—´
  state: {
    count: 0,
  },
  mutations: {
    add(state, num = 1) {
      state.count += num
    },
  },
  getters: {
    score(state) {
      return 'score: ' + state.count * 2
    },
  },
  actions: {
    asyncAdd({ commit }, num) {
      return new Promise((resolve) =&gt; {
        setTimeout(() =&gt; {
          commit('add', num)
          resolve({ ok: 1 })
        }, 1000)
      })
    },
  },
}
</code></pre>
<p>/store/index.js</p>
<pre><code class="language-js">import Vue from 'vue'
import Vuex from 'vuex'
import count from './count'

Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    c: count,
  },
})
</code></pre>
<p>vue</p>
<pre><code class="language-js">    &lt;h3&gt;{{ $store.state.c.count }}&lt;/h3&gt;
    &lt;h3&gt;{{ $store.getters['c/score'] }}&lt;/h3&gt;
    
  methods: {
    add() {
      this.$store.commit('c/add')
    },
    asyncAdd() {
      this.$store.dispatch('c/asyncAdd').then((res) =&gt; {
        if (res.ok === 1) {
          alert('ok')
        }
      })
    },
  },
</code></pre>
<h2 id="æµ…ææºç ">æµ…ææºç </h2>
<h3 id="ç›®æ ‡">ç›®æ ‡</h3>
<ol>
<li>ç»´æŠ¤çŠ¶æ€ state ï¼ˆå“åº”å¼ï¼‰</li>
<li>ä¿®æ”¹çŠ¶æ€ commit</li>
<li>ä¸šåŠ¡é€»è¾‘æ§åˆ¶ dispatch</li>
<li>çŠ¶æ€æ´¾å‘ getterï¼ˆå“åº”å¼ï¼‰</li>
<li>æ··å…¥</li>
</ol>
<h3 id="å®ç°">å®ç°</h3>
<pre><code class="language-js">let Vue

function install(_Vue) {
  Vue = _Vue

  Vue.mixin({
    beforeCreate() {
      if (this.$options.store) {
        Vue.prototype.$store = this.$options.store
      }
    },
  })
}

class Store {
  constructor(options) {
    this.state = new Vue({
      data: options.state,
    })

    this.mutations = options.mutations || {}
    this.actions = options.actions || {}

    options.getters &amp;&amp; this.handleGetters(options.getters)
  }

  commit = (type, arg) =&gt; {
    // å¦‚æœä¸ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œdispatch ä¸­è°ƒç”¨æ—¶ this ä¼šæ”¹å˜
    // console.log(this)
    const fn = this.mutations[type]
    fn(this.state, arg)
  }

  dispatch(type, arg) {
    const fn = this.actions[type]
    return fn({ commit: this.commit, state: this.state }, arg)
  }

  // {foo(state){},doo(state){}}
  handleGetters(getters) {
    this.getters = {}

    // å®šä¹‰åªè¯»å±æ€§å’Œå“åº”å¼
    Object.keys(getters).forEach((key) =&gt; {
      Object.defineProperty(this.getters, key, {
        get: () =&gt; {
          return getters[key](this.state)
        },
      })
    })
  }
}

export default { Store, install }
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[vue-router æ‰©å±• API ä¸ç®€å•å®ç°]]></title>
        <id>https://yuufen.com/blog/post/8pW7fVIsz/</id>
        <link href="https://yuufen.com/blog/post/8pW7fVIsz/">
        </link>
        <updated>2020-02-24T08:30:02.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>åŸç‰ˆå®ç°æ›´æ›´æ›´æ›´å€¼å¾—å­¦ä¹ </p>
<p><a href="https://github.com/vuejs/vue-router">vue-router</a></p>
<p><a href="https://github.com/vuejs/vue-router/blob/dev/src/components/view.js">router-view</a></p>
</blockquote>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<h3 id="æ‡’åŠ è½½">æ‡’åŠ è½½</h3>
<pre><code class="language-js">      // ï¤·ç”±å±‚çº§ä»£ç åˆ†å‰²ï¼Œç”Ÿæˆåˆ†ç‰‡(about.[hash].js)      
      // å½“ï¤·ç”±è®¿é—®æ—¶ä¼šæ‡’åŠ è½½.      
      component: () =&gt; import(/* webpackChunkName: &quot;about&quot; */ './views/About.vue')
</code></pre>
<h3 id="è·¯ç”±å®ˆå«">è·¯ç”±å®ˆå«</h3>
<p>å…¨å±€å®ˆå«</p>
<p>è·¯ç”±ç‹¬äº«å®ˆå«</p>
<p>ç»„ä»¶å†…å®ˆå«</p>
<h3 id="åŠ¨æ€è·¯ç”±">åŠ¨æ€è·¯ç”±</h3>
<p>ï§ç”¨$router.addRoutes()å¯ä»¥å®ç°åŠ¨æ€ï¤·ç”±æ·»åŠ ï¼Œå¸¸ç”¨äºç”¨æˆ·æƒé™æ§åˆ¶ã€‚</p>
<pre><code class="language-js">// router.js
// æ¥å£è¿”å›æ•°æ®å¯èƒ½æ˜¯è¿™æ ·çš„
// [{
//   path: &quot;/&quot;,
//   name: &quot;home&quot;,
//   component: &quot;Home&quot;, //Home
// }]

// å¼‚æ­¥è·å–è·¯ï¤·ç”±
api.getRoutes().then((routes) =&gt; {
  const routeConfig = routes.map((route) =&gt; mapComponent(route))
  router.addRoutes(routeConfig)
})

// æ˜ å°„å…³ç³»
const compMap = {
  Home: () =&gt; import('./view/Home.vue'),
}

// é€’å½’æ›¿æ¢
function mapComponent(route) {
  route.component = compMap[route.component]
  if (route.children) {
    route.children = route.children.map((child) =&gt; mapComponent(child))
  }
  return route
}
</code></pre>
<h3 id="é¢åŒ…å±‘">é¢åŒ…å±‘</h3>
<p>åˆ©ç”¨$route.matchedå¯å¾—åˆ°ï¤·ç”±åŒ¹é…æ•°ç»„ï¼ŒæŒ‰é¡ºåºè§£æå¯å¾—ï¤·ç”±å±‚æ¬¡å…³ç³»ã€‚</p>
<pre><code class="language-js">// Breadcrumb.vue
watch: {
  $route: {
    handler(route) {
      // [{name:'home',path:'/'},{name:'list',path:'/list'}]
      console.log(this.$route.matched);
      // ['home','list']
      this.crumbData = this.$route.matched.map(m =&gt; m.name || m.redirect)
    },
    immediate: true // è®©å®ƒ create çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡
  }
}
</code></pre>
<h2 id="ç®€å•é‡ç°">ç®€å•é‡ç°</h2>
<p>https://github.com/yuuFen/vue-router-reimplement</p>
<h3 id="é€šå¸¸ç”¨æ³•ä¸ç›®æ ‡åˆ†æ">é€šå¸¸ç”¨æ³•ä¸ç›®æ ‡åˆ†æ</h3>
<pre><code class="language-js">import Vue from 'vue'
import VueRouter from 'vue-router'

import Home from &quot;./views/Home&quot;
import About from &quot;./views/About&quot;

Vue.use(VueRouter)

export default new VueRouter({
    routes: [
        { path: '/', component: Home },
        { path: '/about', component: About },
    ]
})
</code></pre>
<pre><code class="language-js">import router from './router'

new View({
    router,
    // ...
})
</code></pre>
<p>ç›®æ ‡ï¼š</p>
<ol>
<li>è§£æroutesï¼Œå˜æˆä¸€ä¸ªkeyä¸ºpathï¼Œvalueä¸ºcomponentçš„map</li>
<li>ç›‘å¬urlå˜åŒ–äº‹ä»¶ï¼ŒæŠŠæœ€æ–°çš„hashå€¼ä¿å­˜åˆ°currentè·¯ç”±</li>
<li>å®šä¹‰ä¸¤ä¸ªå…¨å±€ç»„ä»¶ï¼šrouter-viewç”¨äºæ˜¾ç¤ºåŒ¹é…ç»„ä»¶çš„å†…å®¹ï¼Œrouter-linkç”¨äºä¿®æ”¹hash</li>
<li>currentåº”è¯¥æ˜¯å“åº”å¼çš„ï¼Œè¿™æ ·å¯ä»¥è§¦å‘router-viewçš„é‡æ–°æ¸²æŸ“</li>
</ol>
<h3 id="å®ç°">å®ç°</h3>
<blockquote>
<p>æ²¡æœ‰è€ƒè™‘åµŒå¥—</p>
</blockquote>
<pre><code class="language-js">// install æ—¶è·å–
let Vue

// hash æ”¹å˜ =&gt; current (å“åº”å¼)æ”¹å˜ =&gt; router-view çš„ render æ”¹å˜
export default class VueRouter {
  constructor(options) {
    this.$options = options

    // ç”¨æ¥ä¿å­˜ path å’Œ route çš„æ˜ å°„
    this.routeMap = {}

    // åˆ©ç”¨ Vue è®© current å®ç°å“åº”å¼
    this.app = new Vue({
      data: {
        current: '/',
      },
    })
  }

  init() {
    // ç»‘å®šæµè§ˆå™¨äº‹ä»¶
    this.bindEvents()

    // è§£æè·¯ç”±é…ç½®
    this.createRouteMap(this.$options)

    // åˆ›å»º router-link å’Œ router-view
    this.initComponent()
  }

  bindEvents() {
    window.addEventListener('hashchange', this.onHashChange.bind(this))
    window.addEventListener('load', this.onHashChange.bind(this))
  }
  onHashChange() {
    this.app.current = window.location.hash.slice(1) || '/'
  }
  createRouteMap(options) {
    options.routes.forEach((item) =&gt; {
      this.routeMap[item.path] = item
    })
  }
  initComponent() {
    Vue.component('router-link', {
      props: {
        to: String,
      },
      render(h) {
        // ç›®æ ‡ï¼š&lt;a :href=&quot;to&quot;&gt;doooo&lt;/a&gt;
        // è¿™é‡Œ this æŒ‡å‘ router-link ç»„ä»¶å®ä¾‹
        return h('a', { attrs: { href: '#' + this.to } }, this.$slots.default)
        // return &lt;a href={this.to}&gt;{this.$slots.default}&lt;/a&gt;  // éœ€è¦ babel-loader
      },
    })
    Vue.component('router-view', {
      // ç®­å¤´å‡½æ•°å¯ä»¥ä¿ç•™ this æŒ‡å‘ï¼Œæ‰€ä»¥è¿™é‡ŒæŒ‡å‘ VueRouter å®ä¾‹
      render: (h) =&gt; {
        // console.log(this.app.current)
        // console.log(this.routeMap)
        // console.log(this.routeMap[this.app.current])
        const Comp = this.routeMap[this.app.current].component
        return h(Comp)
      },
    })
  }
}

VueRouter.install = function(_Vue) {
  Vue = _Vue

  Vue.mixin({
    beforeCreate() {
      // æ¯ä¸ªç»„ä»¶ beforeCreate çš„æ—¶å€™éƒ½ä¼šæ‰§è¡Œ
      // ä½†æ˜¯è¿™é‡Œåªå¸Œæœ›åœ¨æ ¹ç»„ä»¶ä¸Šæ‰§è¡Œä¸€æ¬¡
      // this æŒ‡å‘ Vue ç»„ä»¶å®ä¾‹
      // this.$options.router å°±æ˜¯åœ¨ router.js ä¸­ new çš„ VueRouter å®ä¾‹
      if (this.$options.router) {
        Vue.prototype.$router = this.$options.router
        this.$options.router.init()
      }
    },
  })
}
</code></pre>
<h3 id="ä½¿ç”¨åŒåŸç‰ˆ">ä½¿ç”¨åŒåŸç‰ˆ</h3>
<pre><code class="language-js">import Vue from 'vue'
import VueRouter from '../utils/router'

import Home from '../views/Home.vue'
import About from '../views/About.vue'
import Main from '../views/Main.vue'

Vue.use(VueRouter)

export default new VueRouter({
  routes: [
    { path: '/', component: Home },
    { path: '/main', component: Main },
    { path: '/about', component: About },
  ],
})
</code></pre>
<pre><code class="language-js">// ...

import router from './router'

new Vue({
  router,
  render: (h) =&gt; h(App),
}).$mount('#app')
</code></pre>
<pre><code class="language-html">    &lt;router-link to=&quot;/&quot;&gt;Home&lt;/router-link&gt;
    &lt;router-link to=&quot;/main&quot;&gt;Main&lt;/router-link&gt;
    &lt;router-link to=&quot;/about&quot;&gt;About&lt;/router-link&gt;
    &lt;router-view&gt;&lt;/router-view&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue ç»„ä»¶åŒ–]]></title>
        <id>https://yuufen.com/blog/post/Bpq2VQQen/</id>
        <link href="https://yuufen.com/blog/post/Bpq2VQQen/">
        </link>
        <updated>2020-02-22T09:56:41.000Z</updated>
        <content type="html"><![CDATA[<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1583424020660.png" alt="" loading="lazy"></figure>
<h2 id="ç»„ä»¶é—´é€šä¿¡">ç»„ä»¶é—´é€šä¿¡</h2>
<h3 id="çˆ¶ç»„ä»¶-å­ç»„ä»¶">çˆ¶ç»„ä»¶ =&gt; å­ç»„ä»¶</h3>
<ul>
<li>å±æ€§ props</li>
</ul>
<pre><code class="language-vue">// child 
props: { msg: String } 
// parent 
&lt;HelloWorld msg=&quot;Welcome to Your Vue.js App&quot; /&gt;
</code></pre>
<ul>
<li>$attrs / $listeners</li>
</ul>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">å‚¨</mi><mi mathvariant="normal">å­˜</mi><mi mathvariant="normal">çš„</mi><mi mathvariant="normal">æ˜¯</mi><mi mathvariant="normal">çˆ¶</mi><mi mathvariant="normal">ä½œ</mi><mi mathvariant="normal">ç”¨</mi><mi mathvariant="normal">åŸŸ</mi><mi mathvariant="normal">ä¸­</mi><mi mathvariant="normal">ä¸</mi><mi mathvariant="normal">è¢«</mi><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">æ‰€</mi><mi mathvariant="normal">è¯†</mi><mi mathvariant="normal">åˆ«</mi><mo>(</mo><mi mathvariant="normal">ä¸”</mi><mi mathvariant="normal">è·</mi><mi mathvariant="normal">å–</mi><mo>)</mo><mi mathvariant="normal">çš„</mi><mi mathvariant="normal">ç‰¹</mi><mi mathvariant="normal">æ€§</mi><mi mathvariant="normal">ç»‘</mi><mi mathvariant="normal">å®š</mi><mo>(</mo><mi>c</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mi mathvariant="normal">å’Œ</mi><mi>s</mi><mi>t</mi><mi>y</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">é™¤</mi><mi mathvariant="normal">å¤–</mi><mo>)</mo><mi mathvariant="normal">ï¼Œ</mi><mi mathvariant="normal">ä½¿</mi><mi mathvariant="normal">ç”¨</mi><mi>v</mi><mo>âˆ’</mo><mi>b</mi><mi>i</mi><mi>n</mi><mi>d</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi></mrow><annotation encoding="application/x-tex">attrså‚¨å­˜çš„æ˜¯çˆ¶ä½œç”¨åŸŸä¸­ä¸è¢« prop æ‰€è¯†åˆ« (ä¸”è·å–) çš„ç‰¹æ€§ç»‘å®š (class å’Œ style é™¤å¤–) ï¼Œä½¿ç”¨v-bind=&quot;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">s</span><span class="mord cjk_fallback">å‚¨</span><span class="mord cjk_fallback">å­˜</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">æ˜¯</span><span class="mord cjk_fallback">çˆ¶</span><span class="mord cjk_fallback">ä½œ</span><span class="mord cjk_fallback">ç”¨</span><span class="mord cjk_fallback">åŸŸ</span><span class="mord cjk_fallback">ä¸­</span><span class="mord cjk_fallback">ä¸</span><span class="mord cjk_fallback">è¢«</span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord cjk_fallback">æ‰€</span><span class="mord cjk_fallback">è¯†</span><span class="mord cjk_fallback">åˆ«</span><span class="mopen">(</span><span class="mord cjk_fallback">ä¸”</span><span class="mord cjk_fallback">è·</span><span class="mord cjk_fallback">å–</span><span class="mclose">)</span><span class="mord cjk_fallback">çš„</span><span class="mord cjk_fallback">ç‰¹</span><span class="mord cjk_fallback">æ€§</span><span class="mord cjk_fallback">ç»‘</span><span class="mord cjk_fallback">å®š</span><span class="mopen">(</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mord cjk_fallback">å’Œ</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">e</span><span class="mord cjk_fallback">é™¤</span><span class="mord cjk_fallback">å¤–</span><span class="mclose">)</span><span class="mord cjk_fallback">ï¼Œ</span><span class="mord cjk_fallback">ä½¿</span><span class="mord cjk_fallback">ç”¨</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">&quot;</span></span></span></span>attrs&quot;å¯ä»¥å®ç°è‡ªåŠ¨æŒ‚è½½ã€‚</p>
<p>é»˜è®¤ç»„ä»¶æ ¹å…ƒç´ ä¸Šä¼šè‡ªåŠ¨æŒ‚è½½æ²¡æœ‰åœ¨propså£°æ˜çš„å±æ€§ï¼Œé…ç½® inheritAttrs: false å¯ä»¥å…³é—­ã€‚</p>
<ul>
<li>å¼•ç”¨ $refs</li>
</ul>
<pre><code class="language-vue">// parent
&lt;HelloWorld ref=&quot;hw&quot; /&gt;

this.$refs.hw.xx = 'xxx'
</code></pre>
<ul>
<li>$children</li>
</ul>
<pre><code>// parent
this.$children[0].xx = 'xxx'
</code></pre>
<blockquote>
<p>ä¸ä¿è¯é¡ºåº</p>
</blockquote>
<h3 id="å­ç»„ä»¶-çˆ¶ç»„ä»¶">å­ç»„ä»¶ =&gt; çˆ¶ç»„ä»¶</h3>
<p>è‡ªå®šä¹‰äº‹ä»¶ï¼š</p>
<pre><code class="language-vue">// child 
this.$emit('add', good) 
// parent 
&lt;Cart @add=&quot;cartAdd($event)&quot;&gt;&lt;/Cart&gt;
</code></pre>
<p>è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå› ä¸ºæ˜¯ä½œç”¨åŸŸæ˜¯ this æ‰€ä»¥<strong>è°æ´¾å‘è°ç›‘å¬</strong>ã€‚</p>
<h3 id="v-model-åŒå‘ç»‘å®š-ä¸-sync-çš„åŒºåˆ«">v-model åŒå‘ç»‘å®š / ä¸ .sync çš„åŒºåˆ«</h3>
<ul>
<li>
<p>v-model=&quot;bar&quot;æ˜¯ :value=&quot;bar&quot; @input=&quot;bar=$event&quot; çš„è¯­æ³•ç³–</p>
<p>ä½†æ˜¯å¯ä»¥åœ¨<strong>ç»„ä»¶ä¸­</strong>è®¾ç½®modelé€‰é¡¹ä¿®æ”¹v-modelçš„é»˜è®¤è¡Œä¸º</p>
</li>
</ul>
<pre><code class="language-js">// Checkbox.vue
{
  {
    model: {
      prop: 'checked'
      event: 'change'
    }
  }
}
</code></pre>
<ul>
<li>
<p>value.sync=â€barâ€œ æ˜¯ :value=&quot;bar&quot; @update:value=&quot;bar=$event&quot; çš„è¯­æ³•ç³–</p>
<p>è¦æ›´æ”¹ç»‘å®šçš„å±æ€§åç§°ï¼Œéœ€è¦åœ¨<strong>çˆ¶ç»„ä»¶</strong>ä¸­æ›´æ”¹ï¼Œå¦‚ï¼š</p>
<pre><code class="language-html">&lt;m-input foo.sync=&quot;bar&quot;&gt;
ç­‰æ•ˆäº
&lt;m-input :foo=&quot;bar&quot; @update:foo=&quot;bar=$event&quot;&gt; 
</code></pre>
</li>
</ul>
<h3 id="å…„å¼Ÿç»„ä»¶">å…„å¼Ÿç»„ä»¶</h3>
<p>é€šè¿‡å…±åŒçš„ç¥–è¾ˆç»„ä»¶æ­æ¡¥ï¼Œ$parent æˆ– $rootï¼š</p>
<pre><code class="language-js">// brother1
this.$parent.$on('foo', handle)

// brother2
this.$parent.$emit('foo')
</code></pre>
<h3 id="ç¥–å…ˆä¸åä»£">ç¥–å…ˆä¸åä»£</h3>
<ul>
<li>provide / inject å¯ä»¥å®ç°ç¥–å…ˆç»™åä»£ä¼ å€¼ï¼Œå¯ä»¥ä¼ å¯¹è±¡ï¼š</li>
</ul>
<pre><code class="language-js">// ancestor
provide() { Â  Â 
  return {foo: 'foo'}
}

// descendant
inject: ['foo']
</code></pre>
<blockquote>
<p>provide å’Œ inject ä¸»è¦ä¸ºé«˜é˜¶æ’ä»¶/ç»„ä»¶åº“æä¾›ç”¨ä¾‹ï¼Œå¹¶ä¸æ¨èç›´æ¥ç”¨äºåº”ç”¨ç¨‹åºä»£ç ä¸­ï¼Œå¤šä¼šåœ¨å¼€æºç»„ä»¶åº“ä¸­è§åˆ°ã€‚<br>
åä»£æƒ³ç»™ç¥–å…ˆä¼ å€¼è¿™ç§æ–¹æ¡ˆè¡Œä¸é€š</p>
</blockquote>
<ul>
<li>å¹¿æ’­ï¼Œè‡ªä¸Šè€Œä¸‹</li>
</ul>
<p>https://github.com/ElemeFE/element/blob/dev/src/mixins/emitter.js</p>
<pre><code class="language-js">function broadcast(componentName, eventName, params) {
  this.$children.forEach(child =&gt; {
    var name = child.$options.componentName;

    if (name === componentName) {
      child.$emit.apply(child, [eventName].concat(params));
    } else {
      broadcast.apply(child, [componentName, eventName].concat([params]));
    }
  });
}
</code></pre>
<ul>
<li>è‡ªä¸‹è€Œä¸Š</li>
</ul>
<pre><code class="language-js">dispatch(componentName, eventName, params) {
  var parent = this.$parent || this.$root;
  var name = parent.$options.componentName;

  while (parent &amp;&amp; (!name || name !== componentName)) {
    parent = parent.$parent;

    if (parent) {
      name = parent.$options.componentName;
    }
  }
  if (parent) {
    parent.$emit.apply(parent, [eventName].concat(params));
  }
},
</code></pre>
<h3 id="ä»»æ„ä¸¤ä¸ªç»„ä»¶ä¹‹é—´äº‹ä»¶æ€»çº¿-vuex">ä»»æ„ä¸¤ä¸ªç»„ä»¶ä¹‹é—´ï¼šäº‹ä»¶æ€»çº¿ / Vuex</h3>
<ul>
<li>äº‹ä»¶æ€»çº¿</li>
</ul>
<pre><code class="language-js">// åˆ›å»ºä¸€ä¸ªBusç±»è´Ÿè´£äº‹ä»¶æ´¾å‘ã€ç›‘å¬å’Œå›è°ƒç®¡ç†
class Bus {
  constructor() {
    this.callbacks = {}
  }
  $on(name, fn) {
    ;(this.callbacks[name] || this.callbacks[name] = []).push(fn)
  }
  $emit(name, ...args) {
    const cbs = this.callback[name]
    if (cbs) {
      cbs.forEach((cb) =&gt; {
        cb.call(this, ...args)
      })
    }
  }
}

// main.js
Vue.prototype.$bus = new Bus()

// child1
this.$bus.$on('foo', handle)
// child2
this.$bus.$emit('foo')
</code></pre>
<pre><code class="language-js">// æˆ–è€… main.js ç›´æ¥
Vue.prototype.$bus = new Vue()
</code></pre>
<ul>
<li>Vuex</li>
</ul>
<p>åˆ›å»ºå”¯ä¸€çš„å…¨å±€æ•°æ®ç®¡ç†è€… storeï¼Œé€šè¿‡å®ƒç®¡ç†æ•°æ®å¹¶é€šçŸ¥ç»„ä»¶çŠ¶æ€å˜æ›´</p>
<h2 id="ç»„ä»¶å¤åˆ-å†…å®¹åˆ†å‘æ’æ§½">ç»„ä»¶å¤åˆ / å†…å®¹åˆ†å‘ï¼šæ’æ§½</h2>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€‚åŒ¿åæ’æ§½ã€å…·åæ’æ§½ã€ä½œç”¨åŸŸæ’æ§½ã€‚</p>
<blockquote>
<p>Vue 2.6.0ä¹‹åé‡‡ç”¨å…¨æ–°çš„v-slotè¯­æ³•å–ä»£ä¹‹å‰çš„slotã€slot-scope</p>
</blockquote>
<pre><code class="language-vue">// comp2 
&lt;div&gt;
  &lt;slot&gt;&lt;/slot&gt;
  &lt;slot name=&quot;content&quot;&gt;&lt;/slot&gt;
  &lt;slot name=&quot;bar&quot; foo=&quot;foooooooo&quot;&gt;&lt;/slot&gt;
&lt;/div&gt;

// parent 
&lt;Comp2&gt;
  &lt;!-- åŒ¿åæ’æ§½ç”¨defaultåšå‚æ•° --&gt;
  &lt;template v-slot:default&gt;å…·åæ’æ§½&lt;/template&gt;
  &lt;!-- å…·åæ’æ§½ç”¨æ’æ§½ååšå‚æ•° --&gt;
  &lt;template v-slot:content&gt;å†…å®¹...&lt;/template&gt;
  &lt;!-- ä½œç”¨åŸŸæ’æ§½è·å–å­ç»„ä»¶ä¼ æ¥çš„æ•°æ® --&gt;
  &lt;template v-slot:content=&quot;ctx&quot;&gt;æ¥è‡ªå­ç»„ä»¶æ•°æ®ï¼š{{ctx.foo}}&lt;/template&gt;
&lt;/Comp2&gt;
</code></pre>
<h2 id="å¼¹çª—ç»„ä»¶">å¼¹çª—ç»„ä»¶</h2>
<p>å¼¹çª—è¿™ç±»ç»„ä»¶çš„ç‰¹ç‚¹æ˜¯å®ƒä»¬åœ¨å½“å‰vueå®ä¾‹ï¦µä¹‹å¤–ç‹¬â½´ç«‹å­˜åœ¨ï¼Œé€šå¸¸æŒ‚è½½äºbodyï¼ˆæ‰€ä»¥éœ€è¦ new ä¸€ä¸ª Vue å®ä¾‹ï¼‰ï¼›å®ƒä»¬æ˜¯é€šè¿‡JSåŠ¨æ€åˆ›å»º çš„ï¼Œä¸éœ€è¦åœ¨ä»»ä½•ç»„ä»¶ä¸­å£°æ˜ã€‚</p>
<p>create.js</p>
<pre><code class="language-js">import Vue from 'vue'
export default function create(Component, props) {
  const vm = new Vue({
    render(h) {
      // render æ–¹æ³•æä¾› h å‡½æ•°ï¼Œç”¨æ¥æ¸²æŸ“ VNode
      return h(Component, { props })
    },
  }).$mount() // åšå¥½æŒ‚è½½å‡†å¤‡(ç”ŸæˆDOM)ä½†æš‚ä¸æŒ‚è½½ï¼ˆå› ä¸ºä¸æ”¯æŒç›´æ¥æŒ‚è½½åˆ°bodyï¼‰ï¼Œä¸ºä¸‹é¢ $el åšå‡†å¤‡

  // 1. vm åˆ›å»ºç»„ä»¶å®ä¾‹
  // 2. é€šè¿‡ $children è·å–åˆ›å»ºå¥½çš„ä¼ å…¥ç»„ä»¶çš„å®ä¾‹
  const comp = vm.$children[0]

  // 3. è¿½åŠ è‡³body
  document.body.appendChild(vm.$el)

  // 4. ç»™ç»„ä»¶ç›´æ¥æŒ‚è½½ä¸Šæ¸…ç†å‡½æ•°
  comp.remove = function(){
    document.body.removeChild(vm.$el)
    vm.$destroy()
  }

  // 5. è¿”å›ç»„ä»¶å®ä¾‹
  return comp
}
</code></pre>
<p>notice.vue</p>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div v-if=&quot;iShow&quot;&gt;
    &lt;h3&gt;title&lt;/h3&gt;
    &lt;div&gt;message&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  props: {
    title: { type: String, default: '' },
    message: { type: String, default: '' },
    duration: { type: Number, default: 1000 },
  },
  data() {
    return {
      isShow: false,
    }
  },
  methods: {
    show() {
      this.isShow = true
      setTimeout(() =&gt; {
        this.hide()
      }, this.duration)
    },
    hide() {
      this.isShow = false
      this.remove() // æ¥è‡ª create.js
    },
  },
}
&lt;/script&gt;
</code></pre>
<p>Father.vue</p>
<pre><code class="language-js">import create from '...' // æˆ–è€…ç›´æ¥æŒ‚åœ¨ Vue.prototype ä¸Šï¼Œèƒ½åœ¨ä»»ä½•åœ°æ–¹ Create
import Notice from '...'

  const notice = create(Notice, {
    title: 'Title',
    message: 'Message',
    duration: 2000
  })
  notice.show()

</code></pre>
<h2 id="é€’å½’ç»„ä»¶">é€’å½’ç»„ä»¶</h2>
<pre><code class="language-vue">// Node.vue
&lt;template&gt;
  &lt;div&gt;
    &lt;h3&gt;{{ data.title }}&lt;/h3&gt;
    &lt;!-- å¿…é¡»æœ‰ç»“æŸæ¡ä»¶ --&gt;
    &lt;Node v-for=&quot;d in data.children&quot; :key=&quot;d.id&quot; :data=&quot;d&quot;&gt;&lt;/Node&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  name: 'Node', // nameå¯¹é€’å½’ç»„ä»¶æ˜¯å¿…è¦çš„
  props: {
    data: {
      type: Object,
      require: true,
    },
  },
}
&lt;/script&gt;

// ä½¿ç”¨ 
&lt;Node :data=&quot;{id:'1',title:'é€’å½’ç»„ä»¶',children:[{...}]}&quot;&gt;&lt;/Node&gt;
</code></pre>
<h3 id="tree-ç»„ä»¶">Tree ç»„ä»¶</h3>
<p>Father.vue</p>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;ul&gt;
      &lt;item :model=&quot;treeData&quot;&gt;&lt;/item&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>item.vue</p>
<pre><code class="language-vue">&lt;template&gt;
  &lt;li&gt;
    &lt;div @click=&quot;toggle&quot;&gt;
        {{model.title}}
        &lt;span v-if=&quot;haveChild&quot;&gt;{{open ? '-' : '+'}}&lt;/span&gt;
    &lt;/div&gt;
    &lt;ul&gt;
        &lt;item v-for=&quot;model in model.children&quot; :model=&quot;model&quot; :key=&quot;model.title&quot;&gt;&lt;/item&gt;  
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/template&gt;

// æ‡’åŠ è½½ï¼šä¼ å…¥æ ‡è¯†ç¬¦ =&gt; åˆ¤æ–­æ ‡è¯†ç¬¦ true =&gt; show loadingã€è¯·æ±‚æ•°æ®
</code></pre>
<h2 id="plugins">plugins</h2>
<pre><code class="language-js">// æ’ä»¶å®šä¹‰ 
MyPlugin.install = function (Vue, options) {  
  // 1. æ·»åŠ å…¨å±€æ–¹æ³•æˆ–å±æ€§  
  Vue.myGlobalMethod = function () {    
    // é€»è¾‘...  
  }
  // 2. æ·»åŠ å…¨å±€èµ„æº  
  Vue.directive('my-directive', {    
    bind (el, binding, vnode, oldVnode) {     
      // é€»è¾‘...    
    }  
    ...  
  })
  // 3. æ³¨â¼Šç»„ä»¶é€‰é¡¹
  Vue.mixin({  
    created: function () {   
      // é€»è¾‘...  
    } 
    ... 
  })
  // 4. æ·»åŠ å®ä¾‹æ–¹æ³• 
  Vue.prototype.$myMethod = function (methodOptions) {
    // é€»è¾‘... 
  }
}

// æ’ä»¶ä½¿ç”¨
Vue.use(MyPlugin)
</code></pre>
<h2 id="mixins">mixins</h2>
<pre><code class="language-js">// å®šä¹‰ä¸€ä¸ªæ··å…¥å¯¹è±¡
var myMixin = {
  created: function() {
    this.hello()
  },
  methods: {
    hello: function() {
      console.log('hello from mixin!')
    },
  },
}
// å®šä¹‰ä¸€ä¸ªä½¿ç”¨æ··å…¥å¯¹è±¡çš„ç»„ä»¶
var Component = Vue.extend({
  mixins: [myMixin],
})
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‡½æ•°æŸ¯é‡ŒåŒ–]]></title>
        <id>https://yuufen.com/blog/post/gxNr15aBN/</id>
        <link href="https://yuufen.com/blog/post/gxNr15aBN/">
        </link>
        <updated>2020-02-20T04:16:25.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æŸ¯é‡ŒåŒ–ä»ä½•è€Œæ¥">æŸ¯é‡ŒåŒ–ä»ä½•è€Œæ¥</h2>
<p>æŸ¯é‡ŒåŒ–, å³ Currying çš„éŸ³è¯‘ã€‚Currying æ˜¯ç¼–è¯‘åŸç†å±‚é¢å®ç°å¤šå‚å‡½æ•°çš„ä¸€ä¸ªæŠ€æœ¯ã€‚</p>
<p>åœ¨ç¼–ç è¿‡ç¨‹ä¸­ï¼Œèº«ä¸ºç å†œçš„æˆ‘ä»¬æœ¬è´¨ä¸Šæ‰€è¿›è¡Œçš„å·¥ä½œå°±æ˜¯â€”â€”å°†å¤æ‚é—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªå¯ç¼–ç¨‹çš„å°é—®é¢˜ã€‚</p>
<p>Currying ä¸ºå®ç°å¤šå‚å‡½æ•°æä¾›äº†ä¸€ä¸ªé€’å½’é™è§£çš„å®ç°æ€è·¯â€”â€”æŠŠæ¥å—å¤šä¸ªå‚æ•°çš„å‡½æ•°å˜æ¢æˆæ¥å—ä¸€ä¸ªå•ä¸€å‚æ•°ï¼ˆæœ€åˆå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰çš„å‡½æ•°ï¼Œå¹¶ä¸”è¿”å›æ¥å—ä½™ä¸‹çš„å‚æ•°è€Œä¸”è¿”å›ç»“æœçš„æ–°å‡½æ•°ï¼Œåœ¨æŸäº›ç¼–ç¨‹è¯­è¨€ä¸­ï¼ˆå¦‚ Haskellï¼‰ï¼Œæ˜¯é€šè¿‡ Currying æŠ€æœ¯æ”¯æŒå¤šå‚å‡½æ•°è¿™ä¸€è¯­è¨€ç‰¹æ€§çš„ã€‚</p>
<p>æ‰€ä»¥ Currying åŸæœ¬æ˜¯ä¸€é—¨ç¼–è¯‘åŸç†å±‚é¢çš„æŠ€æœ¯ï¼Œç”¨é€”æ˜¯å®ç°å¤šå‚å‡½æ•°ã€‚</p>
<h2 id="å®ç°åŸç†">å®ç°åŸç†</h2>
<pre><code class="language-js">let _fn = curry(function(a, b, c, d, e) {
  console.log(a + b + c + d + e)
})

// ç›®æ ‡ï¼š
_fn(1, 2, 3, 4, 5) // 15
_fn(1)(2, 3)(4)(5) // 15
_fn(1)(2)(3)(4)(5) // 15

// å®ç°ï¼Œå¯ä»¥æŠŠ _curry() æå–å‡ºæ¥
function curry(fn, len = fn.length) {
  return function _curry(...args) {
    if (args.length &gt;= len) {
      return fn.apply(this, args)
    }
    return function(...params) {
      _args = [...args, ...params]

      if (_args.length &gt;= len) {
        return fn.apply(this, _args)
      } else {
        return _curry.call(this, ..._args)
      }
    }
  }
}
</code></pre>
<h2 id="currying-ä½¿ç”¨åœºæ™¯">Currying ä½¿ç”¨åœºæ™¯</h2>
<h3 id="å‚æ•°å¤ç”¨">å‚æ•°å¤ç”¨</h3>
<p>å›ºå®šä¸å˜çš„å‚æ•°ï¼Œå®ç°å‚æ•°å¤ç”¨æ˜¯ Currying çš„ä¸»è¦ç”¨é€”ä¹‹ä¸€ã€‚<br>
ä¸Šæ–‡ä¸­çš„ increment, addTen æ˜¯ä¸€ä¸ªå‚æ•°å¤ç”¨çš„å®ä¾‹ã€‚å¯¹ add æ–¹æ³•å›ºå®šç¬¬ä¸€ä¸ªå‚æ•°ä¸º 10 åï¼Œæ”¹æ–¹æ³•å°±å˜æˆäº†ä¸€ä¸ªå°†æ¥å—çš„å˜é‡å€¼åŠ  10 çš„æ–¹æ³•ã€‚</p>
<h3 id="å»¶è¿Ÿæ‰§è¡Œ">å»¶è¿Ÿæ‰§è¡Œ</h3>
<p>å»¶è¿Ÿæ‰§è¡Œä¹Ÿæ˜¯ Currying çš„ä¸€ä¸ªé‡è¦ä½¿ç”¨åœºæ™¯ï¼ŒåŒæ · bind å’Œç®­å¤´å‡½æ•°ä¹Ÿèƒ½å®ç°åŒæ ·çš„åŠŸèƒ½ã€‚<br>
åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œä¸€ä¸ªå¸¸è§çš„åœºæ™¯å°±æ˜¯ä¸ºæ ‡ç­¾ç»‘å®š onClick äº‹ä»¶ï¼ŒåŒæ—¶è€ƒè™‘ä¸ºç»‘å®šçš„æ–¹æ³•ä¼ é€’å‚æ•°ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-currying">ä¸ºä»€ä¹ˆéœ€è¦ Currying</h2>
<h3 id="ä¸ºäº†å¤šå‚å‡½æ•°å¤ç”¨æ€§">ä¸ºäº†å¤šå‚å‡½æ•°å¤ç”¨æ€§</h3>
<p>Currying è®©äººçœ¼å‰ä¸€äº®çš„åœ°æ–¹åœ¨äºï¼Œè®©äººè§‰å¾—å‡½æ•°è¿˜èƒ½è¿™æ ·å­å¤ç”¨ã€‚</p>
<p>é€šè¿‡ä¸€è¡Œä»£ç ï¼Œå°† add å‡½æ•°è½¬æ¢ä¸º incrementï¼ŒaddTen ç­‰ã€‚</p>
<p>å¯¹äº Currying çš„å¤æ‚å®ç°ä¸­ï¼Œä»¥ Lodash ä¸ºåˆ—ï¼Œæä¾›äº† placeholder çš„ç¥å¥‡æ“ä½œã€‚å¯¹å¤šå‚å‡½æ•°çš„å¤ç”¨ç©å‡ºèŠ±æ ·ã€‚</p>
<pre><code class="language-js">import _ from 'loadsh'

function abc(a, b, c) {
  return [a, b, c]
}

var curried = _.curry(abc)

// Curried with placeholders.
curried(1)(_, 3)(2)
// =&gt; [1, 2, 3]
</code></pre>
<h3 id="ä¸ºå‡½æ•°å¼ç¼–ç¨‹è€Œç”Ÿ">ä¸ºå‡½æ•°å¼ç¼–ç¨‹è€Œç”Ÿ</h3>
<p>Currying æ˜¯ä¸ºå‡½æ•°å¼è€Œç”Ÿçš„ä¸œè¥¿ã€‚åº”è¿ç€æœ‰ä¸€æ•´å¥—å‡½æ•°å¼ç¼–ç¨‹çš„ä¸œè¥¿ï¼Œçº¯å‡½æ•°ã€composeã€container ç­‰ç­‰äº‹ç‰©ã€‚ï¼ˆå¯é˜…è¯»ã€Šmostly-adequate-guideã€‹ ï¼‰<br>
å‡å¦‚è¦å†™ Pointfree Javascript é£æ ¼çš„ä»£ç ï¼Œé‚£ä¹ˆ Currying æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚<br>
è¦ä½¿ç”¨ composeï¼Œè¦ä½¿ç”¨ container ç­‰äº‹ç‰©ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ Curryingã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä¸éœ€è¦-currying">ä¸ºä»€ä¹ˆä¸éœ€è¦ Currying</h2>
<h3 id="currying-çš„ä¸€äº›ç‰¹æ€§æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆ">Currying çš„ä¸€äº›ç‰¹æ€§æœ‰å…¶ä»–è§£å†³æ–¹æ¡ˆ</h3>
<p>å¦‚æœæˆ‘ä»¬åªæ˜¯æƒ³æå‰ç»‘å®šå‚æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰å¾ˆå¤šå¥½å‡ ä¸ªç°æˆçš„é€‰æ‹©ï¼Œbindï¼Œç®­å¤´å‡½æ•°ç­‰ï¼Œè€Œä¸”æ€§èƒ½æ¯” Curring æ›´å¥½ã€‚</p>
<h3 id="currying-é™·äºå‡½æ•°å¼ç¼–ç¨‹">Currying é™·äºå‡½æ•°å¼ç¼–ç¨‹</h3>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæä¾›äº†ä¸€ä¸ª trueCurrying çš„å®ç°ï¼Œè¿™ä¸ªå®ç°ä¹Ÿæ˜¯æœ€ç¬¦åˆ Currying å®šä¹‰çš„ï¼Œä¹Ÿæä¾› äº† bindï¼Œç®­å¤´å‡½æ•°ç­‰ä¸å…·å¤‡çš„â€œæ–°å¥‡â€ç‰¹æ€§â€”â€”å¯æŒç»­çš„ Curryingï¼ˆè¿™ä¸ªè¯æ˜¯æœ¬äººä¸´æ—¶é€ çš„ï¼‰ã€‚<br>
ä½†æ˜¯è¿™ä¸ªâ€œæ–°å¥‡â€ç‰¹æ€§çš„åº”ç”¨å¹¶éæƒ³è±¡å¾—é‚£ä¹ˆå¹¿æ³›ã€‚<br>
å…¶åŸå› åœ¨äºï¼ŒCurrying æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„äº§ç‰©ï¼Œå®ƒç”Ÿäºå‡½æ•°å¼ç¼–ç¨‹ï¼Œä¹ŸæœåŠ¡äºå‡½æ•°å¼ç¼–ç¨‹ã€‚<br>
è€Œ JavaScript å¹¶éçœŸæ­£çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼Œç›¸æ¯” Haskell ç­‰å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ï¼ŒJavaScript ä½¿ç”¨ Currying ç­‰å‡½æ•°å¼ç‰¹æ€§æœ‰é¢å¤–çš„æ€§èƒ½å¼€é”€ï¼Œä¹Ÿç¼ºä¹ç±»å‹æ¨å¯¼ã€‚<br>
ä»è€ŒæŠŠ JavaScript ä»£ç å†™å¾—ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹æ€æƒ³å’Œè§„èŒƒçš„é¡¹ç›®éƒ½è¾ƒå°‘ï¼Œä»è€Œä¹Ÿé™åˆ¶äº† Currying ç­‰æŠ€æœ¯åœ¨ JavaScript ä»£ç ä¸­çš„æ™®éä½¿ç”¨ã€‚<br>
å‡å¦‚æˆ‘ä»¬è¿˜æ²¡æœ‰å‡†å¤‡å¥½å»å†™å‡½æ•°å¼ç¼–ç¨‹è§„èŒƒçš„ä»£ç ï¼Œä»…éœ€è¦åœ¨ JSX ä»£ç ä¸­æå‰ç»‘å®šä¸€æ¬¡å‚æ•°ï¼Œé‚£ä¹ˆ bind æˆ–ç®­å¤´å‡½æ•°å°±è¶³å¤Ÿäº†ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<ol>
<li>Currying åœ¨ JavaScript ä¸­æ˜¯â€œä½æ€§èƒ½â€çš„ï¼Œä½†æ˜¯è¿™äº›æ€§èƒ½åœ¨ç»å¤§å¤šæ•°åœºæ™¯ï¼Œæ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚</li>
<li>Currying çš„æ€æƒ³æå¤§åœ°åŠ©äºæå‡å‡½æ•°çš„å¤ç”¨æ€§ã€‚</li>
<li>Currying ç”Ÿäºå‡½æ•°å¼ç¼–ç¨‹ï¼Œä¹Ÿé™·äºå‡½æ•°å¼ç¼–ç¨‹ã€‚å‡å¦‚æ²¡æœ‰å‡†å¤‡å¥½å†™çº¯æ­£çš„å‡½æ•°å¼ä»£ç ï¼Œé‚£ä¹ˆ Currying æœ‰æ›´å¥½çš„æ›¿ä»£å“ã€‚</li>
<li>å‡½æ•°å¼ç¼–ç¨‹åŠå…¶æ€æƒ³ï¼Œæ˜¯å€¼å¾—å…³æ³¨ã€å­¦ä¹ å’Œåº”ç”¨çš„äº‹ç‰©ã€‚æ‰€ä»¥åœ¨æ–‡æœ«å†æ¬¡å®‰åˆ© JavaScript ç¨‹åºå‘˜é˜…è¯»æ­¤ä¹¦ â€”â€” ã€Šmostly-adequate-guideã€‹</li>
</ol>
<p>éƒ¨åˆ†è½¬è½½äº https://juejin.im/post/5af13664f265da0ba266efcf</p>
]]></content>
    </entry>
</feed>