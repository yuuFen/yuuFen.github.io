<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://yuufen.com/blog</id>
    <title>YuuFen</title>
    <updated>2020-04-26T18:30:21.529Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://yuufen.com/blog"/>
    <link rel="self" href="https://yuufen.com/blog/atom.xml"/>
    <subtitle>å¸Œæœ›ä½ å¯ä»¥è®°ä½æˆ‘</subtitle>
    <logo>https://yuufen.com/blog/images/avatar.png</logo>
    <icon>https://yuufen.com/blog/favicon.ico</icon>
    <rights>All rights reserved 2020, YuuFen</rights>
    <entry>
        <title type="html"><![CDATA[ä½ å¥½å‘€ï¼Œé™Œç”Ÿäºº]]></title>
        <id>https://yuufen.com/blog/post/about/</id>
        <link href="https://yuufen.com/blog/post/about/">
        </link>
        <updated>2024-02-28T16:00:00.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™å‘€ï¼Œå¾ˆé«˜å…´é‡è§ä½ ï¼ğŸ¤</p>
</blockquote>
<h2 id="å…³äºæœ¬ç«™">ğŸ  å…³äºæœ¬ç«™</h2>
<p>å› ä¸ºç¬”è®°å¤ªå¤šå¤ªæ‚ï¼Œå†³å®šå®šæœŸå†™å†™åšå®¢æ•´ç†æ•´ç†ç¬”è®°ã€‚</p>
<p><s>ç„¶åå› ä¸ºå„ç§åŸå› å¤±å»äº†åŠ¨åŠ›</s></p>
<p><s>å› æ­¤æä¸¢äº†å¥½å¤šç¬”è®°å•Šå•Šå•Šå•Šå•Šå•Šå•ŠğŸ˜­ğŸ˜­ğŸ˜­</s></p>
<p><s>çœ‹äº†çœ‹ä¸€å¹´å‰çš„åšæ–‡å‘ç°è‡ªå·±çœŸçš„å˜åŒ–äº†è›®å¤šçš„ï¼ˆåŠ æ²¹ğŸ’ªï¼‰</s></p>
<p>æ€»ä¹‹ç°åœ¨åˆå¼€å§‹äº†</p>
<h2 id="å…³äºæˆ‘">ğŸŸ å…³äºæˆ‘</h2>
<p>æˆ‘ç›®å‰å¤§äºŒåœ¨è¯»ï¼Œæˆ‘çš„èŒä¸šè§„åˆ’æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œæˆ‘çš„ä¸“ä¸šæ˜¯ç”µå­ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘è¿˜äº†è§£ä¸€äº›åµŒå…¥å¼å¼€å‘ï¼ˆå½“ç„¶åªæ˜¯ä¸€äº›äº›ï¼‰ï¼Œå¯¹Pythonå’ŒTensorFlowä¹Ÿæœ‰ä¸€å®šçš„æ¶‰çŒã€‚æˆ‘æ­£åœ¨åŠªåŠ›å¯»æ‰¾æš‘æœŸå®ä¹ ï¼</p>
<p>åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æœ‰å…³æˆ‘çš„æ›´å¤šä¿¡æ¯ï¼š</p>
<p><a href="https://yuufen.com/" target="_blank" class="text-button">ä¸»é¡µ</a><a href="https://yuufen.com/blog" target="_blank" class="text-button">åšå®¢</a><a href="https://github.com/yuuFen" target="_blank" class="text-button">é¡¹ç›®</a><a href="mailto:me@yuufen.com" class="text-button">ç»™æˆ‘å‘é‚®ä»¶</a></p>
<h2 id="å…´è¶£çˆ±å¥½">ğŸ¨ å…´è¶£çˆ±å¥½</h2>
<p><strong>æ‘„å½±</strong>ã€ç¾½æ¯›çƒã€è½®æ»‘ï¼Œand playing!</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Node åŸºç¡€]]></title>
        <id>https://yuufen.com/blog/post/jAmCPqVpt/</id>
        <link href="https://yuufen.com/blog/post/jAmCPqVpt/">
        </link>
        <updated>2020-04-03T19:35:51.000Z</updated>
        <content type="html"><![CDATA[<h2 id="nodejs-æ˜¯ä»€ä¹ˆ">NodeJS æ˜¯ä»€ä¹ˆ</h2>
<h3 id="nodejs-æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„äº‹ä»¶é©±åŠ¨çš„-javascript-è¿è¡Œæ—¶">node.js æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„äº‹ä»¶é©±åŠ¨çš„ JavaScript è¿è¡Œæ—¶ã€‚</h3>
<blockquote>
<ul>
<li>JRE æ˜¯ java è¿è¡Œæ—¶ç¯å¢ƒ</li>
<li>C Runtime</li>
<li>.NET Common Language Runtime</li>
</ul>
<p>è¿è¡Œæ—¶ runtime å°±æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ</p>
<p>æŒ‡çš„æ˜¯æŒ‡ä»¤åŠ è½½åˆ°å†…å­˜å¹¶ç”± CPU æ‰§è¡Œçš„æ—¶å€™ã€‚</p>
<p>è¿è¡Œæ—¶åº“å°±æ˜¯ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€è¦ä¾èµ–çš„åº“ã€‚</p>
<p>C ä»£ç ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼ŒæŒ‡ä»¤æ²¡æœ‰è¢« CPU æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™ç®—æ˜¯<strong>ç¼–è¯‘æ—¶</strong>ã€‚</p>
</blockquote>
<h3 id="nodejs-ç‰¹æ€§å…¶å®å°±æ˜¯-js-ç‰¹æ€§">node.js ç‰¹æ€§å…¶å®å°±æ˜¯ JS ç‰¹æ€§ï¼š</h3>
<ul>
<li>éé˜»å¡ I/O</li>
<li>äº‹ä»¶é©±åŠ¨</li>
</ul>
<h3 id="node-å†å²-ä¸ºæ€§èƒ½è€Œç”Ÿ">node å†å² â€” ä¸ºæ€§èƒ½è€Œç”Ÿ</h3>
<blockquote>
<p>Ryan Dahl(Google Brain)ï¼Œä»–çš„å·¥ä½œæ˜¯ç”¨ C/C++ å†™é«˜æ€§èƒ½ Web æœåŠ¡ã€‚å¯¹äºé«˜æ€§èƒ½ï¼Œå¼‚æ­¥ IOã€äº‹ä»¶é©±åŠ¨æ˜¯åŸºæœ¬åŸåˆ™ï¼Œä½†æ˜¯ç”¨ C/C++ æ¥å†™å°±å¤ªç—›è‹¦äº†ã€‚äºæ˜¯ä»–å¼€å§‹è®¾æƒ³ç”¨é«˜çº§è¯­è¨€å¼€å‘ Web æœåŠ¡ã€‚ä»–è¯„ä¼°äº†å¾ˆå¤šç§é«˜çº§åŸå› ï¼Œè¿˜æƒ³å¾ˆå¤šè¯­è¨€è™½ç„¶åŒæ—¶æä¾›äº†åŒæ­¥ IO å’Œå¼‚æ­¥ IOï¼Œä½†æ˜¯å¼€å‘äººå‘˜ä¸€æ—¦ç”¨äº†åŒæ­¥ IOï¼Œä»–ä»¬å°±å†ä¹Ÿæ‡’å¾—å†™å¼‚æ­¥ IOï¼Œæ‰€ä»¥æœ€ç»ˆ Ryan ç„å‘äº† JavaScriptã€‚</p>
<p>å› ä¸º JavaScript æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œæ ¹æœ¬ä¸èƒ½è¿›è¡ŒåŒæ­¥ IO æ“ä½œï¼Œæ‰€ä»¥ JavaScript çš„è¿™ä¸€&quot;ç¼ºé™·&quot;å¯¼è‡´äº†å®ƒåªèƒ½ä½¿ç”¨å¼‚æ­¥IOã€‚</p>
<p>é€‰å®šäº†å¼€å‘è¯­è¨€ï¼Œè¿˜è¦æœ‰è¿è¡Œæ—¶ç¯å¢ƒï¼ŒV8 å°±æ˜¯å¼€æºçš„ JavaScript å¼•æ“ã€‚äºæ˜¯åœ¨2009ï¼ŒRyan æ­£å¼æ¨å‡ºäº†åŸºäº JavaScript è¯­è¨€å’Œ V8 å¼•æ“çš„å¼€æº Web æœåŠ¡å™¨é¡¹ç›®ï¼Œå‘½åä¸º Node.jsã€‚Node ç¬¬ä¸€æ¬¡æŠŠ JavaScript å¸¦å…¥åˆ°åç«¯æœåŠ¡å™¨å¼€å‘ã€‚</p>
</blockquote>
<h3 id="å¹¶å‘å¤„ç†çš„æ›´æ›¿">å¹¶å‘å¤„ç†çš„æ›´æ›¿</h3>
<ul>
<li>
<p>å¤šè¿›ç¨‹ - Linux C / Apache</p>
<blockquote>
<p>è¿›ç¨‹çš„ç¼ºé™·ï¼š</p>
<ul>
<li>åˆ›å»ºå’Œåˆ‡æ¢çš„æ—¶é—´å’Œç©ºé—´å¼€é”€è¾ƒå¤§ï¼Œä¸”éšç€å¹¶å‘è¿›ç¨‹æ•°é‡çš„æå‡ï¼Œæ—¶é—´å’Œç©ºé—´çš„å¼€é”€ä¼šé€æ¸å¢å¤§ï¼Œä»è€Œé™åˆ¶äº†ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚</li>
<li>è¿›ç¨‹é—´çš„èµ„æºå…±äº«ä¸æ–¹ä¾¿</li>
</ul>
</blockquote>
</li>
<li>
<p>å¤šçº¿ç¨‹ - Java</p>
</li>
<li>
<p>å¼‚æ­¥ I/O - JavaScript</p>
</li>
<li>
<p>åç¨‹ - Lua / OpenResty / Go / deno (go + TS)</p>
</li>
</ul>
<blockquote>
<p>deno</p>
<p><a href="https://studygolang.com/articles/13101"> https://studygolang.com/articles/13101 </a></p>
</blockquote>
<h3 id="ä¸å‰ç«¯ä¸­-js-å¼‚åŒ">ä¸å‰ç«¯ä¸­ JS å¼‚åŒ</h3>
<ul>
<li>æ ¸å¿ƒè¯­æ³•ä¸å˜</li>
<li>å‰ç«¯ï¼šBOM / DOM</li>
<li>åç«¯ï¼šfs / http / buffer / event / os</li>
</ul>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<h3 id="è¿è¡Œ">è¿è¡Œ</h3>
<p>æ¯æ¬¡ä¿®æ”¹ js æ–‡ä»¶éœ€é‡æ–°æ‰§ï¨ˆæ‰èƒ½ç”Ÿæ•ˆï¼Œå®‰è£… nodemon å¯ä»¥ç›‘è§†æ–‡ä»¶æ”¹åŠ¨ï¼Œè‡ªåŠ¨é‡å¯ï¼š</p>
<pre><code>npm i -g nodemon
</code></pre>
<h3 id="è°ƒè¯•">è°ƒè¯•</h3>
<p>Debug - Start Debugging</p>
<blockquote>
<p>https://nodejs.org/en/</p>
</blockquote>
<h3 id="ä½¿ç”¨æ¨¡å—">ä½¿ç”¨æ¨¡å—</h3>
<ul>
<li>
<p>node å†…å»ºæ¨¡å—</p>
<pre><code class="language-js">// å†…å»ºæ¨¡å—ç›´æ¥å¼•ç”¨
const os = require('os')
const mem = os.freemem() / os.totalmem() * 100
console.log(`å†…å­˜å ç”¨ç‡${mem.toFixed(2)}%`)
</code></pre>
</li>
<li>
<p>ç¬¬ä¸‰æ–¹æ¨¡å—</p>
<blockquote>
<p><a href="https://www.npmjs.com/">https://www.npmjs.com/</a></p>
</blockquote>
<pre><code class="language-js">// åŒçº§ CPU å ç”¨ç‡ï¼Œå…ˆå®‰è£…
npm i download-git-repo -S
</code></pre>
<pre><code class="language-js">// å¯¼å…¥å¹¶ä½¿ç”¨
const download = require('download-git-repo')
const ora = require('ora')

const process = ora('ä¸‹è½½ä¸­...')
process.start()

download('github:yuuFen/vue-template-for-cli-demo', '../test', (err) =&gt; {
  // console.log(err ? 'Error' : 'Success')
  if (err) {
    process.fail()
  } else {
    process.succeed()
  }
})
</code></pre>
</li>
<li>
<p>promisefy</p>
<blockquote>
<p>è®©å¼‚æ­¥ä»»åŠ¡ä¸²è¡ŒåŒ–ï¼ˆè¦ç¬¦åˆè§„èŒƒï¼‰</p>
</blockquote>
<pre><code class="language-js">const repo = 'github:yuuFen/vue-template-for-cli-demo'
const desc = '../test'
clone(repo, desc)

async function clone(repo, desc) {
  const { pormisify } = require('util')
  const download = promisify(require('download-git-repo'))
  const ora = require('ora')
  const process = ora('ä¸‹è½½ä¸­...')
  process.start()
  try {
    await download(repo, desc)
  } catch (err) {
    process.fail()
  }
  process.succeed()
}
</code></pre>
</li>
<li>
<p>è‡ªå®šä¹‰æ¨¡å—</p>
<pre><code class="language-js">// download.js
// å¯ä»¥ä½œä¸ºå¯¼å‡ºå¯¹è±¡çš„å±æ€§å¯¼å‡º
module.exports.clone = async function clone(repo, desc) {
  const { pormisify } = require('util')
  const download = promisify(require('download-git-repo'))
  const ora = require('ora')
  const process = ora('ä¸‹è½½ä¸­...')
  process.start()
  try {
    await download(repo, desc)
  } catch (err) {
    process.fail()
  }
  process.succeed()
}

// run
const { clone } = require('./download')
const repo = 'github:yuuFen/vue-template-for-cli-demo'
const desc = '../test'

clone(repo, desc)
</code></pre>
</li>
</ul>
<h2 id="api">API</h2>
<h3 id="fs">fs</h3>
<pre><code class="language-js">const fs = require('fs')

// åŒæ­¥è°ƒç”¨
const data = fs.readFileSync('./download.js')
// data ç±»å‹ä¸º Buffer
console.log(data.toString())

// å¼‚æ­¥
fs.readFile('./download.js', (err, data) =&gt; {
    if (err) throw err
    console.log(data.toString())
})

// fs å¸¸æ­é… path api ä½¿ç”¨
const path = require('path')
fs.readFile(path.resolve(path.resolve(__dirname, './download.js')), (err, data) =&gt; {
    if (err) throw err
    console.log(data.toString())
})

// prromisify
const { promisify } = require('util')
const readFile = promisify(fs.readFile)
readFile('./download.js').then(data =&gt; console.log(data))

// fs Promises API node v10
const fsp = require('fs').promises
fsp
    .readFile('./download.js')
    .then(data =&gt; console.log(data))
	.catch(err =&gt; console.log(err))
</code></pre>
<h3 id="buffer">Buffer</h3>
<blockquote>
<p>ç”¨äºåœ¨ TCP æµã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ä»¥åŠå…¶ä»–ä¸Šä¸‹æ–‡ä¸­ä¸å…«ä½å­—èŠ‚æµè¿›ï¨ˆäº¤äº’ã€‚ å…«ä½å­—èŠ‚ç»„æˆçš„æ•°ç»„ï¼Œå¯ä»¥æœ‰æ•ˆçš„åœ¨ JS ä¸­å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ã€‚</p>
</blockquote>
<pre><code class="language-js">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º 10 å­—èŠ‚ä»¥ 0 å¡«å……çš„Buffer
const buf1 = Buffer.alloc(10)
console.log(buf1)

// åˆ›å»ºä¸€ä¸ª Buffer åŒ…å« ascii
const buf2 = Buffer.from('a')
console.log(buf2, buf2.toString())

// åˆ›å»º Buffer åŒ…å« UTF-8 å­—èŠ‚
// UFT-8ï¼šä¸€ç§å˜é•¿çš„ç¼–ç æ–¹æ¡ˆï¼Œä½¿ç”¨ 1 ~ 6 ä¸ªå­—èŠ‚æ¥å­˜å‚¨
// UFT-32ï¼šä¸€ç§å›ºå®šé•¿åº¦çš„ç¼–ç æ–¹æ¡ˆï¼Œï¥§ç®¡å­—ç¬¦ç¼–å·å¤§å°ï¼Œå§‹ç»ˆä½¿ç”¨ 4 ä¸ªå­—èŠ‚æ¥å­˜å‚¨
// UTF-16ï¼šä»‹äº UTF-8 å’Œ UTF-32 ä¹‹é—´ï¼Œä½¿ç”¨ 2 ä¸ªæˆ–è€… 4 ä¸ªå­—èŠ‚æ¥å­˜å‚¨ï¼Œé•¿åº¦æ—¢å›ºå®šåˆå¯å˜
const buf3 = Buffer.from('Buffer åˆ›å»ºæ–¹æ³•')
console.log(buf3)

// å†™å…¥Bufferæ•°æ®
buf1.write('hello')
console.log(buf1)

// è¯»å–Bufferæ•°æ®  
console.log(buf3.toString())  

// åˆå¹¶Buffer  
const buf4 = Buffer.concat([buf1, buf3])
console.log(buf4.toString());
</code></pre>
<h3 id="http">http</h3>
<blockquote>
<p>ç”¨äºåˆ›å»º web æœåŠ¡çš„æ¨¡å—</p>
</blockquote>
<ul>
<li>åˆ›å»ºä¸€ä¸ªhttpæœåŠ¡å™¨</li>
</ul>
<pre><code class="language-js">const http = require('http')
const server = http.createServer((request, response) =&gt; {
    // æ‰“å°ä¸€ä¸‹ response çš„åŸå‹é“¾
    console.log(getPrototypeChain(response))
    // response æ˜¯ä¸€ä¸ª Steam
    response.end('a response from server')
})

server.listen(3000)


function getPrototypeChain(obj) {
    let prototypeChain = []
    while (obj = Object.getPrototypeOf(obj)) {
        prototypeChain.push(obj)
    }
    prototypeChain.push(null)
    return prototypeChain
}
</code></pre>
<p>æ˜¾ç¤ºé¦–é¡µ / å®ç°æ¥å£</p>
<pre><code class="language-js">const http = require('http')
const fs = require('fs')

const server = http.createServer((request, response) =&gt; {
  const { url, method } = request

  if (url === '/' &amp;&amp; method === 'GET') {
    fs.readFile('./index.html', (err, data) =&gt; {
      if (err) {
        response.writeHead(500, { 'Content-Type': 'text/plain;charset=utf-8' })
        response.end('500 æœåŠ¡ç«¯é”™è¯¯')
      }
      response.statusCode = 200
      response.setHeader('Content-Type', 'text/html')
      response.end(data)
    })
  } else if (url === '/users' &amp;&amp; method === 'GET') {
    response.setHeader('Content-Type', 'application/json')
    response.end(JSON.stringify({ name: 'name' }))
  } else {
    response.statusCode = 404
    response.setHeader('Content-Type', 'text/plain;charset=utf-8')
    response.end('404 é¡µé¢ä¸å­˜åœ¨')
  }
})

server.listen(3000)
</code></pre>
<h3 id="stream">stream</h3>
<blockquote>
<p>ç”¨äºä¸ node ä¸­æµæ•°æ®äº¤äº’çš„æ¥å£</p>
</blockquote>
<pre><code class="language-js">const fs = require('fs')

const rs = fs.createReadStream('./img1.png')
const ws = fs.createWriteStream('./img2.png')
// åœ¨å†…å­˜ä¸­ä»¥å­—èŠ‚æµåŠ¨ï¼Œé˜²æ­¢ä¼ è¾“å¤§æ–‡ä»¶æ—¶å†…å­˜å ç”¨è¿‡é«˜
rs.pipe(ws)
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1587322423228.png" alt="" loading="lazy"></figure>
<p>å“åº”å›¾ç‰‡è¯·æ±‚</p>
<pre><code class="language-js">const http = require('http')
const fs = require('fs')

const server = http.createServer((request, response) =&gt; {
  const { url, method, headers } = request

  if (url === '/' &amp;&amp; method === 'GET') {
    fs.readFile('./index.html', (err, data) =&gt; {
      if (err) {
        response.writeHead(500, { 'Content-Type': 'text/plain;charset=utf-8' })
        response.end('500 æœåŠ¡ç«¯é”™è¯¯')
      }
      response.statusCode = 200
      response.setHeader('Content-Type', 'text/html')
      response.end(data)
    })
  } else if (method === 'GET' &amp;&amp; headers.accept.indexOf('image/*') !== -1) {
    console.log(url) // '/img.png'
	// response æ˜¯ Stream
    fs.createReadStream('.' + url).pipe(response)
  }
})

server.listen(3000)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è™šæ‹Ÿ DOM ç®€å•å®ç°]]></title>
        <id>https://yuufen.com/blog/post/M0Xa7RsWm/</id>
        <link href="https://yuufen.com/blog/post/M0Xa7RsWm/">
        </link>
        <updated>2020-04-01T03:24:31.000Z</updated>
        <content type="html"><![CDATA[<h2 id="é¡¹ç›®åœ°å€">é¡¹ç›®åœ°å€</h2>
<p>https://github.com/yuuFen/Virtual-DOM</p>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿ-dom">ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿ DOM</h2>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1586510765752.png" alt="" loading="lazy"></figure>
<p>çœŸå® DOM éå¸¸å¤æ‚ï¼Œæ‹¥æœ‰è®¸å¤šå±æ€§ï¼Œæ‰€ä»¥ DOM çš„æ“ä½œå¼€é”€å·¨å¤§ï¼Œéœ€è¦å°½å¯èƒ½çš„å°‘æ“ä½œ DOMã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1586523343141.png" alt="" loading="lazy"></figure>
<p>ä½¿ç”¨è‡ªå®šä¹‰çš„ä¸€ä¸ªå¯¹è±¡æ¥æè¿° DOMï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘å¤æ‚åº¦ã€‚</p>
<h2 id="åˆ›å»ºè™šæ‹Ÿ-dom">åˆ›å»ºè™šæ‹Ÿ DOM</h2>
<pre><code class="language-js">let vnode = createElement('div', { id: 'test' }, [
    createElement('p', {}, ['èŠ‚ç‚¹1'])
])
console.log(JSON.stringify(vnode, null, 2))
</code></pre>
<pre><code class="language-js">function createElement(tag, data, children) {
  let flag
  if (typeof tag == 'string') {
    // æ™®é€šçš„ html æ ‡ç­¾
    flag = vnodeType.HTML
  } else if (typeof tag == 'function') {
    flag = vnodeType.COMPONENT
  } else {
    flag = vnodeType.TEXT
  }

  let childrenFlag
  if (children == null) {
    childrenFlag = childrenType.EMPTY
  } else if (Array.isArray(children)) {
    let length = children.length
    if (length === 0) {
      childrenFlag = childrenType.SINGLE
    } else {
      childrenFlag = childrenType.MULTIPLE
    }
  } else {
    // å…¶ä»–æƒ…å†µè®¤ä¸ºæ˜¯æ–‡æœ¬
    childrenFlag = childrenType.SINGLE
    children = createTextVNode(children + '')
  }

  // è¿”å› vnode
  return {
    flag, // vnode ç±»å‹
    tag, // æ ‡ç­¾ç±»å‹ / æ–‡æœ¬æ²¡æœ‰ tag / ç»„ä»¶çš„ tag æ˜¯å‡½æ•°
    data,
    children,
    childrenFlag,
  }
}

function createTextVNode(text) {
  return {
    flag: vnodeType.TEXT,
    tag: null,
    data: null,
    children: text,
    childrenFlag: childrenType.EMPTY,
  }
}
</code></pre>
<h2 id="æ¸²æŸ“">æ¸²æŸ“</h2>
<pre><code class="language-js">      let vnode = createElement('div', { id: 'test' }, [
        createElement('p', { key: 'a',style: { color: 'blue' } }, ['èŠ‚ç‚¹1']),
        createElement('p', { key: 'b', '@click': () =&gt; { alert('xx') } }, ['èŠ‚ç‚¹2']),
        createElement('p', { key: 'c', 'class': 'item-header' }, ['èŠ‚ç‚¹3']),
        createElement('p', { key: 'd' }, ['èŠ‚ç‚¹4']),
      ])

      render(vnode, document.getElementById('app'))
</code></pre>
<pre><code class="language-js">// è¦æ¸²æŸ“çš„ vnodeã€å®¹å™¨ï¼ˆçˆ¶å…ƒç´ ï¼‰
function render(vnode, container) {
  // é¦–æ¬¡æ¸²æŸ“
  mount(vnode, container)
}

// é¦–æ¬¡æŒ‚è½½å…ƒç´ 
function mount(vnode, container) {
  let { flag } = vnode
  if (flag == vnodeType.HTML) {
    // (åº”è¯¥ä½¿ç”¨å¯¹è±¡å®ç°ï¼Œä¸ç„¶ä¾èµ–æœ‰ç‚¹ä¹±)
    mountElement(vnode, container)
  } else if (flag == vnodeType.TEXT) {
    mountText(vnode, container)
  }
}

function mountElement(vnode, container) {
  let dom = document.createElement(vnode.tag)
  vnode.el = dom
  let { data, children, childrenFlag } = vnode

  // æŒ‚è½½ key
  if (data) {
    for (let key in data) {
      patchData(dom, key, null, data[key])
    }
  }

  if (childrenFlag !== childrenType.EMPTY) {
    if (childrenFlag == childrenType.SINGLE) {
      mount(children, dom)
    } else if (childrenFlag == childrenType.MULTIPLE) {
      for (let i = 0; i &lt; children.length; i++) {
        mount(children[i], dom)
      }
    }
  }

  container.appendChild(dom)
}

function mountText(vnode, container) {
  let dom = document.createTextNode(vnode.children)
  vnode.el = dom
  container.appendChild(dom)
}

function patchData(el, key, prv, next) {
  switch (key) {
    case 'style':
      for (let key in next) {
        el.style[key] = next[key]
      }
      break
    case 'class':
      el.className = next
      break
    default:
      if (key[0] === '@') {
        if (next) {
          el.addEventListener(key.slice[1], next)
        }
      } else {
        el.setAttribute(key, next)
      }
      break
  }
}
</code></pre>
<h2 id="è¡¥ä¸">è¡¥ä¸</h2>
<pre><code class="language-js">function patch(prev, next, container) {
  const nextFlag = next.flag
  const prevFlag = prev.flag

  // å¦‚ element å˜ä¸º text, ç›´æ¥æ›¿æ¢, ä¸ç®¡ children
  if (nextFlag !== prevFlag) {
    replaceVNode(prev, next, container)
  } else if (nextFlag == vnodeType.HTML) {
    patchElement(prev, next, container)
  } else if (nextFlag == vnodeType.TEXT) {
    patchText(prev, next, container)
  }
}

function patchElement(prev, next, container) {
  if (prev.tag !== next.tag) {
    replaceVNode(prev, next, container)
    return
  }
  const el = (next.el = prev.el)

  // patch data
  const prevData = prev.data
  const nextData = next.data
  if (nextData) {
    for (const key in nextData) {
      const prevVal = prevData[key]
      const nextVal = nextData[key]
      patchData(el, key, prevVal, nextVal)
    }
  }
  if (prevData) {
    for (const key in prevData) {
      const prevVal = prevData[key]
      if (prevVal &amp;&amp; !nextData.hasOwnProperty(key)) {
        patchData(el, key, prevVal, null)
      }
    }
  }

  // patch children
  patchChildren(prev.childrenFlag, next.childrenFlag, prev.children, next.children, el)
}

function patchChildren(prevChildrenFlag, nextChildrenFlag, prevChildren, nextChildren, container) {
  // 1. è€çš„æ˜¯ å•ç‹¬çš„ / ç©ºçš„ / å¤šä¸ª
  // 2. æ–°çš„æ˜¯ å•ç‹¬çš„ / ç©ºçš„ / å¤šä¸ª
  switch (prevChildrenFlag) {
    case childrenType.SINGLE:
      switch (nextChildrenFlag) {
        case childrenType.SINGLE:
          patch(prevChildren, nextChildren, container)
          break
        case childrenType.EMPTY:
          container.removeChild(prevChildren.el)
          break
        case childrenType.MULTIPLE:
          container.removeChild(prevChildren.el)
          for (let i = 0; i &lt; nextChildren.length; i++) {
            mount(nextChildren[i], container)
          }
          break
      }
      break

    case childrenType.EMPTY:
      switch (nextChildrenFlag) {
        case childrenType.SINGLE:
          mount(nextChildren, container)
          break
        case childrenType.EMPTY:
          break
        case childrenType.MULTIPLE:
          for (let i = 0; i &lt; nextChildren.length; i++) {
            mount(nextChildren[i], container)
          }
          break
      }
      break

    case childrenType.MULTIPLE:
      switch (nextChildrenFlag) {
        case childrenType.SINGLE:
          for (let i = 0; i &lt; prevChildren.length; i++) {
            container.removeChild(prevChildren[i].el)
          }
          mount(nextChildren, container)
          break
        case childrenType.EMPTY:
          for (let i = 0; i &lt; prevChildren.length; i++) {
            container.removeChild(prevChildren[i].el)
          }
          break
        case childrenType.MULTIPLE:
          // ä¼—å¤šè™šæ‹Ÿ DOM å°±åœ¨è¿™é‡Œäº§ç”Ÿåˆ†æ­§ï¼Œæ¯å®¶çš„ä¼˜åŒ–ç­–ç•¥ä¸ä¸€æ ·
          // è€ï¼š[abc] æ–°ï¼š[c**a**b**]
          // ab ä¸éœ€è¦æ›´æ”¹ï¼Œåªéœ€è¦åœ¨ ab ä¹‹é—´æˆ–ä¹‹å‰æ’å…¥å…ƒç´ ï¼Œæˆ–åœ¨æœ€åæ–°å»ºå…ƒç´ 
          let lastIndex = 0
          for (let i = 0; i &lt; nextChildren.length; i++) {
            let find = false
            const nextVNode = nextChildren[i]
            for (let j = 0; j &lt; prevChildren.length; j++) {
              const prevVNode = prevChildren[j]
              if (prevVNode.key === nextVNode.key) {
                find = true
                // å¦‚æœ key ç›¸åŒï¼Œè®¤ä¸ºæ˜¯åŒä¸€ä¸ªå…ƒç´ ï¼Œè¡¥ä¸ä¸€ä¸‹ï¼Œä¸æ–°å»ºæˆ–é”€æ¯
                patch(prevVNode, nextVNode, container)
                if (j &lt; lastIndex) {
                  // éœ€è¦ç§»åŠ¨çš„æƒ…å†µ
                  // lastIndex æŒ‡çš„æ˜¯ä¸Šä¸€ä¸ªæ‰¾åˆ°çš„å…ƒç´ åœ¨ prevVNode ä¸­çš„ä½ç½®
                  // j å°±æ˜¯æœ€æ–°æ‰¾åˆ°çš„å…ƒç´ åœ¨ prevVNode ä¸­çš„ä½ç½®
                  // ä½¿ç”¨ insertBefore ç§»åŠ¨å…ƒç´ 
                  const flagNode = nextChildren[i - 1].el.nextSibling
                  container.insertBefore(prevVNode.el, flagNode)
                } else {
                  // å¦‚æœé¡ºåºæ­£ç¡®ï¼Œå°±æ›´æ–°æœ«å°¾ä½ç½®
                  lastIndex = j
                }
              }
            }
            if (!find) {
              // éœ€è¦æ–°å¢
              const flagNode = i == 0 ? prevChildren[0].el : nextChildren[i - 1].el.nextSibling
              mount(nextVNode, container, flagNode)
            }
          }

          // ç§»é™¤ä¸éœ€è¦çš„å…ƒç´ 
          for (let i = 0; i &lt; prevChildren.length; i++) {
            const prevVNode = prevChildren[i]
            const has = nextChildren.find((next) =&gt; next.key === prevVNode.key)
            if (!has) {
              container.removeChild(prevVNode.el)
            }
          }
          break
      }
      break
  }
}

function patchText(prev, next, container) {
  const el = (next.el = prev.el)
  if (next.children !== prev.children) {
    el.nodeValue = next.children
  }
}

function patchData(el, key, prev, next) {
  switch (key) {
    case 'style':
      for (let key in next) {
        el.style[key] = next[key]
      }
      for (let key in prev) {
        if (!next || !next.hasOwnProperty(key)) {
          el.style[key] = ''
        }
      }

      break
    case 'class':
      el.className = next
      break
    default:
      if (key[0] === '@') {
        if (prev) {
          el.removeEventListener(key.slice(1), prev)
        }
        if (next) {
          el.addEventListener(key.slice(1), next)
        }
      } else {
        el.setAttribute(key, next)
      }
      break
  }
}

function replaceVNode(prev, next, container) {
  container.removeChild(prev.el)
  mount(next, container)
}
</code></pre>
<h2 id="vue-ä¸­çš„ä¼˜åŒ–">Vue ä¸­çš„ä¼˜åŒ–</h2>
<p>å¯¹å¸¸è§çš„ä¿®æ”¹ï¼šæ–°å¢ã€åˆ é™¤ã€å€’åºæ’åˆ—åšäº†ç‰¹å®šä¼˜åŒ–ï¼Œè¯¦ç»†è§ä¹‹å‰æ–‡ç« ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å®ç°ç®€å•çš„ SSR]]></title>
        <id>https://yuufen.com/blog/post/s-05vytU3/</id>
        <link href="https://yuufen.com/blog/post/s-05vytU3/">
        </link>
        <updated>2020-03-25T02:49:07.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æ¸²æŸ“æœåŠ¡å™¨">æ¸²æŸ“æœåŠ¡å™¨</h2>
<p>server/index.js</p>
<pre><code class="language-js">const express = require('express')
const Vue = require('vue')
const fs = require('fs')

// åˆ›å»º express å®ä¾‹
const app = express()

const { createBundleRenderer } = require('vue-server-renderer')

const bundle = require('../dist/server/vue-ssr-server-bundle.json')
const clientManifest = require('../dist/server/vue-ssr-client-bundle.json')
const renderer = createBundleRenderer(bundle, {
  runInNewContext: false,
  template: fs.readFileSync('./src/index.temp.html'),
  clientManifest: clientManifest,
})

function renderToString(context) {
  return new Promise((resolve, reject) =&gt; {
    renderer.renderToString(context, (err, html) =&gt; {
      if (err) {
        reject(err)
        return
      }
      resolve(html)
    })
  })
}

// // åˆ›å»º vue å®ä¾‹
// const vm = new Vue({
//   data: { cnt: 1 },
//   template: `
//     &lt;div&gt;{{cnt}}&lt;/div&gt;
//   `,
// })

// å®¢æˆ·ç«¯éƒ¨ç½²é™æ€æ–‡ä»¶
app.use(express.static('../dist/client'))
// å£°æ˜æœåŠ¡ç«¯è·¯ç”±
app.get('*', async function (req, res) {
  try {
    const context = {
      title: 'ssr test',
      url: req.url,
    }
    const html = await renderToString(context)
    res.send(html)
  } catch (err) {
    res.status(500).send('Internal Server Error')
  }
})

app.listen(3000, () =&gt; {
  console.log('æ¸²æŸ“æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ')
})
</code></pre>
<h2 id="æ‰“åŒ…å…¥å£æ–‡ä»¶">æ‰“åŒ…å…¥å£æ–‡ä»¶</h2>
<h3 id="appjs">app.js</h3>
<pre><code class="language-js">// é€šç”¨ï¼šåˆ›å»º Vue å®ä¾‹

import Vue from 'vue'
import App from './App.vue'
import { createRouter } from './router'
import { createStore } from './store'

export function createApp(context) {
  const router = createRouter()
  const store = createStore()
  const app = new Vue({
    router,
    store,
    render: (h) =&gt; h(App),
  })
  return { app, router }
}
</code></pre>
<h3 id="entry-clientjs">entry-client.js</h3>
<pre><code class="language-js">import { createApp } from './app'

const { app, router } = createApp()

router.onReady(() =&gt; {
  // æŒ‚è½½
  app.$mount('#app')
})
</code></pre>
<h3 id="entry-serverjs">entry-server.js</h3>
<pre><code class="language-js">import { createApp } from './app'

export default (context) =&gt; {
  // è¿”å› Promiseï¼Œç¡®ä¿è·¯ç”±æˆ–ç»„ä»¶å‡†å¤‡å°±ç»ª
  return new Promise((resolve, reject) =&gt; {
    // åˆ›å»º vue å®ä¾‹
    const { app, router } = createApp(context)
    // è·³è½¬é¦–å±åœ°å€
    router.push(context.url)
    // å®Œæˆ promise
    router.onReady(() =&gt; {
      resolve(app)
    }, reject)
  })
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue + TS]]></title>
        <id>https://yuufen.com/blog/post/uhM7D6ItT/</id>
        <link href="https://yuufen.com/blog/post/uhM7D6ItT/">
        </link>
        <updated>2020-03-22T16:30:21.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å¼€å§‹">å¼€å§‹</h2>
<h3 id="æ–‡æ¡£">æ–‡æ¡£</h3>
<p><a href="https://www.tslang.cn/docs/home.html">TypeScriptå‚è€ƒ</a></p>
<h3 id="å¼•å…¥-ts">å¼•å…¥ ts</h3>
<p>å¦‚æœå·²å­˜åœ¨é¡¹ç›®ï¼Œä½¿ç”¨<code>vue add @vue/typescript</code>å¼•å…¥ï¼ˆæ³¨æ„ï¼šä¼šé€ æˆç ´åæ€§æ›´æ”¹ï¼‰ ï¼Œ</p>
<p>å¦åˆ™ç›´æ¥ä½¿ç”¨ vue create å³å¯ã€‚</p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§</h2>
<h3 id="ç±»å‹æ³¨è§£å’Œç±»å‹æ£€æŸ¥">ç±»å‹æ³¨è§£å’Œç±»å‹æ£€æŸ¥</h3>
<pre><code class="language-ts">let name = &quot;xx&quot;; // ç±»å‹æ¨è®º
let title: string = &quot;xx&quot;; // ç±»å‹æ³¨è§£ 
name = 2;// é”™è¯¯
title = 4;// é”™è¯¯

//æ•°ç»„ä½¿ç”¨ç±»å‹
let names: string[]; names = ['Tom'];//æˆ– Array&lt;string&gt;
let foo:any = 'xx' foo = 3

// anyç±»å‹ä¹Ÿå¯ç”¨äºæ•°ç»„
let list: any[] = [1, true, &quot;free&quot;]; 
list[1] = 100;

// å‡½æ•°ä¸­ä½¿ç”¨ç±»å‹æ³¨è§£
function greeting(person: string): string {
    return 'Hello, ' + person;
}
function warnUser(): void {
    alert(&quot;This is my warning message&quot;);
}
</code></pre>
<p>Vue ç»„ä»¶ä¸­åº”ç”¨ï¼š</p>
<pre><code class="language-VUE">&lt;template&gt; 
	&lt;div&gt;  
		&lt;ul&gt;     
        	&lt;li v-for=&quot;feature in features&quot; :key=&quot;feature&quot;&gt;{{feature}}&lt;/li&gt;   
    	&lt;/ul&gt;  
    &lt;/div&gt; 
&lt;/template&gt;
&lt;script lang='ts'&gt; 
    import { Component, Prop, Vue } from &quot;vue-property-decorator&quot;;
    
	@Component 
    export default class Hello extends Vue {  
        features: string[];
    	constructor() {   
        	super();  
            this.features = [&quot;ç±»å‹æ³¨è§£&quot;, &quot;ç¼–è¯‘å‹è¯­â¾”è¨€&quot;]; 
        }
    }
&lt;/script&gt;
</code></pre>
<h2 id="å‡½æ•°">å‡½æ•°</h2>
<pre><code class="language-ts">// æ­¤å¤„ name å’Œ age æ˜¯å¿…å¡«å‚æ•° 
// å¦‚æœè¦å˜ä¸ºå¯é€‰å‚æ•°ï¼ŒåŠ ä¸Šï¼Ÿ 
function sayHello(name: string, age: number = 20, addr?: string): string {  
    return 'ä½ å¥½ï¼š' + name + ' ' + age; 
}
// é‡è½½ 
// å‚æ•°æ•°ï¥¾æˆ–è€…ç±»å‹
// æˆ–è¿”å›ç±»å‹ï¥§åŒ
// å…ˆå£°æ˜ï¼Œåœ¨å®ç° 
function info(a: { name: string }): string;
function info(a: string): object;
function info(a: { name: string } | string): any {
    if (typeof a === &quot;object&quot;) { 
        return a.name; 
    } else {   
        return { name: a };    
    }
} 

console.log(info({ name: &quot;tom&quot; })); 
console.log(info(&quot;tom&quot;));
</code></pre>
<p>Vue ç»„ä»¶ä¸­åº”ç”¨ï¼š</p>
<pre><code class="language-vue">&lt;div&gt;  
    &lt;input type=&quot;text&quot; placeholder=&quot;è¾“â¼Šå…¥æ–°ç‰¹æ€§&quot; @keyup.enter=&quot;addFeature&quot;&gt; 
&lt;/div&gt;
</code></pre>
<pre><code class="language-ts">// â½£ç”Ÿå‘½å‘¨æœŸé’©â¼¦å­ 
created(){}

// æ™®é€šâ½…æ–¹æ³• 
private addFeature(event: any) {
    console.log(event);   
    this.features.push(event.target.value);   
    event.target.value = ''; 
}
</code></pre>
<h2 id="ç±»">ç±»</h2>
<pre><code class="language-ts">class MyComp {
	private _foo: string  // ç§æœ‰å±æ€§
    protected bar: string // ä¿æŠ¤å±æ€§
    readonly baz = 'baz'  // åªè¯»å±æ€§å¿…é¡»åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°é‡Œåˆå§‹åŒ–
    
    // æ„é€ å‡½æ•°ï¼šåˆå§‹åŒ–æˆå‘˜å˜é‡
    // å‚æ•°åŠ ä¸Šä¿®é¥°ç¬¦ï¼Œèƒ½å¤Ÿå®šä¹‰å¹¶åˆå§‹åŒ–ä¸€ä¸ªæˆå‘˜å˜é‡
    constructor(private tua = 'tua') {
        this._foo = 'foo'
        this.bar = 'bar'
    }
	
    private someMethod() {}
	
    // å­˜å–å™¨ï¼šå­˜å–æ•°æ®æ—¶å¯æ·»åŠ é¢å¤–é€»è¾‘ï¼Œåœ¨ vue ä¸­ç”¨ä½œè®¡ç®—å±æ€§
    get foo() { return this._foo }
    set foo(val) {
        this._foo = val
    }
}
</code></pre>
<p>vue ç»„ä»¶ä¸­åº”ç”¨ï¼šå£°æ˜è‡ªå®šä¹‰ç±»å‹ï¼Œçº¦æŸæ•°æ®ç»“æ„</p>
<pre><code class="language-ts">// å®šä¹‰ä¸€ä¸ªç‰¹æ€§ç±»ï¼Œæ‹¥æœ‰æ›´å¤šå±æ€§
class Feature {
    constructor(public id: number, public name: string) {}
}

// å¯ä»¥å¯¹è·å–çš„æ•°æ®ç±»å‹åšçº¦æŸ
@Component
export default class HelloWorld extends Vue {
    private features: Featurre[]
    
    constructor() {
        super()
        this.features = [
            { id: 1, name: 'ç±»å‹æ³¨è§£' },
            { id: 2, name: 'ç¼–è¯‘å‹è¯­è¨€' },
        ]
    }
}
</code></pre>
<p>vue ç»„ä»¶ä¸­åº”ç”¨ï¼šåˆ©ç”¨ getter è®¾ç½®è®¡ç®—å±æ€§</p>
<pre><code class="language-ts">get count() {
	return this.features.length
}
</code></pre>
<h3 id="class-æ˜¯è¯­æ³•ç³–å®ƒæŒ‡å‘çš„å°±æ˜¯æ„é€ å‡½æ•°">class æ˜¯è¯­æ³•ç³–ï¼Œå®ƒæŒ‡å‘çš„å°±æ˜¯æ„é€ å‡½æ•°</h3>
<pre><code class="language-ts">class Person { // ç±»æŒ‡å‘æ„é€ å‡½æ•°
    constructor(name, age) { // constructor æ˜¯é»˜è®¤æ–¹æ³•ï¼Œnew å®ä¾‹æ—¶è‡ªåŠ¨è°ƒç”¨
        this.name = name // å±æ€§å£°æ˜åœ¨å®ä¾‹ä¸Šï¼Œthis æŒ‡å‘å®ä¾‹
        this.age = age
    }
    say() { // æ–¹æ³•ä¼šå£°æ˜åœ¨åŸå‹ä¸Š
        return this.name + &quot;ï¼Œ&quot; + this.age
    }
}

console.log(typeof Person) // function
console.log(Person === Person.prototype.constructor) // true
</code></pre>
<p>ç­‰æ•ˆäºï¼š</p>
<pre><code class="language-ts">function Person(name, age) {
    this.name = name
    this.age = age
}

Person.prototype.say = function() {
    return this.name + &quot;ï¼Œ&quot; + this.age
}
</code></pre>
<h2 id="æ¥å£-interface">æ¥å£ interface</h2>
<p>ä»…å®šä¹‰ç»“æ„ï¼Œä¸è´Ÿè´£å®ç°</p>
<pre><code class="language-ts">interface Person {
    firstName: string;
    lastName: string;
    sayHello(): string; // è¦æ±‚å®ç°æ–¹æ³•
}

// å®ç°æ¥å£
class Greeter implements Person {
    constructor(public firstName = '', public lastName = '') {}
    
    sayHello() {
        return 'Hello,' + this.firstName + this.lastName
    }
}

// é¢å‘æ¥å£ç¼–ç¨‹
function greeting(person: Person) {
    return person.sayHello()
}

// const user = {firstName: 'Jan', lastName = 'User'}
const user = new Greeter('Jane',User)
console.log(user)
console.log(greeting(user))
</code></pre>
<p>ä¿®æ”¹ Feature ä¸ºæ¥å£å½¢å¼ï¼š</p>
<pre><code class="language-vue">&lt;script lang='ts'&gt;
interface Feature {
    id:number;
    name: string;
}
&lt;/script&gt;
</code></pre>
<h2 id="æ³›å‹-generics">æ³›å‹ Generics</h2>
<p>Generics æ˜¯æŒ‡åœ¨å®šä¹‰å‡½æ•°ã€æ¥å£æˆ–ç±»æ—¶ï¼Œä¸é¢„å…ˆæŒ‡å®š å…·ä½“çš„ç±»å‹ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™å†æŒ‡å®šç±»å‹çš„ä¸€ç§ç‰¹æ€§ã€‚</p>
<pre><code class="language-ts">// å®šä¹‰æ³›å‹æ¥å£
interface Result&lt;T&gt; {
    ok: 0 | 1;
    data: T[];
}

// å®šä¹‰æ³›å‹å‡½æ•°
function getData&lt;T&gt;(): Result&lt;T&gt; {
    const data: any[] = [
        { id: 1, name: 'ç±»å‹æ³¨è§£', version: '2.0' },
        { id: 2, name: 'ç¼–è¯‘å‹è¯­è¨€'}
    ];
    return { ok: 1, data }
}

// ä½¿ç”¨
this.features = getData&lt;Feature&gt;().data
</code></pre>
<p>Promiseï¼š</p>
<pre><code class="language-ts">// æ³›å‹ï¼Œè¿”å› Promise
function getData&lt;T&gt;(): Promise&lt;Result&lt;T&gt;&gt; {
    const data: any[] = [
        { id: 1, name: 'ç±»å‹æ³¨è§£', version: '2.0' },
        { id: 2, name: 'ç¼–è¯‘å‹è¯­è¨€'}
    ];
    return Promise.resolve&lt;Result&lt;T&gt;&gt;({ ok: 1, data })
}

// ä½¿ç”¨
async created() {
	this.features = (await getData&lt;Feature&gt;()).data
}
</code></pre>
<h2 id="è£…é¥°å™¨">è£…é¥°å™¨</h2>
<p>è£…é¥°å™¨å®é™…ä¸Šæ˜¯<strong>å·¥å‚å‡½æ•°</strong>ï¼Œé€šè¿‡å®šä¹‰åŠ«æŒï¼Œèƒ½å¤Ÿå¯¹ç±»åŠå…¶æ–¹æ³•ã€å±æ€§æä¾›é¢å¤–çš„æ‰©å±•åŠŸèƒ½ï¼Œä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼Œè¾“å‡ºå¤„ç†åçš„æ–°å¯¹è±¡ã€‚</p>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<pre><code class="language-ts">// ç±»è£…é¥°å™¨
@Component
export default class Hello extends Vue {
    // å±æ€§è£…é¥°å™¨
    // !è¡¨ç¤ºè¯¥å±æ€§ä¸€å®šä¼šè¢«èµ‹å€¼
    @Prop({required: true, type: String}) private msg!: string;
	
	// å‡½æ•°è£…é¥°å™¨
	// å¦‚æœ @Emit ä¸ä¼ å‚ï¼Œè¢«è£…é¥°å‡½æ•°åå³äº‹ä»¶å
	@Emit('add')
	private addFeature(event: any) {
        const feature = {
            name: event.target.value,
            id: this.features.length + 1,
            version: '1.0'
        }
        this.features.push(feature)
        event.target.value = feature
        
        return event.target.value
    }
}
</code></pre>
<h3 id="åŸç†">åŸç†</h3>
<p>è£…é¥°å™¨ä¸ºæˆ‘ä»¬åœ¨ç±»çš„å£°æ˜åŠå…¶æˆå‘˜ä¸Šé€šè¿‡<strong>å…ƒç¼–ç¨‹è¯­æ³•æ·»åŠ æ ‡æ³¨</strong>æä¾›äº†ä¸€ç§æ–¹å¼ã€‚</p>
<p>è£…é¥°å™¨æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å£°æ˜ï¼Œå®ƒèƒ½å¤Ÿè¢«é™„åŠ åˆ°ç±»å£°æ˜ã€æ–¹æ³•ã€è®¿é—®ç¬¦ï¼ˆgetterã€setterï¼‰ã€å±æ€§æˆ–å‚æ•°ä¸Šã€‚è£…é¥°å™¨ä½¿ç”¨<code>@expression</code>å½¢å¼ï¼Œ<code>expression</code>æ±‚å€¼åå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šåœ¨è¿è¡Œæ—¶è¢«è°ƒç”¨ï¼Œè¢«è£…é¥°çš„å£°æ˜ä¿¡æ¯ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<h4 id="ç±»è£…é¥°å™¨">ç±»è£…é¥°å™¨</h4>
<p>ç±»è£…é¥°å™¨åœ¨ç±»å£°æ˜ä¹‹å‰è¢«å£°æ˜ï¼ˆç´§é ç€ç±»å£°æ˜ï¼‰ã€‚ç±»è£…é¥°å™¨åº”ç”¨äºç±»æ„é€ å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥ç›‘è§†ã€ä¿®æ”¹æˆ–æ›¿æ¢ç±»å®šä¹‰ã€‚</p>
<pre><code class="language-ts">// ç±»è£…é¥°å™¨è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶å½“ä½œå‡½æ•°è¢«è°ƒç”¨ï¼Œç±»çš„æ„é€ å‡½æ•°ä½œä¸ºå…¶å”¯ä¸€çš„å‚æ•°ã€‚
function log(target: Function) {
  // target æ˜¯æ„é€ å‡½æ•°
  console.log(target === Foo); // true

  target.prototype.log = function() {
    console.log(this.bar)
  }
  // å¦‚æœè£…é¥°å™¨è¿”å›ä¸€ä¸ªå€¼ï¼Œå®ƒä¼šä½¿ç”¨æä¾›çš„æ„é€ å‡½æ•°æ¥æ›¿æ¢ç±»çš„å£°æ˜
}

@log
class Foo { 
  bar = 'bar'
}

const foo = new Foo()
foo.log()
</code></pre>
<h4 id="æ–¹æ³•è£…é¥°å™¨">æ–¹æ³•è£…é¥°å™¨</h4>
<pre><code class="language-ts">// æ–¹æ³•è£…é¥°å™¨   // æœ‰bugï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ
function log(target: any, name: string, descriptor: any) {
  // target æ˜¯åŸå‹æˆ–æ„é€ å‡½æ•°ï¼Œname æ˜¯æ–¹æ³•åï¼Œdescriptor æ˜¯å±æ€§æè¿°ç¬¦
  // æ–¹æ³•çš„å®šä¹‰æ–¹å¼ï¼šObject.defineProperty(target, name, descrriptor)
  console.log(target[name] === descriptor.value)
  // è¿™é‡Œé€šè¿‡ä¿®æ”¹ descriptor.value æ‰©å±•äº† baz æ–¹æ³•
  const baz = descriptor.value // ä¿å­˜åŸæ¥çš„æ–¹æ³•
  descriptor.value = function (val: string) {
    console.log('æˆ‘è¢«æ‰©å±•äº†')
    baz(val)
  }
  return target
}

class Foo {
  @log
  baz(val: string) {
    console.log(val)
  }
}

const foo = new Foo()
foo.baz('bbb')
</code></pre>
<h4 id="å±æ€§è£…é¥°å™¨">å±æ€§è£…é¥°å™¨</h4>
<pre><code class="language-ts">// å±æ€§è£…é¥°å™¨
function mua(target, name) {
    // target æ˜¯åŸå‹æˆ–æ„é€ å‡½æ•°ï¼Œname æ˜¯å±æ€§å
    console.log(target === Foo.prototype) // ture
    target[name] = 'mua'
}

class Foo {
    @mua mm!:string
}

const foo = new Foo()
console.log(foo.mm)
</code></pre>
<h3 id="component">@Component</h3>
<ul>
<li>ç›®æ ‡ï¼šè§£æå¾—åˆ°options</li>
</ul>
<pre><code class="language-ts">@Component({
	props: {
        mag: {
           type: String,
            default: ''
        }
    }
})
export default calss Decor extends Vue {
    // ...
}
</code></pre>
<ul>
<li>å®ç°ï¼šå·¥å‚å‡½æ•°ï¼Œç”Ÿæˆè£…é¥°å™¨</li>
</ul>
<pre><code class="language-ts">function Component(options: any) {
    return function(target: Function) {
		// è£…é¥°çš„æ—¶å€™ç±»è¿˜æ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è®¿é—®ç±»çš„åŸå‹å¯¹è±¡å’Œ description
        // å…·ä½“å°±å»çœ‹æºç å§
        
        return Vue.extend(options)
    }
}
</code></pre>
<h2 id="vuex-æ”¯æŒvuex-class">vuex æ”¯æŒï¼švuex-class</h2>
<h3 id="å®‰è£…">å®‰è£…</h3>
<pre><code>npm i vuex-class -S
</code></pre>
<h3 id="å®šä¹‰">å®šä¹‰</h3>
<p>store.js</p>
<pre><code class="language-ts">export default new Vuex.Store({
    state: {
        features: ['ç±»å‹æ£€æµ‹', 'é¢„ç¼–è¯‘']
    },
    mutations: {
        addFeatureMutation(state: any, featureName: string) {
            state.features.push({ 
                id: state.features.length + 1, 
                name: featureName
            })
        }
    },
    actions: {
    	addFeatureAction({ commit }, featureName: string) {
            commit('addFeatureMutation', featureName)
        }
	}
})
</code></pre>
<h3 id="ä½¿ç”¨-2">ä½¿ç”¨</h3>
<p>Hello.vue</p>
<pre><code class="language-ts">import { State, Mutation, Action } from 'vuex-class'

@Component
export default Feature extends Vue {
    @State features!: string[];
    @Mutation addFeatureMutation;
    @Action addFeatureAction;
    
    private addFeature(event) {
        console.log(event);
        this.addFeatureAction(event.target.value);
        event.target.value = '';
    }
}
</code></pre>
<blockquote>
<p>å¤æ‚ç”¨ä¾‹ï¼š<a href="https://github.com/ktsn/vuex-class">vuex-class</a></p>
</blockquote>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Nuxt æ¦‚è§ˆ]]></title>
        <id>https://yuufen.com/blog/post/vY7s6sh95/</id>
        <link href="https://yuufen.com/blog/post/vY7s6sh95/">
        </link>
        <updated>2020-03-21T00:54:17.000Z</updated>
        <content type="html"><![CDATA[<h2 id="nuxt-æ¸²æŸ“æµç¨‹">nuxt æ¸²æŸ“æµç¨‹</h2>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1585740512408.png" alt="" loading="lazy"></figure>
<h2 id="å®‰è£…">å®‰è£…</h2>
<pre><code>npx create-nuxt-app &lt;é¡¹ç›®å&gt;
</code></pre>
<h2 id="è·¯ç”±è‡ªåŠ¨ç”Ÿæˆ">è·¯ç”±è‡ªåŠ¨ç”Ÿæˆ</h2>
<p>è¯¦è§ç”¨ä¾‹ä¸æ–‡æ¡£</p>
<h3 id="åŠ¨æ€è·¯ç”±">åŠ¨æ€è·¯ç”±</h3>
<p>ä»¥ä¸‹åˆ’çº¿ä½œä¸ºå‰ç¼€çš„ .vueæ–‡ä»¶æˆ–ç›®å½•ä¼šè¢«å®šä¹‰ä¸ºåŠ¨æ€ï¤·ç”±ï¼Œå¦‚ä¸‹é¢æ–‡ä»¶ç»“æ„</p>
<pre><code>pages/ 
--| detail/ 
----| _id.vue
</code></pre>
<h3 id="åµŒå¥—è·¯ç”±">åµŒå¥—ï¤·ç”±</h3>
<p>åˆ›å»ºå†…åµŒå­ï¤·ç”±ï¼Œä½ éœ€è¦æ·»åŠ ä¸€ä¸ª .vue æ–‡ä»¶ï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ªä¸è¯¥æ–‡ä»¶åŒåçš„ç›®å½•ç”¨æ¥å­˜æ”¾å­è§†å›¾ç»„ä»¶ã€‚</p>
<p>æ„é€ æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>pages/ 
--| index/ 
----| _id.vue 
--| index.vue
</code></pre>
<h3 id="é»˜è®¤å¸ƒå±€">é»˜è®¤å¸ƒå±€</h3>
<p>æ·»åŠ ï¤·ç”±å¯¼èˆªï¼Œlayouts/default.vue</p>
<pre><code class="language-vue">&lt;template&gt;
  &lt;nav&gt;
    &lt;nuxt-link to=&quot;/&quot;&gt;é¦–é¡µ&lt;/nuxt-link&gt;
    &lt;!--åˆ«åï¼šn-linkï¼ŒNLinkï¼ŒNuxtLink--&gt;   
    &lt;!-- no-prefetch å–æ¶ˆé¢„åŠ è½½çš„é»˜è®¤è¡Œä¸º --&gt;
    &lt;n-link to=&quot;/admin&quot; no-prefetch&gt;ç®¡ç†&lt;/n-link&gt;
    &lt;NLink to=&quot;/cart&quot;&gt;è´­ç‰©è½¦&lt;/NLink&gt;
    &lt;nuxt /&gt;
  &lt;/nav&gt;
&lt;/template&gt;
</code></pre>
<p>ç¦ç”¨é¢„åŠ è½½ï¼š <code>&lt;n-link no-prefetch&gt;page not pre-fetched&lt;/n-link&gt;</code></p>
<h3 id="è‡ªå®šä¹‰å¸ƒå±€">è‡ªå®šä¹‰å¸ƒå±€</h3>
<p>åˆ›å»ºç©ºç™½å¸ƒå±€é¡µé¢ layouts/blank.vue ï¼Œç”¨äºlogin.vue</p>
<pre><code>&lt;template&gt;  
	&lt;div&gt;    
		&lt;nuxt /&gt;  
	&lt;/div&gt; 
&lt;/template&gt;
</code></pre>
<p>é¡µé¢ pages/login.vue ä½¿ç”¨è‡ªå®šä¹‰å¸ƒå±€ï¼š</p>
<pre><code>export default {
	layout: 'blank'
}
</code></pre>
<h3 id="è‡ªå®šä¹‰é”™è¯¯é¡µé¢">è‡ªå®šä¹‰é”™è¯¯é¡µé¢</h3>
<p>åˆ›å»ºlayouts/error.vue</p>
<pre><code class="language-vue">&lt;template&gt;
  &lt;!-- é”™è¯¯é¡µ --&gt;
  &lt;div&gt;
    &lt;h1 v-if=&quot;error.statusCode === 404&quot;&gt;é¡µé¢ä¸å­˜åœ¨&lt;/h1&gt;
    &lt;h1 v-else&gt;åº”ç”¨å‘ç”Ÿé”™è¯¯å¼‚å¸¸&lt;/h1&gt;
    &lt;p&gt;{{ error }}&lt;/p&gt;
    &lt;nuxt-link to=&quot;/&quot;&gt;é¦– é¡µ&lt;/nuxt-link&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  // æœåŠ¡å™¨ä¼šä¼ é€’ä¸€ä¸ª error å¯¹è±¡
  props: [&quot;error&quot;],
  layout: &quot;blank&quot;
};
&lt;/script&gt;
</code></pre>
<h2 id="é…ç½®">é…ç½®</h2>
<p>é¡µé¢ç»„ä»¶å°±æ˜¯ Vue ç»„ä»¶ï¼Œåªï¥§è¿‡ Nuxt.js ä¸ºè¿™äº›ç»„ä»¶æ·»åŠ ï¦ºä¸€äº›ç‰¹æ®Šçš„é…ç½®é¡¹</p>
<h3 id="head">head</h3>
<p>ç»™é¦–é¡µæ·»åŠ æ ‡é¢˜å’Œ metaï¼Œindex.vue</p>
<pre><code class="language-js">export default {
    head() {  
        return {   
            title: &quot;è¯¾ç¨‹åˆ—ï¦œè¡¨&quot;,  
            meta: [{
                name: &quot;description&quot;, 
                hid: &quot;description&quot;, 
                content: &quot;set page meta&quot; 
            }], 
            link: [{ 
                rel: &quot;favicon&quot;, 
                href: &quot;favicon.ico&quot; 
            }],  
        }; 
    },
};
</code></pre>
<h3 id="å¼‚æ­¥æ•°æ®è·å–">å¼‚æ­¥æ•°æ®è·å–</h3>
<p><code>asyncData</code> æ–¹æ³•ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨è®¾ç½®ç»„ä»¶æ•°æ®ä¹‹å‰å¼‚æ­¥è·å–å’Œå¤„ç†æ•°æ®ã€‚</p>
<p>èŒƒä¾‹ï¼šè·å–å•†å“æ•°æ®</p>
<h4 id="æ¥å£å‡†å¤‡">æ¥å£å‡†å¤‡</h4>
<ul>
<li>
<p>å®‰è£…ä¾èµ–ï¼š<code>npm i koa-router koa-bodyparser -S</code></p>
</li>
<li>
<p>åˆ›å»ºæ¥å£æ–‡ä»¶ï¼Œserver/api.js</p>
<pre><code class="language-js">const Koa = require('koa')
const app = new Koa()
const bodyparser = require('koa-bodyparser')
const router = require('koa-router'({ prefix: '/api' }))

// è®¾ç½® cookie åŠ å¯†å¯†é’¥
app.keys = ['some secret', 'another secret']

const goods = [
  { id: 1, text: 'å•†å“â… ', price: 1000 },
  { id: 2, text: 'å•†å“2', price: 2000 },
]

router.get('/goods', (ctx) =&gt; {
  ctx.body = {
    ok: 1,
    goods,
  }
})

router.get('/detail', (ctx) =&gt; {
  ctx.body = {
    ok: 1,
    data: goods.find(good.id == ctx.query.id),
  }
})

router.post('/login', (ctx) =&gt; {
  const user = ctx.request.body
  if (user.username === 'jerry' &amp;&amp; user.password === '123') {
    // å°† token å­˜å…¥ cookie
    const token = 'a mock token'
    ctx.cookies.set('token', token)
    ctx.body = { ok: 1, token }
  } else {
    ctx.body = { ok: 0 }
  }
})

// è§£æ post æ•°æ®å¹¶æ³¨å†Œè·¯ç”±
app.use(bodyparser())
app.user(router.routes())

app.listen(8080, () =&gt; console.log('api æœåŠ¡å™¨å·²å¯åŠ¨'))
</code></pre>
</li>
</ul>
<h4 id="å¼•å…¥-axios">å¼•å…¥ axios</h4>
<p>å®‰è£… @nuxt/axios æ¨¡å—ï¼š<code>npm install @nuxtjs/axios -S</code></p>
<p>é…ç½® nuxt.config.js</p>
<pre><code class="language-js">modules: [   
    '@nuxtjs/axios', 
], 

axios: {    
    proxy: true
}, 
    
proxy: {    
    &quot;/api&quot;: &quot;http://localhost:8080&quot; 
}
</code></pre>
<h4 id="æµ‹è¯•ä»£ç ">æµ‹è¯•ä»£ç </h4>
<p>index.vue</p>
<pre><code class="language-vue">&lt;script&gt; 
    export default {   
        async asyncData({ $axios, error }) {   
            const {ok, goods} = await $axios.$get(&quot;/api/goods&quot;); 
            if (ok) {          
                return { goods };     
            }        
            // é”™è¯¯å¤„ç†ï§¤      
            error({ statusCode: 400, message: &quot;æ•°æ®æŸ¥è¯¢å¤±è´¥&quot; }); 
        }, 
    } 
&lt;/script&gt;
</code></pre>
<h2 id="ä¸­é—´ä»¶">ä¸­é—´ä»¶</h2>
<p>ä¸­é—´ä»¶ä¼šåœ¨ä¸€ä¸ªé¡µé¢æˆ–ä¸€ç»„é¡µé¢æ¸²æŸ“ä¹‹å‰è¿è¡Œæˆ‘ä»¬å®šä¹‰çš„å‡½æ•°ï¼Œå¸¸ç”¨äºæƒé™æ§åˆ¶ã€æ ¡éªŒç­‰ä»»åŠ¡ã€‚</p>
<h3 id="ç®¡ç†å‘˜ä¿æŠ¤é¡µé¢">ç®¡ç†å‘˜ä¿æŠ¤é¡µé¢</h3>
<ul>
<li>
<p>åˆ›å»ºmiddleware/auth.js</p>
<pre><code class="language-js">export default function({ route, redirect, store }) {
  // å¦‚æœæ²¡æœ‰ tokenï¼Œåˆ™é‡å®šå‘åˆ° login
  // vuex å­˜åœ¨æµè§ˆå™¨çš„å†…å­˜ä¸­ï¼Œåˆ·æ–°åæ¸…ç©º
  // æ‰€ä»¥åˆ·æ–°æ—¶éœ€è¦åœ¨æœåŠ¡ç«¯é‡æ–°å°† token å¡«å……åˆ° vuex ä¸­ï¼ˆå¦‚æœå­˜åœ¨tokenï¼‰
  // é€‚åˆåœ¨ nuxtServerInit é’©å­ä¸­å®Œæˆä¸Šé¢è¿™ä¸€æ­¥
  if (!store.state.user.token) {
    redirect(&quot;/login?redirect=&quot; + route.path);
  }
}
</code></pre>
</li>
<li>
<p>æ³¨å†Œä¸­é—´ä»¶ï¼Œadmin.vue</p>
<pre><code class="language-vue">&lt;script&gt;    
    export default { 
        middleware: ['auth'] 
    }
&lt;/script&gt;
</code></pre>
</li>
</ul>
<h2 id="çŠ¶æ€ç®¡ç†-vuex">çŠ¶æ€ç®¡ç† vuex</h2>
<p>åº”ç”¨æ ¹ç›®å½•ä¸‹å¦‚æœå­˜åœ¨ <code>store</code> ç›®å½•ï¼ŒNuxt.js å°†å¯ç”¨ vuex çŠ¶æ€æ•°</p>
<h3 id="ç”¨æˆ·ç™»å½•ä»¥åŠç™»å½•çŠ¶æ€ä¿å­˜">ç”¨æˆ·ç™»å½•ä»¥åŠç™»å½•çŠ¶æ€ä¿å­˜</h3>
<ul>
<li>
<p>åˆ›å»º store/user.js</p>
<pre><code class="language-js">export const state = () =&gt; ({
    token: '' 
});

export const mutations = {  
    init(state, token) { 
        state.token = token; 
    }
};

export const getters = { 
    isLogin(state) {  
        return !!state.token; 
    } 
};

export const actions = { 
    login({ commit, getters }, u) {  
        return this.$login(u).then(({ token }) =&gt; {  
            if (token) {     
                commit(&quot;SET_TOKEN&quot;, token);  
            }   
            return getters.isLogin; 
        });
    } 
};
</code></pre>
</li>
<li>
<p>ä½¿ç”¨</p>
</li>
</ul>
<pre><code class="language-ts">@state 
</code></pre>
<h3 id="nuxtserverinit-é’©å­">nuxtServerInit é’©å­</h3>
<p>é€šè¿‡åœ¨ store çš„æ ¹æ¨¡å—ä¸­å®šä¹‰ <code>nuxtServerInit</code> æ–¹æ³•ï¼Œå°†æœåŠ¡ç«¯çš„ä¸€äº›æ•°æ®ä¼ åˆ°å®¢æˆ·ç«¯ã€‚</p>
<ul>
<li>å®‰è£…ä¾èµ–æ¨¡å—ï¼š<code>npm i cookie-universal-nuxt</code></li>
<li>æ³¨å†Œï¼š<code>modules: [&quot;cookie-universal-nuxt&quot;]</code></li>
</ul>
<p>ç™»å½•çŠ¶æ€åˆå§‹åŒ–ï¼šstore/index.js</p>
<pre><code class="language-js">export const actions = {  
    nuxtServerInit({ commit }, { app }) {   
        const token = app.$cookies.get(&quot;token&quot;); 
        if (token) {      
            console.log(&quot;nuxtServerInit: token:&quot;+token); 
            commit(&quot;user/SET_TOKEN&quot;, token);  
        }
    } 
};
</code></pre>
<h2 id="æ’ä»¶">æ’ä»¶</h2>
<p>Nuxt.js ä¼šåœ¨è¿è¡Œåº”ç”¨ä¹‹å‰æ‰§è¡Œæ’ä»¶å‡½æ•°ï¼Œéœ€è¦å¼•å…¥æˆ–è®¾ç½® Vue æ’ä»¶ã€è‡ªå®šä¹‰æ¨¡å—å’Œç¬¬ä¸‰æ–¹æ¨¡å—æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<h3 id="æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨é™„åŠ token">æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨é™„åŠ token</h3>
<ul>
<li>
<p>åˆ›å»º plugins/interceptor.js</p>
<pre><code class="language-js">export default function({ $axios, store }) {  
    $axios.onRequest(config =&gt; {   
        if (store.state.user.token) {  
            config.headers.Authorization = &quot;Bearer &quot; + store.state.user.token;
        }    
        return config; 
    }); 
}
</code></pre>
</li>
<li>
<p>æ³¨å†Œæ’ä»¶ nuxt.config.js</p>
<pre><code class="language-js">plugins: [&quot;@/plugins/interceptor&quot;]
</code></pre>
</li>
</ul>
<h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<h3 id="æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨éƒ¨ç½²">æœåŠ¡ç«¯æ¸²æŸ“åº”ç”¨éƒ¨ç½²</h3>
<pre><code>npm run build
npm start
</code></pre>
<h3 id="é™æ€åº”ç”¨éƒ¨ç½²">é™æ€åº”ç”¨éƒ¨ç½²</h3>
<p>Nuxt.js å¯ä¾æ®è·¯ç”±é…ç½®å°†åº”ç”¨é™æ€åŒ–ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å°†åº”ç”¨éƒ¨ç½²è‡³ä»»æ„ä¸€ä¸ªé™æ€ç«™ç‚¹ä¸»æœºæœåŠ¡å•†ã€‚</p>
<pre><code>npm run generate
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue æµ‹è¯•]]></title>
        <id>https://yuufen.com/blog/post/VkzI4KJ9x/</id>
        <link href="https://yuufen.com/blog/post/VkzI4KJ9x/">
        </link>
        <updated>2020-03-16T01:03:54.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æµ‹è¯•åˆ†ç±»">æµ‹è¯•åˆ†ç±»</h2>
<ul>
<li>é»‘ç›’æµ‹è¯•
<ul>
<li><strong>E2E æµ‹è¯•</strong>ï¼Œè®¾è®¡ N ä¸ªç”¨ä¾‹ï¼Œæµ‹è¯•æŸä¸ªåŠŸèƒ½çš„æ­£ç¡®æ€§</li>
<li><strong>é›†æˆæµ‹è¯•</strong>ï¼Œé›†åˆå¤šä¸ªæµ‹è¯•è¿‡çš„å•å…ƒä¸€èµ·æµ‹è¯•</li>
</ul>
</li>
<li>ç™½ç›’æµ‹è¯•
<ul>
<li><strong>å•å…ƒæµ‹è¯•</strong>ï¼Œå¦‚é’ˆå¯¹ä¸€äº›å†…éƒ¨æ ¸å¿ƒå®ç°é€»è¾‘ç¼–å†™æµ‹è¯•ä»£ç </li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1584914075235.png" alt="" loading="lazy"></figure>
<h2 id="ä¸ºä»€ä¹ˆè¦ç¼–å†™æµ‹è¯•ä»£ç ">ä¸ºä»€ä¹ˆè¦ç¼–å†™æµ‹è¯•ä»£ç </h2>
<ul>
<li>æä¾›æè¿°ç»„ä»¶è¡Œä¸ºçš„æ–‡æ¡£</li>
<li>èŠ‚çœæ‰‹åŠ¨æµ‹è¯•çš„æ—¶é—´</li>
<li>å‡å°‘ç ”å‘æ–°ç‰¹æ€§æ—¶äº§ç”Ÿçš„ bug</li>
<li>æ”¹è¿›è®¾è®¡</li>
<li>ä¿ƒè¿›é‡æ„</li>
</ul>
<h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2>
<p>è¦å®Œæˆæµ‹è¯•ä»»åŠ¡ï¼Œéœ€è¦æµ‹è¯•æ¡†æ¶ï¼ˆè¿è¡Œæµ‹è¯•ä»£ç ï¼Œå¦‚ Mochaï¼‰ã€ æ–­è¨€åº“ï¼ˆç¼–å†™æµ‹è¯•ä»£ç ï¼Œå¦‚ Chaiï¼‰å’Œç¼–ç¨‹æ¡†æ¶ç‰¹æœ‰çš„æµ‹è¯•å¥—ä»¶ã€‚Vue ä¸­çš„ç»„ä»¶ç­‰æµ‹è¯•ä»£ç çš„ç¼–å†™éœ€è¦ <a href="https://vue-test-utils.vuejs.org/zh/">vue-text-utils</a> å¥—ä»¶æ”¯æŒã€‚</p>
<p>Jest åŒæ—¶åŒ…å«æµ‹è¯•æ¡†æ¶ä¸æ–­è¨€åº“ï¼Œæ‰€ä»¥æ¼”ç¤ºä»£ç ä½¿ç”¨ Jestï¼Œä½†æ˜¯å®ƒä»¬çš„è¯­æ³•åŸºæœ¬ä¸€è‡´ã€‚</p>
<h3 id="æ–°å»º-vue-é¡¹ç›®æ—¶é›†æˆ">æ–°å»º vue é¡¹ç›®æ—¶é›†æˆ</h3>
<p>é€‰æ‹©ç‰¹æ€§ <code>Unit Testing</code> å’Œ <code>E2E Testing</code></p>
<figure data-type="image" tabindex="2"><img src="https://yuufen.com/blog/post-images/1584924220583.png" alt="" loading="lazy"></figure>
<p>å•å…ƒæµ‹è¯•è§£å†³æ–¹æ¡ˆé€‰æ‹© <code>Jest</code></p>
<figure data-type="image" tabindex="3"><img src="https://yuufen.com/blog/post-images/1584924289071.png" alt="" loading="lazy"></figure>
<p>ç«¯åˆ°ç«¯æµ‹è¯•è§£å†³æ–¹æ¡ˆé€‰æ‹© <code>Cypress</code></p>
<figure data-type="image" tabindex="4"><img src="https://yuufen.com/blog/post-images/1584924306319.png" alt="" loading="lazy"></figure>
<h3 id="åœ¨å·²å­˜åœ¨é¡¹ç›®ä¸­é›†æˆ">åœ¨å·²å­˜åœ¨é¡¹ç›®ä¸­é›†æˆ</h3>
<p>è¿è¡Œ <code>vue add @vue/unit-jest</code> å’Œ <code>vue add @vue/e2e-cypress</code></p>
<h2 id="ç¼–å†™å•å…ƒæµ‹è¯•">ç¼–å†™å•å…ƒæµ‹è¯•</h2>
<p>å•å…ƒæµ‹è¯•ï¼ˆunit testingï¼‰ï¼Œæ˜¯æŒ‡å¯¹è½¯ä»¶ä¸­æœ€å°å¯æµ‹è¯•å•å…ƒè¿›è¡Œæ£€æŸ¥å’ŒéªŒè¯ã€‚</p>
<ul>
<li>test/unit/demo.spec.jsï¼ˆ<code>*.spec.js</code> æ˜¯å‘½åè§„èŒƒï¼‰</li>
</ul>
<pre><code class="language-js">function add(num1, num2) {
  return num1 + num2
}

// æµ‹è¯•å¥—ä»¶ test suite
describe('demo', () =&gt; {
  // æµ‹è¯•ç”¨ä¾‹ test case
  it('æµ‹è¯• add å‡½æ•°', () =&gt; {
    // æ–­è¨€ assert
    expect(add(1,3)).toBe(3)
    expect(add('str',4)).toBe(5)
    expect(add(1,3)).toBe(4)
  })
}) 
</code></pre>
<ul>
<li><code>yarn test:unit</code></li>
</ul>
<h3 id="æ–­è¨€-api-ç®€ä»‹">æ–­è¨€ API ç®€ä»‹</h3>
<ul>
<li>
<p><code>describe</code>ï¼šå®šä¹‰æµ‹è¯•å¥—ä»¶</p>
</li>
<li>
<p><code>it</code>ï¼šå®šä¹‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹</p>
</li>
<li>
<p><code>expect</code>ï¼šæ–­è¨€çš„åˆ¤æ–­æ¡ä»¶</p>
<blockquote>
<p><a href="https://jestjs.io/docs/zh-Hans/expect">æ›´å¤šæ–­è¨€ API</a></p>
</blockquote>
</li>
</ul>
<h3 id="æµ‹è¯•-vue-ç»„ä»¶">æµ‹è¯• Vue ç»„ä»¶</h3>
<ul>
<li>åˆ›å»ºä¸€ä¸ª vue ç»„ä»¶ components/testDemo.vue</li>
</ul>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div&gt;
    &lt;span&gt;{{ message }}&lt;/span&gt; &lt;button @click=&quot;changeMsg&quot;&gt;ç‚¹å‡»&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
export default {
  data() {
    return { message: 'vue-text' }
  },
  created() {
    this.message = 'Demo'
  },
  methods: {
    changeMsg() {
      this.message = 'æŒ‰é’®ç‚¹å‡»'
    },
  },
}
&lt;/script&gt;
</code></pre>
<ul>
<li>tests/unit/compDemo.spec.js</li>
</ul>
<pre><code class="language-js">import Vue from 'vue'
import TestDemo from '@/components/TestDemo.vue'

import { mount } from '@vue/test-utils'

describe('TestDemo', () =&gt; {
  // åŸå§‹å†™æ³•ï¼š

  // æ£€æŸ¥åŸå§‹ç»„ä»¶é€‰é¡¹
  it('å­˜åœ¨ created ç”Ÿå‘½å‘¨æœŸ', () =&gt; {
    expect(typeof TestDemo.created).toBe('function')
  })

  // è¯„ä¼°åŸå§‹ç»„ä»¶é€‰é¡¹ä¸­çš„å‡½æ•°çš„ç»“æœ
  it('åˆå§‹ data æ˜¯ vue-text', () =&gt; {
    // æ£€æŸ¥ data å‡½æ•°å­˜åœ¨æ€§
    expect(typeof TestDemo.data).toBe('function')
    // æ£€æŸ¥ data è¿”å›çš„é»˜è®¤å€¼
    const defaultData = TestDemo.data()
    expect(defaultData.message).toBe('Hello!')
  })

  it('mount ä¹‹å data.message æ˜¯ Demo', () =&gt; {
    const vm = new Vue(TestDemo).$mount()
    expect(vm.message).toBe('Demo')
  })

  // ä½¿ç”¨ vue test utilsï¼š
    
  it('æŒ‰é’®ç‚¹å‡»å', () =&gt; {
    // æŒ‚è½½ç»„ä»¶
    const wrapper = mount(TestDemo)
    // æŸ¥æ‰¾å…ƒç´ ï¼Œè§¦å‘äº‹ä»¶
    wrapper.find('button').trigger('click')
    // æµ‹è¯•æ•°æ®å˜åŒ–
    expect(wrapper.vm.message).toBe('æŒ‰é’®ç‚¹å‡»')
    // æµ‹è¯• html æ¸²æŸ“ç»“æœ
    expect(wrapper.find('span').html()).toBe('&lt;span&gt;æŒ‰é’®ç‚¹å‡»&lt;/span&gt;')
    // ç­‰æ•ˆçš„æ–¹å¼
    expect(wrapper.find('span').text()).toBe('æŒ‰é’®ç‚¹å‡»')
  })
})
</code></pre>
<h3 id="æµ‹è¯•è¦†ç›–ç‡">æµ‹è¯•è¦†ç›–ç‡</h3>
<p>åœ¨jest.conï¬g.jsä¸­æ·»åŠ </p>
<pre><code class="language-js">module.exports = {
  collectCoverage: true,
  collectCoverageFrom: ['src/**/*.{js,vue}'],
}
</code></pre>
<p>æ‰§è¡Œ <code>yarn test:unit</code>ï¼Œå³å¯çœ‹åˆ°æµ‹è¯•è¦†ç›–ç‡ï¼š</p>
<figure data-type="image" tabindex="5"><img src="https://yuufen.com/blog/post-images/1585008205915.png" alt="" loading="lazy"></figure>
<blockquote>
<p><code>%Stmts</code> - è¯­å¥è¦†ç›–ç‡ï¼ˆstatement coverageï¼‰ï¼šæ˜¯ä¸æ˜¯æ¯ä¸ªè¯­å¥éƒ½æ‰§è¡Œäº†ï¼Ÿ<br>
<code>%Branch</code> - åˆ†æ”¯è¦†ç›–ç‡ï¼ˆbranch coverageï¼‰ï¼šæ˜¯ä¸æ˜¯æ¯ä¸ª if ä»£ç å—éƒ½æ‰§è¡Œäº†ï¼Ÿ<br>
<code>%Funcs</code> - å‡½æ•°è¦†ç›–ç‡ï¼ˆfunction coverageï¼‰ï¼šæ˜¯ä¸æ˜¯æ¯ä¸ªå‡½æ•°éƒ½è°ƒç”¨è¿‡äº†ï¼Ÿ<br>
<code>%Lines</code> - è¡Œè¦†ç›–ç‡ï¼ˆline coverageï¼‰ï¼šæ˜¯ä¸æ˜¯æ¯ä¸€è¡Œéƒ½æ‰§è¡Œäº†ï¼Ÿ</p>
</blockquote>
<h3 id="e2e-æµ‹è¯•">E2E æµ‹è¯•</h3>
<p>å€Ÿç”¨æµè§ˆï¨¸çš„èƒ½ï¦Šï¼Œç«™åœ¨ç”¨æˆ·æµ‹è¯•äººå‘˜çš„è§’åº¦ï¼Œè¾“å…¥æ¡†ï¼Œç‚¹å‡»æŒ‰é’®ç­‰ï¼Œå®Œå…¨æ¨¡æ‹Ÿç”¨æˆ·ï¼Œè¿™ä¸ªå’Œå…·ä½“çš„æ¡†æ¶å…³ç³»ï¥§â¼¤ï¼Œå®Œå…¨æ¨¡æ‹Ÿæµè§ˆï¨¸ï¨ˆä¸ºã€‚</p>
<ul>
<li>ä¿®æ”¹ tests/e2e/spec/test.js</li>
</ul>
<pre><code class="language-js">// https://docs.cypress.io/api/introduction/api.html
describe('ç«¯åˆ°ç«¯æµ‹è¯•ï¼ŒæŠ¢æµ‹è¯•â¼ˆäººå‘˜çš„é¥­ç¢—', () =&gt; {
  it('å…ˆè®¿é—®â¼€ä¸€ä¸‹', () =&gt; {
    cy.visit('/')
    // cy.contains('h1', 'Welcome to Your Vue.js App')
    cy.contains('span', 'Demo')
  })
})
</code></pre>
<p>æµ‹è¯•æœªé€šè¿‡ï¼Œå› ä¸ºæ²¡æœ‰ä½¿ç”¨ TestDemo.vueï¼Œä¿®æ”¹ App.vue</p>
<pre><code class="language-vue">&lt;div id=&quot;app&quot;&gt;   
  &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt; 
  &lt;test-demo&gt;&lt;/test-demo&gt; 
&lt;/div&gt;

import Kaikeba from './components/Kaikeba.vue' 
export default { 
  name: 'app', 
  components: { 
    HelloWorld,Kaikeba
  } 
}
</code></pre>
<figure data-type="image" tabindex="6"><img src="https://yuufen.com/blog/post-images/1585012934606.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue ä¸­çš„æ•°æ®äº¤äº’]]></title>
        <id>https://yuufen.com/blog/post/LR9CET7_-/</id>
        <link href="https://yuufen.com/blog/post/LR9CET7_-/">
        </link>
        <updated>2020-03-14T19:13:16.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å°è£…-request-api">å°è£… request / api</h2>
<p>api service =&gt; request =&gt; local mock / easy-mock / service api</p>
<blockquote>
<p>ä¸»è¦é—®é¢˜åˆ†æï¼š</p>
<ol>
<li>æœ‰æ—¶éœ€è¦è¯·æ±‚å¤´ã€å“åº”ï¼Œè¿›è¡Œç»Ÿä¸€é¢„å¤„ç†</li>
<li>è¯·æ±‚ä¸åŒæ•°æ®æºæ—¶ url ä¼šå˜åŒ–ï¼Œéœ€è¦èƒ½æ ¹æ®ç¯å¢ƒè‡ªåŠ¨ä¿®æ”¹url</li>
<li>å¯èƒ½å‡ºç°çš„è·¨åŸŸé—®é¢˜</li>
</ol>
</blockquote>
<h3 id="srcutilsrequestjs">src/utils/request.js</h3>
<pre><code class="language-js">import axios from 'axios'
import { MessageBox, Message } from 'element-ui'
import store from '@/store'
import { getToken } from '@/utils/auth'

// åˆ›å»º axios å®ä¾‹
const service = axios.create({
  baseURL: process.env.VUE_APP_BASE_API, // url åŸºç¡€åœ°å€ï¼Œè§£å†³ä¸åŒæ•°æ®æº url å˜åŒ–é—®é¢˜
  // withCredentials: true, // è·¨åŸŸæ—¶è‹¥è¦å‘é€ cookie éœ€è®¾ç½®è¯¥é¡¹
  timeout: 5000, // è¶…æ—¶
})

// è¯·æ±‚æ‹¦æˆª
service.interceptors.request.use(
  (config) =&gt; {
    // do something

    if (store.getters.token) {
      // è®¾ç½®ä»¤ç‰Œè¯·æ±‚å¤´
      // åç«¯é‡‡ç”¨é»˜è®¤é…ç½®ï¼ˆè§„èŒƒ: http://www.rfcreader.com/#rfc6750_line188ï¼‰ï¼š
      config.headers['Authorization'] = 'Bearer' + getToken()
      // // åç«¯è‡ªå®šä¹‰å¦‚ï¼š
      // config.headers['x-token'] = getToken()
    }
    return config
  },
  (error) =&gt; {
    // è¯·æ±‚é”™è¯¯é¢„å¤„ç†
    // console.log(error) // for debug
    return Promise.reject(error)
  },
)

// å“åº”æ‹¦æˆª
service.interceptors.response.use(
  // é€šè¿‡è‡ªå®šä¹‰ code åˆ¤æ–­å“åº”çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ HTTP çŠ¶æ€ç åˆ¤å®š
  (response) =&gt; {
    // ä»…è¿”å›æ•°æ®éƒ¨åˆ†
    const res = response.data
    // ä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€ç åˆ¤æ–­é”™è¯¯ï¼š
    // code ä¸ä¸º 1 åˆ™åˆ¤å®šä¸ºé”™è¯¯
    if (res.code !== 1) {
      Message({
        message: res.message || 'Error',
        type: 'error',
        duration: 5 * 1000,
      })

      // å‡è®¾ï¼š10008-éæ³•ä»¤ç‰Œï¼›10012-å…¶ä»–å®¢æˆ·ç«¯å·²ç™»å½•ï¼›10014-ä»¤ç‰Œè¿‡æœŸ
      if (res.code === 10008 || res.code === 10012 || res.code === 10014) {
        MessageBox.confirm('ç™»é™†çŠ¶æ€å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•', 'ç¡®è®¤ç™»å½•ä¿¡æ¯', {
          confirmButtonText: 'é‡æ–°ç™»é™†',
          cancelButtonText: 'å–æ¶ˆ',
          type: 'warning',
        }).then(() =&gt; {
          store.dispatch('user/resetToken').then(() =&gt; {
            location.reload()
          })
        })
      }
      return Promise.reject(new Error(res.message || 'Error'))
    } else {
      return res
    }
  },
  (error) =&gt; {
    // ä½¿ç”¨é”™è¯¯ç ï¼š
    Message({
      message: error.message,
      type: 'error',
      duration: 5 * 1000,
    })
  },
)

export default service
</code></pre>
<h3 id="srcapiuserjs">src/api/user.js</h3>
<pre><code class="language-js">import request from '@/utils/request'

export function login(data) {
  return request({
    url: '/user/login',
    methods: 'post',
    data,
  })
}

export function getInfo() {
  return request({
    url: '/user/info',
    methods: 'get',
  })
}
</code></pre>
<h3 id="srcstoreuserjs">src/store/user.js</h3>
<pre><code class="language-js">  getters: {
    roles: (state) =&gt; state.user.roles,
+   token: (state) =&gt; state.user.token,
    permission_routes: (state) =&gt; state.permission.routes,
  },
</code></pre>
<h3 id="srcstoreuserjs-2">src/store/user.js</h3>
<pre><code class="language-js">import { login, getInfo } from '@/api/user'

const actions = {
  // user login
  login({ commit }, userInfo) {
    // è°ƒç”¨æ¥å£ï¼Œå¹¶å¤„ç†ç»“æœï¼Œé”™è¯¯å¤„ç†å·²æ‹¦æˆªæ‰€ä»¥æ— éœ€å¤„ç†
    return login(userInfo).then((res) =&gt; {
      commit('SET_TOKEN', res.data)
      setToken(res.data)
    })
  },
  // get user info
  getInfo({ commit, state }) {
    return getInfo().then(({ data: roles }) =&gt; {
      commit('SET_ROLES', roles)
      return { roles }
    })
  },
</code></pre>
<h2 id="mock">mock</h2>
<h3 id="æœ¬åœ°-mock">æœ¬åœ° mock</h3>
<p>vue.config.js</p>
<pre><code class="language-js">// å¤„ç† post è¯·æ±‚å‚æ•°
const bodyParser = require('body-parser')

// ...

module.exports = {
  publicPath: '/practice',
  devServer: {
    port,
    // é…ç½® mock æ¥å£
    // app æ˜¯ express çš„å®ä¾‹
    before: (app) =&gt; {
      // æ³¨å†Œä¸­é—´ä»¶ï¼Œå¤„ç† post å‚æ•°
      app.use(bodyParser.json())

      app.post('/dev-api/user/login', (req, res) =&gt; {
        const { username } = req.body

        if (username === 'admin' || username === 'jerry') {
          res.json({
            code: 1,
            data: username,
          })
        } else {
          res.json({
            code: 10204,
            message: 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯',
          })
        }
      })

      // get ä¹‹å‰éœ€è¦ä¸€ä¸ªä¸­é—´ä»¶æ¥åˆ¤æ–­ token åˆæ³•æ€§ï¼Œè¿™é‡Œæ²¡å†™
      app.get('/dev-api/user/info', (req, res) =&gt; {
        const auth = req.headers['authorization']
        const roles = auth.split(' ')[1] === 'admin' ? ['admin'] : ['editor']
        res.json({
          code: 1,
          data: roles,
        })
      })
    },
  },
    
  // ...
</code></pre>
<h3 id="easy-mock">easy-mock</h3>
<p><a href="easy-mock.com">é¡¹ç›®åœ°å€</a></p>
<h2 id="è§£å†³è·¨åŸŸ">è§£å†³è·¨åŸŸ</h2>
<blockquote>
<p>å¦‚æœè¯·æ±‚çš„æ¥å£åœ¨å¦ä¸€å°æœåŠ¡ï¨¸ä¸Šï¼Œå¼€å‘æ—¶åˆ™éœ€è¦åœ¨æœ¬åœ°è®¾ç½®ä»£ï§¤æœåŠ¡å™¨ï¼Œé¿å…è·¨åŸŸé—®é¢˜</p>
</blockquote>
<h3 id="é…ç½®ä»£ç†-vueconfigjs">é…ç½®ä»£ç† vue.config.js</h3>
<pre><code class="language-js">const port = 7070
const title = 'Vue Learning Record'

const path = require('path')
// å°†ä¼ å…¥çš„ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ï¼Œè·¨å¹³å°
function resolve(dir) {
  return path.join(__dirname, dir)
}

module.exports = {
  publicPath: '/practice',
  devServer: {
    port,
    // å¦‚æœè¯·æ±‚çš„æ¥å£åœ¨å¦ä¸€å°æœåŠ¡ï¨¸ä¸Šï¼Œå¼€å‘æ—¶åˆ™éœ€è¦è®¾ç½®ä»£ï§¤é¿å…è·¨åŸŸé—®é¢˜
    proxy: {
      // ä»£ç† /dev-api/user/login åˆ° http://127.0.0.1:3000/user/login
      // è¯·æ±‚çš„è¿˜æ˜¯ http://localhost:7070/..ï¼Œä¹‹åçš„ä»£ç†è½¬å‘æµè§ˆå™¨ä¸å¯çŸ¥
      // ä»£ç†è½¬å‘å‘ç”Ÿåœ¨ before ä¹‹åï¼Œæ‰€ä»¥ä¼šè¢« before æ‹¦æˆªï¼Œæ‰€ä»¥è¿™ä¿©äº’æ–¥ 
      // å½“ä½¿ç”¨ç»å¯¹è·¯å¾„æ—¶ï¼Œä»£ç†ä¸ç”Ÿæ•ˆ
      [process.env.VUE_APP_BASE_API]: {
        target: `http://127.0.0.1:3000/`,
        changeOrigin: true,  
        pathRewrite: { // dev-api/user/login =&gt; /user/login
          ['^' + process.env.VUE_APP_BASE_API]: ''
        }
        
      }
    },
      
    // ..
</code></pre>
<h3 id="åˆ›å»ºä¸€ä¸ªç‹¬ç«‹æ¥å£æœåŠ¡å™¨~serverindexjs">åˆ›å»ºä¸€ä¸ªç‹¬ç«‹æ¥å£æœåŠ¡ï¨¸ï¼Œ~/server/index.js</h3>
<pre><code class="language-js">const express = require('express')
const app = express()
const bodyParser = require('body-parser')

app.use(bodyParser.json())
app.use(
  bodyParser.urlencoded({
    extended: true,
  }),
)

app.post('/user/login', (req, res) =&gt; {
  const { username } = req.body
  if (username === 'admin' || username === 'jerry') {
    res.json({
      code: 1,
      data: username,
    })
  } else {
    res.json({
      code: 10204,
      message: 'â½¤ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯',
    })
  }
})

app.get('/user/info', (req, res) =&gt; {
  const roles = req.headers['authorization'].split(' ')[1] ? ['admin'] : ['editor']
  res.json({ code: 1, data: roles })
})

app.listen(3000)
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åŠ¨æ€å¯¼èˆªèœå•ç»„ä»¶]]></title>
        <id>https://yuufen.com/blog/post/SZ8FawuZz/</id>
        <link href="https://yuufen.com/blog/post/SZ8FawuZz/">
        </link>
        <updated>2020-03-13T20:50:11.000Z</updated>
        <content type="html"><![CDATA[<h2 id="ç®€å•å®ç°">ç®€å•å®ç°</h2>
<blockquote>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ nameï¼Œä½†æ˜¯å®¹æ˜“é€ æˆå†²çªï¼Œå¹¶ä¸” name å±æ€§ä¸å¿…è¦</p>
</blockquote>
<ul>
<li>è·¯ç”±æ•°æ®æ¨¡æ¿ï¼š</li>
</ul>
<pre><code class="language-js">export const constRoutes = [
  {
    path: '/login',
    component: () =&gt; import('@/views/Login'),
    hidden: true,
  },
  {
    path: '/',
    component: Layout,
    redirect: '/home',
    meta: {
      title: 'ä¸»é¡µ',
    },
    children: [
      {
        path: 'home',
        component: () =&gt; import(/* webpackChunkName: &quot;home&quot; */ '@/views/Home'),
        name: 'Home',
        meta: {
          title: 'Home', // å¯¼èˆªèœå•é¡¹æ ‡é¢˜
          icon: 'msg', // å¯¼èˆªèœå•é¡¹å›¾æ ‡
        },
      },
    ],
  },
]
</code></pre>
<ul>
<li>src/components/SideMenu/index.vue</li>
</ul>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;ul&gt;
      &lt;item
        class=&quot;item&quot;
        v-for=&quot;route in permission_routes&quot;
        :key=&quot;route.path&quot;
        :model=&quot;route&quot;
        :base-path=&quot;route.path&quot;
      &gt;&lt;/item&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import Item from './Item'
import { mapGetters } from 'vuex'

export default {
  name: 'SideMenu',
  components: { Item },
  computed: {
    ...mapGetters(['permission_routes']),
  },
  mounted() {
    console.log(this.permission_routes)
  },
}
&lt;/script&gt;
</code></pre>
<ul>
<li>src/components/SideMenu/Item.vue</li>
</ul>
<pre><code class="language-vue">&lt;template&gt;
  &lt;!-- hidden é€‰é¡¹å­˜åœ¨åˆ™ä¸æ˜¾ç¤º --&gt;
  &lt;li v-if=&quot;!model.hidden&quot;&gt;
    &lt;div @click=&quot;toggle&quot;&gt;
      &lt;!-- å›¾æ ‡ --&gt;
      &lt;Icon v-if=&quot;model.meta &amp;&amp; model.meta.icon&quot; :icon-class=&quot;model.meta.icon&quot;&gt;&lt;/Icon&gt;
      &lt;!-- æ ‡é¢˜ --&gt;
      &lt;span v-if=&quot;isFolder&quot;&gt;
        &lt;!-- å¦‚æœæ˜¯çˆ¶èŠ‚ç‚¹ --&gt;
        &lt;span v-if=&quot;model.meta &amp;&amp; model.meta.title&quot;&gt;
          {{ model.meta.title }}
        &lt;/span&gt;
        &lt;span&gt;{{ open ? '-' : '+' }}&lt;/span&gt;
      &lt;/span&gt;
      &lt;template v-else&gt;
        &lt;!-- å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹ï¼Œæ¸²æŸ“é“¾æ¥ --&gt;
        &lt;router-link v-if=&quot;model.meta &amp;&amp; model.meta.title&quot; :to=&quot;resolvePath(model.path)&quot;&gt;
          {{ model.meta.title }}
        &lt;/router-link&gt;
      &lt;/template&gt;
    &lt;/div&gt;

    &lt;!-- å­æ ‘ï¼Œé€’å½’ç»„ä»¶ --&gt;
    &lt;ul v-show=&quot;open&quot; v-if=&quot;isFolder&quot;&gt;
      &lt;Item
        class=&quot;item&quot;
        v-for=&quot;route in model.children&quot;
        :key=&quot;route.path&quot;
        :model=&quot;route&quot;
        :base-path=&quot;resolvePath(model.path)&quot;
      &gt;&lt;/Item&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/template&gt;

&lt;script&gt;
import path from 'path'

export default {
  name: 'Item',
  props: {
    model: Object,
    basePath: {
      tpye: String,
      default: '',
    },
  },
  data() {
    return {
      open: false,
    }
  },
  computed: {
    // åˆ¤æ–­æ˜¯å¦æœ‰å­æ ‘
    isFolder: function() {
      return this.model.children &amp;&amp; this.model.children.length
    },
  },
  methods: {
    // è€ƒè™‘è·¨å¹³å°ï¼Œæ‹¼æ¥çˆ¶ path å’Œå­ path ä¸ºå®Œæ•´ path
    resolvePath(routePath) {
      return path.resolve(this.basePath, routePath)
    },
    toggle() {
      if (this.isFolder) {
        this.open = !this.open
      }
    },
  },
}
&lt;/script&gt;
</code></pre>
<ul>
<li>src/layout/index.js</li>
</ul>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div class=&quot;app-wrapper&quot;&gt;
    &lt;!-- &lt;sidebar class=&quot;sidebar-container&quot; /&gt; --&gt;
    &lt;SideMenu&gt;&lt;/SideMenu&gt;
    &lt;div class=&quot;main-container&quot;&gt;
      &lt;router-view /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import SideMenu from '@/components/SideMenu'
export default {
  components: { SideMenu },
}
&lt;/script&gt;
</code></pre>
<ul>
<li>src/store/index.js</li>
</ul>
<pre><code class="language-js">  getters: {
    roles: (state) =&gt; state.user.roles,
+   permission_routes: (state) =&gt; state.permission.routes,
  },
</code></pre>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<ul>
<li>components/Sidebar/index.vue</li>
</ul>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div&gt;
    &lt;el-scrollbar wrap-class=&quot;scrollbar-wrapper&quot;&gt;
      &lt;el-menu
        :default-active=&quot;activeMenu&quot;
        :background-color=&quot;variables.menuBg&quot;
        :text-color=&quot;variables.menuText&quot;
        :unique-opened=&quot;false&quot;
        :active-text-color=&quot;variables.menuActiveText&quot;
        :collapse-transition=&quot;false&quot;
        mode=&quot;vertical&quot;
      &gt;
        &lt;sidebar-item v-for=&quot;route in permission_routes&quot; :key=&quot;route.path&quot; :item=&quot;route&quot; :base-path=&quot;route.path&quot; /&gt;
      &lt;/el-menu&gt;
    &lt;/el-scrollbar&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import { mapGetters } from 'vuex'
import SidebarItem from './SidebarItem'
export default {
  components: { SidebarItem },
  computed: {
    ...mapGetters(['permission_routes']),
    activeMenu() {
      const route = this.$route
      const { meta, path } = route
      // é»˜è®¤æ¿€æ´»é¡¹
      if (meta.activeMenu) {
        return meta.activeMenu
      }
      return path
    },
    variables() {
      return { menuText: '#bfcbd9', menuActiveText: '#409EFF', menuBg: '#304156' }
    },
  },
}
&lt;/script&gt;
</code></pre>
<ul>
<li>layout/components/Sidebar/SidebarItem.vue</li>
</ul>
<pre><code class="language-vue">&lt;template&gt;
  &lt;div v-if=&quot;!item.hidden&quot; class=&quot;menu-wrapper&quot;&gt;
    &lt;template
      v-if=&quot;
        hasOneShowingChild(item.children, item) &amp;&amp;
          (!onlyOneChild.children || onlyOneChild.noShowingChildren) &amp;&amp;
          !item.alwaysShow
      &quot;
    &gt;
      &lt;router-link v-if=&quot;onlyOneChild.meta&quot; :to=&quot;resolvePath(onlyOneChild.path)&quot;&gt;
        &lt;el-menu-item :index=&quot;resolvePath(onlyOneChild.path)&quot; :class=&quot;{ 'submenu-title-noDropdown': !isNest }&quot;&gt;
          &lt;item :icon=&quot;onlyOneChild.meta.icon || (item.meta &amp;&amp; item.meta.icon)&quot; :title=&quot;onlyOneChild.meta.title&quot; /&gt;
        &lt;/el-menu-item&gt;
      &lt;/router-link&gt;
    &lt;/template&gt;
    &lt;el-submenu v-else ref=&quot;subMenu&quot; :index=&quot;resolvePath(item.path)&quot; popperappend-to-body&gt;
      &lt;template v-slot:title&gt;
        &lt;item v-if=&quot;item.meta&quot; :icon=&quot;item.meta &amp;&amp; item.meta.icon&quot; :title=&quot;item.meta.title&quot; /&gt;
      &lt;/template&gt;
      &lt;sidebar-item
        v-for=&quot;child in item.children&quot;
        :key=&quot;child.path&quot;
        :is-nest=&quot;true&quot;
        :item=&quot;child&quot;
        :base-path=&quot;resolvePath(child.path)&quot;
        class=&quot;nest-menu&quot;
      /&gt;
    &lt;/el-submenu&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import path from 'path'
import Item from './Item'
export default {
  name: 'SidebarItem',
  components: { Item },
  props: {
    item: { type: Object, required: true },
    isNest: { type: Boolean, default: false },
    basePath: { type: String, default: '' },
  },
  data() {
    this.onlyOneChild = null
    return {}
  },
  methods: {
    hasOneShowingChild(children = [], parent) {
      const showingChildren = children.filter((item) =&gt; {
        if (item.hidden) {
          return false
        } else {
          // å¦‚æœåªæœ‰ä¸€ä¸ªå­èœå•
          this.onlyOneChild = item
          return true
        }
      })
      // å¦‚æœåªæœ‰ä¸€ä¸ªå­è·¯ç”±ï¼Œåˆ™ä¸æ˜¾ç¤ºçˆ¶çº§
      if (showingChildren.length === 1) {
        return true
      }
      // å¦åˆ™æ˜¾ç¤ºçˆ¶çº§
      if (showingChildren.length === 0) {
        this.onlyOneChild = { ...parent, path: '', noShowingChildren: true }
        return true
      }
      return false
    },
    resolvePath(routePath) {
      return path.resolve(this.basePath, routePath)
    },
  },
}
&lt;/script&gt;

</code></pre>
<ul>
<li>layout/components/Sidebar/Item.vue</li>
</ul>
<pre><code class="language-vue">&lt;script&gt;
export default {
  name: 'MenuItem',
  functional: true,
  props: {
    icon: {
      type: String,
      default: '',
    },
    title: {
      type: String,
      default: '',
    },
  },
  render(h, context) {
    const { icon, title } = context.props
    const vnodes = []
    if (icon) {
      vnodes.push(&lt;Icon icon-class={icon} /&gt;)
    }
    if (title) {
      vnodes.push(&lt;span slot=&quot;title&quot;&gt;{title}&lt;/span&gt;)
    }
    return vnodes
  },
}
&lt;/script&gt;
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Vue ä¸­çš„æƒé™æ§åˆ¶]]></title>
        <id>https://yuufen.com/blog/post/Xoj8uZb5R/</id>
        <link href="https://yuufen.com/blog/post/Xoj8uZb5R/">
        </link>
        <updated>2020-03-13T20:40:50.000Z</updated>
        <content type="html"><![CDATA[<h2 id="è·¯ç”±æƒé™æ§åˆ¶">è·¯ç”±æƒé™æ§åˆ¶</h2>
<h3 id="1-æ¶æ„">1. æ¶æ„</h3>
<figure data-type="image" tabindex="1"><img src="https://yuufen.com/blog/post-images/1584603744487.png" alt="" loading="lazy"></figure>
<h3 id="2-å®šä¹‰è·¯ç”±">2. å®šä¹‰è·¯ç”±</h3>
<pre><code class="language-js">// src/router/index.js
import Vue from 'vue'
import Router from 'vue-router'

import Layout from '@/layout'

Vue.use(Router)

// é™æ€éƒ¨åˆ† é€šç”¨éƒ¨åˆ†
export const constRoutes = [
  {
    path: '/login',
    component: () =&gt; import('@/views/Login'),
    hidden: true,
  },
  {
    path: '/',
    component: Layout,
    redirect: '/home',
    children: [
      {
        path: 'home',
        component: () =&gt; import(/* webpackChunkName: &quot;home&quot; */ '@/views/Home'),
        name: 'Home',
        meta: {
          title: 'Home', // å¯¼èˆªèœå•é¡¹æ ‡é¢˜
          icon: 'msg', // å¯¼èˆªèœå•é¡¹å›¾æ ‡
        },
      },
    ],
  },
]

export const asyncRoutes = [
  {
    path: '/about',
    component: Layout,
    redirect: '/about/index',
    children: [
      {
        path: 'index',
        component: () =&gt; import(/* webpackChunkName: &quot;home&quot; */ '@/views/About.vue'),
        name: 'about',
        meta: {
          title: 'About',
          icon: 'img',
          // è§’è‰²
          role: ['admin', 'editor'],
        },
      },
    ],
  },
]

export default new Router({
  mode: 'history',
  base: process.env.BASE_URL,
  routes: constRoutes,
})
</code></pre>
<h3 id="3-è·¯ç”±å®ˆå«å®ŒæˆåŠ¨æ€ç”Ÿæˆè·¯ç”±ç™»å½•çš„é€»è¾‘">3. è·¯ç”±å®ˆå«ï¼šå®ŒæˆåŠ¨æ€ç”Ÿæˆè·¯ç”±ï¼ˆç™»å½•ï¼‰çš„é€»è¾‘</h3>
<pre><code class="language-js">// src/permission.js
// ç”Ÿæˆå…¨å±€è·¯ç”±
import router from './router'
import store from './store'
import { getToken } from '@/utils/auth' // ä» cookie ä¸­è·å– token

const whiteList = ['/login']

router.beforeEach(async (to, from, next) =&gt; {
  const hasToken = getToken()
  if (hasToken) {
    if (to.path === '/login') {
      next({ path: '/home' })
    } else {
      // å·²ç™»å½•ï¼Œè·å–ç”¨æˆ·è§’è‰²
      const hasRoles = store.getters.roles &amp;&amp; store.getters.roles.length &gt; 0

      if (hasRoles) {
        next()
      } else {
        // è¿™æ ·ä¼šé˜»å¡é…ç½®é‡Œçš„é‡å®šå‘
        // å…ˆè¯·æ±‚ç”¨æˆ·ä¿¡æ¯
        const { roles } = await store.dispatch('user/getInfo')
        // æ ¹æ®è§’è‰²ç”ŸæˆåŠ¨æ€è·¯ç”±
        const accessedRoutes = await store.dispatch('permission/generateRoutes', roles)
        // æ·»åŠ è‡³ router
        router.addRoutes(accessedRoutes)
        // é‡å®šå‘
        next()
      }
    }
  } else {
    if (whiteList.indexOf(to.path) !== -1) {
      next()
    } else {
      next(`/login?redirect=${to.path}`)
    }
  }
})

</code></pre>
<h3 id="4-å…·ä½“å®ç°">4. å…·ä½“å®ç°</h3>
<ul>
<li>src/utils/auth</li>
</ul>
<pre><code class="language-js">import Cookies from 'js-cookie'

const TOKEN = 'token'

export function getToken() {
  return Cookies.get(TOKEN)
}

export function setToken(token) {
  return Cookies.set(TOKEN,token)
}
export function removeToken() {
  return Cookies.remove(TOKEN)
}
</code></pre>
<ul>
<li>src/store/user.js</li>
</ul>
<pre><code class="language-js">// ç”¨æˆ·ä¿¡æ¯
import { getToken, setToken, removeToken } from '@/utils/auth'

const state = {
  token: getToken(),
  roles: [],
}

const mutations = {
  SET_TOKEN: (state, token) =&gt; {
    state.token = token
  },
  SET_ROLES: (state, roles) =&gt; {
    state.roles = roles
  },
}

const actions = {
  // user login
  login({ commit }, userInfo) {
    const { username } = userInfo
    return new Promise((resolve, reject) =&gt; {
      setTimeout(() =&gt; {
        if (username === 'admin' || username === 'jerry') {
          commit('SET_TOKEN', username)
          setToken(username)
          resolve()
        } else {
          reject('ç”¨æˆ·åä¸å­˜åœ¨')
        }
      }, 1000)
    })
  },
  // get user info
  getInfo({ commit, state }) {
    return new Promise((resolve) =&gt; {
      setTimeout(() =&gt; {
        const roles = state.token === 'admin' ? ['admin'] : ['editor']
        commit('SET_ROLES', roles)
        resolve({ roles })
      }, 1000)
    })
  },

  // remove token
  resetToken({ commit }) {
    return new Promise((resolve) =&gt; {
      commit('SET_TOKEN', '')
      commit('SET_ROLES', [])
      removeToken()
      resolve()
    })
  },
}
export default {
  namespaced: true,
  state,
  mutations,
  actions,
}
</code></pre>
<ul>
<li>src/store/permission.js</li>
</ul>
<pre><code class="language-js">// è·¯ç”±é…ç½®ä¿¡æ¯ã€è·¯ç”±ç”Ÿæˆé€»è¾‘
import { constRoutes, asyncRoutes } from '@/router'

/**
 * æ ¹æ®è·¯ç”± meta.role ç¡®å®šå½“å‰ç”¨æˆ·æ˜¯å¦å…·æœ‰è®¿é—®æƒé™
 * @roles ç”¨æˆ·çš„æ‹¥æœ‰è§’è‰²
 * @route å¾…åˆ¤æ–­è·¯ç”±
 */
function hasPermission(roles, route) {
  if (route.meta &amp;&amp; route.meta.roles) {
    // å¦‚æœå½“å‰è·¯ç”±æœ‰ roles å­—æ®µï¼Œåˆ™éœ€è¦åˆ¤æ–­ç”¨æˆ·æƒé™
    return roles.some((role) =&gt; route.meta.roles.includes(role))
  } else {
    return true
  }
}

/**
 * é€’å½’è¿‡æ»¤ AsyncRoutes è·¯ç”±è¡¨
 * @roles ç”¨æˆ·æ‹¥æœ‰çš„è§’è‰²
 * @routes å¾…è¿‡æ»¤è·¯ç”±è¡¨ï¼Œ é¦–æ¬¡ä¼ å…¥çš„å°±æ˜¯ AsyncRoutes
 */
export function filterAsyncRoutes(roles, routes) {
  const res = []
  routes.forEach((route) =&gt; {
    // å¤åˆ¶ä¸€ä»½
    const tmp = { ...route }
    // å¦‚æœç”¨æˆ·æœ‰è®¿é—®æƒé™åˆ™åŠ å…¥ç»“æœè·¯ç”±è¡¨
    if (hasPermission(roles, tmp)) {
      // å¦‚æœå­˜åœ¨å­è·¯ç”±åˆ™é€’å½’è¿‡æ»¤
      if (tmp.children) {
        tmp.children = filterAsyncRoutes(roles, tmp.children)
      }
      res.push(tmp)
    }
  })
  return res
}

const state = {
  // å®Œæ•´è·¯ç”±
  routes: [],
  // èƒ½å¤Ÿè®¿é—®çš„åŠ¨æ€è·¯ç”±
  addRoutes: [],
}

const mutations = {
  SET_ROUTES: (state, routes) =&gt; {
    state.addRoutes = routes
    state.routes = constRoutes.concat(routes)
  },
}

const actions = {
  // ç”Ÿæˆè·¯ç”±ï¼Œåœ¨å¾—åˆ°ç”¨æˆ·è§’è‰²åä¼šç¬¬ä¸€æ—¶é—´è°ƒç”¨
  generateRoutes({ commit }, roles) {
    return new Promise((resolve) =&gt; {
      let accessedRoutes
      if (roles.includes('admin')) {
        // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæœ‰å…¨éƒ¨æƒé™
        accessedRoutes = asyncRoutes || []
      } else {
        // å¦åˆ™è¿‡æ»¤
        accessedRoutes = filterAsyncRoutes(roles, asyncRoutes)
      }
      commit('SET_ROUTES', accessedRoutes)
      resolve(accessedRoutes)
    })
  },
}

export default {
  namespaced: true,
  state,
  mutations,
  actions,
}
</code></pre>
<ul>
<li>src/store/index.js</li>
</ul>
<pre><code class="language-js">import Vue from 'vue'
import Vuex from 'vuex'

import permission from './permission'
import user from './user'

Vue.use(Vuex)

export default new Vuex.Store({
  modules: {
    permission, // æƒé™
    user, // ç”¨æˆ·ä¿¡æ¯
  },
  getters: {
    roles: (state) =&gt; state.user.roles,  
  },
})
</code></pre>
<ul>
<li>ç™»å½•</li>
</ul>
<pre><code class="language-js">    login() {
      this.$store
        .dispatch('user/login', { username: this.username })
        .then(() =&gt; {
          this.$router.push({
            path: this.$route.query.redirect || '/',
          })
        })
        .catch((error) =&gt; {
          alert(error)
        })
    },
</code></pre>
<blockquote>
<p>å¦‚æœè·¯ç”±æ¥è‡ªåç«¯ï¼š</p>
<pre><code class="language-js">// å‰ç«¯ç»„ä»¶åå’Œç»„ä»¶çš„æ˜ å°„è¡¨
const map = {
    // login: require('login/index').default // åŒæ­¥
    login: () =&gt; import('login/index')       // å¼‚æ­¥
}
// æœåŠ¡ç«¯è¿”å›çš„ map ç±»ä¼¼äº
const serviceMap = [
    {path: '/login', component: 'login', hidden: true},
]
// éå† serviceMapï¼Œå°† component æ›¿æ¢ä¸º map[component]ï¼ŒåŠ¨æ€ç”Ÿæˆ asyncRoutes
function mapComponent(route) {
    route.component = map[route.component]
    if(route.children) {
		route.children = route.children.map(child =&gt; mapComponent(child))
    }
    return route
}
</code></pre>
</blockquote>
<h2 id="ç»„ä»¶æƒé™æ§åˆ¶æŒ‡ä»¤">ç»„ä»¶æƒé™æ§åˆ¶ï¼šæŒ‡ä»¤</h2>
<ul>
<li>ä½¿ç”¨</li>
</ul>
<pre><code class="language-html">    &lt;button v-permission=&quot;['admin', 'editor']&quot;&gt;editor button&lt;/button&gt;
    &lt;button v-permission=&quot;['admin']&quot;&gt;admin button&lt;/button&gt;
</code></pre>
<ul>
<li>src/directive/permission.js</li>
</ul>
<pre><code class="language-js">// v-permission=&quot;[]&quot;
// å®Œæˆä¸€ä¸ªæŒ‡ä»¤ï¼Œé€šè¿‡ä¼ é€’è¿›æ¥çš„æƒé™æ•°ç»„å’Œå½“å‰ç”¨æˆ·çš„è§’è‰²æ•°ç»„è¿›è¡Œè¿‡æ»¤
// å¦‚æœç”¨æˆ·æ‹¥æœ‰è¦æ±‚çš„è§’è‰²ï¼Œåˆ™å¯ä»¥çœ‹åˆ°

import store from '@/store'

// å¦åˆ™åˆ é™¤æŒ‡ä»¤æŒ‚é’© DOM å…ƒç´ 
export default {
  // el æŒ‚è½½çš„dom
  // binding ç»‘å®šçš„æ•°ç»„
  inserted(el, binding) {
    // è·å–å€¼
    const { value: permissionRoles } = binding
    console.log(binding)
    // è·å–ç”¨æˆ·è§’è‰²
    const roles = store.getters.roles
    // åˆæ³•æ€§åˆ¤æ–­
    if (permissionRoles &amp;&amp; permissionRoles instanceof Array &amp;&amp; permissionRoles.length &gt; 0) {
      // åˆ¤æ–­ç”¨æˆ·è§’è‰²ä¸­æ˜¯å¦æœ‰ç¬¦åˆè¦æ±‚çš„
      const hasPermission = roles.some((role) =&gt; {
        return permissionRoles.includes(role)
      })
      // å¦‚æœæ²¡æœ‰æƒé™ï¼Œåˆ™åˆ é™¤å½“å‰ DOM
      if (!hasPermission) {
        el.parentNode &amp;&amp; el.parentNode.removeChild(el)
      }
    } else {
      throw new Error('v-permission æ¥æ”¶æ•°ç»„ç±»å‹ value')
    }
  },
}

</code></pre>
<ul>
<li>main.js</li>
</ul>
<pre><code class="language-js">// æ³¨å†ŒæŒ‡ä»¤
import permission from '@/directive/permission'
Vue.directive('permission', permission)
</code></pre>
<blockquote>
<p>è¯¥æŒ‡ä»¤åªèƒ½åˆ é™¤æŒ‚è½½æŒ‡ä»¤çš„å…ƒç´ ï¼Œå…¶ä»–çš„ç›¸å…³å…ƒç´ ä¸èƒ½æŸ¥æ‰¾åˆ°ï¼Œå¦‚ el-tabs&gt;el-tab-pane</p>
<p>æ­¤æ—¶åªèƒ½ç”¨ v-if å®ç°ï¼Œå¦‚ <code>v-if=&quot;checkPermission(['admin'])&quot;</code></p>
<p>v-if åœ¨ç¼–è¯‘è¿‡ç¨‹å°±ä¼šä½“ç°ï¼Œæ‰€ä»¥å¦‚æœæ²¡æœ‰æƒé™æ ¹æœ¬ä¸ä¼šè¢«æ¸²æŸ“ï¼Œå°±ç”¨ä¸ç€å»åˆ é™¤äº†</p>
</blockquote>
]]></content>
    </entry>
</feed>